<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="robots" content="noindex, nofollow">
    <title>ëª¨ì—¬ë¼ë”œ ì˜ìƒ ìŠ¤íŠœë””ì˜¤ - ë©”íƒ€ê´‘ê³ ìš©</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Noto Sans KR', -apple-system, BlinkMacSystemFont, sans-serif;
            background: #0a0a0f;
            min-height: 100vh;
            color: white;
        }

        /* Login Screen */
        .login-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #0a0a0f;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 9999;
        }

        .login-screen.hidden {
            display: none;
        }

        .login-box {
            background: rgba(255,255,255,0.03);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 20px;
            padding: 40px;
            width: 360px;
            text-align: center;
        }

        .login-logo {
            font-size: 28px;
            font-weight: 700;
            background: linear-gradient(90deg, #00d9ff, #00ff88);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 8px;
        }

        .login-subtitle {
            font-size: 13px;
            color: #666;
            margin-bottom: 30px;
        }

        .login-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 11px;
            font-weight: 600;
            background: rgba(255,71,87,0.2);
            color: #ff6b81;
            margin-bottom: 24px;
        }

        .password-input-group {
            margin-bottom: 20px;
        }

        .password-input {
            width: 100%;
            padding: 14px 18px;
            background: rgba(255,255,255,0.05);
            border: 2px solid rgba(255,255,255,0.1);
            border-radius: 12px;
            color: white;
            font-size: 18px;
            text-align: center;
            letter-spacing: 8px;
            font-family: inherit;
            transition: all 0.3s;
        }

        .password-input:focus {
            outline: none;
            border-color: #00d9ff;
            background: rgba(0,217,255,0.05);
        }

        .password-input.error {
            border-color: #ff4757;
            animation: shake 0.5s;
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-10px); }
            75% { transform: translateX(10px); }
        }

        .login-btn {
            width: 100%;
            padding: 14px;
            background: linear-gradient(135deg, #00d9ff, #00ff88);
            border: none;
            border-radius: 12px;
            color: #000;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .login-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(0,217,255,0.3);
        }

        .login-error {
            margin-top: 16px;
            font-size: 12px;
            color: #ff6b81;
            min-height: 18px;
        }

        /* Password Change Modal */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s;
        }

        .modal-overlay.visible {
            opacity: 1;
            visibility: visible;
        }

        .modal-box {
            background: #1a1a22;
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 16px;
            padding: 30px;
            width: 360px;
            transform: scale(0.9);
            transition: all 0.3s;
        }

        .modal-overlay.visible .modal-box {
            transform: scale(1);
        }

        .modal-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 20px;
            text-align: center;
        }

        .modal-input-group {
            margin-bottom: 16px;
        }

        .modal-label {
            font-size: 12px;
            color: #888;
            margin-bottom: 6px;
            display: block;
        }

        .modal-input {
            width: 100%;
            padding: 12px 14px;
            background: rgba(255,255,255,0.05);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 8px;
            color: white;
            font-size: 14px;
            text-align: center;
            letter-spacing: 6px;
        }

        .modal-input:focus {
            outline: none;
            border-color: #00d9ff;
        }

        .modal-btns {
            display: flex;
            gap: 10px;
            margin-top: 24px;
        }

        .modal-btn {
            flex: 1;
            padding: 12px;
            border: none;
            border-radius: 8px;
            font-size: 13px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .modal-btn.cancel {
            background: rgba(255,255,255,0.1);
            color: #888;
        }

        .modal-btn.confirm {
            background: linear-gradient(135deg, #00d9ff, #00ff88);
            color: #000;
        }

        .modal-error {
            font-size: 11px;
            color: #ff6b81;
            text-align: center;
            margin-top: 12px;
            min-height: 16px;
        }

        /* Main App */
        .main-app {
            display: none;
        }

        .main-app.visible {
            display: block;
        }

        .app-header {
            background: linear-gradient(135deg, rgba(0,217,255,0.1), rgba(0,255,136,0.1));
            border-bottom: 1px solid rgba(255,255,255,0.1);
            padding: 12px 24px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .logo {
            font-size: 18px;
            font-weight: 700;
            background: linear-gradient(90deg, #00d9ff, #00ff88);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .header-right {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .badges {
            display: flex;
            gap: 8px;
        }

        .badge {
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 600;
        }

        .badge.meta {
            background: #ff4757;
            color: white;
        }

        .badge.video {
            background: #5f27cd;
            color: white;
        }

        .header-actions {
            display: flex;
            gap: 8px;
        }

        .header-btn {
            padding: 6px 12px;
            background: rgba(255,255,255,0.08);
            border: 1px solid rgba(255,255,255,0.15);
            border-radius: 8px;
            color: #aaa;
            font-size: 11px;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .header-btn:hover {
            background: rgba(255,255,255,0.12);
            color: white;
        }

        .header-btn.danger:hover {
            background: rgba(255,71,87,0.2);
            border-color: #ff4757;
            color: #ff6b81;
        }

        .app-container {
            display: flex;
            height: calc(100vh - 52px);
        }

        /* Left Sidebar */
        .sidebar-left {
            width: 260px;
            background: rgba(255,255,255,0.02);
            border-right: 1px solid rgba(255,255,255,0.1);
            padding: 16px;
            overflow-y: auto;
        }

        .sidebar-title {
            font-size: 12px;
            color: #888;
            margin-bottom: 12px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .template-grid {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .template-card {
            background: rgba(255,255,255,0.05);
            border: 2px solid transparent;
            border-radius: 10px;
            padding: 10px;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .template-card:hover {
            background: rgba(255,255,255,0.08);
            border-color: rgba(0,217,255,0.3);
        }

        .template-card.active {
            border-color: #00d9ff;
            background: rgba(0,217,255,0.1);
        }

        .template-icon {
            width: 50px;
            height: 50px;
            background: rgba(0,0,0,0.3);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
        }

        .template-info {
            flex: 1;
        }

        .template-name {
            font-size: 13px;
            font-weight: 600;
            margin-bottom: 2px;
        }

        .template-desc {
            font-size: 10px;
            color: #888;
        }

        /* Center Preview */
        .preview-area {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 16px;
            background: #0d0d12;
        }

        .canvas-container {
            position: relative;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 20px 60px rgba(0,0,0,0.5);
        }

        canvas {
            display: block;
            background: #000;
            width: 270px;
            height: 480px;
        }

        .spec-badge {
            position: absolute;
            top: 8px;
            right: 8px;
            background: rgba(0,0,0,0.7);
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 10px;
            color: #00ff88;
        }

        .controls {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 13px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .btn-play {
            background: linear-gradient(135deg, #00ff88, #00d9ff);
            color: #000;
        }

        .btn-record {
            background: linear-gradient(135deg, #ff4757, #ff6b81);
            color: white;
        }

        .btn-record.recording {
            animation: pulse 1s infinite;
        }

        @keyframes pulse {
            0%, 100% { box-shadow: 0 0 0 0 rgba(255,71,87,0.7); }
            50% { box-shadow: 0 0 0 12px rgba(255,71,87,0); }
        }

        .btn-download {
            background: linear-gradient(135deg, #5f27cd, #a55eea);
            color: white;
        }

        .btn:disabled {
            opacity: 0.4;
            cursor: not-allowed;
        }

        .status-bar {
            margin-top: 12px;
            padding: 8px 16px;
            background: rgba(255,255,255,0.05);
            border-radius: 6px;
            font-size: 12px;
            color: #888;
        }

        .status-bar.recording {
            background: rgba(255,71,87,0.2);
            color: #ff6b81;
        }

        /* Right Sidebar */
        .sidebar-right {
            width: 300px;
            background: rgba(255,255,255,0.02);
            border-left: 1px solid rgba(255,255,255,0.1);
            padding: 16px;
            overflow-y: auto;
        }

        .panel {
            background: rgba(255,255,255,0.03);
            border-radius: 10px;
            padding: 14px;
            margin-bottom: 12px;
        }

        .panel-title {
            font-size: 13px;
            font-weight: 600;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .media-slots {
            display: flex;
            flex-direction: column;
            gap: 6px;
        }

        .media-slot {
            display: flex;
            align-items: center;
            gap: 8px;
            background: rgba(255,255,255,0.03);
            padding: 6px;
            border-radius: 6px;
            border: 1px dashed rgba(255,255,255,0.15);
        }

        .media-slot.filled {
            border-color: #00ff88;
            border-style: solid;
        }

        .media-slot.video-filled {
            border-color: #a55eea;
            border-style: solid;
        }

        .slot-preview {
            width: 44px;
            height: 44px;
            border-radius: 4px;
            background: rgba(255,255,255,0.08);
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            font-size: 12px;
            color: #555;
            position: relative;
        }

        .slot-preview img,
        .slot-preview video {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .slot-preview .video-icon {
            position: absolute;
            bottom: 2px;
            right: 2px;
            background: #a55eea;
            color: white;
            font-size: 8px;
            padding: 2px 4px;
            border-radius: 3px;
        }

        .slot-info {
            flex: 1;
            min-width: 0;
        }

        .slot-label {
            font-size: 10px;
            color: #666;
        }

        .slot-name {
            font-size: 11px;
            color: #ccc;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .slot-type {
            font-size: 9px;
            padding: 2px 6px;
            border-radius: 4px;
            margin-top: 2px;
            display: inline-block;
        }

        .slot-type.image {
            background: rgba(0,255,136,0.2);
            color: #00ff88;
        }

        .slot-type.video {
            background: rgba(165,94,234,0.2);
            color: #a55eea;
        }

        .slot-btn {
            background: rgba(0,217,255,0.15);
            border: none;
            color: #00d9ff;
            padding: 4px 10px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 10px;
        }

        .slot-btn.remove {
            background: rgba(255,71,87,0.15);
            color: #ff6b81;
        }

        .input-group {
            margin-bottom: 10px;
        }

        .input-label {
            font-size: 10px;
            color: #888;
            margin-bottom: 4px;
            display: block;
        }

        .text-input {
            width: 100%;
            padding: 8px 10px;
            background: rgba(255,255,255,0.05);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 6px;
            color: white;
            font-size: 12px;
            font-family: inherit;
        }

        .text-input:focus {
            outline: none;
            border-color: #00d9ff;
        }

        .color-options {
            display: flex;
            gap: 6px;
            flex-wrap: wrap;
        }

        .color-btn {
            width: 28px;
            height: 28px;
            border-radius: 6px;
            border: 2px solid transparent;
            cursor: pointer;
            transition: all 0.2s;
        }

        .color-btn.active {
            border-color: white;
            transform: scale(1.1);
        }

        .hidden-input {
            display: none;
        }

        .tip-box {
            background: rgba(0,217,255,0.1);
            border: 1px solid rgba(0,217,255,0.2);
            border-radius: 8px;
            padding: 10px;
            font-size: 11px;
            color: #aaa;
            line-height: 1.5;
        }

        .tip-box strong {
            color: #00d9ff;
        }

        .tip-box.purple {
            background: rgba(165,94,234,0.1);
            border-color: rgba(165,94,234,0.2);
        }

        .tip-box.purple strong {
            color: #a55eea;
        }

        ::-webkit-scrollbar {
            width: 5px;
        }

        ::-webkit-scrollbar-thumb {
            background: rgba(255,255,255,0.2);
            border-radius: 3px;
        }

        .hidden-videos {
            position: absolute;
            left: -9999px;
            top: -9999px;
        }

        /* Responsive */
        @media (max-width: 1024px) {
            .sidebar-left {
                width: 200px;
            }
            .sidebar-right {
                width: 260px;
            }
        }

        @media (max-width: 768px) {
            .app-container {
                flex-direction: column;
                height: auto;
            }
            .sidebar-left, .sidebar-right {
                width: 100%;
                border: none;
                border-bottom: 1px solid rgba(255,255,255,0.1);
            }
            .preview-area {
                min-height: 500px;
            }
            .header-right {
                flex-wrap: wrap;
                gap: 8px;
            }
        }
    </style>
</head>
<body>
    <!-- Login Screen -->
    <div class="login-screen" id="loginScreen">
        <div class="login-box">
            <div class="login-logo">ğŸ¬ ëª¨ì—¬ë¼ë”œ ìŠ¤íŠœë””ì˜¤</div>
            <div class="login-subtitle">ë§ˆì¼€íŒ… & ì½˜í…ì¸  ì œì‘ì†Œ</div>
            <div class="login-badge">INTERNAL ACCESS ONLY</div>
            <div class="password-input-group">
                <input type="password" class="password-input" id="passwordInput" placeholder="****" maxlength="10" autocomplete="off">
            </div>
            <button class="login-btn" id="loginBtn">ì ‘ì†í•˜ê¸°</button>
            <div class="login-error" id="loginError"></div>
        </div>
    </div>

    <!-- Password Change Modal -->
    <div class="modal-overlay" id="pwModal">
        <div class="modal-box">
            <div class="modal-title">ë¹„ë°€ë²ˆí˜¸ ë³€ê²½</div>
            <div class="modal-input-group">
                <label class="modal-label">í˜„ì¬ ë¹„ë°€ë²ˆí˜¸</label>
                <input type="password" class="modal-input" id="currentPw" placeholder="****" maxlength="10">
            </div>
            <div class="modal-input-group">
                <label class="modal-label">ìƒˆ ë¹„ë°€ë²ˆí˜¸</label>
                <input type="password" class="modal-input" id="newPw" placeholder="****" maxlength="10">
            </div>
            <div class="modal-input-group">
                <label class="modal-label">ìƒˆ ë¹„ë°€ë²ˆí˜¸ í™•ì¸</label>
                <input type="password" class="modal-input" id="confirmPw" placeholder="****" maxlength="10">
            </div>
            <div class="modal-error" id="pwModalError"></div>
            <div class="modal-btns">
                <button class="modal-btn cancel" id="pwModalCancel">ì·¨ì†Œ</button>
                <button class="modal-btn confirm" id="pwModalConfirm">ë³€ê²½í•˜ê¸°</button>
            </div>
        </div>
    </div>

    <!-- Main App -->
    <div class="main-app" id="mainApp">
        <header class="app-header">
            <div class="logo">ğŸ¬ ëª¨ì—¬ë¼ë”œ ì˜ìƒ ìŠ¤íŠœë””ì˜¤</div>
            <div class="header-right">
                <div class="badges">
                    <div class="badge meta">META ê´‘ê³ </div>
                    <div class="badge video">ì˜ìƒ ì§€ì›</div>
                </div>
                <div class="header-actions">
                    <button class="header-btn" id="changePwBtn">ë¹„ë°€ë²ˆí˜¸ ë³€ê²½</button>
                    <button class="header-btn danger" id="logoutBtn">ë¡œê·¸ì•„ì›ƒ</button>
                </div>
            </div>
        </header>

        <div class="app-container">
            <!-- Left Sidebar -->
            <aside class="sidebar-left">
                <div class="sidebar-title">ğŸ“ í…œí”Œë¦¿</div>
                <div class="template-grid">
                    <div class="template-card active" onclick="selectTemplate('grid-pop')" data-template="grid-pop">
                        <div class="template-icon">âŠ</div>
                        <div class="template-info">
                            <div class="template-name">ê·¸ë¦¬ë“œ íŒì—…</div>
                            <div class="template-desc">ì´ë¯¸ì§€/ì˜ìƒ ìˆœì°¨ íŒì—…</div>
                        </div>
                    </div>

                    <div class="template-card" onclick="selectTemplate('slideshow')" data-template="slideshow">
                        <div class="template-icon">â–¶</div>
                        <div class="template-info">
                            <div class="template-name">ìŠ¬ë¼ì´ë“œì‡¼</div>
                            <div class="template-desc">í’€ìŠ¤í¬ë¦° í˜ì´ë“œ ì „í™˜</div>
                        </div>
                    </div>

                    <div class="template-card" onclick="selectTemplate('stack-cards')" data-template="stack-cards">
                        <div class="template-icon">ğŸƒ</div>
                        <div class="template-info">
                            <div class="template-name">ìŠ¤íƒ ì¹´ë“œ</div>
                            <div class="template-desc">ì¹´ë“œê°€ í¼ì³ì§€ëŠ” íš¨ê³¼</div>
                        </div>
                    </div>

                    <div class="template-card" onclick="selectTemplate('mosaic')" data-template="mosaic">
                        <div class="template-icon">â–¦</div>
                        <div class="template-info">
                            <div class="template-name">ëª¨ìì´í¬</div>
                            <div class="template-desc">ë‹¤ì–‘í•œ í¬ê¸°ë¡œ ë°°ì¹˜</div>
                        </div>
                    </div>

                    <div class="template-card" onclick="selectTemplate('zoom-reveal')" data-template="zoom-reveal">
                        <div class="template-icon">â—</div>
                        <div class="template-info">
                            <div class="template-name">ì¤Œ ë¦¬ë¹Œ</div>
                            <div class="template-desc">ì¤‘ì•™ì—ì„œ í™•ëŒ€ ì „í™˜</div>
                        </div>
                    </div>

                    <div class="template-card" onclick="selectTemplate('dynamic-grid')" data-template="dynamic-grid">
                        <div class="template-icon">â–£</div>
                        <div class="template-info">
                            <div class="template-name">ë‹¤ì´ë‚˜ë¯¹ ê·¸ë¦¬ë“œ</div>
                            <div class="template-desc">íšŒì „í•˜ë©° ë“±ì¥</div>
                        </div>
                    </div>
                </div>

                <div class="tip-box purple" style="margin-top: 16px;">
                    <strong>ğŸ¥ ì˜ìƒ ì—…ë¡œë“œ íŒ</strong><br>
                    â€¢ MP4, WebM, MOV ì§€ì›<br>
                    â€¢ ì˜ìƒì€ ìë™ ë°˜ë³µ ì¬ìƒ<br>
                    â€¢ ìŒì†Œê±° ìƒíƒœë¡œ ì¬ìƒë©ë‹ˆë‹¤
                </div>
            </aside>

            <!-- Center Preview -->
            <main class="preview-area">
                <div class="canvas-container">
                    <canvas id="canvas" width="1080" height="1920"></canvas>
                    <div class="spec-badge">1080Ã—1920 Â· 9:16</div>
                </div>

                <div class="controls">
                    <button class="btn btn-play" onclick="playAnimation()">â–¶ ë¯¸ë¦¬ë³´ê¸°</button>
                    <button class="btn btn-record" id="recordBtn" onclick="toggleRecording()">â— ë…¹í™”</button>
                    <button class="btn btn-download" id="downloadBtn" onclick="downloadVideo()" disabled>â¬‡ ë‹¤ìš´ë¡œë“œ</button>
                </div>

                <div class="status-bar" id="status">ì´ë¯¸ì§€ ë˜ëŠ” ì˜ìƒì„ ì—…ë¡œë“œí•˜ì„¸ìš”</div>
            </main>

            <!-- Right Sidebar -->
            <aside class="sidebar-right">
                <div class="panel">
                    <div class="panel-title">ğŸ“·ğŸ¥ ë¯¸ë””ì–´ (ì´ë¯¸ì§€/ì˜ìƒ)</div>
                    <div class="media-slots" id="mediaSlots"></div>
                </div>

                <div class="panel">
                    <div class="panel-title">âœï¸ í…ìŠ¤íŠ¸</div>
                    <div class="input-group">
                        <label class="input-label">ë©”ì¸ íƒ€ì´í‹€</label>
                        <input type="text" class="text-input" id="mainTitle" value="ì¸í”Œë£¨ì–¸ì„œì™€ í•¨ê»˜í•˜ëŠ”" oninput="updatePreview()">
                    </div>
                    <div class="input-group">
                        <label class="input-label">ë©”ì¸ íƒ€ì´í‹€ 2</label>
                        <input type="text" class="text-input" id="mainTitle2" value="íŠ¹ë³„í•œ ê³µë™êµ¬ë§¤" oninput="updatePreview()">
                    </div>
                    <div class="input-group">
                        <label class="input-label">CTA ë¬¸êµ¬</label>
                        <input type="text" class="text-input" id="ctaText" value="ì§€ê¸ˆ ë°”ë¡œ ì…€ëŸ¬ ì‹ ì²­ â†’" oninput="updatePreview()">
                    </div>
                    <div class="input-group">
                        <label class="input-label">í•˜ë‹¨ URL/ë¸Œëœë“œ</label>
                        <input type="text" class="text-input" id="urlText" value="moyeoradeal.com" oninput="updatePreview()">
                    </div>
                </div>

                <div class="panel">
                    <div class="panel-title">ğŸ¨ ì»¬ëŸ¬ í…Œë§ˆ</div>
                    <div class="color-options">
                        <button class="color-btn active" style="background: linear-gradient(135deg, #00ff88, #00d9ff);" onclick="setColorTheme('mint')" data-theme="mint"></button>
                        <button class="color-btn" style="background: linear-gradient(135deg, #ff6b81, #ff4757);" onclick="setColorTheme('coral')" data-theme="coral"></button>
                        <button class="color-btn" style="background: linear-gradient(135deg, #a55eea, #5f27cd);" onclick="setColorTheme('purple')" data-theme="purple"></button>
                        <button class="color-btn" style="background: linear-gradient(135deg, #ffa502, #ff6348);" onclick="setColorTheme('orange')" data-theme="orange"></button>
                        <button class="color-btn" style="background: linear-gradient(135deg, #1e90ff, #00bfff);" onclick="setColorTheme('blue')" data-theme="blue"></button>
                        <button class="color-btn" style="background: linear-gradient(135deg, #fff, #ddd);" onclick="setColorTheme('white')" data-theme="white"></button>
                    </div>
                </div>

                <div class="panel">
                    <div class="panel-title">â±ï¸ ì˜ìƒ ê¸¸ì´</div>
                    <div class="input-group">
                        <input type="range" id="duration" min="6" max="15" value="10" style="width: 100%;" oninput="document.getElementById('durationVal').textContent = this.value + 'ì´ˆ'">
                        <div style="text-align: center; margin-top: 6px; color: #00d9ff; font-size: 14px;" id="durationVal">10ì´ˆ</div>
                    </div>
                </div>
            </aside>
        </div>
    </div>

    <input type="file" id="fileInput" class="hidden-input" accept="image/*,video/*" onchange="handleFileSelect(event)">

    <!-- Hidden video container for playback -->
    <div class="hidden-videos" id="hiddenVideos"></div>

    <script>
        // ==================== PASSWORD MANAGEMENT ====================
        const DEFAULT_PASSWORD = '0000';
        const STORAGE_KEY = 'moyeoradeal_studio_pw';
        const SESSION_KEY = 'moyeoradeal_studio_session';

        function getPassword() {
            return localStorage.getItem(STORAGE_KEY) || DEFAULT_PASSWORD;
        }

        function setPassword(newPw) {
            localStorage.setItem(STORAGE_KEY, newPw);
        }

        function isLoggedIn() {
            return sessionStorage.getItem(SESSION_KEY) === 'true';
        }

        function setLoggedIn(value) {
            if (value) {
                sessionStorage.setItem(SESSION_KEY, 'true');
            } else {
                sessionStorage.removeItem(SESSION_KEY);
            }
        }

        // Login Elements
        const loginScreen = document.getElementById('loginScreen');
        const mainApp = document.getElementById('mainApp');
        const passwordInput = document.getElementById('passwordInput');
        const loginBtn = document.getElementById('loginBtn');
        const loginError = document.getElementById('loginError');
        const logoutBtn = document.getElementById('logoutBtn');
        const changePwBtn = document.getElementById('changePwBtn');
        const pwModal = document.getElementById('pwModal');
        const currentPwInput = document.getElementById('currentPw');
        const newPwInput = document.getElementById('newPw');
        const confirmPwInput = document.getElementById('confirmPw');
        const pwModalError = document.getElementById('pwModalError');
        const pwModalCancel = document.getElementById('pwModalCancel');
        const pwModalConfirm = document.getElementById('pwModalConfirm');

        // Check session on load
        if (isLoggedIn()) {
            loginScreen.classList.add('hidden');
            mainApp.classList.add('visible');
        }

        // Login
        function attemptLogin() {
            const enteredPw = passwordInput.value;
            const correctPw = getPassword();

            if (enteredPw === correctPw) {
                setLoggedIn(true);
                loginScreen.classList.add('hidden');
                mainApp.classList.add('visible');
                loginError.textContent = '';
                init(); // Initialize app after login
            } else {
                passwordInput.classList.add('error');
                loginError.textContent = 'ë¹„ë°€ë²ˆí˜¸ê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤';
                setTimeout(() => {
                    passwordInput.classList.remove('error');
                }, 500);
            }
        }

        loginBtn.addEventListener('click', attemptLogin);
        passwordInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') attemptLogin();
        });

        // Logout
        logoutBtn.addEventListener('click', () => {
            setLoggedIn(false);
            loginScreen.classList.remove('hidden');
            mainApp.classList.remove('visible');
            passwordInput.value = '';
        });

        // Password change modal
        changePwBtn.addEventListener('click', () => {
            pwModal.classList.add('visible');
            currentPwInput.value = '';
            newPwInput.value = '';
            confirmPwInput.value = '';
            pwModalError.textContent = '';
        });

        pwModalCancel.addEventListener('click', () => {
            pwModal.classList.remove('visible');
        });

        pwModal.addEventListener('click', (e) => {
            if (e.target === pwModal) {
                pwModal.classList.remove('visible');
            }
        });

        pwModalConfirm.addEventListener('click', () => {
            const currentPw = currentPwInput.value;
            const newPw = newPwInput.value;
            const confirmPw = confirmPwInput.value;

            if (currentPw !== getPassword()) {
                pwModalError.textContent = 'í˜„ì¬ ë¹„ë°€ë²ˆí˜¸ê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤';
                return;
            }

            if (newPw.length < 4) {
                pwModalError.textContent = 'ìƒˆ ë¹„ë°€ë²ˆí˜¸ëŠ” 4ì ì´ìƒì´ì–´ì•¼ í•©ë‹ˆë‹¤';
                return;
            }

            if (newPw !== confirmPw) {
                pwModalError.textContent = 'ìƒˆ ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤';
                return;
            }

            setPassword(newPw);
            pwModal.classList.remove('visible');
            alert('ë¹„ë°€ë²ˆí˜¸ê°€ ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤');
        });

        // ==================== MAIN APP ====================
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');

        // State
        let state = {
            template: 'grid-pop',
            media: [], // { type: 'image'|'video', element: HTMLImageElement|HTMLVideoElement, src: string }
            maxMedia: 5,
            colorTheme: 'mint',
            isPlaying: false,
            isRecording: false,
            videoBlob: null,
            currentSlot: 0,
            previewAnimationId: null
        };

        const colorThemes = {
            mint: { primary: '#00ff88', secondary: '#00d9ff', bg: '#0a0a0f', text: '#ffffff' },
            coral: { primary: '#ff6b81', secondary: '#ff4757', bg: '#0f0a0a', text: '#ffffff' },
            purple: { primary: '#a55eea', secondary: '#5f27cd', bg: '#0a0a0f', text: '#ffffff' },
            orange: { primary: '#ffa502', secondary: '#ff6348', bg: '#0f0d0a', text: '#ffffff' },
            blue: { primary: '#1e90ff', secondary: '#00bfff', bg: '#0a0c0f', text: '#ffffff' },
            white: { primary: '#333333', secondary: '#666666', bg: '#ffffff', text: '#000000' }
        };

        // Font loading
        const font = new FontFace('Noto Sans KR', 'url(https://fonts.gstatic.com/s/notosanskr/v36/PbyxFmXiEBPT4ITbgNA5Cgms3VYcOA-vvnIzzuoyeLTq8H4hfeE.woff2)');
        font.load().then(() => {
            document.fonts.add(font);
            updatePreview();
        });

        function init() {
            updateMediaSlots();
            startPreviewLoop();
        }

        function updateMediaSlots() {
            const container = document.getElementById('mediaSlots');
            container.innerHTML = '';

            for (let i = 0; i < state.maxMedia; i++) {
                const media = state.media[i];
                const hasMedia = media != null;
                const isVideo = hasMedia && media.type === 'video';

                let previewContent = (i + 1);
                let slotClass = 'media-slot';
                let typeTag = '';

                if (hasMedia) {
                    slotClass += isVideo ? ' video-filled' : ' filled';
                    if (isVideo) {
                        previewContent = `<video src="${media.src}" muted></video><span class="video-icon">â–¶</span>`;
                        typeTag = '<span class="slot-type video">ì˜ìƒ</span>';
                    } else {
                        previewContent = `<img src="${media.src}">`;
                        typeTag = '<span class="slot-type image">ì´ë¯¸ì§€</span>';
                    }
                }

                container.innerHTML += `
                    <div class="${slotClass}" id="slot-${i}">
                        <div class="slot-preview" id="preview-${i}">${previewContent}</div>
                        <div class="slot-info">
                            <div class="slot-label">ìŠ¬ë¡¯ ${i + 1}</div>
                            <div class="slot-name" id="name-${i}">${hasMedia ? (isVideo ? 'ì˜ìƒ' : 'ì´ë¯¸ì§€') : 'í´ë¦­í•˜ì—¬ ì„ íƒ'}</div>
                            ${typeTag}
                        </div>
                        ${hasMedia ?
                            `<button class="slot-btn remove" onclick="removeMedia(${i})">âœ•</button>` :
                            `<button class="slot-btn" onclick="selectMedia(${i})">ì„ íƒ</button>`
                        }
                    </div>
                `;
            }
        }

        function selectTemplate(template) {
            state.template = template;
            document.querySelectorAll('.template-card').forEach(card => card.classList.remove('active'));
            document.querySelector(`[data-template="${template}"]`).classList.add('active');
        }

        function setColorTheme(theme) {
            state.colorTheme = theme;
            document.querySelectorAll('.color-btn').forEach(btn => btn.classList.remove('active'));
            document.querySelector(`[data-theme="${theme}"]`).classList.add('active');
        }

        function selectMedia(slot) {
            state.currentSlot = slot;
            document.getElementById('fileInput').click();
        }

        function removeMedia(slot) {
            // Clean up video element if exists
            if (state.media[slot] && state.media[slot].type === 'video') {
                state.media[slot].element.pause();
                state.media[slot].element.src = '';
            }
            state.media[slot] = null;
            updateMediaSlots();
        }

        function handleFileSelect(event) {
            const file = event.target.files[0];
            if (!file) return;

            const isVideo = file.type.startsWith('video/');
            const reader = new FileReader();

            reader.onload = function(e) {
                if (isVideo) {
                    // Create video element
                    const video = document.createElement('video');
                    video.src = e.target.result;
                    video.muted = true;
                    video.loop = true;
                    video.playsInline = true;
                    video.preload = 'auto';

                    // Add to hidden container
                    document.getElementById('hiddenVideos').appendChild(video);

                    video.onloadeddata = function() {
                        state.media[state.currentSlot] = {
                            type: 'video',
                            element: video,
                            src: e.target.result
                        };
                        updateMediaSlots();
                        // Start playing for preview
                        video.play().catch(() => {});
                    };

                    video.load();
                } else {
                    // Create image element
                    const img = new Image();
                    img.onload = function() {
                        state.media[state.currentSlot] = {
                            type: 'image',
                            element: img,
                            src: e.target.result
                        };
                        updateMediaSlots();
                    };
                    img.src = e.target.result;
                }
            };

            reader.readAsDataURL(file);
            event.target.value = '';
        }

        // Start all videos playing
        function playAllVideos() {
            state.media.forEach(m => {
                if (m && m.type === 'video') {
                    m.element.currentTime = 0;
                    m.element.play().catch(() => {});
                }
            });
        }

        // Pause all videos
        function pauseAllVideos() {
            state.media.forEach(m => {
                if (m && m.type === 'video') {
                    m.element.pause();
                }
            });
        }

        // Drawing utilities
        function roundRect(ctx, x, y, w, h, r) {
            ctx.beginPath();
            ctx.moveTo(x + r, y);
            ctx.lineTo(x + w - r, y);
            ctx.quadraticCurveTo(x + w, y, x + w, y + r);
            ctx.lineTo(x + w, y + h - r);
            ctx.quadraticCurveTo(x + w, y + h, x + w - r, y + h);
            ctx.lineTo(x + r, y + h);
            ctx.quadraticCurveTo(x, y + h, x, y + h - r);
            ctx.lineTo(x, y + r);
            ctx.quadraticCurveTo(x, y, x + r, y);
            ctx.closePath();
        }

        function drawMediaCover(ctx, mediaObj, x, y, w, h, radius = 0) {
            if (!mediaObj) return;

            const element = mediaObj.element;
            const sourceW = mediaObj.type === 'video' ? element.videoWidth : element.width;
            const sourceH = mediaObj.type === 'video' ? element.videoHeight : element.height;

            if (!sourceW || !sourceH) return;

            ctx.save();
            if (radius > 0) {
                roundRect(ctx, x, y, w, h, radius);
                ctx.clip();
            }

            const scale = Math.max(w / sourceW, h / sourceH);
            const sw = sourceW * scale;
            const sh = sourceH * scale;
            ctx.drawImage(element, x - (sw - w) / 2, y - (sh - h) / 2, sw, sh);
            ctx.restore();
        }

        function easeOutBack(t) {
            const c1 = 1.70158;
            const c3 = c1 + 1;
            return 1 + c3 * Math.pow(t - 1, 3) + c1 * Math.pow(t - 1, 2);
        }

        function easeOutQuad(t) {
            return 1 - (1 - t) * (1 - t);
        }

        function easeOutCubic(t) {
            return 1 - Math.pow(1 - t, 3);
        }

        // Draw text
        function drawText(text, x, y, options = {}) {
            const {
                fontSize = 60,
                fontWeight = '700',
                color = '#ffffff',
                align = 'center',
                shadow = false
            } = options;

            ctx.save();
            ctx.font = `${fontWeight} ${fontSize}px 'Noto Sans KR', sans-serif`;
            ctx.fillStyle = color;
            ctx.textAlign = align;
            ctx.textBaseline = 'middle';

            if (shadow) {
                ctx.shadowColor = 'rgba(0,0,0,0.5)';
                ctx.shadowBlur = 20;
                ctx.shadowOffsetY = 4;
            }

            ctx.fillText(text, x, y);
            ctx.restore();
        }

        // Draw CTA button
        function drawCTAButton(theme, y, alpha = 1) {
            const ctaText = document.getElementById('ctaText').value;
            const urlText = document.getElementById('urlText').value;

            ctx.globalAlpha = alpha;

            const gradient = ctx.createLinearGradient(140, y, 940, y);
            gradient.addColorStop(0, theme.primary);
            gradient.addColorStop(1, theme.secondary);

            ctx.shadowColor = theme.primary;
            ctx.shadowBlur = 30;

            roundRect(ctx, 140, y, 800, 140, 24);
            ctx.fillStyle = gradient;
            ctx.fill();

            ctx.shadowBlur = 0;

            const btnTextColor = theme.bg === '#ffffff' ? '#ffffff' : '#000000';
            drawText(ctaText, 540, y + 70, { fontSize: 48, fontWeight: '900', color: btnTextColor });
            drawText(urlText, 540, y + 200, { fontSize: 36, fontWeight: '400', color: theme.text });

            ctx.globalAlpha = 1;
        }

        // Continuous preview loop (for videos)
        function startPreviewLoop() {
            function loop() {
                if (!state.isPlaying) {
                    updatePreview();
                }
                state.previewAnimationId = requestAnimationFrame(loop);
            }
            loop();
        }

        // Static preview
        function updatePreview() {
            const theme = colorThemes[state.colorTheme];
            const title1 = document.getElementById('mainTitle').value;
            const title2 = document.getElementById('mainTitle2').value;

            ctx.fillStyle = theme.bg;
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            drawText(title1, 540, 350, { fontSize: 64, fontWeight: '700', color: theme.text });
            drawText(title2, 540, 440, { fontSize: 72, fontWeight: '900', color: theme.primary });

            switch(state.template) {
                case 'grid-pop':
                    drawGridPopStatic(theme);
                    break;
                case 'slideshow':
                    drawSlideshowStatic(theme);
                    break;
                case 'stack-cards':
                    drawStackCardsStatic(theme);
                    break;
                case 'mosaic':
                    drawMosaicStatic(theme);
                    break;
                case 'zoom-reveal':
                    drawZoomRevealStatic(theme);
                    break;
                case 'dynamic-grid':
                    drawDynamicGridStatic(theme);
                    break;
            }

            drawCTAButton(theme, 1450);
        }

        function drawGridPopStatic(theme) {
            const imgSize = 320;
            const gap = 30;
            const cols = 2;
            const startY = 550;
            const startX = (canvas.width - (cols * imgSize + gap)) / 2;

            state.media.forEach((media, i) => {
                if (!media || i >= 4) return;
                const col = i % cols;
                const row = Math.floor(i / cols);
                const x = startX + col * (imgSize + gap);
                const y = startY + row * (imgSize + gap);

                drawMediaCover(ctx, media, x, y, imgSize, imgSize, 20);

                ctx.strokeStyle = media.type === 'video' ? '#a55eea' : theme.primary;
                ctx.lineWidth = 4;
                roundRect(ctx, x, y, imgSize, imgSize, 20);
                ctx.stroke();

                // Video indicator
                if (media.type === 'video') {
                    ctx.fillStyle = 'rgba(165,94,234,0.8)';
                    ctx.beginPath();
                    ctx.arc(x + imgSize - 30, y + imgSize - 30, 20, 0, Math.PI * 2);
                    ctx.fill();
                    ctx.fillStyle = 'white';
                    ctx.font = 'bold 16px sans-serif';
                    ctx.textAlign = 'center';
                    ctx.fillText('â–¶', x + imgSize - 28, y + imgSize - 26);
                }
            });

            if (state.media[4]) {
                const x = (canvas.width - imgSize) / 2;
                const y = startY + 2 * (imgSize + gap);
                drawMediaCover(ctx, state.media[4], x, y, imgSize, imgSize, 20);
                ctx.strokeStyle = state.media[4].type === 'video' ? '#a55eea' : theme.primary;
                ctx.lineWidth = 4;
                roundRect(ctx, x, y, imgSize, imgSize, 20);
                ctx.stroke();
            }
        }

        function drawSlideshowStatic(theme) {
            if (state.media[0]) {
                drawMediaCover(ctx, state.media[0], 60, 520, 960, 850, 24);

                const gradient = ctx.createLinearGradient(60, 520, 60, 1370);
                gradient.addColorStop(0, 'rgba(0,0,0,0)');
                gradient.addColorStop(1, 'rgba(0,0,0,0.6)');
                ctx.fillStyle = gradient;
                roundRect(ctx, 60, 520, 960, 850, 24);
                ctx.fill();
            }

            const validCount = state.media.filter(Boolean).length;
            for (let i = 0; i < validCount; i++) {
                ctx.beginPath();
                ctx.arc(540 - (validCount - 1) * 15 + i * 30, 1320, i === 0 ? 10 : 6, 0, Math.PI * 2);
                ctx.fillStyle = i === 0 ? theme.primary : 'rgba(255,255,255,0.4)';
                ctx.fill();
            }
        }

        function drawStackCardsStatic(theme) {
            const cardW = 500;
            const cardH = 650;
            const centerX = 540;
            const centerY = 900;

            const validMedia = state.media.filter(Boolean).slice(0, 5);

            validMedia.slice().reverse().forEach((media, idx) => {
                const i = validMedia.length - 1 - idx;
                const rotation = (i - 2) * 8;

                ctx.save();
                ctx.translate(centerX, centerY);
                ctx.rotate(rotation * Math.PI / 180);

                ctx.shadowColor = 'rgba(0,0,0,0.4)';
                ctx.shadowBlur = 30;
                ctx.shadowOffsetY = 15;

                drawMediaCover(ctx, media, -cardW/2, -cardH/2, cardW, cardH, 20);

                ctx.strokeStyle = media.type === 'video' ? '#a55eea' : theme.primary;
                ctx.lineWidth = 4;
                roundRect(ctx, -cardW/2, -cardH/2, cardW, cardH, 20);
                ctx.stroke();

                ctx.restore();
            });
        }

        function drawMosaicStatic(theme) {
            const layouts = [
                { x: 40, y: 520, w: 480, h: 550 },
                { x: 560, y: 520, w: 480, h: 260 },
                { x: 560, y: 810, w: 480, h: 260 },
                { x: 40, y: 1100, w: 320, h: 320 },
                { x: 390, y: 1100, w: 650, h: 320 }
            ];

            layouts.forEach((l, i) => {
                if (!state.media[i]) return;
                drawMediaCover(ctx, state.media[i], l.x, l.y, l.w, l.h, 16);
                ctx.strokeStyle = state.media[i].type === 'video' ? '#a55eea' : theme.primary;
                ctx.lineWidth = 3;
                roundRect(ctx, l.x, l.y, l.w, l.h, 16);
                ctx.stroke();
            });
        }

        function drawZoomRevealStatic(theme) {
            const centerX = 540;
            const centerY = 900;
            const radius = 350;

            if (state.media[0]) {
                ctx.save();
                ctx.beginPath();
                ctx.arc(centerX, centerY, radius, 0, Math.PI * 2);
                ctx.clip();
                drawMediaCover(ctx, state.media[0], centerX - radius, centerY - radius, radius * 2, radius * 2);
                ctx.restore();

                ctx.strokeStyle = state.media[0].type === 'video' ? '#a55eea' : theme.primary;
                ctx.lineWidth = 6;
                ctx.beginPath();
                ctx.arc(centerX, centerY, radius, 0, Math.PI * 2);
                ctx.stroke();
            }

            [400, 450, 500].forEach((r, i) => {
                ctx.strokeStyle = theme.secondary;
                ctx.lineWidth = 2;
                ctx.globalAlpha = 0.3 - i * 0.1;
                ctx.beginPath();
                ctx.arc(centerX, centerY, r, 0, Math.PI * 2);
                ctx.stroke();
            });
            ctx.globalAlpha = 1;
        }

        function drawDynamicGridStatic(theme) {
            const size = 280;
            const positions = [
                { x: 100, y: 550, rot: -5 },
                { x: 420, y: 520, rot: 3 },
                { x: 720, y: 560, rot: -3 },
                { x: 180, y: 870, rot: 4 },
                { x: 540, y: 900, rot: -4 }
            ];

            state.media.forEach((media, i) => {
                if (!media || i >= positions.length) return;
                const p = positions[i];

                ctx.save();
                ctx.translate(p.x + size/2, p.y + size/2);
                ctx.rotate(p.rot * Math.PI / 180);

                ctx.shadowColor = 'rgba(0,0,0,0.3)';
                ctx.shadowBlur = 20;

                drawMediaCover(ctx, media, -size/2, -size/2, size, size, 16);

                ctx.strokeStyle = media.type === 'video' ? '#a55eea' : theme.primary;
                ctx.lineWidth = 3;
                roundRect(ctx, -size/2, -size/2, size, size, 16);
                ctx.stroke();

                ctx.restore();
            });
        }

        // Animations
        function playAnimation() {
            if (state.isPlaying) return;
            state.isPlaying = true;

            // Start all videos
            playAllVideos();

            const duration = parseInt(document.getElementById('duration').value) * 1000;
            const startTime = performance.now();
            const theme = colorThemes[state.colorTheme];

            function animate(currentTime) {
                const elapsed = currentTime - startTime;
                const progress = Math.min(elapsed / duration, 1);

                ctx.fillStyle = theme.bg;
                ctx.fillRect(0, 0, canvas.width, canvas.height);

                switch(state.template) {
                    case 'grid-pop':
                        animateGridPop(elapsed, duration, theme);
                        break;
                    case 'slideshow':
                        animateSlideshow(elapsed, duration, theme);
                        break;
                    case 'stack-cards':
                        animateStackCards(elapsed, duration, theme);
                        break;
                    case 'mosaic':
                        animateMosaic(elapsed, duration, theme);
                        break;
                    case 'zoom-reveal':
                        animateZoomReveal(elapsed, duration, theme);
                        break;
                    case 'dynamic-grid':
                        animateDynamicGrid(elapsed, duration, theme);
                        break;
                }

                if (progress < 1) {
                    state.animationId = requestAnimationFrame(animate);
                } else {
                    state.isPlaying = false;
                    if (state.isRecording) stopRecording();
                    document.getElementById('status').textContent = 'âœ… ì¬ìƒ ì™„ë£Œ!';
                    document.getElementById('status').classList.remove('recording');
                }
            }

            document.getElementById('status').textContent = 'â–¶ ì¬ìƒ ì¤‘...';
            state.animationId = requestAnimationFrame(animate);
        }

        function animateGridPop(elapsed, duration, theme) {
            const title1 = document.getElementById('mainTitle').value;
            const title2 = document.getElementById('mainTitle2').value;

            const titleP = Math.min(elapsed / 800, 1);
            const titleY = 350 - 50 * (1 - easeOutCubic(titleP));
            ctx.globalAlpha = easeOutCubic(titleP);
            drawText(title1, 540, titleY, { fontSize: 64, fontWeight: '700', color: theme.text });
            drawText(title2, 540, titleY + 90, { fontSize: 72, fontWeight: '900', color: theme.primary });
            ctx.globalAlpha = 1;

            const imgSize = 320;
            const gap = 30;
            const startY = 550;
            const startX = (canvas.width - (2 * imgSize + gap)) / 2;

            state.media.forEach((media, i) => {
                if (!media) return;

                const imgStart = 600 + i * 350;
                const imgElapsed = Math.max(0, elapsed - imgStart);
                const imgP = Math.min(imgElapsed / 400, 1);

                if (imgP <= 0) return;

                let x, y;
                if (i < 4) {
                    const col = i % 2;
                    const row = Math.floor(i / 2);
                    x = startX + col * (imgSize + gap);
                    y = startY + row * (imgSize + gap);
                } else {
                    x = (canvas.width - imgSize) / 2;
                    y = startY + 2 * (imgSize + gap);
                }

                const scale = easeOutBack(imgP);
                const centerX = x + imgSize / 2;
                const centerY = y + imgSize / 2;
                const scaledSize = imgSize * scale;

                ctx.globalAlpha = easeOutQuad(imgP);
                ctx.shadowColor = media.type === 'video' ? '#a55eea' : theme.primary;
                ctx.shadowBlur = 25 * imgP;

                drawMediaCover(ctx, media, centerX - scaledSize/2, centerY - scaledSize/2, scaledSize, scaledSize, 20 * scale);

                ctx.strokeStyle = media.type === 'video' ? '#a55eea' : theme.primary;
                ctx.lineWidth = 4;
                roundRect(ctx, centerX - scaledSize/2, centerY - scaledSize/2, scaledSize, scaledSize, 20 * scale);
                ctx.stroke();

                ctx.shadowBlur = 0;
                ctx.globalAlpha = 1;
            });

            if (elapsed > duration - 2500) {
                const ctaP = Math.min((elapsed - (duration - 2500)) / 600, 1);
                const ctaY = 1450 + 50 * (1 - easeOutCubic(ctaP));
                drawCTAButton(theme, ctaY, easeOutCubic(ctaP));
            }
        }

        function animateSlideshow(elapsed, duration, theme) {
            const title1 = document.getElementById('mainTitle').value;
            const title2 = document.getElementById('mainTitle2').value;
            const validMedia = state.media.filter(Boolean);
            const mediaCount = validMedia.length || 1;
            const transitionDuration = (duration - 2500) / mediaCount;

            const mediaElapsed = Math.max(0, elapsed - 400);
            const currentIdx = Math.min(Math.floor(mediaElapsed / transitionDuration), mediaCount - 1);
            const localP = (mediaElapsed % transitionDuration) / transitionDuration;

            if (validMedia[currentIdx]) {
                const fadeIn = Math.min(localP * 4, 1);
                const fadeOut = currentIdx < mediaCount - 1 ? Math.max(0, 1 - (localP - 0.75) * 4) : 1;
                const scale = 1 + localP * 0.08;

                ctx.globalAlpha = fadeIn * fadeOut;
                ctx.save();
                ctx.translate(540, 945);
                ctx.scale(scale, scale);
                ctx.translate(-540, -945);
                drawMediaCover(ctx, validMedia[currentIdx], 60, 520, 960, 850, 24);
                ctx.restore();

                const gradient = ctx.createLinearGradient(60, 520, 60, 1370);
                gradient.addColorStop(0, 'rgba(0,0,0,0)');
                gradient.addColorStop(1, 'rgba(0,0,0,0.5)');
                ctx.fillStyle = gradient;
                roundRect(ctx, 60, 520, 960, 850, 24);
                ctx.fill();
                ctx.globalAlpha = 1;
            }

            const titleP = Math.min(elapsed / 600, 1);
            ctx.globalAlpha = easeOutCubic(titleP);
            drawText(title1, 540, 350, { fontSize: 64, fontWeight: '700', color: theme.text, shadow: true });
            drawText(title2, 540, 440, { fontSize: 72, fontWeight: '900', color: theme.primary, shadow: true });
            ctx.globalAlpha = 1;

            for (let i = 0; i < mediaCount; i++) {
                ctx.beginPath();
                ctx.arc(540 - (mediaCount - 1) * 15 + i * 30, 1320, i === currentIdx ? 10 : 6, 0, Math.PI * 2);
                ctx.fillStyle = i === currentIdx ? theme.primary : 'rgba(255,255,255,0.4)';
                ctx.fill();
            }

            if (elapsed > duration - 2000) {
                const ctaP = Math.min((elapsed - (duration - 2000)) / 600, 1);
                drawCTAButton(theme, 1450, easeOutCubic(ctaP));
            }
        }

        function animateStackCards(elapsed, duration, theme) {
            const title1 = document.getElementById('mainTitle').value;
            const title2 = document.getElementById('mainTitle2').value;
            const validMedia = state.media.filter(Boolean).slice(0, 5);
            const cardW = 500;
            const cardH = 650;
            const centerX = 540;
            const centerY = 900;

            const titleP = Math.min(elapsed / 600, 1);
            ctx.globalAlpha = easeOutCubic(titleP);
            drawText(title1, 540, 350, { fontSize: 64, fontWeight: '700', color: theme.text });
            drawText(title2, 540, 440, { fontSize: 72, fontWeight: '900', color: theme.primary });
            ctx.globalAlpha = 1;

            const spreadStart = 800;

            validMedia.forEach((media, i) => {
                const cardDelay = i * 200;
                const cardElapsed = Math.max(0, elapsed - spreadStart - cardDelay);
                const cardP = Math.min(cardElapsed / 500, 1);

                const stackOffset = (validMedia.length - 1 - i) * 15 * (1 - easeOutCubic(cardP));
                const targetRot = (i - Math.floor(validMedia.length / 2)) * 10;
                const rotation = targetRot * easeOutBack(cardP);
                const xOffset = (i - Math.floor(validMedia.length / 2)) * 40 * easeOutCubic(cardP);

                ctx.save();
                ctx.translate(centerX + xOffset, centerY + stackOffset);
                ctx.rotate(rotation * Math.PI / 180);

                ctx.shadowColor = 'rgba(0,0,0,0.4)';
                ctx.shadowBlur = 30;
                ctx.shadowOffsetY = 15;

                drawMediaCover(ctx, media, -cardW/2, -cardH/2, cardW, cardH, 20);

                ctx.strokeStyle = media.type === 'video' ? '#a55eea' : theme.primary;
                ctx.lineWidth = 4;
                roundRect(ctx, -cardW/2, -cardH/2, cardW, cardH, 20);
                ctx.stroke();

                ctx.restore();
            });

            if (elapsed > duration - 2500) {
                const ctaP = Math.min((elapsed - (duration - 2500)) / 600, 1);
                drawCTAButton(theme, 1450, easeOutCubic(ctaP));
            }
        }

        function animateMosaic(elapsed, duration, theme) {
            const title1 = document.getElementById('mainTitle').value;
            const title2 = document.getElementById('mainTitle2').value;

            const titleP = Math.min(elapsed / 600, 1);
            ctx.globalAlpha = easeOutCubic(titleP);
            drawText(title1, 540, 350, { fontSize: 64, fontWeight: '700', color: theme.text });
            drawText(title2, 540, 440, { fontSize: 72, fontWeight: '900', color: theme.primary });
            ctx.globalAlpha = 1;

            const layouts = [
                { x: 40, y: 520, w: 480, h: 550, dir: 'left' },
                { x: 560, y: 520, w: 480, h: 260, dir: 'right' },
                { x: 560, y: 810, w: 480, h: 260, dir: 'right' },
                { x: 40, y: 1100, w: 320, h: 320, dir: 'bottom' },
                { x: 390, y: 1100, w: 650, h: 320, dir: 'bottom' }
            ];

            layouts.forEach((l, i) => {
                if (!state.media[i]) return;

                const imgStart = 500 + i * 300;
                const imgElapsed = Math.max(0, elapsed - imgStart);
                const imgP = Math.min(imgElapsed / 450, 1);

                if (imgP <= 0) return;

                let offsetX = 0, offsetY = 0;
                if (l.dir === 'left') offsetX = -200 * (1 - easeOutCubic(imgP));
                else if (l.dir === 'right') offsetX = 200 * (1 - easeOutCubic(imgP));
                else if (l.dir === 'bottom') offsetY = 200 * (1 - easeOutCubic(imgP));

                ctx.globalAlpha = easeOutCubic(imgP);

                drawMediaCover(ctx, state.media[i], l.x + offsetX, l.y + offsetY, l.w, l.h, 16);

                ctx.strokeStyle = state.media[i].type === 'video' ? '#a55eea' : theme.primary;
                ctx.lineWidth = 3;
                roundRect(ctx, l.x + offsetX, l.y + offsetY, l.w, l.h, 16);
                ctx.stroke();

                ctx.globalAlpha = 1;
            });

            if (elapsed > duration - 2000) {
                const ctaP = Math.min((elapsed - (duration - 2000)) / 600, 1);
                drawCTAButton(theme, 1450, easeOutCubic(ctaP));
            }
        }

        function animateZoomReveal(elapsed, duration, theme) {
            const title1 = document.getElementById('mainTitle').value;
            const title2 = document.getElementById('mainTitle2').value;
            const validMedia = state.media.filter(Boolean);
            const centerX = 540;
            const centerY = 900;
            const maxRadius = 350;
            const mediaCount = validMedia.length || 1;
            const mediaDuration = (duration - 2500) / mediaCount;

            const titleP = Math.min(elapsed / 600, 1);
            ctx.globalAlpha = easeOutCubic(titleP);
            drawText(title1, 540, 350, { fontSize: 64, fontWeight: '700', color: theme.text });
            drawText(title2, 540, 440, { fontSize: 72, fontWeight: '900', color: theme.primary });
            ctx.globalAlpha = 1;

            const mediaElapsed = Math.max(0, elapsed - 600);
            const currentIdx = Math.min(Math.floor(mediaElapsed / mediaDuration), mediaCount - 1);
            const localP = (mediaElapsed % mediaDuration) / mediaDuration;

            if (validMedia[currentIdx]) {
                const zoomP = easeOutCubic(Math.min(localP * 2.5, 1));
                const radius = maxRadius * zoomP;
                const fadeOut = currentIdx < mediaCount - 1 ? Math.max(0, 1 - (localP - 0.7) * 3.3) : 1;

                ctx.globalAlpha = fadeOut;
                ctx.save();
                ctx.beginPath();
                ctx.arc(centerX, centerY, radius, 0, Math.PI * 2);
                ctx.clip();
                drawMediaCover(ctx, validMedia[currentIdx], centerX - radius, centerY - radius, radius * 2, radius * 2);
                ctx.restore();

                ctx.strokeStyle = validMedia[currentIdx].type === 'video' ? '#a55eea' : theme.primary;
                ctx.lineWidth = 6;
                ctx.beginPath();
                ctx.arc(centerX, centerY, radius, 0, Math.PI * 2);
                ctx.stroke();
                ctx.globalAlpha = 1;
            }

            const rippleP = (elapsed % 1500) / 1500;
            [1, 1.2, 1.4].forEach((mult, i) => {
                const rp = (rippleP + i * 0.15) % 1;
                ctx.globalAlpha = 0.4 * (1 - rp);
                ctx.strokeStyle = theme.secondary;
                ctx.lineWidth = 3;
                ctx.beginPath();
                ctx.arc(centerX, centerY, maxRadius + 100 * rp, 0, Math.PI * 2);
                ctx.stroke();
            });
            ctx.globalAlpha = 1;

            if (elapsed > duration - 2000) {
                const ctaP = Math.min((elapsed - (duration - 2000)) / 600, 1);
                drawCTAButton(theme, 1450, easeOutCubic(ctaP));
            }
        }

        function animateDynamicGrid(elapsed, duration, theme) {
            const title1 = document.getElementById('mainTitle').value;
            const title2 = document.getElementById('mainTitle2').value;

            const titleP = Math.min(elapsed / 600, 1);
            ctx.globalAlpha = easeOutCubic(titleP);
            drawText(title1, 540, 350, { fontSize: 64, fontWeight: '700', color: theme.text });
            drawText(title2, 540, 440, { fontSize: 72, fontWeight: '900', color: theme.primary });
            ctx.globalAlpha = 1;

            const size = 280;
            const positions = [
                { x: 100, y: 550, rot: -8 },
                { x: 420, y: 520, rot: 5 },
                { x: 720, y: 560, rot: -4 },
                { x: 180, y: 870, rot: 6 },
                { x: 540, y: 900, rot: -5 }
            ];

            state.media.forEach((media, i) => {
                if (!media || i >= positions.length) return;
                const p = positions[i];

                const imgStart = 500 + i * 350;
                const imgElapsed = Math.max(0, elapsed - imgStart);
                const imgP = Math.min(imgElapsed / 500, 1);

                if (imgP <= 0) return;

                const scale = easeOutBack(imgP);
                const rotation = p.rot * easeOutCubic(imgP);

                ctx.save();
                ctx.globalAlpha = easeOutCubic(imgP);
                ctx.translate(p.x + size/2, p.y + size/2);
                ctx.rotate(rotation * Math.PI / 180);
                ctx.scale(scale, scale);

                ctx.shadowColor = 'rgba(0,0,0,0.3)';
                ctx.shadowBlur = 25;

                drawMediaCover(ctx, media, -size/2, -size/2, size, size, 16);

                ctx.strokeStyle = media.type === 'video' ? '#a55eea' : theme.primary;
                ctx.lineWidth = 4;
                roundRect(ctx, -size/2, -size/2, size, size, 16);
                ctx.stroke();

                ctx.restore();
            });

            if (elapsed > duration - 2500) {
                const ctaP = Math.min((elapsed - (duration - 2500)) / 600, 1);
                drawCTAButton(theme, 1450, easeOutCubic(ctaP));
            }
        }

        // Recording
        function toggleRecording() {
            if (state.isRecording) {
                stopRecording();
            } else {
                startRecording();
            }
        }

        function startRecording() {
            state.videoBlob = null;
            document.getElementById('downloadBtn').disabled = true;

            const stream = canvas.captureStream(60);
            const mediaRecorder = new MediaRecorder(stream, {
                mimeType: 'video/webm;codecs=vp9',
                videoBitsPerSecond: 10000000
            });

            const chunks = [];

            mediaRecorder.ondataavailable = (e) => {
                if (e.data.size > 0) chunks.push(e.data);
            };

            mediaRecorder.onstop = () => {
                state.videoBlob = new Blob(chunks, { type: 'video/webm' });
                document.getElementById('downloadBtn').disabled = false;
                document.getElementById('status').textContent = 'âœ… ë…¹í™” ì™„ë£Œ! ë‹¤ìš´ë¡œë“œë¥¼ ëˆŒëŸ¬ì£¼ì„¸ìš”';
                document.getElementById('status').classList.remove('recording');
            };

            state.mediaRecorder = mediaRecorder;
            mediaRecorder.start();
            state.isRecording = true;

            document.getElementById('recordBtn').classList.add('recording');
            document.getElementById('recordBtn').textContent = 'â–  ì¤‘ì§€';
            document.getElementById('status').textContent = 'ğŸ”´ ë…¹í™” ì¤‘...';
            document.getElementById('status').classList.add('recording');

            setTimeout(() => playAnimation(), 300);
        }

        function stopRecording() {
            if (state.mediaRecorder && state.mediaRecorder.state !== 'inactive') {
                state.mediaRecorder.stop();
            }
            state.isRecording = false;
            document.getElementById('recordBtn').classList.remove('recording');
            document.getElementById('recordBtn').textContent = 'â— ë…¹í™”';
        }

        function downloadVideo() {
            if (!state.videoBlob) return;

            const url = URL.createObjectURL(state.videoBlob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `moyeoradeal_${state.template}_${Date.now()}.webm`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);

            document.getElementById('status').textContent = 'â¬‡ï¸ ë‹¤ìš´ë¡œë“œ ì™„ë£Œ! (WebM â†’ MP4: cloudconvert.com)';
        }

        // Init on page load if already logged in
        if (isLoggedIn()) {
            init();
        }
    </script>
</body>
</html>
