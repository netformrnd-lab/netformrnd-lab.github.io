<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ì…€ëŸ¬ ê°€ì´ë“œ | ëª¨ì—¬ë¼ë”œ</title>
    <link href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.9/dist/web/static/pretendard.min.css" rel="stylesheet">
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        :root { 
            --main: #fc9600; 
            --main-dark: #e08600; 
            --white: #ffffff; 
            --gray-900: #191f28;
            --gray-700: #4e5968;
            --gray-500: #8b95a1;
            --gray-200: #e5e8eb;
            --gray-100: #f2f4f6;
            --gray-50: #f9fafb;
        }
        body { 
            font-family: 'Pretendard', -apple-system, sans-serif; 
            background: linear-gradient(180deg, var(--main) 0%, #ffb340 100%); 
            min-height: 100vh; 
            padding: 20px 16px 40px; 
            line-height: 1.5; 
        }
        
        .logo { text-align: center; margin-bottom: 20px; }
        .logo img { height: 40px; }
        
        .header { text-align: center; color: var(--white); margin-bottom: 24px; }
        .header h1 { font-size: 22px; font-weight: 800; text-shadow: 0 2px 8px rgba(0,0,0,0.15); margin-bottom: 6px; }
        .header p { font-size: 14px; opacity: 0.95; }
        
        .tabs { display: flex; gap: 6px; margin-bottom: 20px; flex-wrap: wrap; }
        .tab-btn { 
            flex: 1; 
            min-width: calc(33% - 4px);
            padding: 12px 6px; 
            border: none; 
            border-radius: 14px; 
            font-size: 13px; 
            font-weight: 700; 
            cursor: pointer; 
            background: linear-gradient(180deg, #ffffff 0%, #f0f0f0 100%); 
            color: var(--gray-500); 
            box-shadow: 0 4px 0 #d0d0d0, 0 6px 12px rgba(0,0,0,0.15); 
        }
        .tab-btn.active { 
            background: linear-gradient(180deg, #ffffff 0%, #fff8f0 100%); 
            color: var(--main); 
            box-shadow: 0 2px 0 var(--main-dark), 0 4px 12px rgba(252, 150, 0, 0.3); 
            transform: translateY(2px); 
        }
        .tab-btn:active { transform: translateY(2px); }
        
        .content-card { 
            background: var(--white); 
            border-radius: 24px; 
            padding: 24px 20px; 
            box-shadow: 0 8px 0 rgba(0,0,0,0.08), 0 12px 24px rgba(0,0,0,0.1); 
        }
        
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        
        .section-title { 
            font-size: 18px; 
            font-weight: 800; 
            color: var(--main); 
            margin-bottom: 16px; 
        }
        
        /* ê³µêµ¬ ë§ì¶¤ ê°€ì´ë“œ - ìƒí’ˆ ì¹´ë“œ */
        .product-card { 
            background: var(--gray-100); 
            border-radius: 16px; 
            padding: 16px; 
            margin-bottom: 12px; 
            display: flex; 
            align-items: center; 
            gap: 12px; 
        }
        .product-card.featured { 
            background: linear-gradient(135deg, #fff8f0 0%, #ffedd5 100%); 
            border: 2px solid var(--main); 
        }
        .product-icon { 
            font-size: 28px; 
            width: 48px; 
            height: 48px; 
            background: var(--white); 
            border-radius: 12px; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            box-shadow: 0 2px 8px rgba(0,0,0,0.08); 
        }
        .product-info { flex: 1; }
        .product-name { font-size: 15px; font-weight: 700; color: #333; margin-bottom: 2px; }
        .product-desc { font-size: 12px; color: var(--gray-500); }
        .product-price { text-align: right; }
        .price-original { font-size: 12px; color: #999; text-decoration: line-through; }
        .price-sale { font-size: 18px; font-weight: 800; color: #e53935; }
        .price-discount { 
            display: inline-block; 
            background: #e53935; 
            color: white; 
            font-size: 11px; 
            font-weight: 700; 
            padding: 2px 6px; 
            border-radius: 4px; 
            margin-top: 2px; 
        }
        
        /* í˜œíƒ ë°•ìŠ¤ */
        .benefit-box {
            background: linear-gradient(135deg, #fffbeb 0%, #fef3c7 100%);
            border: 1px solid #fcd34d;
            border-radius: 16px;
            padding: 16px;
            margin-bottom: 16px;
        }
        .benefit-item {
            display: flex;
            align-items: start;
            gap: 10px;
            padding: 10px 0;
            border-bottom: 1px dashed #fcd34d;
        }
        .benefit-item:last-child { border-bottom: none; }
        .benefit-icon { font-size: 20px; flex-shrink: 0; }
        .benefit-label { font-size: 11px; color: #92400e; margin-bottom: 2px; }
        .benefit-text { font-size: 14px; font-weight: 600; color: #78350f; }
        
        /* ì¼ì • íƒ€ì„ë¼ì¸ */
        .timeline-item { 
            display: flex; 
            gap: 12px; 
            margin-bottom: 16px; 
            padding-bottom: 16px; 
            border-bottom: 1px solid #eee; 
        }
        .timeline-item:last-child { border-bottom: none; margin-bottom: 0; padding-bottom: 0; }
        .timeline-dot { 
            width: 32px; 
            height: 32px; 
            background: linear-gradient(180deg, var(--main) 0%, var(--main-dark) 100%); 
            border-radius: 50%; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            color: white; 
            font-size: 14px; 
            font-weight: 700; 
            flex-shrink: 0; 
            box-shadow: 0 3px 0 rgba(0,0,0,0.15); 
        }
        .timeline-content { flex: 1; }
        .timeline-title { font-size: 15px; font-weight: 700; color: #333; margin-bottom: 4px; }
        .timeline-desc { font-size: 13px; color: var(--gray-500); line-height: 1.6; }
        .timeline-highlight { 
            background: #fff3cd; 
            color: #856404; 
            padding: 2px 6px; 
            border-radius: 4px; 
            font-weight: 600; 
            font-size: 12px; 
            display: inline-block; 
            margin-top: 4px; 
        }
        
        /* íŒ ë°•ìŠ¤ */
        .tip-box { 
            background: linear-gradient(135deg, #e8f5e9 0%, #c8e6c9 100%); 
            border-radius: 12px; 
            padding: 14px 16px; 
            margin-top: 20px; 
        }
        .tip-title { font-size: 14px; font-weight: 700; color: #2e7d32; margin-bottom: 6px; }
        .tip-desc { font-size: 13px; color: #1b5e20; line-height: 1.5; }
        
        /* ìº¡ì…˜ ì„¹ì…˜ */
        .caption-section { margin-bottom: 24px; }
        .caption-label { 
            font-size: 14px; 
            font-weight: 700; 
            color: #333; 
            margin-bottom: 10px; 
            display: flex; 
            align-items: center; 
            gap: 6px; 
        }
        .caption-label .num { 
            width: 22px; 
            height: 22px; 
            background: var(--main); 
            color: white; 
            border-radius: 50%; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            font-size: 12px; 
        }
        .caption-box { 
            background: var(--gray-100); 
            border-radius: 12px; 
            padding: 16px; 
            font-size: 13px; 
            line-height: 1.8; 
            color: #333; 
            margin-bottom: 10px; 
            white-space: pre-line; 
            max-height: 220px; 
            overflow-y: auto; 
        }
        
        /* ë³µì‚¬ ë²„íŠ¼ */
        .copy-btn { 
            width: 100%; 
            padding: 14px; 
            border: none; 
            border-radius: 12px; 
            font-size: 15px; 
            font-weight: 700; 
            cursor: pointer; 
            background: linear-gradient(180deg, #ffffff 0%, #f5f5f5 100%); 
            color: var(--main); 
            box-shadow: 0 4px 0 #d0d0d0, 0 6px 12px rgba(0,0,0,0.1); 
        }
        .copy-btn:active { transform: translateY(2px); }
        
        /* í•´ì‹œíƒœê·¸ */
        .hashtag-box { 
            background: var(--gray-100); 
            border-radius: 12px; 
            padding: 16px; 
            margin-top: 20px; 
        }
        .hashtag-title { font-size: 14px; font-weight: 700; color: #333; margin-bottom: 10px; }
        .hashtags { display: flex; flex-wrap: wrap; gap: 6px; }
        .hashtag { 
            background: var(--white); 
            padding: 6px 10px; 
            border-radius: 20px; 
            font-size: 12px; 
            color: var(--main); 
            font-weight: 600; 
            box-shadow: 0 2px 4px rgba(0,0,0,0.06); 
        }
        
        /* ê³µí†µ ê°€ì´ë“œ ì¹´ë“œ */
        .guide-card {
            background: var(--white);
            border-radius: 16px;
            padding: 20px;
            margin-bottom: 16px;
            border: 1px solid var(--gray-200);
        }
        .guide-card h3 {
            font-size: 16px;
            font-weight: 700;
            color: var(--gray-900);
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .guide-card ul {
            list-style: none;
            padding: 0;
        }
        .guide-card li {
            padding: 10px 0;
            border-bottom: 1px solid var(--gray-100);
            font-size: 14px;
            color: var(--gray-700);
            display: flex;
            align-items: start;
            gap: 8px;
        }
        .guide-card li:last-child { border-bottom: none; }
        .guide-card li::before {
            content: 'âœ“';
            color: var(--main);
            font-weight: 700;
            flex-shrink: 0;
        }
        
        /* í† ìŠ¤íŠ¸ */
        .toast { 
            position: fixed; 
            bottom: 30px; 
            left: 50%; 
            transform: translateX(-50%) translateY(100px); 
            background: #333; 
            color: white; 
            padding: 14px 28px; 
            border-radius: 30px; 
            font-size: 14px; 
            font-weight: 600; 
            opacity: 0; 
            transition: all 0.3s; 
            z-index: 1000; 
        }
        .toast.show { transform: translateX(-50%) translateY(0); opacity: 1; }
        
        .footer { text-align: center; margin-top: 24px; color: rgba(255,255,255,0.8); font-size: 12px; }
        
        /* ë¡œë”© */
        .loading {
            text-align: center;
            padding: 40px;
            color: var(--gray-500);
        }
        .loading-spinner {
            width: 40px;
            height: 40px;
            border: 3px solid var(--gray-200);
            border-top-color: var(--main);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 16px;
        }
        @keyframes spin { to { transform: rotate(360deg); } }
        
        /* ê³µêµ¬ ì •ë³´ ì—†ì„ ë•Œ */
        .no-deal {
            text-align: center;
            padding: 30px 20px;
        }
        .no-deal-icon {
            font-size: 48px;
            margin-bottom: 16px;
        }
        .no-deal h2 {
            font-size: 18px;
            color: var(--gray-700);
            margin-bottom: 8px;
        }
        .no-deal p {
            font-size: 14px;
            color: var(--gray-500);
        }
    </style>
</head>
<body>
    <div class="logo">
        <img src="logo-horizontal.png" alt="ëª¨ì—¬ë¼ë”œ">
    </div>
    
    <div id="app">
        <div class="loading">
            <div class="loading-spinner"></div>
            <p>ê°€ì´ë“œ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>
        </div>
    </div>
    
    <div class="footer">ê¶ê¸ˆí•œ ì ì€ ì–¸ì œë“  ë¬¸ì˜ì£¼ì„¸ìš” ğŸ˜Š</div>
    
    <div class="toast" id="toast">âœ“ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!</div>
    
    <script>
        // Firebase ì´ˆê¸°í™”
        const firebaseConfig = {
            apiKey: "AIzaSyCGa0mfQPa1X7EpCB8wutX9GiU7TWD-fFg",
            authDomain: "moyeoradeal.firebaseapp.com",
            projectId: "moyeoradeal",
            storageBucket: "moyeoradeal.firebasestorage.app",
            messagingSenderId: "362aborede994012",
            appId: "1:362994012108:web:7a192f3a4be4fcda4ef513"
        };
        
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        
        // URL íŒŒë¼ë¯¸í„°ì—ì„œ deal ID ê°€ì ¸ì˜¤ê¸°
        const urlParams = new URLSearchParams(window.location.search);
        const dealId = urlParams.get('id');
        
        // ì•± ìƒíƒœ
        let state = {
            deal: null,
            supplier: null,
            seller: null,
            products: [],
            isCustomGuide: !!dealId
        };
        
        // ì´ˆê¸°í™”
        async function init() {
            if (dealId) {
                // ê³µêµ¬ë³„ ë§ì¶¤ ê°€ì´ë“œ
                await loadDealData(dealId);
            } else {
                // ê³µí†µ ê°€ì´ë“œ
                renderCommonGuide();
            }
        }
        
        // ê³µêµ¬ ë°ì´í„° ë¡œë“œ
        async function loadDealData(id) {
            try {
                const dealDoc = await db.collection('deals').doc(id).get();
                if (!dealDoc.exists) {
                    renderNoDeal();
                    return;
                }
                
                state.deal = { id: dealDoc.id, ...dealDoc.data() };
                
                // ê³µê¸‰ì‚¬ ì •ë³´
                if (state.deal.supplierId) {
                    const supplierDoc = await db.collection('suppliers').doc(state.deal.supplierId).get();
                    if (supplierDoc.exists) {
                        state.supplier = { id: supplierDoc.id, ...supplierDoc.data() };
                    }
                }
                
                // ì…€ëŸ¬ ì •ë³´
                if (state.deal.sellerId) {
                    const sellerDoc = await db.collection('sellers').doc(state.deal.sellerId).get();
                    if (sellerDoc.exists) {
                        state.seller = { id: sellerDoc.id, ...sellerDoc.data() };
                    }
                }
                
                // ìƒí’ˆ ì •ë³´
                if (state.deal.selectedProducts && state.deal.selectedProducts.length > 0) {
                    const productIds = state.deal.selectedProducts.map(p => typeof p === 'string' ? p : p.productId);
                    const productsSnap = await db.collection('supplierProducts').where(firebase.firestore.FieldPath.documentId(), 'in', productIds).get();
                    state.products = productsSnap.docs.map(doc => {
                        const productData = { id: doc.id, ...doc.data() };
                        const selectedProduct = state.deal.selectedProducts.find(p => (typeof p === 'string' ? p : p.productId) === doc.id);
                        if (selectedProduct && typeof selectedProduct === 'object') {
                            productData.marginRate = selectedProduct.marginRate;
                        }
                        return productData;
                    });
                }
                
                renderCustomGuide();
            } catch (e) {
                console.error('Error loading deal:', e);
                renderNoDeal();
            }
        }
        
        // ê³µêµ¬ë³„ ë§ì¶¤ ê°€ì´ë“œ ë Œë”ë§
        function renderCustomGuide() {
            const deal = state.deal;
            const negotiation = deal.negotiation || {};
            const products = state.products;
            
            // ì…€ëŸ¬ ë‹‰ë„¤ì„ ì¶”ì¶œ
            let sellerName = 'ì…€ëŸ¬';
            if (state.seller?.name) {
                const parts = state.seller.name.split('/');
                sellerName = parts.length > 1 ? parts[1].split('(')[0] : parts[0];
            }
            
            // ìƒí’ˆëª… ëª©ë¡
            const productNames = products.map(p => p.productName).slice(0, 3);
            const productDisplay = productNames.join(', ') + (products.length > 3 ? ' ì™¸' : '');
            
            document.querySelector('.header')?.remove();
            
            const app = document.getElementById('app');
            app.innerHTML = `
                <div class="header">
                    <h1>ğŸ“ ${sellerName}ë‹˜ ê³µêµ¬ ê°€ì´ë“œ</h1>
                    <p>${productDisplay || deal.title}</p>
                </div>
                
                <div class="tabs">
                    <button class="tab-btn active" onclick="showTab('benefit')">ğŸ í˜œíƒ</button>
                    <button class="tab-btn" onclick="showTab('product')">ğŸ“¦ ìƒí’ˆ</button>
                    <button class="tab-btn" onclick="showTab('schedule')">ğŸ“… ì¼ì •</button>
                    <button class="tab-btn" onclick="showTab('caption')">âœï¸ ìº¡ì…˜</button>
                    <button class="tab-btn" onclick="showTab('tip')">ğŸ’¡ íŒ</button>
                </div>
                
                <div class="content-card">
                    <!-- í˜œíƒ íƒ­ -->
                    <div id="benefit" class="tab-content active">
                        <div class="section-title">ğŸ ì´ë²ˆ ê³µêµ¬ í˜œíƒ</div>
                        
                        ${(negotiation.eventSupplier || negotiation.event || negotiation.eventMoyeora || negotiation.support) ? `
                        <div class="benefit-box">
                            ${(negotiation.eventSupplier || negotiation.event) ? `
                            <div class="benefit-item">
                                <span class="benefit-icon">ğŸ­</span>
                                <div>
                                    <div class="benefit-label">ê³µê¸‰ì‚¬ ì œê³µ</div>
                                    <div class="benefit-text">${negotiation.eventSupplier || negotiation.event}</div>
                                </div>
                            </div>
                            ` : ''}
                            
                            ${negotiation.eventMoyeora ? `
                            <div class="benefit-item">
                                <span class="benefit-icon">ğŸ§¡</span>
                                <div>
                                    <div class="benefit-label" style="color: var(--main);">ëª¨ì—¬ë¼ë”œ ì œê³µ</div>
                                    <div class="benefit-text" style="color: #ea580c;">${negotiation.eventMoyeora}</div>
                                </div>
                            </div>
                            ` : ''}
                            
                            ${negotiation.support ? `
                            <div class="benefit-item">
                                <span class="benefit-icon">ğŸ¯</span>
                                <div>
                                    <div class="benefit-label" style="color: var(--gray-500);">ì„œë¹„ìŠ¤ ì§€ì›</div>
                                    <div class="benefit-text" style="color: var(--gray-700);">${negotiation.support}</div>
                                </div>
                            </div>
                            ` : ''}
                        </div>
                        ` : `
                        <div style="text-align: center; padding: 30px; color: var(--gray-500);">
                            <p>ë“±ë¡ëœ í˜œíƒ ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤.</p>
                        </div>
                        `}
                        
                        <div class="tip-box">
                            <div class="tip-title">ğŸ’¡ í˜œíƒ í™œìš© íŒ</div>
                            <div class="tip-desc">
                                â€¢ í˜œíƒì„ ìº¡ì…˜ì— ëª…í™•íˆ ì•ˆë‚´í•´ì£¼ì„¸ìš”<br>
                                â€¢ ì´ë²¤íŠ¸ ë‹¹ì²¨ìëŠ” ê³µêµ¬ì˜¤í”ˆ í”¼ë“œ/ëŒ“ê¸€ì—ì„œ ë°œí‘œí•´ìš”
                            </div>
                        </div>
                    </div>
                    
                    <!-- ìƒí’ˆ íƒ­ -->
                    <div id="product" class="tab-content">
                        <div class="section-title">ğŸ“¦ íŒë§¤ ìƒí’ˆ</div>
                        
                        ${products.length > 0 ? products.map((p, idx) => `
                        <div class="product-card ${idx === 0 ? 'featured' : ''}">
                            <div class="product-icon">${getProductIcon(p.productName)}</div>
                            <div class="product-info">
                                <div class="product-name">${p.productName}</div>
                                <div class="product-desc">${p.category || ''}</div>
                            </div>
                            <div class="product-price">
                                ${p.originalPrice ? `<div class="price-original">${Number(p.originalPrice).toLocaleString()}ì›</div>` : ''}
                                ${p.salePrice ? `<div class="price-sale">${Number(p.salePrice).toLocaleString()}ì›</div>` : ''}
                                ${p.marginRate ? `<div class="price-discount">${p.marginRate}%</div>` : ''}
                            </div>
                        </div>
                        `).join('') : `
                        <div style="text-align: center; padding: 30px; color: var(--gray-500);">
                            <p>ë“±ë¡ëœ ìƒí’ˆ ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤.</p>
                        </div>
                        `}
                    </div>
                    
                    <!-- ì¼ì • íƒ­ -->
                    <div id="schedule" class="tab-content">
                        <div class="section-title">ğŸ“… í•„ìˆ˜ í”¼ë“œ 3ê°œ</div>
                        
                        <div class="timeline-item">
                            <div class="timeline-dot">1</div>
                            <div class="timeline-content">
                                <div class="timeline-title">ğŸ”¥ ê³µêµ¬ì˜ˆê³  D-1</div>
                                <div class="timeline-desc">
                                    "ì•Œë¦¼" ëŒ“ê¸€ ì´ë²¤íŠ¸ ì§„í–‰<br>
                                    <span class="timeline-highlight">ë‹¹ì²¨ë°œí‘œëŠ” ê³µêµ¬ì˜¤í”ˆ í”¼ë“œì—ì„œ!</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="timeline-item">
                            <div class="timeline-dot">2</div>
                            <div class="timeline-content">
                                <div class="timeline-title">ğŸ”¥ ê³µêµ¬ì˜ˆê³  D-8ì‹œê°„</div>
                                <div class="timeline-desc">
                                    ì„ ì°©ìˆœ/í›„ê¸°ì¸ì¦ ì´ë²¤íŠ¸ ë¦¬ë§ˆì¸ë“œ<br>
                                    D-1 ì•Œë¦¼ëŒ“ê¸€ ì´ë²¤íŠ¸ ë¦¬ë§ˆì¸ë“œ
                                </div>
                            </div>
                        </div>
                        
                        <div class="timeline-item">
                            <div class="timeline-dot">3</div>
                            <div class="timeline-content">
                                <div class="timeline-title">ğŸ”¥ ê³µêµ¬ì˜¤í”ˆ</div>
                                <div class="timeline-desc">
                                    D-1 ì•Œë¦¼ëŒ“ê¸€ ë‹¹ì²¨ì ë°œí‘œ (í”¼ë“œ ë‚´)<br>
                                    ìƒí’ˆ ìƒì„¸ ì†Œê°œ<br>
                                    <span class="timeline-highlight">ì„ ì°©ìˆœ/í›„ê¸°ì¸ì¦ â†’ ëŒ“ê¸€ ê³ ì •ìœ¼ë¡œ ë°œí‘œ</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="tip-box">
                            <div class="tip-title">ğŸ’¡ íŒë§¤ UP ê¿€íŒ!</div>
                            <div class="tip-desc">ìŠ¤í† ë¦¬ë‚˜ ì¶”ê°€ í”¼ë“œë¡œ í™ë³´í•˜ë©´<br>íŒë§¤ëŸ‰ì´ ë” ì˜¬ë¼ê°€ìš”!</div>
                        </div>
                    </div>
                    
                    <!-- ìº¡ì…˜ íƒ­ -->
                    <div id="caption" class="tab-content">
                        <div class="section-title">âœï¸ ìº¡ì…˜ ë³µì‚¬</div>
                        
                        <div class="caption-section">
                            <div class="caption-label"><span class="num">1</span> ê³µêµ¬ì˜ˆê³  D-1</div>
                            <div class="caption-box" id="caption1"></div>
                            <button class="copy-btn" onclick="copyCaption(1)">ğŸ“‹ ë³µì‚¬í•˜ê¸°</button>
                        </div>
                        
                        <div class="caption-section">
                            <div class="caption-label"><span class="num">2</span> ê³µêµ¬ì˜ˆê³  D-8ì‹œê°„</div>
                            <div class="caption-box" id="caption2"></div>
                            <button class="copy-btn" onclick="copyCaption(2)">ğŸ“‹ ë³µì‚¬í•˜ê¸°</button>
                        </div>
                        
                        <div class="caption-section">
                            <div class="caption-label"><span class="num">3</span> ê³µêµ¬ì˜¤í”ˆ</div>
                            <div class="caption-box" id="caption3"></div>
                            <button class="copy-btn" onclick="copyCaption(3)">ğŸ“‹ ë³µì‚¬í•˜ê¸°</button>
                        </div>
                        
                        <div class="hashtag-box">
                            <div class="hashtag-title">#ï¸âƒ£ í•´ì‹œíƒœê·¸</div>
                            <div class="hashtags" id="hashtags"></div>
                            <button class="copy-btn" style="margin-top: 12px;" onclick="copyHashtags()">ğŸ“‹ í•´ì‹œíƒœê·¸ ë³µì‚¬</button>
                        </div>
                    </div>
                    
                    <!-- íŒ íƒ­ -->
                    <div id="tip" class="tab-content">
                        <div class="section-title">ğŸ’¡ ì»¨í…ì¸  ì œì‘ íŒ</div>
                        
                        <div class="guide-card">
                            <h3>ğŸ“¸ ì´¬ì˜ íŒ</h3>
                            <ul>
                                <li>ìì—°ê´‘ì—ì„œ ì´¬ì˜í•˜ë©´ ìƒ‰ê°ì´ ì˜ˆë»ìš”</li>
                                <li>ì œí’ˆì„ 45ë„ ê°ë„ë¡œ ì°ìœ¼ë©´ ì…ì²´ê° UP</li>
                                <li>ë°°ê²½ì€ ì‹¬í”Œí•˜ê²Œ, ì œí’ˆì´ ë‹ë³´ì´ê²Œ</li>
                                <li>ì‚¬ìš©í•˜ëŠ” ëª¨ìŠµ(ì†/ì–¼êµ´)ì„ í•¨ê»˜ ì°ìœ¼ë©´ ì‹ ë¢°ë„ UP</li>
                            </ul>
                        </div>
                        
                        <div class="guide-card">
                            <h3>ğŸ“ ìº¡ì…˜ ì‘ì„± íŒ</h3>
                            <ul>
                                <li>ì²« ì¤„ì— ì´ëª¨ì§€ì™€ í•µì‹¬ ë©”ì‹œì§€ë¥¼ ë„£ì–´ìš”</li>
                                <li>í˜œíƒ/í• ì¸ìœ¨ì„ ëª…í™•í•˜ê²Œ ê°•ì¡°í•´ìš”</li>
                                <li>êµ¬ë§¤ ë§í¬ ìœ„ì¹˜ë¥¼ ê¼­ ì•ˆë‚´í•´ìš” (í”„ë¡œí•„ ë§í¬)</li>
                                <li>ë§ˆê° ì‹œê°„ì„ ëª…ì‹œí•˜ë©´ êµ¬ë§¤ ì „í™˜ìœ¨ UP</li>
                            </ul>
                        </div>
                        
                        <div class="guide-card">
                            <h3>ğŸ“± ê³„ì • ê´€ë¦¬ íŒ</h3>
                            <ul>
                                <li>ìŠ¤í† ë¦¬ëŠ” í•˜ë£¨ 3~5íšŒ ì—…ë¡œë“œê°€ ì ë‹¹í•´ìš”</li>
                                <li>ëŒ“ê¸€ì— ë¹ ë¥´ê²Œ ë‹µë³€í•˜ë©´ íŒ”ë¡œì›Œ ì¶©ì„±ë„ UP</li>
                                <li>ê³µêµ¬ ì „ë‚  ì˜ˆê³  í”¼ë“œë¥¼ ê¼­ ì˜¬ë ¤ì£¼ì„¸ìš”</li>
                                <li>ê³µêµ¬ í›„ ê°ì‚¬ ì¸ì‚¬ + í›„ê¸° ê³µìœ ë„ ì¤‘ìš”í•´ìš”</li>
                            </ul>
                        </div>
                    </div>
                </div>
            `;
            
            // ìº¡ì…˜ ë‚´ìš© ì„¤ì •
            setupCaptions();
            setupHashtags();
        }
        
        // ìº¡ì…˜ ì„¤ì •
        function setupCaptions() {
            const deal = state.deal;
            const negotiation = deal?.negotiation || {};
            const products = state.products;
            
            // ìƒí’ˆëª… ëª©ë¡
            const productDisplay = products.map(p => p.productName).slice(0, 2).join(', ');
            
            // í˜œíƒ í…ìŠ¤íŠ¸
            const supplierBenefit = negotiation.eventSupplier || negotiation.event || '';
            const moyeoraBenefit = negotiation.eventMoyeora || '';
            
            window.captions = {
                1: `ğŸ”¥ ê³µêµ¬ì˜¤í”ˆ D-1

${productDisplay ? productDisplay + ' ğŸ' : ''}

${supplierBenefit ? `ì²´í—˜í•˜ì‹¤ë¶„~ ëŒ“ê¸€ ë‚¨ê²¨ì£¼ì‹œë©´
${supplierBenefit} ë³´ë‚´ë“œë¦´ê²Œìš”~!
"ì•Œë¦¼" ëŒ“ê¸€ ë‚¨ê²¨ì£¼ì„¸ìš” :)
ë‹¹ì²¨ë°œí‘œëŠ” ê³µêµ¬ì˜¤í”ˆí”¼ë“œì—ì„œ ë§Œë‚˜ìš”~!` : '"ì•Œë¦¼" ëŒ“ê¸€ ë‚¨ê²¨ì£¼ì„¸ìš” :)'}

${moyeoraBenefit ? `ğŸ ${moyeoraBenefit}` : ''}

ğŸ“ [ë‚ ì§œ] ì˜¤í›„ [ì‹œê°„] ì˜¤í”ˆ
ğŸ“ í”„ë¡œí•„ ë§í¬ í™•ì¸í•´ì£¼ì„¸ìš”!`,

                2: `ğŸ”¥ ê³µêµ¬ì˜¤í”ˆ D-8ì‹œê°„

${moyeoraBenefit ? `ğŸ ${moyeoraBenefit}` : ''}

â”â”â”â”â”â”â”â”â”â”â”â”

${supplierBenefit ? `D-1 ê³µêµ¬ì˜ˆê³  í”¼ë“œì— ëŒ“ê¸€ì£¼ì‹œë©´
${supplierBenefit} ë³´ë‚´ë“œë¦¬ë‹ˆê¹Œ
ìŠì§€ë§ˆì„¸ìš”!` : 'D-1 ê³µêµ¬ì˜ˆê³  í”¼ë“œ í™•ì¸í•´ì£¼ì„¸ìš”!'}

ğŸ“ ì˜¤ëŠ˜ [ì‹œê°„] ì˜¤í”ˆ
ğŸ“ í”„ë¡œí•„ ë§í¬ í™•ì¸í•´ì£¼ì„¸ìš”!`,

                3: `ğŸ”¥ ê³µêµ¬ ì˜¤í”ˆ! ğŸ”¥

ğŸ“¢ ì•Œë¦¼ëŒ“ê¸€ ë‹¹ì²¨ì
[@ë‹¹ì²¨ì1 @ë‹¹ì²¨ì2 ...]
ì¶•í•˜ë“œë ¤ìš”! DM ì£¼ì„¸ìš” ğŸ’Œ

â”â”â”â”â”â”â”â”â”â”â”â”

ğŸ“¦ ìƒí’ˆ êµ¬ì„±
${products.map(p => `${getProductIcon(p.productName)} ${p.productName} â†’ ${p.salePrice ? Number(p.salePrice).toLocaleString() + 'ì›' : ''} ${p.marginRate ? '(' + p.marginRate + '%)' : ''}`).join('\n')}

â”â”â”â”â”â”â”â”â”â”â”â”

ğŸ›’ êµ¬ë§¤ëŠ” í”„ë¡œí•„ ë§í¬ì—ì„œ!

âœ¨ ì„ ì°©ìˆœ/í›„ê¸°ì¸ì¦ ë‹¹ì²¨ìëŠ”
ëŒ“ê¸€ ê³ ì •ìœ¼ë¡œ ë°œí‘œí•´ìš”!`
            };
            
            document.getElementById('caption1').textContent = window.captions[1];
            document.getElementById('caption2').textContent = window.captions[2];
            document.getElementById('caption3').textContent = window.captions[3];
        }
        
        // í•´ì‹œíƒœê·¸ ì„¤ì •
        function setupHashtags() {
            const products = state.products;
            const supplier = state.supplier;
            
            // ê¸°ë³¸ í•´ì‹œíƒœê·¸
            let tags = ['#ê³µë™êµ¬ë§¤', '#ê³µêµ¬'];
            
            // ìƒí’ˆëª… ê¸°ë°˜ í•´ì‹œíƒœê·¸
            products.forEach(p => {
                if (p.productName) {
                    tags.push('#' + p.productName.replace(/\s/g, ''));
                }
            });
            
            // ê³µê¸‰ì‚¬ëª… í•´ì‹œíƒœê·¸
            if (supplier?.name) {
                tags.push('#' + supplier.name.replace(/\s/g, ''));
            }
            
            window.hashtagText = tags.join(' ');
            
            const container = document.getElementById('hashtags');
            container.innerHTML = tags.map(tag => `<span class="hashtag">${tag}</span>`).join('');
        }
        
        // ìƒí’ˆ ì•„ì´ì½˜ ì¶”ì¶œ
        function getProductIcon(name) {
            if (!name) return 'ğŸ“¦';
            if (name.includes('ì ¤ë¦¬')) return 'ğŸ‡';
            if (name.includes('ì£¼ìŠ¤') || name.includes('ì¦™') || name.includes('íŒ©')) return 'ğŸ§ƒ';
            if (name.includes('ë°°')) return 'ğŸ';
            return 'ğŸ“¦';
        }
        
        // ê³µí†µ ê°€ì´ë“œ ë Œë”ë§
        function renderCommonGuide() {
            document.querySelector('.header')?.remove();
            
            const app = document.getElementById('app');
            app.innerHTML = `
                <div class="header">
                    <h1>ğŸ“š ì…€ëŸ¬ ê°€ì´ë“œ</h1>
                    <p>ê³µêµ¬ ì„±ê³µì„ ìœ„í•œ í•„ìˆ˜ ê°€ì´ë“œ</p>
                </div>
                
                <div class="tabs">
                    <button class="tab-btn active" onclick="showTab('photo')">ğŸ“¸ ì´¬ì˜</button>
                    <button class="tab-btn" onclick="showTab('caption')">âœï¸ ìº¡ì…˜</button>
                    <button class="tab-btn" onclick="showTab('account')">ğŸ“± ê³„ì •</button>
                </div>
                
                <div class="content-card">
                    <!-- ì´¬ì˜ íŒ -->
                    <div id="photo" class="tab-content active">
                        <div class="section-title">ğŸ“¸ ì´¬ì˜ ê°€ì´ë“œ</div>
                        
                        <div class="guide-card">
                            <h3>ğŸŒ ì¡°ëª…</h3>
                            <ul>
                                <li>ìì—°ê´‘ì´ ê°€ì¥ ì¢‹ì•„ìš” (ì°½ê°€ ì¶”ì²œ)</li>
                                <li>ê·¸ë¦¼ìê°€ ì§€ì§€ ì•Šë„ë¡ ë¹› ë°©í–¥ ì²´í¬</li>
                                <li>íë¦° ë‚ ì´ ì˜¤íˆë ¤ ë¶€ë“œëŸ¬ìš´ ë¹›ì„ ì–»ì„ ìˆ˜ ìˆì–´ìš”</li>
                                <li>í˜•ê´‘ë“± ì•„ë˜ëŠ” ìƒ‰ê°ì´ ì´ìƒí•´ì§ˆ ìˆ˜ ìˆì–´ìš”</li>
                            </ul>
                        </div>
                        
                        <div class="guide-card">
                            <h3>ğŸ“ êµ¬ë„</h3>
                            <ul>
                                <li>ì œí’ˆì„ í™”ë©´ ì¤‘ì•™ì— ë°°ì¹˜</li>
                                <li>45ë„ ê°ë„ë¡œ ì°ìœ¼ë©´ ì…ì²´ê° UP</li>
                                <li>ì—¬ë°±ì„ ì ì ˆíˆ í™œìš© (ê½‰ ì±„ìš°ì§€ ì•Šê¸°)</li>
                                <li>ë‹¤ì–‘í•œ ê°ë„ë¡œ 3~5ì¥ ì´ìƒ ì´¬ì˜</li>
                            </ul>
                        </div>
                        
                        <div class="guide-card">
                            <h3>ğŸ¨ ë°°ê²½</h3>
                            <ul>
                                <li>ë‹¨ìƒ‰ ë°°ê²½ì´ ì œí’ˆì„ ë‹ë³´ì´ê²Œ í•´ìš”</li>
                                <li>í°ìƒ‰, ë² ì´ì§€, ìš°ë“œí†¤ ì¶”ì²œ</li>
                                <li>ìƒí™œê° ìˆëŠ” ë°°ê²½ë„ ì¢‹ì•„ìš” (í…Œì´ë¸”, ì£¼ë°©)</li>
                                <li>ë„ˆë¬´ ë³µì¡í•œ ë°°ê²½ì€ í”¼í•´ì£¼ì„¸ìš”</li>
                            </ul>
                        </div>
                        
                        <div class="guide-card">
                            <h3>âœ¨ ì—°ì¶œ</h3>
                            <ul>
                                <li>ì œí’ˆ ì‚¬ìš© ëª¨ìŠµì„ í•¨ê»˜ ì°ìœ¼ë©´ ì‹ ë¢°ë„ UP</li>
                                <li>ì†ì´ë‚˜ ì–¼êµ´ì´ ë‚˜ì˜¤ë©´ ë” ìì—°ìŠ¤ëŸ¬ì›Œìš”</li>
                                <li>ì†Œí’ˆ í™œìš© (ì»µ, ì ‘ì‹œ, ì‹ë¬¼ ë“±)</li>
                                <li>ì–¸ë°•ì‹± ì˜ìƒë„ ì¸ê¸° ìˆì–´ìš”</li>
                            </ul>
                        </div>
                    </div>
                    
                    <!-- ìº¡ì…˜ ê°€ì´ë“œ -->
                    <div id="caption" class="tab-content">
                        <div class="section-title">âœï¸ ìº¡ì…˜ ì‘ì„± ê°€ì´ë“œ</div>
                        
                        <div class="guide-card">
                            <h3>ğŸ“Œ í•„ìˆ˜ í¬í•¨ ë‚´ìš©</h3>
                            <ul>
                                <li>ê³µêµ¬ ê¸°ê°„ (ì‹œì‘ì¼~ë§ˆê°ì¼)</li>
                                <li>í• ì¸ìœ¨ ë˜ëŠ” íŠ¹ê°€ ì •ë³´</li>
                                <li>êµ¬ë§¤ ë§í¬ ìœ„ì¹˜ (í”„ë¡œí•„ ë§í¬)</li>
                                <li>ì´ë²¤íŠ¸/í˜œíƒ ì•ˆë‚´</li>
                            </ul>
                        </div>
                        
                        <div class="guide-card">
                            <h3>ğŸ’¡ ì‘ì„± íŒ</h3>
                            <ul>
                                <li>ì²« ì¤„ì— ì´ëª¨ì§€ + í•µì‹¬ ë©”ì‹œì§€</li>
                                <li>ê°€ê²©/í• ì¸ìœ¨ì€ ìˆ«ìë¡œ ëª…í™•í•˜ê²Œ</li>
                                <li>ì¤„ë°”ê¿ˆìœ¼ë¡œ ê°€ë…ì„± ë†’ì´ê¸°</li>
                                <li>í•´ì‹œíƒœê·¸ëŠ” 10~15ê°œê°€ ì ë‹¹í•´ìš”</li>
                            </ul>
                        </div>
                        
                        <div class="guide-card">
                            <h3>ğŸ”¥ ì „í™˜ìœ¨ ë†’ì´ëŠ” ë¬¸êµ¬</h3>
                            <ul>
                                <li>"ì„ ì°©ìˆœ OOëª…" - í¬ì†Œì„± ê°•ì¡°</li>
                                <li>"ì˜¤ëŠ˜ ë§ˆê°" - ê¸´ê¸‰ì„± ê°•ì¡°</li>
                                <li>"ìµœì €ê°€ ë³´ì¥" - ê°€ê²© ë§¤ë ¥ ê°•ì¡°</li>
                                <li>"í’ˆì ˆ ì„ë°•" - FOMO ìê·¹</li>
                            </ul>
                        </div>
                    </div>
                    
                    <!-- ê³„ì • ê´€ë¦¬ -->
                    <div id="account" class="tab-content">
                        <div class="section-title">ğŸ“± ê³„ì • ê´€ë¦¬ ê°€ì´ë“œ</div>
                        
                        <div class="guide-card">
                            <h3>ğŸ“Š ìŠ¤í† ë¦¬ í™œìš©</h3>
                            <ul>
                                <li>í•˜ë£¨ 3~5íšŒ ì—…ë¡œë“œê°€ ì ë‹¹í•´ìš”</li>
                                <li>ê³µêµ¬ ë‹¹ì¼ì€ ë” ìì£¼ ì˜¬ë ¤ë„ OK</li>
                                <li>ì¹´ìš´íŠ¸ë‹¤ìš´ ìŠ¤í‹°ì»¤ë¡œ ë§ˆê° ê°•ì¡°</li>
                                <li>ì§ˆë¬¸ ìŠ¤í‹°ì»¤ë¡œ ì†Œí†µí•˜ê¸°</li>
                            </ul>
                        </div>
                        
                        <div class="guide-card">
                            <h3>ğŸ’¬ ëŒ“ê¸€ ê´€ë¦¬</h3>
                            <ul>
                                <li>ëŒ“ê¸€ì— ë¹ ë¥´ê²Œ ë‹µë³€í•˜ë©´ ì¶©ì„±ë„ UP</li>
                                <li>ì§ˆë¬¸ ëŒ“ê¸€ì€ ìµœëŒ€í•œ ì¹œì ˆí•˜ê²Œ</li>
                                <li>ì´ë²¤íŠ¸ ë‹¹ì²¨ì ë°œí‘œëŠ” ëŒ“ê¸€ ê³ ì •</li>
                                <li>ë¶€ì •ì  ëŒ“ê¸€ì€ DMìœ¼ë¡œ ê°œë³„ ì‘ëŒ€</li>
                            </ul>
                        </div>
                        
                        <div class="guide-card">
                            <h3>ğŸ“ˆ ì„±ê³¼ ë†’ì´ê¸°</h3>
                            <ul>
                                <li>ê³µêµ¬ ì „ë‚  ì˜ˆê³  í”¼ë“œ í•„ìˆ˜!</li>
                                <li>ê³µêµ¬ í›„ ê°ì‚¬ ì¸ì‚¬ + í›„ê¸° ê³µìœ </li>
                                <li>íŒ”ë¡œì›Œì™€ ê¾¸ì¤€íˆ ì†Œí†µí•˜ê¸°</li>
                                <li>ì¸ì‚¬ì´íŠ¸ ë¶„ì„ìœ¼ë¡œ ìµœì  ì‹œê°„ íŒŒì•…</li>
                            </ul>
                        </div>
                    </div>
                </div>
            `;
        }
        
        // ê³µêµ¬ ì •ë³´ ì—†ìŒ
        function renderNoDeal() {
            const app = document.getElementById('app');
            app.innerHTML = `
                <div class="header">
                    <h1>ğŸ“š ì…€ëŸ¬ ê°€ì´ë“œ</h1>
                    <p>ê³µêµ¬ ì •ë³´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤</p>
                </div>
                
                <div class="content-card">
                    <div class="no-deal">
                        <div class="no-deal-icon">ğŸ”</div>
                        <h2>ê³µêµ¬ ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤</h2>
                        <p>ë§í¬ê°€ ë§Œë£Œë˜ì—ˆê±°ë‚˜ ì˜ëª»ëœ ì ‘ê·¼ì…ë‹ˆë‹¤.<br>íŒŒíŠ¸ë„ˆí¬í„¸ì—ì„œ ë‹¤ì‹œ ì ‘ì†í•´ì£¼ì„¸ìš”.</p>
                    </div>
                </div>
            `;
        }
        
        // íƒ­ ì „í™˜
        function showTab(tabId) {
            document.querySelectorAll('.tab-content').forEach(el => el.classList.remove('active'));
            document.getElementById(tabId).classList.add('active');
            document.querySelectorAll('.tab-btn').forEach(el => el.classList.remove('active'));
            event.target.classList.add('active');
        }
        
        // ìº¡ì…˜ ë³µì‚¬
        function copyCaption(num) {
            if (window.captions && window.captions[num]) {
                navigator.clipboard.writeText(window.captions[num]).then(() => showToast('âœ“ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!'));
            }
        }
        
        // í•´ì‹œíƒœê·¸ ë³µì‚¬
        function copyHashtags() {
            if (window.hashtagText) {
                navigator.clipboard.writeText(window.hashtagText).then(() => showToast('âœ“ í•´ì‹œíƒœê·¸ ë³µì‚¬ë¨!'));
            }
        }
        
        // í† ìŠ¤íŠ¸
        function showToast(msg) {
            const toast = document.getElementById('toast');
            toast.textContent = msg;
            toast.classList.add('show');
            setTimeout(() => toast.classList.remove('show'), 2000);
        }
        
        // ì´ˆê¸°í™” ì‹¤í–‰
        init();
    </script>
</body>
</html>
