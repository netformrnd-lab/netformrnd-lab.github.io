<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ëª¨ì—¬ë¼ë”œ ì†Œê°œì„œ</title>
  <link rel="icon" type="image/png" href="../admin/favicon.png">
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }

    :root {
      --primary: #0064FF;
      --primary-dark: #0052D4;
      --gray-50: #F9FAFB;
      --gray-100: #F2F4F6;
      --gray-200: #E5E8EB;
      --gray-500: #6B7684;
      --gray-700: #333D4B;
      --gray-900: #191F28;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
    }

    .loading-screen {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: white;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      z-index: 9999;
    }

    .loading-spinner {
      width: 48px;
      height: 48px;
      border: 4px solid var(--gray-200);
      border-top-color: var(--primary);
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    .proposal-container {
      max-width: 900px;
      margin: 0 auto;
      padding: 20px;
      min-height: 100vh;
    }

    .slide {
      background: white;
      border-radius: 20px;
      box-shadow: 0 20px 60px rgba(0,0,0,0.15);
      margin-bottom: 40px;
      overflow: hidden;
      opacity: 0;
      transform: translateY(30px);
      animation: slideIn 0.6s ease forwards;
    }

    .slide:nth-child(1) { animation-delay: 0.1s; }
    .slide:nth-child(2) { animation-delay: 0.2s; }
    .slide:nth-child(3) { animation-delay: 0.3s; }
    .slide:nth-child(4) { animation-delay: 0.4s; }
    .slide:nth-child(5) { animation-delay: 0.5s; }

    @keyframes slideIn {
      to { opacity: 1; transform: translateY(0); }
    }

    .slide-header {
      padding: 32px 40px;
      background: linear-gradient(135deg, var(--primary), var(--primary-dark));
      color: white;
    }

    .slide-header.style-green {
      background: linear-gradient(135deg, #10B981, #059669);
    }

    .slide-header.style-purple {
      background: linear-gradient(135deg, #8B5CF6, #7C3AED);
    }

    .slide-header.style-orange {
      background: linear-gradient(135deg, #F59E0B, #D97706);
    }

    .slide-number {
      font-size: 12px;
      opacity: 0.8;
      margin-bottom: 8px;
    }

    .slide-title {
      font-size: 28px;
      font-weight: 700;
      line-height: 1.3;
    }

    .slide-content {
      padding: 40px;
    }

    .slide-text {
      font-size: 16px;
      line-height: 1.8;
      color: var(--gray-700);
      white-space: pre-line;
    }

    .slide-image {
      width: 100%;
      border-radius: 12px;
      margin: 20px 0;
    }

    .video-container {
      position: relative;
      padding-bottom: 56.25%;
      height: 0;
      overflow: hidden;
      border-radius: 12px;
      margin: 20px 0;
      background: var(--gray-100);
    }

    .video-container iframe {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      border: none;
    }

    .cta-buttons {
      display: flex;
      gap: 12px;
      margin-top: 24px;
      flex-wrap: wrap;
    }

    .cta-btn {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 14px 28px;
      border-radius: 12px;
      font-size: 15px;
      font-weight: 600;
      text-decoration: none;
      transition: all 0.2s;
      cursor: pointer;
      border: none;
    }

    .cta-btn.primary {
      background: var(--primary);
      color: white;
    }

    .cta-btn.primary:hover {
      background: var(--primary-dark);
      transform: translateY(-2px);
      box-shadow: 0 8px 20px rgba(0,100,255,0.3);
    }

    .cta-btn.secondary {
      background: var(--gray-100);
      color: var(--gray-700);
    }

    .cta-btn.secondary:hover {
      background: var(--gray-200);
    }

    .highlight-box {
      background: linear-gradient(135deg, #EEF2FF, #E0E7FF);
      border-radius: 16px;
      padding: 24px;
      margin: 20px 0;
    }

    .highlight-box h4 {
      color: var(--primary);
      margin-bottom: 12px;
      font-size: 16px;
    }

    .benefit-list {
      list-style: none;
    }

    .benefit-list li {
      padding: 12px 0;
      border-bottom: 1px solid var(--gray-200);
      display: flex;
      align-items: center;
      gap: 12px;
      font-size: 15px;
      color: var(--gray-700);
    }

    .benefit-list li:last-child {
      border-bottom: none;
    }

    .benefit-icon {
      width: 32px;
      height: 32px;
      background: var(--primary);
      color: white;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 14px;
    }

    /* ì…ì ì‹ ì²­ í¼ */
    .apply-form {
      background: var(--gray-50);
      border-radius: 16px;
      padding: 32px;
      margin-top: 24px;
    }

    .apply-form h3 {
      font-size: 20px;
      margin-bottom: 20px;
      color: var(--gray-900);
    }

    .form-group {
      margin-bottom: 16px;
    }

    .form-group label {
      display: block;
      font-size: 13px;
      font-weight: 600;
      color: var(--gray-700);
      margin-bottom: 6px;
    }

    .form-group input,
    .form-group select,
    .form-group textarea {
      width: 100%;
      padding: 12px 16px;
      border: 1px solid var(--gray-200);
      border-radius: 10px;
      font-size: 15px;
      transition: border-color 0.2s;
    }

    .form-group input:focus,
    .form-group select:focus,
    .form-group textarea:focus {
      outline: none;
      border-color: var(--primary);
    }

    .submit-btn {
      width: 100%;
      padding: 16px;
      background: linear-gradient(135deg, var(--primary), var(--primary-dark));
      color: white;
      border: none;
      border-radius: 12px;
      font-size: 16px;
      font-weight: 700;
      cursor: pointer;
      transition: all 0.2s;
    }

    .submit-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 20px rgba(0,100,255,0.3);
    }

    /* í”Œë¡œíŒ… ë„¤ë¹„ê²Œì´ì…˜ */
    .floating-nav {
      position: fixed;
      bottom: 30px;
      right: 30px;
      display: flex;
      flex-direction: column;
      gap: 12px;
      z-index: 100;
    }

    .nav-btn {
      width: 56px;
      height: 56px;
      border-radius: 50%;
      background: white;
      border: none;
      box-shadow: 0 4px 20px rgba(0,0,0,0.15);
      cursor: pointer;
      font-size: 20px;
      transition: all 0.2s;
    }

    .nav-btn:hover {
      transform: scale(1.1);
    }

    .nav-btn.primary {
      background: var(--primary);
      color: white;
    }

    /* ì§„í–‰ í‘œì‹œê¸° */
    .progress-bar {
      position: fixed;
      top: 0;
      left: 0;
      height: 4px;
      background: var(--primary);
      z-index: 1000;
      transition: width 0.3s;
    }

    /* í˜ì´ì§€ ì¸ë””ì¼€ì´í„° */
    .page-indicator {
      position: fixed;
      left: 20px;
      top: 50%;
      transform: translateY(-50%);
      display: flex;
      flex-direction: column;
      gap: 8px;
      z-index: 100;
    }

    .page-dot {
      width: 12px;
      height: 12px;
      border-radius: 50%;
      background: rgba(255,255,255,0.5);
      cursor: pointer;
      transition: all 0.2s;
    }

    .page-dot.active {
      background: white;
      transform: scale(1.3);
    }

    /* ë°˜ì‘í˜• */
    @media (max-width: 768px) {
      .proposal-container {
        padding: 12px;
      }

      .slide-header {
        padding: 24px;
      }

      .slide-title {
        font-size: 22px;
      }

      .slide-content {
        padding: 24px;
      }

      .page-indicator {
        display: none;
      }

      .floating-nav {
        bottom: 20px;
        right: 20px;
      }
    }

    /* ì—ëŸ¬ í˜ì´ì§€ */
    .error-page {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
      color: white;
      text-align: center;
      padding: 20px;
    }

    .error-page h1 {
      font-size: 72px;
      margin-bottom: 16px;
    }

    .error-page p {
      font-size: 18px;
      opacity: 0.8;
    }
  </style>
</head>
<body>
  <div class="loading-screen" id="loadingScreen">
    <div class="loading-spinner"></div>
    <p style="margin-top: 16px; color: var(--gray-500);">ì†Œê°œì„œë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>
  </div>

  <div class="progress-bar" id="progressBar"></div>

  <div class="page-indicator" id="pageIndicator"></div>

  <div class="proposal-container" id="proposalContainer">
    <!-- ë™ì ìœ¼ë¡œ ìŠ¬ë¼ì´ë“œ ë Œë”ë§ -->
  </div>

  <div class="floating-nav">
    <button class="nav-btn" onclick="scrollToTop()" title="ë§¨ ìœ„ë¡œ">â¬†ï¸</button>
    <button class="nav-btn primary" onclick="scrollToApply()" title="ì…ì  ì‹ ì²­">ğŸ“</button>
  </div>

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>

  <script>
    // Firebase ì´ˆê¸°í™”
    const firebaseConfig = {
      apiKey: "AIzaSyCGCpCnmBqKBqLzBkjWqLhXxCjmYvmB7z4",
      authDomain: "moyeoradeal.firebaseapp.com",
      projectId: "moyeoradeal",
      storageBucket: "moyeoradeal.firebasestorage.app",
      messagingSenderId: "1004270012576",
      appId: "1:1004270012576:web:2c37eb97d6f4c98e0e9bf3",
      measurementId: "G-4R2LQSCM7V"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    // ì „ì—­ ë³€ìˆ˜
    let proposalId = null;
    let proposalData = null;
    let sessionId = null;
    let viewStartTime = Date.now();
    let currentSlideIndex = 0;
    let slideViewTimes = {};

    // URLì—ì„œ proposal ID ê°€ì ¸ì˜¤ê¸°
    function getProposalId() {
      const params = new URLSearchParams(window.location.search);
      return params.get('id');
    }

    // ì„¸ì…˜ ID ìƒì„±
    function generateSessionId() {
      return 'session_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
    }

    // ì†Œê°œì„œ ë¡œë“œ
    async function loadProposal() {
      proposalId = getProposalId();

      if (!proposalId) {
        showError('ì†Œê°œì„œ IDê°€ ì—†ìŠµë‹ˆë‹¤');
        return;
      }

      try {
        const doc = await db.collection('proposals').doc(proposalId).get();

        if (!doc.exists) {
          showError('ì†Œê°œì„œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤');
          return;
        }

        proposalData = { id: doc.id, ...doc.data() };

        // ì„¸ì…˜ ì‹œì‘ ë° ë·° ì¹´ìš´íŠ¸ ì¦ê°€
        sessionId = generateSessionId();
        await trackView();

        // ë Œë”ë§
        renderProposal();
        hideLoading();

        // ìŠ¤í¬ë¡¤ ì¶”ì  ì‹œì‘
        setupScrollTracking();

      } catch (e) {
        console.error('ì†Œê°œì„œ ë¡œë“œ ì˜¤ë¥˜:', e);
        showError('ì†Œê°œì„œë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤');
      }
    }

    // ë·° ì¶”ì 
    async function trackView() {
      try {
        // ì¡°íšŒìˆ˜ ì¦ê°€
        await db.collection('proposals').doc(proposalId).update({
          viewCount: firebase.firestore.FieldValue.increment(1)
        });

        // ë¶„ì„ ë°ì´í„° ê¸°ë¡
        await db.collection('proposalAnalytics').add({
          proposalId,
          sessionId,
          event: 'view',
          timestamp: new Date().toISOString(),
          userAgent: navigator.userAgent,
          referrer: document.referrer || 'direct'
        });
      } catch (e) {
        console.error('ë·° ì¶”ì  ì˜¤ë¥˜:', e);
      }
    }

    // ìŠ¬ë¼ì´ë“œ ë·° ì¶”ì 
    async function trackSlideView(slideIndex) {
      if (slideViewTimes[slideIndex]) return; // ì´ë¯¸ ê¸°ë¡ë¨

      slideViewTimes[slideIndex] = Date.now();

      try {
        await db.collection('proposalAnalytics').add({
          proposalId,
          sessionId,
          event: 'slide_view',
          slideIndex,
          slideTitle: proposalData.slides[slideIndex]?.title || '',
          timestamp: new Date().toISOString()
        });
      } catch (e) {
        console.error('ìŠ¬ë¼ì´ë“œ ë·° ì¶”ì  ì˜¤ë¥˜:', e);
      }
    }

    // ë§í¬ í´ë¦­ ì¶”ì 
    async function trackLinkClick(linkUrl, linkText, slideIndex) {
      try {
        await db.collection('proposalAnalytics').add({
          proposalId,
          sessionId,
          event: 'link_click',
          linkUrl,
          linkText,
          slideIndex,
          timestamp: new Date().toISOString()
        });
      } catch (e) {
        console.error('ë§í¬ í´ë¦­ ì¶”ì  ì˜¤ë¥˜:', e);
      }
    }

    // CTA í´ë¦­ ì¶”ì 
    async function trackCTAClick(ctaType, slideIndex) {
      try {
        await db.collection('proposalAnalytics').add({
          proposalId,
          sessionId,
          event: 'cta_click',
          ctaType,
          slideIndex,
          timestamp: new Date().toISOString()
        });
      } catch (e) {
        console.error('CTA ì¶”ì  ì˜¤ë¥˜:', e);
      }
    }

    // ì´íƒˆ ì¶”ì 
    function trackExit() {
      const totalTime = Math.round((Date.now() - viewStartTime) / 1000);

      // sendBeaconìœ¼ë¡œ ë¹„ë™ê¸° ì „ì†¡
      const data = JSON.stringify({
        proposalId,
        sessionId,
        event: 'exit',
        totalTime,
        lastSlideIndex: currentSlideIndex,
        timestamp: new Date().toISOString()
      });

      navigator.sendBeacon && navigator.sendBeacon(
        'https://firestore.googleapis.com/v1/projects/moyeoradeal/databases/(default)/documents/proposalAnalytics',
        data
      );
    }

    // ìŠ¤í¬ë¡¤ ì¶”ì  ì„¤ì •
    function setupScrollTracking() {
      const slides = document.querySelectorAll('.slide');

      const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
          if (entry.isIntersecting) {
            const slideIndex = parseInt(entry.target.dataset.slideIndex);
            currentSlideIndex = slideIndex;
            trackSlideView(slideIndex);
            updatePageIndicator(slideIndex);
            updateProgressBar();
          }
        });
      }, { threshold: 0.5 });

      slides.forEach(slide => observer.observe(slide));

      // ì´íƒˆ ì¶”ì 
      window.addEventListener('beforeunload', trackExit);
    }

    // ì§„í–‰ ë°” ì—…ë°ì´íŠ¸
    function updateProgressBar() {
      const scrollTop = window.scrollY;
      const docHeight = document.documentElement.scrollHeight - window.innerHeight;
      const progress = (scrollTop / docHeight) * 100;
      document.getElementById('progressBar').style.width = progress + '%';
    }

    // í˜ì´ì§€ ì¸ë””ì¼€ì´í„° ì—…ë°ì´íŠ¸
    function updatePageIndicator(activeIndex) {
      document.querySelectorAll('.page-dot').forEach((dot, i) => {
        dot.classList.toggle('active', i === activeIndex);
      });
    }

    // ì†Œê°œì„œ ë Œë”ë§
    function renderProposal() {
      const container = document.getElementById('proposalContainer');
      const slides = proposalData.slides || [];

      // í˜ì´ì§€ íƒ€ì´í‹€ ì„¤ì •
      document.title = proposalData.title + ' - ëª¨ì—¬ë¼ë”œ';

      // í˜ì´ì§€ ì¸ë””ì¼€ì´í„° ìƒì„±
      const indicatorHtml = slides.map((_, i) =>
        `<div class="page-dot ${i === 0 ? 'active' : ''}" onclick="scrollToSlide(${i})"></div>`
      ).join('');
      document.getElementById('pageIndicator').innerHTML = indicatorHtml;

      // ìŠ¬ë¼ì´ë“œ ë Œë”ë§
      container.innerHTML = slides.map((slide, index) => renderSlide(slide, index)).join('');
    }

    // ê°œë³„ ìŠ¬ë¼ì´ë“œ ë Œë”ë§
    function renderSlide(slide, index) {
      const headerStyle = slide.headerStyle || 'blue';
      const styleClass = headerStyle === 'green' ? 'style-green' :
                         headerStyle === 'purple' ? 'style-purple' :
                         headerStyle === 'orange' ? 'style-orange' : '';

      let contentHtml = '';

      // í…ìŠ¤íŠ¸
      if (slide.text) {
        contentHtml += `<div class="slide-text">${slide.text}</div>`;
      }

      // ì´ë¯¸ì§€
      if (slide.imageUrl) {
        contentHtml += `<img src="${slide.imageUrl}" alt="" class="slide-image" loading="lazy">`;
      }

      // ë¹„ë””ì˜¤
      if (slide.videoUrl) {
        const videoEmbed = getVideoEmbed(slide.videoUrl);
        contentHtml += `
          <div class="video-container">
            ${videoEmbed}
          </div>
        `;
      }

      // í˜œíƒ ë¦¬ìŠ¤íŠ¸
      if (slide.benefits && slide.benefits.length > 0) {
        contentHtml += `
          <div class="highlight-box">
            <h4>${slide.benefitsTitle || 'ì£¼ìš” í˜œíƒ'}</h4>
            <ul class="benefit-list">
              ${slide.benefits.map((b, i) => `
                <li>
                  <span class="benefit-icon">${i + 1}</span>
                  <span>${b}</span>
                </li>
              `).join('')}
            </ul>
          </div>
        `;
      }

      // CTA ë²„íŠ¼
      if (slide.buttons && slide.buttons.length > 0) {
        contentHtml += `
          <div class="cta-buttons">
            ${slide.buttons.map(btn => `
              <a href="${btn.url}" target="_blank"
                 class="cta-btn ${btn.style || 'primary'}"
                 onclick="trackLinkClick('${btn.url}', '${btn.text}', ${index})">
                ${btn.text}
              </a>
            `).join('')}
          </div>
        `;
      }

      // ì…ì  ì‹ ì²­ í¼
      if (slide.showApplyForm) {
        contentHtml += renderApplyForm(index);
      }

      return `
        <div class="slide" data-slide-index="${index}" id="slide-${index}">
          <div class="slide-header ${styleClass}">
            <div class="slide-number">0${index + 1}</div>
            <h2 class="slide-title">${slide.title}</h2>
          </div>
          <div class="slide-content">
            ${contentHtml}
          </div>
        </div>
      `;
    }

    // ë¹„ë””ì˜¤ ì„ë² ë“œ ìƒì„±
    function getVideoEmbed(url) {
      // YouTube
      const ytMatch = url.match(/(?:youtube\.com\/watch\?v=|youtu\.be\/|youtube\.com\/embed\/)([^&\?\/]+)/);
      if (ytMatch) {
        return `<iframe src="https://www.youtube.com/embed/${ytMatch[1]}" allowfullscreen></iframe>`;
      }

      // Vimeo
      const vimeoMatch = url.match(/vimeo\.com\/(\d+)/);
      if (vimeoMatch) {
        return `<iframe src="https://player.vimeo.com/video/${vimeoMatch[1]}" allowfullscreen></iframe>`;
      }

      // ì¼ë°˜ ë¹„ë””ì˜¤
      return `<video src="${url}" controls style="width:100%;border-radius:12px;"></video>`;
    }

    // ì…ì  ì‹ ì²­ í¼ ë Œë”ë§
    function renderApplyForm(slideIndex) {
      const formType = proposalData.formType || 'supplier'; // supplier or seller

      return `
        <div class="apply-form" id="applyForm">
          <h3>ğŸ“ ${formType === 'seller' ? 'ì…€ëŸ¬' : 'ê³µê¸‰ì‚¬'} ì…ì  ì‹ ì²­</h3>
          <form onsubmit="submitApplication(event, ${slideIndex})">
            <div class="form-group">
              <label>${formType === 'seller' ? 'ì…€ëŸ¬ëª… (ì±„ë„ëª…)' : 'íšŒì‚¬ëª…'} *</label>
              <input type="text" id="apply-company" required placeholder="${formType === 'seller' ? 'ì±„ë„/ê³„ì •ëª…ì„ ì…ë ¥í•˜ì„¸ìš”' : 'íšŒì‚¬ëª…ì„ ì…ë ¥í•˜ì„¸ìš”'}">
            </div>
            <div class="form-group">
              <label>ë‹´ë‹¹ìëª… *</label>
              <input type="text" id="apply-name" required placeholder="ë‹´ë‹¹ì ì´ë¦„">
            </div>
            <div class="form-group">
              <label>ì—°ë½ì²˜ *</label>
              <input type="tel" id="apply-phone" required placeholder="010-0000-0000">
            </div>
            <div class="form-group">
              <label>ì´ë©”ì¼</label>
              <input type="email" id="apply-email" placeholder="email@example.com">
            </div>
            ${formType === 'seller' ? `
            <div class="form-group">
              <label>ì£¼ìš” íŒë§¤ ì±„ë„</label>
              <select id="apply-channel">
                <option value="">ì„ íƒí•˜ì„¸ìš”</option>
                <option value="instagram">ì¸ìŠ¤íƒ€ê·¸ë¨</option>
                <option value="youtube">ìœ íŠœë¸Œ</option>
                <option value="naver">ë„¤ì´ë²„ ë¸”ë¡œê·¸/ì¹´í˜</option>
                <option value="kakao">ì¹´ì¹´ì˜¤ ì±„ë„</option>
                <option value="other">ê¸°íƒ€</option>
              </select>
            </div>
            ` : `
            <div class="form-group">
              <label>ì£¼ìš” í’ˆëª©</label>
              <input type="text" id="apply-category" placeholder="ì˜ˆ: ì‹í’ˆ, ë·°í‹°, ë¦¬ë¹™">
            </div>
            `}
            <div class="form-group">
              <label>ë¬¸ì˜ ì‚¬í•­</label>
              <textarea id="apply-message" rows="3" placeholder="ê¶ê¸ˆí•œ ì ì´ë‚˜ ìš”ì²­ ì‚¬í•­ì„ ì ì–´ì£¼ì„¸ìš”"></textarea>
            </div>
            <button type="submit" class="submit-btn">ì…ì  ì‹ ì²­í•˜ê¸° â†’</button>
          </form>
        </div>
      `;
    }

    // ì…ì  ì‹ ì²­ ì œì¶œ
    async function submitApplication(event, slideIndex) {
      event.preventDefault();

      const formType = proposalData.formType || 'supplier';
      const company = document.getElementById('apply-company').value.trim();
      const name = document.getElementById('apply-name').value.trim();
      const phone = document.getElementById('apply-phone').value.trim();
      const email = document.getElementById('apply-email')?.value.trim() || '';
      const channel = document.getElementById('apply-channel')?.value || '';
      const category = document.getElementById('apply-category')?.value || '';
      const message = document.getElementById('apply-message')?.value.trim() || '';

      try {
        // ì‹ ì²­ ë°ì´í„° ì €ì¥
        const collectionName = formType === 'seller' ? 'sellerApplications' : 'supplierApplications';

        await db.collection(collectionName).add({
          company,
          name,
          phone,
          email,
          channel: channel || null,
          category: category || null,
          message,
          proposalId,
          proposalTitle: proposalData.title,
          status: 'pending',
          createdAt: new Date().toISOString()
        });

        // ë¶„ì„ ë°ì´í„° ê¸°ë¡
        await trackCTAClick('apply_submit', slideIndex);

        // ì„±ê³µ ë©”ì‹œì§€
        alert('ì…ì  ì‹ ì²­ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!\\në‹´ë‹¹ìê°€ ë¹ ë¥´ê²Œ ì—°ë½ë“œë¦¬ê² ìŠµë‹ˆë‹¤.');

        // í¼ ì´ˆê¸°í™”
        event.target.reset();

      } catch (e) {
        console.error('ì…ì  ì‹ ì²­ ì˜¤ë¥˜:', e);
        alert('ì‹ ì²­ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');
      }
    }

    // ì—ëŸ¬ í‘œì‹œ
    function showError(message) {
      document.getElementById('loadingScreen').style.display = 'none';
      document.body.innerHTML = `
        <div class="error-page">
          <h1>ğŸ˜¢</h1>
          <p>${message}</p>
          <a href="/" style="color: white; margin-top: 20px;">í™ˆìœ¼ë¡œ ëŒì•„ê°€ê¸°</a>
        </div>
      `;
    }

    // ë¡œë”© ìˆ¨ê¹€
    function hideLoading() {
      document.getElementById('loadingScreen').style.display = 'none';
    }

    // ë„¤ë¹„ê²Œì´ì…˜ í•¨ìˆ˜
    function scrollToTop() {
      window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    function scrollToApply() {
      const applyForm = document.getElementById('applyForm');
      if (applyForm) {
        applyForm.scrollIntoView({ behavior: 'smooth' });
      } else {
        // ë§ˆì§€ë§‰ ìŠ¬ë¼ì´ë“œë¡œ ì´ë™
        const slides = document.querySelectorAll('.slide');
        slides[slides.length - 1]?.scrollIntoView({ behavior: 'smooth' });
      }
    }

    function scrollToSlide(index) {
      const slide = document.getElementById('slide-' + index);
      if (slide) {
        slide.scrollIntoView({ behavior: 'smooth' });
      }
    }

    // ìŠ¤í¬ë¡¤ ì´ë²¤íŠ¸
    window.addEventListener('scroll', () => {
      updateProgressBar();
    });

    // ì´ˆê¸°í™”
    document.addEventListener('DOMContentLoaded', loadProposal);
  </script>
</body>
</html>
