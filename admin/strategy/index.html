<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ì „ëµì„¼í„° - ëª¨ì—¬ë¼ë”œ</title>
  <link rel="manifest" href="/admin/manifest.json">
  <meta name="theme-color" content="#3182f6">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="ì „ëµì„¼í„°">
  <link rel="apple-touch-icon" href="/admin/icon-192.png">
  <meta name="description" content="ëª¨ì—¬ë¼ë”œ ì „ëµì„¼í„° - ì˜ì—…í˜„í™©, OKR, ì „ëµê¸°íš">
  <link href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/static/pretendard.css" rel="stylesheet">
  <style>
    :root {
      --primary: #3182f6;
      --primary-light: #eef4ff;
      --primary-dark: #1b64da;
      --white: #ffffff;
      --gray-900: #191f28;
      --gray-800: #333d4b;
      --gray-700: #4e5968;
      --gray-600: #6b7684;
      --gray-500: #8b95a1;
      --gray-400: #b0b8c1;
      --gray-300: #d1d6db;
      --gray-200: #e5e8eb;
      --gray-100: #f2f4f6;
      --gray-50: #f9fafb;
      --success: #00c073;
      --success-light: #e8f7f0;
      --warning: #fc9600;
      --warning-light: #fff8f0;
      --danger: #f04452;
      --danger-light: #fff0f1;
      --info: #3182f6;
      --info-light: #eef4ff;
      --card-radius: 16px;
      --card-shadow: 0 2px 8px rgba(0,0,0,0.06);
      --btn-radius: 8px;
    }

    * { margin: 0; padding: 0; box-sizing: border-box; }

    body {
      min-height: 100vh;
      background: var(--gray-100);
      font-family: 'Pretendard', -apple-system, BlinkMacSystemFont, system-ui, sans-serif;
      color: var(--gray-900);
      line-height: 1.5;
      -webkit-font-smoothing: antialiased;
    }

    /* ë¡œê·¸ì¸ í™”ë©´ */
    .login-screen {
      min-height: 100vh;
      background: var(--gray-100);
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 20px;
    }

    .login-container { width: 100%; max-width: 400px; }

    .login-logo {
      text-align: center;
      margin-bottom: 32px;
    }

    .login-logo img { height: 48px; }

    .login-logo-desc {
      font-size: 14px;
      color: var(--gray-500);
      margin-top: 8px;
    }

    .login-card {
      background: var(--white);
      border-radius: 16px;
      padding: 32px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.04);
    }

    .login-title {
      font-size: 18px;
      font-weight: 700;
      text-align: center;
      margin-bottom: 24px;
      color: var(--gray-900);
    }

    .login-error {
      background: var(--danger-light);
      border: 1px solid #fecaca;
      color: var(--danger);
      padding: 12px 16px;
      border-radius: 8px;
      font-size: 14px;
      margin-bottom: 20px;
      display: none;
    }

    .login-error.show { display: block; }

    .login-input {
      width: 100%;
      padding: 12px 14px;
      border: 1px solid var(--gray-300);
      border-radius: 8px;
      font-size: 15px;
      font-family: inherit;
      transition: all 0.15s ease;
      background: var(--white);
      margin-bottom: 12px;
    }

    .login-input:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 3px var(--primary-light);
    }

    .login-btn {
      width: 100%;
      padding: 14px;
      border: none;
      border-radius: 8px;
      font-size: 15px;
      font-weight: 600;
      cursor: pointer;
      background: var(--primary);
      color: var(--white);
      font-family: inherit;
      transition: all 0.15s ease;
    }

    .login-btn:hover { background: var(--primary-dark); }

    /* ë ˆì´ì•„ì›ƒ */
    .app-container {
      display: flex;
      min-height: 100vh;
    }

    /* ì‚¬ì´ë“œë°” */
    .sidebar {
      width: 260px;
      background: var(--white);
      border-right: 1px solid var(--gray-200);
      padding: 24px 0;
      position: fixed;
      height: 100vh;
      overflow-y: auto;
      z-index: 100;
      transition: transform 0.3s ease;
    }

    .logo {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 8px 20px;
      margin-bottom: 32px;
    }

    .logo-icon {
      width: 36px;
      height: 36px;
      background: var(--primary);
      border-radius: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 18px;
    }

    .logo-text {
      font-size: 18px;
      font-weight: 700;
      color: var(--gray-900);
    }

    .nav-section { margin-bottom: 32px; }

    .nav-label {
      font-size: 12px;
      font-weight: 700;
      color: var(--gray-500);
      letter-spacing: -0.2px;
      padding: 0 20px;
      margin-bottom: 12px;
    }

    .nav-item {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 14px 20px;
      cursor: pointer;
      transition: all 0.2s ease;
      font-size: 15px;
      font-weight: 500;
      color: var(--gray-700);
      position: relative;
    }

    .nav-item:hover {
      background: var(--gray-50);
      color: var(--gray-900);
    }

    .nav-item.active {
      background: var(--primary-light);
      color: var(--primary);
      font-weight: 600;
    }

    .nav-item.active::before {
      content: '';
      position: absolute;
      left: 0;
      top: 0;
      bottom: 0;
      width: 3px;
      background: var(--primary);
    }

    .nav-item .icon {
      width: 20px;
      text-align: center;
      font-size: 16px;
    }

    .center-links {
      padding: 16px 20px;
      border-top: 1px solid var(--gray-200);
      margin-top: auto;
    }

    .center-link {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 10px 12px;
      border-radius: 8px;
      font-size: 13px;
      color: var(--gray-600);
      text-decoration: none;
      transition: all 0.2s;
      margin-bottom: 4px;
    }

    .center-link:hover {
      background: var(--gray-100);
      color: var(--gray-900);
    }

    .center-link.active {
      background: var(--primary-light);
      color: var(--primary);
      font-weight: 600;
    }

    /* ë©”ì¸ ì»¨í…ì¸  */
    .main-content {
      flex: 1;
      margin-left: 260px;
      padding: 28px 32px;
      max-width: 1400px;
    }

    /* ëª¨ë°”ì¼ ë©”ë‰´ */
    .mobile-menu-btn {
      display: none;
      position: fixed;
      top: 16px;
      left: 16px;
      z-index: 150;
      background: var(--primary);
      color: var(--white);
      border: none;
      width: 44px;
      height: 44px;
      border-radius: 10px;
      cursor: pointer;
      align-items: center;
      justify-content: center;
      font-size: 20px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.15);
    }

    .sidebar-overlay {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.5);
      z-index: 90;
    }

    /* í—¤ë” */
    .page-header { margin-bottom: 24px; }

    .page-title {
      font-size: 22px;
      font-weight: 700;
      color: var(--gray-900);
      margin-bottom: 4px;
    }

    .page-desc {
      font-size: 14px;
      color: var(--gray-500);
    }

    /* ë²„íŠ¼ */
    .btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
      padding: 10px 16px;
      border-radius: 8px;
      font-size: 14px;
      font-weight: 600;
      border: none;
      cursor: pointer;
      transition: all 0.15s ease;
      font-family: inherit;
    }

    .btn-primary {
      background: var(--primary);
      color: var(--white);
    }

    .btn-primary:hover { background: var(--primary-dark); }

    .btn-secondary {
      background: var(--white);
      color: var(--gray-700);
      border: 1px solid var(--gray-300);
    }

    .btn-secondary:hover { background: var(--gray-50); }

    /* ì¹´ë“œ */
    .card {
      background: var(--white);
      border-radius: var(--card-radius);
      box-shadow: var(--card-shadow);
      padding: 24px;
      margin-bottom: 20px;
    }

    .card-title {
      font-size: 16px;
      font-weight: 700;
      color: var(--gray-900);
      margin-bottom: 16px;
    }

    /* KPI ì¹´ë“œ */
    .kpi-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 16px;
      margin-bottom: 24px;
    }

    .kpi-card {
      background: var(--white);
      border-radius: var(--card-radius);
      padding: 20px;
      box-shadow: var(--card-shadow);
    }

    .kpi-card.highlight {
      background: linear-gradient(135deg, var(--primary), var(--primary-dark));
      color: white;
    }

    .kpi-label {
      font-size: 13px;
      color: var(--gray-500);
      margin-bottom: 8px;
    }

    .kpi-card.highlight .kpi-label {
      color: rgba(255,255,255,0.8);
    }

    .kpi-value {
      font-size: 28px;
      font-weight: 700;
      color: var(--gray-900);
    }

    .kpi-card.highlight .kpi-value {
      color: white;
    }

    .kpi-change {
      font-size: 12px;
      margin-top: 4px;
    }

    .kpi-change.positive { color: var(--success); }
    .kpi-change.negative { color: var(--danger); }

    /* í…Œì´ë¸” */
    .table-wrapper {
      overflow-x: auto;
    }

    table {
      width: 100%;
      border-collapse: collapse;
    }

    th, td {
      padding: 12px 16px;
      text-align: left;
      border-bottom: 1px solid var(--gray-200);
    }

    th {
      font-size: 13px;
      font-weight: 600;
      color: var(--gray-500);
      background: var(--gray-50);
    }

    td {
      font-size: 14px;
      color: var(--gray-700);
    }

    /* ì°¨íŠ¸ í”Œë ˆì´ìŠ¤í™€ë” */
    .chart-placeholder {
      height: 300px;
      background: var(--gray-50);
      border-radius: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      color: var(--gray-500);
      font-size: 14px;
    }

    /* OKR ìŠ¤íƒ€ì¼ */
    .okr-section {
      margin-bottom: 24px;
    }

    .okr-objective {
      background: var(--white);
      border-radius: var(--card-radius);
      padding: 20px;
      margin-bottom: 16px;
      box-shadow: var(--card-shadow);
    }

    .okr-objective-title {
      font-size: 16px;
      font-weight: 700;
      color: var(--gray-900);
      margin-bottom: 12px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .okr-key-result {
      background: var(--gray-50);
      border-radius: 8px;
      padding: 12px 16px;
      margin-bottom: 8px;
    }

    .okr-kr-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 8px;
    }

    .okr-kr-title {
      font-size: 14px;
      color: var(--gray-700);
    }

    .okr-kr-progress {
      font-size: 14px;
      font-weight: 600;
      color: var(--primary);
    }

    .okr-progress-bar {
      height: 6px;
      background: var(--gray-200);
      border-radius: 3px;
      overflow: hidden;
    }

    .okr-progress-fill {
      height: 100%;
      background: var(--primary);
      border-radius: 3px;
      transition: width 0.3s ease;
    }

    /* íƒ­ ë„¤ë¹„ê²Œì´ì…˜ */
    .tab-nav {
      display: flex;
      gap: 4px;
      background: var(--gray-100);
      padding: 4px;
      border-radius: 10px;
      margin-bottom: 24px;
    }

    .tab-btn {
      flex: 1;
      padding: 10px 16px;
      border: none;
      background: transparent;
      border-radius: 8px;
      font-size: 14px;
      font-weight: 500;
      color: var(--gray-600);
      cursor: pointer;
      transition: all 0.2s;
    }

    .tab-btn.active {
      background: var(--white);
      color: var(--gray-900);
      font-weight: 600;
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    }

    .tab-content {
      display: none;
    }

    .tab-content.active {
      display: block;
    }

    /* í† ìŠ¤íŠ¸ */
    #toast {
      position: fixed;
      bottom: 24px;
      left: 50%;
      transform: translateX(-50%);
      background: var(--gray-900);
      color: white;
      padding: 12px 24px;
      border-radius: 8px;
      font-size: 14px;
      display: none;
      z-index: 9999;
    }

    /* ëª¨ë‹¬ */
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.5);
      z-index: 1000;
      align-items: center;
      justify-content: center;
      padding: 20px;
    }

    .modal.show {
      display: flex;
    }

    .modal-content {
      background: var(--white);
      border-radius: 16px;
      width: 100%;
      max-width: 500px;
      box-shadow: 0 20px 60px rgba(0,0,0,0.3);
    }

    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 20px 24px;
      border-bottom: 1px solid var(--gray-200);
    }

    .modal-title {
      font-size: 18px;
      font-weight: 700;
    }

    .modal-close {
      background: none;
      border: none;
      font-size: 24px;
      cursor: pointer;
      color: var(--gray-500);
      padding: 4px;
    }

    .modal-close:hover {
      color: var(--gray-900);
    }

    /* ë°˜ì‘í˜• */
    @media (max-width: 768px) {
      .sidebar {
        transform: translateX(-100%);
      }

      .sidebar.open {
        transform: translateX(0);
      }

      .mobile-menu-btn {
        display: flex;
      }

      .sidebar-overlay.show {
        display: block;
      }

      .main-content {
        margin-left: 0;
        padding: 70px 16px 24px;
      }

      .kpi-grid {
        grid-template-columns: repeat(2, 1fr);
      }
    }
  </style>
</head>
<body>
  <!-- ë¡œê·¸ì¸ í™”ë©´ -->
  <div id="loginScreen" class="login-screen">
    <div class="login-container">
      <div class="login-logo">
        <img src="/admin/moyeora-logo.png" alt="ëª¨ì—¬ë¼ë”œ" onerror="this.style.display='none'">
        <div class="login-logo-desc">ì „ëµì„¼í„°</div>
      </div>
      <div class="login-card">
        <div class="login-title">ê´€ë¦¬ì ë¡œê·¸ì¸</div>
        <div id="loginError" class="login-error"></div>
        <input type="password" id="loginPassword" class="login-input" placeholder="ë¹„ë°€ë²ˆí˜¸ ì…ë ¥" onkeypress="if(event.key==='Enter')handleLogin()">
        <button class="login-btn" onclick="handleLogin()">ë¡œê·¸ì¸</button>
      </div>
    </div>
  </div>

  <!-- ì•± í™”ë©´ -->
  <div id="appScreen" class="app-container" style="display:none;">
    <!-- ëª¨ë°”ì¼ ë©”ë‰´ ë²„íŠ¼ -->
    <button class="mobile-menu-btn" onclick="toggleSidebar()">â˜°</button>
    <div class="sidebar-overlay" onclick="toggleSidebar()"></div>

    <!-- ì‚¬ì´ë“œë°” -->
    <aside class="sidebar">
      <div class="logo">
        <div class="logo-icon">ğŸ“Š</div>
        <span class="logo-text">ì „ëµì„¼í„°</span>
      </div>

      <nav>
        <div class="nav-section">
          <div class="nav-label">ì „ëµ ê´€ë¦¬</div>
          <div class="nav-item active" onclick="switchTab('dashboard')">
            <span class="icon">ğŸ“ˆ</span>
            <span>ì˜ì—…í˜„í™©</span>
          </div>
          <div class="nav-item" onclick="switchTab('okr')">
            <span class="icon">ğŸ¯</span>
            <span>OKR</span>
          </div>
          <div class="nav-item" onclick="switchTab('planning')">
            <span class="icon">ğŸ“‹</span>
            <span>ì „ëµê¸°íš</span>
          </div>
          <div class="nav-item" onclick="switchTab('growth')">
            <span class="icon">ğŸš€</span>
            <span>ê·¸ë¡œìŠ¤ë³´ë“œ</span>
          </div>
          <div class="nav-item" onclick="switchTab('guide')">
            <span class="icon">ğŸ“š</span>
            <span>ì—…ë¬´ê°€ì´ë“œ</span>
          </div>
          <div class="nav-item" onclick="switchTab('reference')">
            <span class="icon">ğŸ“‚</span>
            <span>ë ˆí¼ëŸ°ìŠ¤</span>
          </div>
        </div>

        <!-- ì„¼í„° ì´ë™ -->
        <div class="center-links">
          <div class="nav-label">ì„¼í„° ì´ë™</div>
          <a href="/admin/" class="center-link">
            <span>âš™ï¸</span>
            <span>ìš´ì˜ì„¼í„°</span>
          </a>
          <a href="/admin/crm/" class="center-link">
            <span>ğŸ’¼</span>
            <span>CRMì„¼í„°</span>
          </a>
          <a href="/admin/strategy/" class="center-link active">
            <span>ğŸ“Š</span>
            <span>ì „ëµì„¼í„°</span>
          </a>
        </div>
      </nav>
    </aside>

    <!-- ë©”ì¸ ì»¨í…ì¸  -->
    <main class="main-content">
      <!-- ìƒë‹¨ ì„¼í„° ë°”ë¡œê°€ê¸° -->
      <div style="display: flex; gap: 4px; margin-bottom: 20px; padding: 4px; background: var(--gray-200); border-radius: 12px; width: fit-content;">
        <a href="/admin/" style="display: flex; align-items: center; gap: 6px; padding: 10px 20px; background: transparent; border-radius: 10px; text-decoration: none; color: var(--gray-600); font-size: 13px; font-weight: 500; transition: all 0.2s;" onmouseover="this.style.background='var(--gray-100)'" onmouseout="this.style.background='transparent'">
          ìš´ì˜ì„¼í„°
        </a>
        <a href="/admin/strategy/" style="display: flex; align-items: center; gap: 6px; padding: 10px 20px; background: var(--primary); border-radius: 10px; text-decoration: none; color: white; font-size: 13px; font-weight: 700; box-shadow: 0 2px 8px rgba(49, 130, 246, 0.3);">
          ì „ëµì„¼í„°
        </a>
        <a href="/admin/crm/" style="display: flex; align-items: center; gap: 6px; padding: 10px 20px; background: transparent; border-radius: 10px; text-decoration: none; color: var(--gray-600); font-size: 13px; font-weight: 500; transition: all 0.2s;" onmouseover="this.style.background='var(--gray-100)'" onmouseout="this.style.background='transparent'">
          CRMì„¼í„°
        </a>
      </div>

      <!-- ì˜ì—…í˜„í™© -->
      <div id="tab-dashboard" class="tab-content active">
        <div id="salesDashboardContent">
          <!-- ë™ì ìœ¼ë¡œ ë Œë”ë§ -->
        </div>
      </div>

      <!-- OKR -->
      <div id="tab-okr" class="tab-content">
        <div class="page-header">
          <h1 class="page-title">OKR</h1>
          <p class="page-desc">ëª©í‘œ ë° í•µì‹¬ ê²°ê³¼ ê´€ë¦¬</p>
        </div>

        <div class="tab-nav">
          <button class="tab-btn active" onclick="switchOkrPeriod('quarterly')">ë¶„ê¸°ë³„</button>
          <button class="tab-btn" onclick="switchOkrPeriod('monthly')">ì›”ë³„</button>
          <button class="tab-btn" onclick="switchOkrPeriod('weekly')">ì£¼ê°„</button>
        </div>

        <div class="okr-section" id="okrContent">
          <div class="okr-objective">
            <div class="okr-objective-title">
              <span>ğŸ¯</span>
              <span>Q1 ë§¤ì¶œ ëª©í‘œ ë‹¬ì„±</span>
            </div>
            <div class="okr-key-result">
              <div class="okr-kr-header">
                <span class="okr-kr-title">ì›” ë§¤ì¶œ 1ì–µì› ë‹¬ì„±</span>
                <span class="okr-kr-progress">65%</span>
              </div>
              <div class="okr-progress-bar">
                <div class="okr-progress-fill" style="width: 65%"></div>
              </div>
            </div>
            <div class="okr-key-result">
              <div class="okr-kr-header">
                <span class="okr-kr-title">ì‹ ê·œ ê³µê¸‰ì‚¬ 20ê°œ í™•ë³´</span>
                <span class="okr-kr-progress">40%</span>
              </div>
              <div class="okr-progress-bar">
                <div class="okr-progress-fill" style="width: 40%"></div>
              </div>
            </div>
            <div class="okr-key-result">
              <div class="okr-kr-header">
                <span class="okr-kr-title">ê³µêµ¬ ì „í™˜ìœ¨ 15% ë‹¬ì„±</span>
                <span class="okr-kr-progress">80%</span>
              </div>
              <div class="okr-progress-bar">
                <div class="okr-progress-fill" style="width: 80%"></div>
              </div>
            </div>
          </div>

          <div class="okr-objective">
            <div class="okr-objective-title">
              <span>ğŸš€</span>
              <span>íŒŒíŠ¸ë„ˆ ìƒíƒœê³„ í™•ì¥</span>
            </div>
            <div class="okr-key-result">
              <div class="okr-kr-header">
                <span class="okr-kr-title">ì…€ëŸ¬ ë„¤íŠ¸ì›Œí¬ 50ê°œ í™•ë³´</span>
                <span class="okr-kr-progress">55%</span>
              </div>
              <div class="okr-progress-bar">
                <div class="okr-progress-fill" style="width: 55%"></div>
              </div>
            </div>
            <div class="okr-key-result">
              <div class="okr-kr-header">
                <span class="okr-kr-title">íŒŒíŠ¸ë„ˆ ë§Œì¡±ë„ 4.5ì  ì´ìƒ</span>
                <span class="okr-kr-progress">90%</span>
              </div>
              <div class="okr-progress-bar">
                <div class="okr-progress-fill" style="width: 90%"></div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- ì „ëµê¸°íš (í”„ë¡œì íŠ¸ ê¸°ë°˜) -->
      <div id="tab-planning" class="tab-content">
        <div class="page-header" style="display: flex; justify-content: space-between; align-items: center;">
          <div>
            <h1 class="page-title">í”„ë¡œì íŠ¸ ì „ëµ</h1>
            <p class="page-desc">í”„ë¡œì íŠ¸ë³„ ëª©í‘œ ë° KPI ê´€ë¦¬</p>
          </div>
          <button class="btn btn-primary" onclick="openProjectModal()">+ í”„ë¡œì íŠ¸ ì¶”ê°€</button>
        </div>

        <!-- ì „ì²´ ëª©í‘œ ìš”ì•½ -->
        <div id="projectSummary" style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 16px; margin-bottom: 24px;">
          <div style="background: linear-gradient(135deg, var(--primary), var(--primary-dark)); border-radius: 16px; padding: 20px; color: white;">
            <div style="font-size: 13px; opacity: 0.9;">ì „ì²´ ë§¤ì¶œ ëª©í‘œ</div>
            <div id="totalRevenueGoal" style="font-size: 28px; font-weight: 800;">0ì›</div>
          </div>
          <div class="kpi-card">
            <div class="kpi-label">ì§„í–‰ì¤‘ í”„ë¡œì íŠ¸</div>
            <div id="activeProjects" class="kpi-value">0</div>
          </div>
          <div class="kpi-card">
            <div class="kpi-label">ì™„ë£Œëœ KPI</div>
            <div id="completedKPIs" class="kpi-value">0/0</div>
          </div>
          <div class="kpi-card">
            <div class="kpi-label">ì´ë²ˆ ì£¼ ì—…ë¬´</div>
            <div id="weeklyTasks" class="kpi-value">0ê±´</div>
          </div>
        </div>

        <!-- í”„ë¡œì íŠ¸ ëª©ë¡ -->
        <div id="projectList" style="display: grid; gap: 20px;">
          <div style="text-align: center; padding: 60px; background: var(--gray-50); border-radius: 16px; border: 2px dashed var(--gray-300);">
            <div style="font-size: 48px; margin-bottom: 16px;">ğŸ“‹</div>
            <div style="font-size: 16px; color: var(--gray-600); margin-bottom: 16px;">ì•„ì§ ë“±ë¡ëœ í”„ë¡œì íŠ¸ê°€ ì—†ìŠµë‹ˆë‹¤</div>
            <button class="btn btn-primary" onclick="openProjectModal()">+ ì²« í”„ë¡œì íŠ¸ ë§Œë“¤ê¸°</button>
          </div>
        </div>
      </div>

      <!-- í”„ë¡œì íŠ¸ ëª¨ë‹¬ -->
      <div id="projectModal" class="modal">
        <div class="modal-content" style="max-width: 700px; max-height: 90vh; overflow: hidden; display: flex; flex-direction: column;">
          <div class="modal-header" style="background: var(--primary); color: white;">
            <h2 id="projectModalTitle" class="modal-title" style="color: white;">í”„ë¡œì íŠ¸ ì¶”ê°€</h2>
            <button class="modal-close" onclick="closeProjectModal()" style="color: white;">Ã—</button>
          </div>
          <div style="flex: 1; overflow-y: auto; padding: 24px;">
            <input type="hidden" id="projectId">

            <!-- ê¸°ë³¸ ì •ë³´ -->
            <div style="margin-bottom: 24px;">
              <div style="font-weight: 600; margin-bottom: 12px;">ğŸ“Œ ê¸°ë³¸ ì •ë³´</div>
              <div style="display: grid; gap: 12px;">
                <div>
                  <label style="font-size: 13px; color: var(--gray-600); display: block; margin-bottom: 4px;">í”„ë¡œì íŠ¸ëª… *</label>
                  <input type="text" id="projectName" placeholder="ì˜ˆ: ì¼ë³¸ ì§ìˆ˜ì… ëŸ°ì¹­" style="width: 100%; padding: 12px; border: 1px solid var(--gray-300); border-radius: 8px; font-size: 15px;">
                </div>
                <div>
                  <label style="font-size: 13px; color: var(--gray-600); display: block; margin-bottom: 4px;">ì„¤ëª…</label>
                  <textarea id="projectDesc" placeholder="í”„ë¡œì íŠ¸ ëª©í‘œ ë° ì„¤ëª…" rows="2" style="width: 100%; padding: 12px; border: 1px solid var(--gray-300); border-radius: 8px; font-size: 14px; resize: none;"></textarea>
                </div>
                <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 12px;">
                  <div>
                    <label style="font-size: 13px; color: var(--gray-600); display: block; margin-bottom: 4px;">ë§¤ì¶œ ëª©í‘œ (ì›)</label>
                    <input type="number" id="projectRevenueGoal" placeholder="100000000" style="width: 100%; padding: 12px; border: 1px solid var(--gray-300); border-radius: 8px;">
                  </div>
                  <div>
                    <label style="font-size: 13px; color: var(--gray-600); display: block; margin-bottom: 4px;">ì‹œì‘ì¼</label>
                    <input type="date" id="projectStartDate" style="width: 100%; padding: 12px; border: 1px solid var(--gray-300); border-radius: 8px;">
                  </div>
                  <div>
                    <label style="font-size: 13px; color: var(--gray-600); display: block; margin-bottom: 4px;">ì¢…ë£Œì¼</label>
                    <input type="date" id="projectEndDate" style="width: 100%; padding: 12px; border: 1px solid var(--gray-300); border-radius: 8px;">
                  </div>
                </div>
                <div>
                  <label style="font-size: 13px; color: var(--gray-600); display: block; margin-bottom: 4px;">ìƒíƒœ</label>
                  <select id="projectStatus" style="width: 100%; padding: 12px; border: 1px solid var(--gray-300); border-radius: 8px;">
                    <option value="active">ğŸŸ¢ ì§„í–‰ì¤‘</option>
                    <option value="paused">ğŸŸ¡ ì¼ì‹œì •ì§€</option>
                    <option value="completed">âœ… ì™„ë£Œ</option>
                  </select>
                </div>
              </div>
            </div>

            <!-- íŒ€ KPI -->
            <div style="margin-bottom: 24px;">
              <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
                <div style="font-weight: 600;">ğŸ¯ íŒ€ KPI</div>
                <button type="button" onclick="addTeamKPI()" style="background: var(--primary-light); color: var(--primary); border: none; padding: 6px 12px; border-radius: 6px; font-size: 13px; cursor: pointer;">+ ì¶”ê°€</button>
              </div>
              <div id="teamKPIList" style="display: grid; gap: 8px;">
                <!-- ë™ì ìœ¼ë¡œ ì¶”ê°€ -->
              </div>
            </div>

            <!-- ê°œë³„ KPI -->
            <div style="margin-bottom: 24px;">
              <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
                <div style="font-weight: 600;">ğŸ‘¤ ê°œë³„ KPI (ë‹´ë‹¹ìë³„)</div>
                <button type="button" onclick="addMemberKPI()" style="background: var(--info-light); color: var(--info); border: none; padding: 6px 12px; border-radius: 6px; font-size: 13px; cursor: pointer;">+ ì¶”ê°€</button>
              </div>
              <div id="memberKPIList" style="display: grid; gap: 8px;">
                <!-- ë™ì ìœ¼ë¡œ ì¶”ê°€ -->
              </div>
            </div>
          </div>
          <div style="padding: 16px 24px; border-top: 1px solid var(--gray-200); display: flex; justify-content: space-between;">
            <button id="deleteProjectBtn" type="button" onclick="deleteProject()" style="background: var(--danger-light); color: var(--danger); border: none; padding: 12px 20px; border-radius: 8px; cursor: pointer; display: none;">ì‚­ì œ</button>
            <div style="display: flex; gap: 12px; margin-left: auto;">
              <button type="button" onclick="closeProjectModal()" class="btn btn-secondary">ì·¨ì†Œ</button>
              <button type="button" onclick="saveProject()" class="btn btn-primary">ì €ì¥</button>
            </div>
          </div>
        </div>
      </div>

      <!-- ê·¸ë¡œìŠ¤ë³´ë“œ -->
      <div id="tab-growth" class="tab-content">
        <div class="page-header">
          <h1 class="page-title">ê·¸ë¡œìŠ¤ë³´ë“œ</h1>
          <p class="page-desc">ì„±ì¥ ì§€í‘œ ë° ì‹¤í—˜ í˜„í™©</p>
        </div>

        <div class="kpi-grid">
          <div class="kpi-card">
            <div class="kpi-label">ê³µêµ¬ ì „í™˜ìœ¨</div>
            <div class="kpi-value" id="conversionRate">-</div>
          </div>
          <div class="kpi-card">
            <div class="kpi-label">í‰ê·  ê³µêµ¬ ê¸°ê°„</div>
            <div class="kpi-value" id="avgDealDays">-</div>
          </div>
          <div class="kpi-card">
            <div class="kpi-label">ì¬êµ¬ë§¤ìœ¨</div>
            <div class="kpi-value" id="repeatRate">-</div>
          </div>
          <div class="kpi-card">
            <div class="kpi-label">NPS ì ìˆ˜</div>
            <div class="kpi-value" id="npsScore">-</div>
          </div>
        </div>

        <div class="card">
          <div class="card-title">ì§„í–‰ì¤‘ ì‹¤í—˜</div>
          <div class="table-wrapper">
            <table>
              <thead>
                <tr>
                  <th>ì‹¤í—˜ëª…</th>
                  <th>ìƒíƒœ</th>
                  <th>ê¸°ê°„</th>
                  <th>ê²°ê³¼</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>ì‹ ê·œ ìƒí’ˆ í˜ì´ì§€ A/B í…ŒìŠ¤íŠ¸</td>
                  <td><span style="color: var(--success);">ì§„í–‰ì¤‘</span></td>
                  <td>01.01 ~ 01.31</td>
                  <td>ì „í™˜ìœ¨ +12%</td>
                </tr>
                <tr>
                  <td>í‘¸ì‹œ ì•Œë¦¼ ìµœì í™”</td>
                  <td><span style="color: var(--info);">ë¶„ì„ì¤‘</span></td>
                  <td>12.15 ~ 12.31</td>
                  <td>í´ë¦­ë¥  +8%</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>

      <!-- ì—…ë¬´ê°€ì´ë“œ -->
      <div id="tab-guide" class="tab-content">
        <div id="guideContent">
          <!-- ë™ì ìœ¼ë¡œ ë Œë”ë§ -->
        </div>
      </div>

      <!-- ë ˆí¼ëŸ°ìŠ¤ ë¼ì´ë¸ŒëŸ¬ë¦¬ -->
      <div id="tab-reference" class="tab-content">
        <div class="page-header" style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 16px;">
          <div>
            <h1 class="page-title">ë ˆí¼ëŸ°ìŠ¤ ë¼ì´ë¸ŒëŸ¬ë¦¬</h1>
            <p class="page-desc">ì´ë²¤íŠ¸, ë””ìì¸, ì œì•ˆì„œ, ìˆí¼ ë“± ì—…ë¬´ ë ˆí¼ëŸ°ìŠ¤ë¥¼ ëª¨ì•„ë‘ì„¸ìš”</p>
          </div>
          <div style="display: flex; gap: 8px; flex-wrap: wrap;">
            <button class="btn btn-secondary" onclick="openCategoryModal()">âš™ï¸ ì¹´í…Œê³ ë¦¬ ê´€ë¦¬</button>
            <button class="btn btn-primary" onclick="openReferenceModal()">+ ë ˆí¼ëŸ°ìŠ¤ ì¶”ê°€</button>
          </div>
        </div>

        <!-- ê²€ìƒ‰ ë° í•„í„° -->
        <div class="card" style="margin-bottom: 20px;">
          <div style="display: flex; gap: 16px; align-items: center; flex-wrap: wrap;">
            <div style="flex: 1; min-width: 200px;">
              <input type="text" id="refSearch" placeholder="ë ˆí¼ëŸ°ìŠ¤ ê²€ìƒ‰..." oninput="filterReferences()" style="width: 100%; padding: 12px 16px; border: 1px solid var(--gray-300); border-radius: 10px; font-size: 14px;">
            </div>
            <div id="refCategoryFilters" style="display: flex; gap: 8px; flex-wrap: wrap;">
              <!-- ë™ì ìœ¼ë¡œ ë Œë”ë§ -->
            </div>
          </div>
        </div>

        <!-- ë ˆí¼ëŸ°ìŠ¤ ëª©ë¡ -->
        <div id="referenceList" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 16px;">
          <div style="text-align: center; padding: 60px; grid-column: 1 / -1; background: var(--white); border-radius: 16px;">
            ë ˆí¼ëŸ°ìŠ¤ ë¡œë”©ì¤‘...
          </div>
        </div>
      </div>

      <!-- ë ˆí¼ëŸ°ìŠ¤ ëª¨ë‹¬ -->
      <div id="referenceModal" class="modal">
        <div class="modal-content" style="max-width: 650px; max-height: 90vh; overflow: hidden; display: flex; flex-direction: column;">
          <div class="modal-header" style="background: linear-gradient(135deg, #8B5CF6, #A78BFA); color: white;">
            <h2 id="referenceModalTitle" class="modal-title" style="color: white;">ë ˆí¼ëŸ°ìŠ¤ ì¶”ê°€</h2>
            <button class="modal-close" onclick="closeReferenceModal()" style="color: white;">Ã—</button>
          </div>
          <div style="flex: 1; overflow-y: auto; padding: 24px;">
            <input type="hidden" id="referenceId">
            <div style="display: grid; gap: 16px;">
              <div>
                <label style="font-size: 13px; font-weight: 600; color: var(--gray-700); display: block; margin-bottom: 6px;">ì œëª© *</label>
                <input type="text" id="referenceTitle" placeholder="ë ˆí¼ëŸ°ìŠ¤ ì œëª©" style="width: 100%; padding: 12px; border: 1px solid var(--gray-300); border-radius: 10px; font-size: 14px;">
              </div>
              <div>
                <label style="font-size: 13px; font-weight: 600; color: var(--gray-700); display: block; margin-bottom: 6px;">ì¹´í…Œê³ ë¦¬ *</label>
                <select id="referenceCategory" style="width: 100%; padding: 12px; border: 1px solid var(--gray-300); border-radius: 10px; font-size: 14px;">
                  <!-- ë™ì ìœ¼ë¡œ ë Œë”ë§ -->
                </select>
              </div>
              <div>
                <label style="font-size: 13px; font-weight: 600; color: var(--gray-700); display: block; margin-bottom: 6px;">ì„¤ëª…</label>
                <textarea id="referenceDesc" placeholder="ë ˆí¼ëŸ°ìŠ¤ì— ëŒ€í•œ ì„¤ëª…" rows="3" style="width: 100%; padding: 12px; border: 1px solid var(--gray-300); border-radius: 10px; font-size: 14px; resize: vertical;"></textarea>
              </div>
              <div style="background: #E8F3FF; padding: 16px; border-radius: 10px;">
                <label style="font-size: 13px; font-weight: 600; color: #0064FF; display: block; margin-bottom: 6px;">ğŸ”— ë§í¬ URL</label>
                <input type="url" id="referenceLink" placeholder="https://..." style="width: 100%; padding: 12px; border: 1px solid #C7D2FE; border-radius: 10px; font-size: 14px; background: white;">
                <div style="font-size: 11px; color: var(--gray-600); margin-top: 6px;">ìœ íŠœë¸Œ, ì¸ìŠ¤íƒ€ê·¸ë¨, ì›¹ì‚¬ì´íŠ¸ ë“± ì™¸ë¶€ ë§í¬</div>
              </div>
              <div style="background: linear-gradient(135deg, #FEF3C7, #FDE68A); padding: 16px; border-radius: 10px; border: 1px solid #F59E0B;">
                <label style="font-size: 13px; font-weight: 600; color: #B45309; display: block; margin-bottom: 10px;">ğŸ“¤ ì´ë¯¸ì§€ ì—…ë¡œë“œ <span id="refImageCount" style="color: var(--gray-600); font-weight: 400;"></span></label>
                <div id="refFileUploadArea" style="background: white; border: 2px dashed #F59E0B; border-radius: 10px; padding: 20px; text-align: center; cursor: pointer;" onclick="document.getElementById('refFileInput').click()">
                  <input type="file" id="refFileInput" accept=".jpg,.jpeg,.png,.gif" multiple style="display: none;" onchange="handleRefImageUpload(this.files)">
                  <div style="font-size: 32px; margin-bottom: 8px;">ğŸ–¼ï¸</div>
                  <div style="font-size: 14px; font-weight: 600; color: #92400E;">í´ë¦­í•˜ì—¬ ì´ë¯¸ì§€ ì„ íƒ (ì—¬ëŸ¬ì¥ ê°€ëŠ¥)</div>
                  <div style="font-size: 12px; color: #B45309; margin-top: 4px;">JPG, PNG, GIF (ìµœëŒ€ 10ì¥)</div>
                </div>
                <div id="refImagesPreview" style="display: none; margin-top: 12px;"></div>
              </div>
              <div style="background: #DCFCE7; padding: 16px; border-radius: 10px;">
                <label style="font-size: 13px; font-weight: 600; color: #16A34A; display: block; margin-bottom: 6px;">ğŸ“ íŒŒì¼ URL (ì™¸ë¶€ ë§í¬)</label>
                <input type="url" id="referenceFileUrl" placeholder="êµ¬ê¸€ ë“œë¼ì´ë¸Œ, Dropbox ë“± íŒŒì¼ ê³µìœ  ë§í¬" style="width: 100%; padding: 12px; border: 1px solid #86EFAC; border-radius: 10px; font-size: 14px; background: white;">
              </div>
              <div>
                <label style="font-size: 13px; font-weight: 600; color: var(--gray-700); display: block; margin-bottom: 6px;">íƒœê·¸ (ì‰¼í‘œë¡œ êµ¬ë¶„)</label>
                <input type="text" id="referenceTags" placeholder="ì˜ˆ: ë´„ì‹ ìƒ, í• ì¸ì´ë²¤íŠ¸, ì¸ìŠ¤íƒ€" style="width: 100%; padding: 12px; border: 1px solid var(--gray-300); border-radius: 10px; font-size: 14px;">
              </div>
            </div>
          </div>
          <div style="padding: 16px 24px; border-top: 1px solid var(--gray-200); display: flex; justify-content: space-between;">
            <button id="deleteReferenceBtn" type="button" onclick="deleteReference()" style="background: var(--danger-light); color: var(--danger); border: none; padding: 12px 20px; border-radius: 8px; cursor: pointer; display: none;">ì‚­ì œ</button>
            <div style="display: flex; gap: 12px; margin-left: auto;">
              <button type="button" onclick="closeReferenceModal()" class="btn btn-secondary">ì·¨ì†Œ</button>
              <button type="button" onclick="saveReference()" class="btn btn-primary" id="btnSaveRef">ì €ì¥</button>
            </div>
          </div>
        </div>
      </div>

      <!-- ì¹´í…Œê³ ë¦¬ ê´€ë¦¬ ëª¨ë‹¬ -->
      <div id="categoryModal" class="modal">
        <div class="modal-content" style="max-width: 500px;">
          <div class="modal-header">
            <h2 class="modal-title">ì¹´í…Œê³ ë¦¬ ê´€ë¦¬</h2>
            <button class="modal-close" onclick="closeCategoryModal()">Ã—</button>
          </div>
          <div style="padding: 24px;">
            <div style="display: flex; gap: 8px; margin-bottom: 16px;">
              <input type="text" id="newCatEmoji" placeholder="ğŸ‰" style="width: 60px; padding: 12px; border: 1px solid var(--gray-300); border-radius: 8px; text-align: center; font-size: 20px;">
              <input type="text" id="newCatName" placeholder="ì¹´í…Œê³ ë¦¬ëª…" style="flex: 1; padding: 12px; border: 1px solid var(--gray-300); border-radius: 8px;">
              <input type="color" id="newCatColor" value="#8B5CF6" style="width: 50px; height: 46px; border: none; border-radius: 8px; cursor: pointer;">
              <button onclick="addCategory()" class="btn btn-primary">ì¶”ê°€</button>
            </div>
            <div id="categoryList" style="display: grid; gap: 8px;">
              <!-- ë™ì ìœ¼ë¡œ ë Œë”ë§ -->
            </div>
          </div>
        </div>
      </div>

      <!-- ë ˆí¼ëŸ°ìŠ¤ ìƒì„¸ ëª¨ë‹¬ -->
      <div id="referenceDetailModal" class="modal">
        <div class="modal-content" style="max-width: 700px; max-height: 90vh; overflow-y: auto;">
          <div id="referenceDetailContent">
            <!-- ë™ì ìœ¼ë¡œ ë Œë”ë§ -->
          </div>
        </div>
      </div>
    </main>
  </div>

  <!-- í† ìŠ¤íŠ¸ -->
  <div id="toast"></div>

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>

  <script>
    // Firebase ì„¤ì •
    const firebaseConfig = {
      apiKey: "AIzaSyAQf_Cu9wMji5QsMBQns5eg6nOD_vmrZMs",
      authDomain: "moyeora-deal-manager.firebaseapp.com",
      projectId: "moyeora-deal-manager",
      storageBucket: "moyeora-deal-manager.firebasestorage.app",
      messagingSenderId: "527148187832",
      appId: "1:527148187832:web:dc35b0413a7157db34744d"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    // ìƒíƒœ ê´€ë¦¬
    let state = {
      currentTab: 'dashboard',
      deals: [],
      suppliers: [],
      sellers: [],
      projects: [],
      references: [],
      refCategories: [],
      isLoggedIn: false
    };

    // ê¸°ë³¸ ì¹´í…Œê³ ë¦¬ (Firebaseì— ì—†ì„ ë•Œ ì‚¬ìš©)
    const DEFAULT_CATEGORIES = [
      { id: 'event', label: 'ì´ë²¤íŠ¸', emoji: 'ğŸ‰', color: '#F59E0B', bg: '#FEF3C7' },
      { id: 'design', label: 'ë””ìì¸', emoji: 'ğŸ¨', color: '#EC4899', bg: '#FCE7F3' },
      { id: 'proposal', label: 'ì œì•ˆì„œ', emoji: 'ğŸ“„', color: '#3B82F6', bg: '#DBEAFE' },
      { id: 'shortform', label: 'ìˆí¼', emoji: 'ğŸ¬', color: '#EF4444', bg: '#FEE2E2' },
      { id: 'content', label: 'ì½˜í…ì¸ ', emoji: 'âœï¸', color: '#10B981', bg: '#D1FAE5' },
      { id: 'marketing', label: 'ë§ˆì¼€íŒ…', emoji: 'ğŸ“¢', color: '#8B5CF6', bg: '#EDE9FE' },
      { id: 'etc', label: 'ê¸°íƒ€', emoji: 'ğŸ“', color: '#6B7280', bg: '#F3F4F6' }
    ];

    // ë ˆí¼ëŸ°ìŠ¤ ê´€ë ¨ ì „ì—­ ë³€ìˆ˜
    let refCategoryFilter = 'all';
    let refSearchQuery = '';
    let refUploadedImages = [];

    let adminPassword = 'admin1234';

    // ë¹„ë°€ë²ˆí˜¸ ë¡œë“œ
    async function loadAdminPassword() {
      try {
        const doc = await db.collection('settings').doc('admin').get();
        if (doc.exists && doc.data().password) {
          adminPassword = doc.data().password;
        }
      } catch (e) {
        console.error('ë¹„ë°€ë²ˆí˜¸ ë¡œë“œ ì‹¤íŒ¨:', e);
      }
    }

    // ë¡œê·¸ì¸ ìƒíƒœ í™•ì¸
    function checkLoginStatus() {
      const isLoggedIn = sessionStorage.getItem('moyeora_admin_logged_in') === 'true';
      if (isLoggedIn) {
        state.isLoggedIn = true;
        showApp();
      } else {
        showLogin();
      }
    }

    // ë¡œê·¸ì¸ ì²˜ë¦¬
    async function handleLogin() {
      const password = document.getElementById('loginPassword').value;
      const errorEl = document.getElementById('loginError');

      if (password === adminPassword) {
        state.isLoggedIn = true;
        sessionStorage.setItem('moyeora_admin_logged_in', 'true');
        showApp();
      } else {
        errorEl.textContent = 'ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.';
        errorEl.classList.add('show');
      }
    }

    // ë¡œê·¸ì¸ í™”ë©´ í‘œì‹œ
    function showLogin() {
      document.getElementById('loginScreen').style.display = 'flex';
      document.getElementById('appScreen').style.display = 'none';
    }

    // ì•± í™”ë©´ í‘œì‹œ
    function showApp() {
      document.getElementById('loginScreen').style.display = 'none';
      document.getElementById('appScreen').style.display = 'flex';
      setupListeners();
      // ì˜ì—…í˜„í™© ì´ˆê¸° ë Œë”ë§
      setTimeout(() => renderSalesDashboard(), 100);
    }

    // Firebase ë¦¬ìŠ¤ë„ˆ
    function setupListeners() {
      db.collection('deals').orderBy('startDate', 'desc').onSnapshot(snapshot => {
        state.deals = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
        render();
      });

      db.collection('suppliers').orderBy('name').onSnapshot(snapshot => {
        state.suppliers = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
        render();
      });

      db.collection('projects').orderBy('createdAt', 'desc').onSnapshot(snapshot => {
        state.projects = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
        render();
      });

      db.collection('references').orderBy('createdAt', 'desc').onSnapshot(snapshot => {
        state.references = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
        if (state.currentTab === 'reference') renderReferences();
      });

      // ì¹´í…Œê³ ë¦¬ ë¦¬ìŠ¤ë„ˆ
      db.collection('refCategories').orderBy('order', 'asc').onSnapshot(snapshot => {
        if (snapshot.empty) {
          state.refCategories = DEFAULT_CATEGORIES;
        } else {
          state.refCategories = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
        }
        renderCategoryFilters();
        renderCategoryOptions();
      });

      db.collection('sellers').orderBy('name').onSnapshot(snapshot => {
        state.sellers = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
        render();
      });

      // ì…€ëŸ¬ ì •ì‚° ë°ì´í„° (ì˜ì—…í˜„í™©ìš©)
      db.collection('sellerSettlements').orderBy('settlementDate', 'desc').onSnapshot(snapshot => {
        state.sellerSettlements = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
        if (state.currentTab === 'dashboard') renderSalesDashboard();
      });

      // ê³µê¸‰ì‚¬ ì •ì‚° ë°ì´í„° (ì˜ì—…í˜„í™©ìš©)
      db.collection('supplierSettlements').orderBy('settlementDate', 'desc').onSnapshot(snapshot => {
        state.supplierSettlements = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
      });

      // íŒ€ì› ë°ì´í„° (ì˜ì—…í˜„í™©ìš©)
      db.collection('teamMembers').orderBy('name').onSnapshot(snapshot => {
        state.teamMembers = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
        if (state.currentTab === 'dashboard') renderSalesDashboard();
      });

      // ì „ëµ ì„¤ì • ë°ì´í„° (ëª©í‘œì¹˜)
      db.collection('settings').doc('strategy').onSnapshot(doc => {
        if (doc.exists) {
          state.strategyData = doc.data();
        }
      });
    }

    // íƒ­ ì „í™˜
    function switchTab(tabId) {
      state.currentTab = tabId;

      // ë„¤ë¹„ê²Œì´ì…˜ í™œì„±í™”
      document.querySelectorAll('.nav-item').forEach(item => {
        item.classList.remove('active');
      });
      event.currentTarget.classList.add('active');

      // íƒ­ ì»¨í…ì¸  í‘œì‹œ
      document.querySelectorAll('.tab-content').forEach(tab => {
        tab.classList.remove('active');
      });
      document.getElementById(`tab-${tabId}`).classList.add('active');

      render();

      // ë ˆí¼ëŸ°ìŠ¤ íƒ­ ë Œë”ë§
      if (tabId === 'reference') {
        renderReferences();
      }

      // ì—…ë¬´ê°€ì´ë“œ íƒ­ ë Œë”ë§
      if (tabId === 'guide') {
        renderGuide();
      }

      // ì˜ì—…í˜„í™© íƒ­ ë Œë”ë§
      if (tabId === 'dashboard') {
        renderSalesDashboard();
      }
    }

    // OKR ê¸°ê°„ ì „í™˜
    function switchOkrPeriod(period) {
      document.querySelectorAll('.tab-nav .tab-btn').forEach(btn => {
        btn.classList.remove('active');
      });
      event.currentTarget.classList.add('active');
      // TODO: ê¸°ê°„ë³„ OKR ë°ì´í„° ë¡œë“œ
    }

    // ì‚¬ì´ë“œë°” í† ê¸€
    function toggleSidebar() {
      document.querySelector('.sidebar').classList.toggle('open');
      document.querySelector('.sidebar-overlay').classList.toggle('show');
    }

    // ë Œë”ë§
    function render() {
      // ê·¸ë¡œìŠ¤ë³´ë“œ ì§€í‘œ (null ì²´í¬)
      const conversionRateEl = document.getElementById('conversionRate');
      const avgDealDaysEl = document.getElementById('avgDealDays');
      const repeatRateEl = document.getElementById('repeatRate');
      const npsScoreEl = document.getElementById('npsScore');

      if (conversionRateEl) {
        const today = new Date();
        today.setHours(0, 0, 0, 0);
        const activeDeals = state.deals.filter(deal => {
          const start = new Date(deal.startDate);
          const end = new Date(deal.endDate);
          return today >= start && today <= end;
        });
        conversionRateEl.textContent = state.deals.length > 0 ? `${((activeDeals.length / state.deals.length) * 100).toFixed(1)}%` : '-';
      }
      if (avgDealDaysEl) avgDealDaysEl.textContent = '7ì¼';
      if (repeatRateEl) repeatRateEl.textContent = '-';
      if (npsScoreEl) npsScoreEl.textContent = '-';

      // í”„ë¡œì íŠ¸ ëª©ë¡ ë Œë”ë§
      renderProjects();
    }

    // ========================================
    // í”„ë¡œì íŠ¸ ê´€ë¦¬ ì‹œìŠ¤í…œ
    // ========================================

    // í”„ë¡œì íŠ¸ ëª¨ë‹¬ ì—´ê¸°
    function openProjectModal(project = null) {
      const modal = document.getElementById('projectModal');
      const title = document.getElementById('projectModalTitle');
      const deleteBtn = document.getElementById('deleteProjectBtn');

      // í¼ ì´ˆê¸°í™”
      document.getElementById('projectId').value = project?.id || '';
      document.getElementById('projectName').value = project?.name || '';
      document.getElementById('projectDesc').value = project?.description || '';
      document.getElementById('projectRevenueGoal').value = project?.revenueGoal || '';
      document.getElementById('projectStartDate').value = project?.startDate || '';
      document.getElementById('projectEndDate').value = project?.endDate || '';
      document.getElementById('projectStatus').value = project?.status || 'active';

      // KPI ì´ˆê¸°í™”
      document.getElementById('teamKPIList').innerHTML = '';
      document.getElementById('memberKPIList').innerHTML = '';

      if (project) {
        title.textContent = 'í”„ë¡œì íŠ¸ ìˆ˜ì •';
        deleteBtn.style.display = 'block';
        // ê¸°ì¡´ íŒ€ KPI ë¡œë“œ
        (project.teamKPIs || []).forEach(kpi => addTeamKPI(kpi));
        // ê¸°ì¡´ ê°œë³„ KPI ë¡œë“œ
        (project.memberKPIs || []).forEach(kpi => addMemberKPI(kpi));
      } else {
        title.textContent = 'í”„ë¡œì íŠ¸ ì¶”ê°€';
        deleteBtn.style.display = 'none';
        // ê¸°ë³¸ KPI í•˜ë‚˜ì”© ì¶”ê°€
        addTeamKPI();
      }

      modal.classList.add('show');
    }

    function closeProjectModal() {
      document.getElementById('projectModal').classList.remove('show');
    }

    // íŒ€ KPI ì¶”ê°€
    function addTeamKPI(kpi = null) {
      const list = document.getElementById('teamKPIList');
      const idx = list.children.length;
      const div = document.createElement('div');
      div.style.cssText = 'display: grid; grid-template-columns: 1fr 80px 80px 40px; gap: 8px; align-items: center; background: var(--gray-50); padding: 12px; border-radius: 8px;';
      div.innerHTML = `
        <input type="text" class="team-kpi-name" placeholder="KPI í•­ëª© (ì˜ˆ: ê³µê¸‰ì‚¬ ê³„ì•½)" value="${kpi?.name || ''}" style="padding: 10px; border: 1px solid var(--gray-300); border-radius: 6px;">
        <input type="number" class="team-kpi-target" placeholder="ëª©í‘œ" value="${kpi?.target || ''}" style="padding: 10px; border: 1px solid var(--gray-300); border-radius: 6px;">
        <input type="number" class="team-kpi-current" placeholder="í˜„ì¬" value="${kpi?.current || 0}" style="padding: 10px; border: 1px solid var(--gray-300); border-radius: 6px;">
        <button type="button" onclick="this.parentElement.remove()" style="background: var(--danger-light); color: var(--danger); border: none; padding: 8px; border-radius: 6px; cursor: pointer;">âœ•</button>
      `;
      list.appendChild(div);
    }

    // ê°œë³„ KPI ì¶”ê°€
    function addMemberKPI(kpi = null) {
      const list = document.getElementById('memberKPIList');
      const div = document.createElement('div');
      div.style.cssText = 'display: grid; grid-template-columns: 100px 1fr 70px 70px 40px; gap: 8px; align-items: center; background: var(--info-light); padding: 12px; border-radius: 8px;';
      div.innerHTML = `
        <select class="member-kpi-member" style="padding: 10px; border: 1px solid var(--gray-300); border-radius: 6px;">
          <option value="songhee" ${kpi?.memberId === 'songhee' ? 'selected' : ''}>ê¹€ì†¡í¬</option>
          <option value="chaeeun" ${kpi?.memberId === 'chaeeun' ? 'selected' : ''}>ì´ì±„ì€</option>
        </select>
        <input type="text" class="member-kpi-name" placeholder="KPI í•­ëª©" value="${kpi?.name || ''}" style="padding: 10px; border: 1px solid var(--gray-300); border-radius: 6px;">
        <input type="number" class="member-kpi-target" placeholder="ëª©í‘œ" value="${kpi?.target || ''}" style="padding: 10px; border: 1px solid var(--gray-300); border-radius: 6px;">
        <input type="number" class="member-kpi-current" placeholder="í˜„ì¬" value="${kpi?.current || 0}" style="padding: 10px; border: 1px solid var(--gray-300); border-radius: 6px;">
        <button type="button" onclick="this.parentElement.remove()" style="background: var(--danger-light); color: var(--danger); border: none; padding: 8px; border-radius: 6px; cursor: pointer;">âœ•</button>
      `;
      list.appendChild(div);
    }

    // í”„ë¡œì íŠ¸ ì €ì¥
    async function saveProject() {
      const id = document.getElementById('projectId').value;
      const name = document.getElementById('projectName').value.trim();

      if (!name) {
        showToast('í”„ë¡œì íŠ¸ëª…ì„ ì…ë ¥í•´ì£¼ì„¸ìš”');
        return;
      }

      // íŒ€ KPI ìˆ˜ì§‘
      const teamKPIs = [];
      document.querySelectorAll('#teamKPIList > div').forEach(row => {
        const kpiName = row.querySelector('.team-kpi-name').value.trim();
        const target = parseInt(row.querySelector('.team-kpi-target').value) || 0;
        const current = parseInt(row.querySelector('.team-kpi-current').value) || 0;
        if (kpiName) {
          teamKPIs.push({ name: kpiName, target, current });
        }
      });

      // ê°œë³„ KPI ìˆ˜ì§‘
      const memberKPIs = [];
      document.querySelectorAll('#memberKPIList > div').forEach(row => {
        const memberId = row.querySelector('.member-kpi-member').value;
        const kpiName = row.querySelector('.member-kpi-name').value.trim();
        const target = parseInt(row.querySelector('.member-kpi-target').value) || 0;
        const current = parseInt(row.querySelector('.member-kpi-current').value) || 0;
        if (kpiName) {
          memberKPIs.push({ memberId, name: kpiName, target, current });
        }
      });

      const projectData = {
        name,
        description: document.getElementById('projectDesc').value.trim(),
        revenueGoal: parseInt(document.getElementById('projectRevenueGoal').value) || 0,
        startDate: document.getElementById('projectStartDate').value,
        endDate: document.getElementById('projectEndDate').value,
        status: document.getElementById('projectStatus').value,
        teamKPIs,
        memberKPIs,
        updatedAt: new Date().toISOString()
      };

      try {
        if (id) {
          await db.collection('projects').doc(id).update(projectData);
        } else {
          projectData.createdAt = new Date().toISOString();
          await db.collection('projects').add(projectData);
        }
        showToast('ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤');
        closeProjectModal();
      } catch (e) {
        console.error(e);
        showToast('ì €ì¥ ì‹¤íŒ¨');
      }
    }

    // í”„ë¡œì íŠ¸ ì‚­ì œ
    async function deleteProject() {
      const id = document.getElementById('projectId').value;
      if (!id) return;

      if (!confirm('ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;

      try {
        await db.collection('projects').doc(id).delete();
        showToast('ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤');
        closeProjectModal();
      } catch (e) {
        showToast('ì‚­ì œ ì‹¤íŒ¨');
      }
    }

    // KPI ë¹ ë¥¸ ì—…ë°ì´íŠ¸
    async function quickUpdateKPI(projectId, kpiType, kpiIndex, newValue) {
      const project = state.projects.find(p => p.id === projectId);
      if (!project) return;

      const kpiList = kpiType === 'team' ? project.teamKPIs : project.memberKPIs;
      if (kpiList && kpiList[kpiIndex]) {
        kpiList[kpiIndex].current = parseInt(newValue) || 0;

        try {
          await db.collection('projects').doc(projectId).update({
            [kpiType === 'team' ? 'teamKPIs' : 'memberKPIs']: kpiList
          });
          showToast('ì—…ë°ì´íŠ¸ ì™„ë£Œ');
        } catch (e) {
          showToast('ì—…ë°ì´íŠ¸ ì‹¤íŒ¨');
        }
      }
    }

    // í”„ë¡œì íŠ¸ ëª©ë¡ ë Œë”ë§
    function renderProjects() {
      const list = document.getElementById('projectList');
      if (!list) return;

      const projects = state.projects || [];
      const activeProjects = projects.filter(p => p.status === 'active');

      // ìš”ì•½ ì—…ë°ì´íŠ¸
      const totalGoal = projects.reduce((sum, p) => sum + (p.revenueGoal || 0), 0);
      document.getElementById('totalRevenueGoal').textContent = totalGoal >= 100000000
        ? (totalGoal / 100000000).toFixed(1) + 'ì–µì›'
        : (totalGoal / 10000).toLocaleString() + 'ë§Œì›';
      document.getElementById('activeProjects').textContent = activeProjects.length;

      // KPI ì™„ë£Œ ê³„ì‚°
      let totalKPIs = 0, completedKPIs = 0;
      projects.forEach(p => {
        (p.teamKPIs || []).forEach(k => {
          totalKPIs++;
          if (k.current >= k.target) completedKPIs++;
        });
        (p.memberKPIs || []).forEach(k => {
          totalKPIs++;
          if (k.current >= k.target) completedKPIs++;
        });
      });
      document.getElementById('completedKPIs').textContent = `${completedKPIs}/${totalKPIs}`;

      if (projects.length === 0) {
        list.innerHTML = `
          <div style="text-align: center; padding: 60px; background: var(--gray-50); border-radius: 16px; border: 2px dashed var(--gray-300);">
            <div style="font-size: 48px; margin-bottom: 16px;">ğŸ“‹</div>
            <div style="font-size: 16px; color: var(--gray-600); margin-bottom: 16px;">ì•„ì§ ë“±ë¡ëœ í”„ë¡œì íŠ¸ê°€ ì—†ìŠµë‹ˆë‹¤</div>
            <button class="btn btn-primary" onclick="openProjectModal()">+ ì²« í”„ë¡œì íŠ¸ ë§Œë“¤ê¸°</button>
          </div>
        `;
        return;
      }

      list.innerHTML = projects.map(project => {
        const statusColors = {
          active: { bg: '#dcfce7', text: '#16a34a', icon: 'ğŸŸ¢' },
          paused: { bg: '#fef3c7', text: '#d97706', icon: 'ğŸŸ¡' },
          completed: { bg: '#dbeafe', text: '#2563eb', icon: 'âœ…' }
        };
        const status = statusColors[project.status] || statusColors.active;

        // íŒ€ KPI ì§„í–‰ë¥ 
        const teamKPIs = project.teamKPIs || [];
        const memberKPIs = project.memberKPIs || [];
        const allKPIs = [...teamKPIs, ...memberKPIs];
        const kpiProgress = allKPIs.length > 0
          ? Math.round(allKPIs.reduce((sum, k) => sum + Math.min(100, (k.current / k.target) * 100), 0) / allKPIs.length)
          : 0;

        return `
          <div class="card" style="cursor: pointer;" onclick="openProjectModal(state.projects.find(p=>p.id==='${project.id}'))">
            <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 16px;">
              <div>
                <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 4px;">
                  <span style="font-size: 20px; font-weight: 700;">${project.name}</span>
                  <span style="background: ${status.bg}; color: ${status.text}; padding: 2px 8px; border-radius: 12px; font-size: 11px;">${status.icon} ${project.status === 'active' ? 'ì§„í–‰ì¤‘' : project.status === 'paused' ? 'ì¼ì‹œì •ì§€' : 'ì™„ë£Œ'}</span>
                </div>
                <div style="font-size: 13px; color: var(--gray-500);">${project.description || ''}</div>
              </div>
              <div style="text-align: right;">
                <div style="font-size: 24px; font-weight: 800; color: var(--primary);">${project.revenueGoal >= 100000000 ? (project.revenueGoal/100000000).toFixed(1) + 'ì–µ' : (project.revenueGoal/10000).toLocaleString() + 'ë§Œ'}</div>
                <div style="font-size: 11px; color: var(--gray-500);">ë§¤ì¶œ ëª©í‘œ</div>
              </div>
            </div>

            <!-- KPI ì§„í–‰ë¥  ë°” -->
            <div style="margin-bottom: 16px;">
              <div style="display: flex; justify-content: space-between; font-size: 12px; margin-bottom: 4px;">
                <span style="color: var(--gray-600);">KPI ì§„í–‰ë¥ </span>
                <span style="font-weight: 600; color: ${kpiProgress >= 70 ? 'var(--success)' : kpiProgress >= 40 ? 'var(--warning)' : 'var(--gray-600)'};">${kpiProgress}%</span>
              </div>
              <div style="background: var(--gray-200); height: 8px; border-radius: 4px;">
                <div style="background: ${kpiProgress >= 70 ? 'var(--success)' : kpiProgress >= 40 ? 'var(--warning)' : 'var(--primary)'}; height: 100%; width: ${kpiProgress}%; border-radius: 4px; transition: width 0.3s;"></div>
              </div>
            </div>

            <!-- íŒ€ KPI -->
            ${teamKPIs.length > 0 ? `
            <div style="margin-bottom: 12px;">
              <div style="font-size: 12px; font-weight: 600; color: var(--gray-600); margin-bottom: 8px;">ğŸ¯ íŒ€ KPI</div>
              <div style="display: flex; flex-wrap: wrap; gap: 8px;">
                ${teamKPIs.map((kpi, idx) => {
                  const progress = Math.min(100, Math.round((kpi.current / kpi.target) * 100));
                  return `
                    <div style="background: var(--gray-50); padding: 8px 12px; border-radius: 8px; display: flex; align-items: center; gap: 8px;" onclick="event.stopPropagation()">
                      <span style="font-size: 13px;">${kpi.name}</span>
                      <span style="font-weight: 700; color: ${progress >= 100 ? 'var(--success)' : 'var(--gray-900)'};">${kpi.current}/${kpi.target}</span>
                      <button onclick="event.stopPropagation(); quickUpdateKPI('${project.id}', 'team', ${idx}, ${kpi.current + 1})" style="background: var(--primary); color: white; border: none; width: 24px; height: 24px; border-radius: 4px; cursor: pointer; font-size: 14px;">+</button>
                    </div>
                  `;
                }).join('')}
              </div>
            </div>
            ` : ''}

            <!-- ê°œë³„ KPI -->
            ${memberKPIs.length > 0 ? `
            <div>
              <div style="font-size: 12px; font-weight: 600; color: var(--gray-600); margin-bottom: 8px;">ğŸ‘¤ ê°œë³„ KPI</div>
              <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 8px;">
                ${memberKPIs.map((kpi, idx) => {
                  const progress = Math.min(100, Math.round((kpi.current / kpi.target) * 100));
                  const memberName = kpi.memberId === 'songhee' ? 'ê¹€ì†¡í¬' : 'ì´ì±„ì€';
                  return `
                    <div style="background: var(--info-light); padding: 8px 12px; border-radius: 8px; display: flex; align-items: center; justify-content: space-between;" onclick="event.stopPropagation()">
                      <div>
                        <span style="font-size: 11px; color: var(--info);">${memberName}</span>
                        <div style="font-size: 13px;">${kpi.name}</div>
                      </div>
                      <div style="display: flex; align-items: center; gap: 6px;">
                        <span style="font-weight: 700; color: ${progress >= 100 ? 'var(--success)' : 'var(--gray-900)'};">${kpi.current}/${kpi.target}</span>
                        <button onclick="event.stopPropagation(); quickUpdateKPI('${project.id}', 'member', ${idx}, ${kpi.current + 1})" style="background: var(--info); color: white; border: none; width: 22px; height: 22px; border-radius: 4px; cursor: pointer; font-size: 12px;">+</button>
                      </div>
                    </div>
                  `;
                }).join('')}
              </div>
            </div>
            ` : ''}

            <!-- ê¸°ê°„ -->
            ${project.startDate || project.endDate ? `
            <div style="margin-top: 12px; padding-top: 12px; border-top: 1px solid var(--gray-200); font-size: 12px; color: var(--gray-500);">
              ğŸ“… ${project.startDate || '?'} ~ ${project.endDate || '?'}
            </div>
            ` : ''}
          </div>
        `;
      }).join('');
    }

    // ========================================
    // ë ˆí¼ëŸ°ìŠ¤ ë¼ì´ë¸ŒëŸ¬ë¦¬ ì‹œìŠ¤í…œ
    // ========================================

    // ì¹´í…Œê³ ë¦¬ ê°€ì ¸ì˜¤ê¸° í—¬í¼
    function getCategories() {
      return state.refCategories.length > 0 ? state.refCategories : DEFAULT_CATEGORIES;
    }

    function getCategoryById(catId) {
      const cats = getCategories();
      return cats.find(c => c.id === catId) || cats[cats.length - 1];
    }

    // ì¹´í…Œê³ ë¦¬ í•„í„° ë²„íŠ¼ ë Œë”ë§
    function renderCategoryFilters() {
      const container = document.getElementById('refCategoryFilters');
      if (!container) return;

      const cats = getCategories();
      let html = `<button onclick="setRefCategoryFilter('all')" class="ref-cat-btn ${refCategoryFilter === 'all' ? 'active' : ''}"
                          style="padding: 8px 16px; border: none; border-radius: 20px; cursor: pointer; font-size: 13px; font-weight: 600;
                          background: ${refCategoryFilter === 'all' ? '#0064FF' : '#F2F4F6'};
                          color: ${refCategoryFilter === 'all' ? 'white' : '#6B7684'};">ì „ì²´</button>`;

      cats.forEach(c => {
        const isActive = refCategoryFilter === c.id;
        html += `<button onclick="setRefCategoryFilter('${c.id}')" class="ref-cat-btn ${isActive ? 'active' : ''}"
                         style="padding: 8px 16px; border: none; border-radius: 20px; cursor: pointer; font-size: 13px; font-weight: 500;
                         background: ${isActive ? c.color : c.bg}; color: ${isActive ? 'white' : c.color};">
                   ${c.emoji} ${c.label}
                 </button>`;
      });
      container.innerHTML = html;
    }

    // ì¹´í…Œê³ ë¦¬ ì…€ë ‰íŠ¸ ì˜µì…˜ ë Œë”ë§
    function renderCategoryOptions() {
      const select = document.getElementById('referenceCategory');
      if (!select) return;

      const cats = getCategories();
      select.innerHTML = cats.map(c => `<option value="${c.id}">${c.emoji} ${c.label}</option>`).join('');
    }

    // ì¹´í…Œê³ ë¦¬ í•„í„° ì„¤ì •
    function setRefCategoryFilter(category) {
      refCategoryFilter = category;
      renderCategoryFilters();
      filterReferences();
    }

    // ë ˆí¼ëŸ°ìŠ¤ í•„í„°ë§
    function filterReferences() {
      const searchInput = document.getElementById('refSearch');
      const search = searchInput ? searchInput.value.toLowerCase() : '';
      refSearchQuery = search;

      const filtered = state.references.filter(ref => {
        const matchCategory = refCategoryFilter === 'all' || ref.category === refCategoryFilter;
        const matchSearch = !search ||
          ref.title.toLowerCase().includes(search) ||
          (ref.description || '').toLowerCase().includes(search) ||
          (ref.tags || []).some(t => t.toLowerCase().includes(search));
        return matchCategory && matchSearch;
      });
      renderReferenceList(filtered);
    }

    // ë ˆí¼ëŸ°ìŠ¤ ëª©ë¡ ë Œë”ë§
    function renderReferences() {
      renderCategoryFilters();
      filterReferences();
    }

    function renderReferenceList(references) {
      const container = document.getElementById('referenceList');
      if (!container) return;

      if (references.length === 0) {
        container.innerHTML = `
          <div style="text-align: center; padding: 60px; grid-column: 1 / -1; background: white; border-radius: 16px;">
            <div style="font-size: 48px; margin-bottom: 16px;">ğŸ“­</div>
            <div style="font-size: 18px; font-weight: 600; color: var(--gray-900); margin-bottom: 8px;">ë“±ë¡ëœ ë ˆí¼ëŸ°ìŠ¤ê°€ ì—†ìŠµë‹ˆë‹¤</div>
            <p style="color: var(--gray-600); margin-bottom: 20px;">ìƒˆë¡œìš´ ë ˆí¼ëŸ°ìŠ¤ë¥¼ ì¶”ê°€í•´ë³´ì„¸ìš”!</p>
            <button onclick="openReferenceModal()" class="btn btn-primary">+ ì²« ë ˆí¼ëŸ°ìŠ¤ ì¶”ê°€</button>
          </div>`;
        return;
      }

      let html = '';
      references.forEach(ref => {
        const cat = getCategoryById(ref.category);
        const date = ref.createdAt ? ref.createdAt.substring(0, 10) : '';
        const images = ref.images || [];
        const hasImages = images.length > 0;
        const firstImage = hasImages ? images[0].data : null;
        const tags = (ref.tags || []).slice(0, 3);

        html += `
          <div onclick="openReferenceDetail('${ref.id}')"
               style="background: white; border-radius: 16px; overflow: hidden; cursor: pointer; transition: all 0.2s;
                      box-shadow: 0 2px 8px rgba(0,0,0,0.04); border: 1px solid #E5E8EB;"
               onmouseover="this.style.borderColor='#8B5CF6'; this.style.transform='translateY(-2px)'"
               onmouseout="this.style.borderColor='#E5E8EB'; this.style.transform='none'">
            ${firstImage ? `
              <div style="position: relative; width: 100%; height: 140px; background: #F2F4F6;">
                <img src="${firstImage}" style="width: 100%; height: 100%; object-fit: cover;">
                ${images.length > 1 ? `<span style="position: absolute; top: 8px; right: 8px; background: rgba(0,0,0,0.7); color: white; padding: 4px 8px; border-radius: 12px; font-size: 11px;">+${images.length - 1}</span>` : ''}
              </div>
            ` : ''}
            <div style="padding: 16px;">
              <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                <span style="font-size: 11px; padding: 4px 10px; background: ${cat.bg}; color: ${cat.color}; border-radius: 6px; font-weight: 600;">${cat.emoji} ${cat.label}</span>
                <span style="font-size: 11px; color: #8B95A1;">${date}</span>
              </div>
              <div style="font-size: 15px; font-weight: 700; color: #191F28; margin-bottom: 6px; line-height: 1.4;">${ref.title}</div>
              ${ref.description ? `<div style="font-size: 12px; color: #6B7684; margin-bottom: 10px; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden;">${ref.description}</div>` : ''}
              <div style="display: flex; gap: 6px; flex-wrap: wrap;">
                ${ref.linkUrl ? `<span style="font-size: 10px; padding: 3px 8px; background: #E8F3FF; color: #0064FF; border-radius: 4px;">ğŸ”— ë§í¬</span>` : ''}
                ${hasImages ? `<span style="font-size: 10px; padding: 3px 8px; background: #FEF3C7; color: #B45309; border-radius: 4px;">ğŸ–¼ï¸ ${images.length}ì¥</span>` : ''}
                ${ref.fileUrl && !hasImages ? `<span style="font-size: 10px; padding: 3px 8px; background: #DCFCE7; color: #16A34A; border-radius: 4px;">ğŸ“ íŒŒì¼</span>` : ''}
                ${tags.map(t => `<span style="font-size: 11px; padding: 4px 8px; background: #F2F4F6; color: #6B7684; border-radius: 4px;">#${t}</span>`).join('')}
              </div>
            </div>
          </div>
        `;
      });
      container.innerHTML = html;
    }

    // ë ˆí¼ëŸ°ìŠ¤ ëª¨ë‹¬ ì—´ê¸°
    function openReferenceModal(refId = null) {
      refUploadedImages = [];
      const modal = document.getElementById('referenceModal');
      const title = document.getElementById('referenceModalTitle');
      const deleteBtn = document.getElementById('deleteReferenceBtn');

      renderCategoryOptions();

      // í¼ ì´ˆê¸°í™”
      document.getElementById('referenceId').value = '';
      document.getElementById('referenceTitle').value = '';
      document.getElementById('referenceCategory').value = 'event';
      document.getElementById('referenceDesc').value = '';
      document.getElementById('referenceLink').value = '';
      document.getElementById('referenceFileUrl').value = '';
      document.getElementById('referenceTags').value = '';
      document.getElementById('refImagesPreview').style.display = 'none';
      document.getElementById('refImagesPreview').innerHTML = '';

      if (refId) {
        title.textContent = 'ë ˆí¼ëŸ°ìŠ¤ ìˆ˜ì •';
        deleteBtn.style.display = 'block';
        loadReferenceForEdit(refId);
      } else {
        title.textContent = 'ë ˆí¼ëŸ°ìŠ¤ ì¶”ê°€';
        deleteBtn.style.display = 'none';
      }

      modal.classList.add('show');
    }

    // ìˆ˜ì •ìš© ë°ì´í„° ë¡œë“œ
    async function loadReferenceForEdit(refId) {
      try {
        const doc = await db.collection('references').doc(refId).get();
        if (doc.exists) {
          const ref = doc.data();
          document.getElementById('referenceId').value = refId;
          document.getElementById('referenceTitle').value = ref.title || '';
          document.getElementById('referenceCategory').value = ref.category || 'etc';
          document.getElementById('referenceDesc').value = ref.description || '';
          document.getElementById('referenceLink').value = ref.linkUrl || '';
          document.getElementById('referenceFileUrl').value = ref.fileUrl || '';
          document.getElementById('referenceTags').value = (ref.tags || []).join(', ');

          if (ref.images && ref.images.length > 0) {
            refUploadedImages = ref.images;
            renderRefImagesPreview();
          }
        }
      } catch (e) {
        console.error('ë ˆí¼ëŸ°ìŠ¤ ë¡œë“œ ì˜¤ë¥˜:', e);
      }
    }

    function closeReferenceModal() {
      document.getElementById('referenceModal').classList.remove('show');
    }

    // ì´ë¯¸ì§€ ì—…ë¡œë“œ ì²˜ë¦¬
    async function handleRefImageUpload(files) {
      if (!files || files.length === 0) return;

      const maxImages = 10;
      const currentCount = refUploadedImages.length;
      if (currentCount >= maxImages) {
        showToast('ìµœëŒ€ ' + maxImages + 'ì¥ê¹Œì§€ ì—…ë¡œë“œ ê°€ëŠ¥í•©ë‹ˆë‹¤');
        return;
      }

      const filesToProcess = Array.from(files).slice(0, maxImages - currentCount);
      const btn = document.getElementById('btnSaveRef');
      if (btn) btn.disabled = true;

      for (const file of filesToProcess) {
        const result = await processRefImage(file);
        if (result) refUploadedImages.push(result);
      }

      renderRefImagesPreview();
      if (btn) btn.disabled = false;
      document.getElementById('refFileInput').value = '';
      showToast(`${filesToProcess.length}ì¥ ì¶”ê°€ë¨`);
    }

    async function processRefImage(file) {
      const allowedTypes = ['image/jpeg', 'image/png', 'image/gif'];
      const ext = file.name.split('.').pop().toLowerCase();
      if (!allowedTypes.includes(file.type) && !['jpg', 'jpeg', 'png', 'gif'].includes(ext)) return null;
      if (file.size > 10 * 1024 * 1024) return null;

      try {
        const base64 = await new Promise((resolve, reject) => {
          const reader = new FileReader();
          reader.onload = e => resolve(e.target.result);
          reader.onerror = reject;
          reader.readAsDataURL(file);
        });

        // ê°„ë‹¨í•œ ì••ì¶• (700KB ì´í•˜ë©´ ê·¸ëŒ€ë¡œ ì‚¬ìš©)
        if (base64.length <= 700000) {
          return { data: base64, name: file.name, type: file.type };
        }

        // ì••ì¶• í•„ìš”ì‹œ canvas ì‚¬ìš©
        const compressed = await compressImage(base64, 1200, 0.7);
        return { data: compressed, name: file.name, type: 'image/jpeg' };
      } catch (e) {
        console.error('ì´ë¯¸ì§€ ì²˜ë¦¬ ì˜¤ë¥˜:', e);
        return null;
      }
    }

    function compressImage(base64, maxSize, quality) {
      return new Promise((resolve) => {
        const img = new Image();
        img.onload = () => {
          const canvas = document.createElement('canvas');
          let { width, height } = img;
          if (width > maxSize || height > maxSize) {
            if (width > height) {
              height = Math.round(height * maxSize / width);
              width = maxSize;
            } else {
              width = Math.round(width * maxSize / height);
              height = maxSize;
            }
          }
          canvas.width = width;
          canvas.height = height;
          canvas.getContext('2d').drawImage(img, 0, 0, width, height);
          resolve(canvas.toDataURL('image/jpeg', quality));
        };
        img.src = base64;
      });
    }

    function renderRefImagesPreview() {
      const preview = document.getElementById('refImagesPreview');
      const count = document.getElementById('refImageCount');

      if (count) count.textContent = refUploadedImages.length > 0 ? `(${refUploadedImages.length}ì¥)` : '';

      if (!preview) return;
      if (refUploadedImages.length === 0) {
        preview.style.display = 'none';
        return;
      }

      let html = '<div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(70px, 1fr)); gap: 8px;">';
      refUploadedImages.forEach((img, i) => {
        html += `
          <div style="position: relative; aspect-ratio: 1; border-radius: 8px; overflow: hidden; border: 1px solid #F59E0B;">
            <img src="${img.data}" style="width: 100%; height: 100%; object-fit: cover;">
            <button onclick="removeRefImage(${i})" style="position: absolute; top: 2px; right: 2px; width: 20px; height: 20px; border-radius: 50%; background: rgba(220,38,38,0.9); color: white; border: none; cursor: pointer; font-size: 12px;">Ã—</button>
          </div>`;
      });
      html += '</div>';
      preview.innerHTML = html;
      preview.style.display = 'block';
    }

    function removeRefImage(index) {
      refUploadedImages.splice(index, 1);
      renderRefImagesPreview();
    }

    // ë ˆí¼ëŸ°ìŠ¤ ì €ì¥
    async function saveReference() {
      const id = document.getElementById('referenceId').value;
      const title = document.getElementById('referenceTitle').value.trim();
      const linkUrl = document.getElementById('referenceLink').value.trim();
      const fileUrl = document.getElementById('referenceFileUrl').value.trim();

      if (!title) { showToast('ì œëª©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”'); return; }
      if (!linkUrl && refUploadedImages.length === 0 && !fileUrl) {
        showToast('ë§í¬ ë˜ëŠ” ì´ë¯¸ì§€ë¥¼ ë“±ë¡í•´ì£¼ì„¸ìš”');
        return;
      }

      const tagsStr = document.getElementById('referenceTags').value.trim();
      const tags = tagsStr ? tagsStr.split(',').map(t => t.trim()).filter(Boolean) : [];

      const data = {
        title,
        category: document.getElementById('referenceCategory').value,
        description: document.getElementById('referenceDesc').value.trim(),
        linkUrl: linkUrl || null,
        fileUrl: refUploadedImages.length > 0 ? null : (fileUrl || null),
        images: refUploadedImages,
        tags,
        updatedAt: new Date().toISOString()
      };

      try {
        if (id) {
          await db.collection('references').doc(id).update(data);
        } else {
          data.createdAt = new Date().toISOString();
          data.createdBy = 'admin';
          data.createdByName = 'ê´€ë¦¬ì';
          await db.collection('references').add(data);
        }
        showToast('ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤');
        closeReferenceModal();
        renderReferences();
      } catch (e) {
        console.error(e);
        showToast('ì €ì¥ ì‹¤íŒ¨');
      }
    }

    // ë ˆí¼ëŸ°ìŠ¤ ì‚­ì œ
    async function deleteReference() {
      const id = document.getElementById('referenceId').value;
      if (!id || !confirm('ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;

      try {
        await db.collection('references').doc(id).delete();
        showToast('ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤');
        closeReferenceModal();
        renderReferences();
      } catch (e) {
        showToast('ì‚­ì œ ì‹¤íŒ¨');
      }
    }

    // ë ˆí¼ëŸ°ìŠ¤ ìƒì„¸ ë³´ê¸°
    async function openReferenceDetail(refId) {
      const ref = state.references.find(r => r.id === refId);
      if (!ref) return;

      const cat = getCategoryById(ref.category);
      const images = ref.images || [];
      const tags = ref.tags || [];

      let html = `
        <div style="display: flex; justify-content: space-between; align-items: flex-start; padding: 20px 24px; border-bottom: 1px solid var(--gray-200);">
          <span style="font-size: 13px; padding: 6px 14px; background: ${cat.bg}; color: ${cat.color}; border-radius: 8px; font-weight: 600;">${cat.emoji} ${cat.label}</span>
          <button onclick="closeReferenceDetail()" style="background: none; border: none; font-size: 24px; cursor: pointer; color: var(--gray-500);">Ã—</button>
        </div>
        <div style="padding: 24px;">
          <h2 style="font-size: 22px; font-weight: 700; color: var(--gray-900); margin-bottom: 16px;">${ref.title}</h2>
          ${images.length > 0 ? `
            <div style="margin-bottom: 20px;">
              <div style="width: 100%; max-height: 350px; border-radius: 12px; overflow: hidden; background: #F2F4F6; margin-bottom: 10px;">
                <img id="detailMainImg" src="${images[0].data}" style="width: 100%; height: 100%; object-fit: contain; max-height: 350px;">
              </div>
              ${images.length > 1 ? `
                <div style="display: flex; gap: 8px; overflow-x: auto;">
                  ${images.map((img, i) => `<img src="${img.data}" onclick="document.getElementById('detailMainImg').src='${img.data}'" style="width: 60px; height: 60px; object-fit: cover; border-radius: 8px; cursor: pointer; border: 2px solid ${i === 0 ? '#8B5CF6' : '#E5E8EB'};">`).join('')}
                </div>
              ` : ''}
            </div>
          ` : ''}
          ${ref.description ? `<div style="font-size: 15px; color: var(--gray-700); line-height: 1.7; margin-bottom: 20px; padding: 16px; background: var(--gray-100); border-radius: 10px;">${ref.description}</div>` : ''}
          ${ref.linkUrl ? `
            <a href="${ref.linkUrl}" target="_blank" style="display: flex; align-items: center; gap: 12px; padding: 16px; background: #E8F3FF; border-radius: 12px; margin-bottom: 12px; text-decoration: none;">
              <span style="font-size: 24px;">ğŸ”—</span>
              <div style="flex: 1;"><div style="font-size: 14px; font-weight: 600; color: #0064FF;">ì™¸ë¶€ ë§í¬ ì—´ê¸°</div></div>
              <span style="color: #0064FF;">â†’</span>
            </a>
          ` : ''}
          ${ref.fileUrl && images.length === 0 ? `
            <a href="${ref.fileUrl}" target="_blank" style="display: flex; align-items: center; gap: 12px; padding: 16px; background: #DCFCE7; border-radius: 12px; margin-bottom: 12px; text-decoration: none;">
              <span style="font-size: 24px;">ğŸ“</span>
              <div style="flex: 1;"><div style="font-size: 14px; font-weight: 600; color: #16A34A;">íŒŒì¼ ì—´ê¸°</div></div>
              <span style="color: #16A34A;">â†’</span>
            </a>
          ` : ''}
          ${tags.length > 0 ? `<div style="display: flex; flex-wrap: wrap; gap: 8px; margin-bottom: 20px;">${tags.map(t => `<span style="font-size: 12px; padding: 6px 12px; background: var(--gray-100); color: var(--gray-600); border-radius: 6px;">#${t}</span>`).join('')}</div>` : ''}
          <div style="padding: 16px; background: var(--gray-50); border-radius: 10px; font-size: 13px; color: var(--gray-500);">
            ğŸ“… ${ref.createdAt ? ref.createdAt.substring(0, 10) : ''}
          </div>
          <div style="display: flex; gap: 12px; margin-top: 20px;">
            <button onclick="closeReferenceDetail(); openReferenceModal('${ref.id}')" class="btn btn-primary" style="flex: 1;">âœï¸ ìˆ˜ì •</button>
            <button onclick="if(confirm('ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) { db.collection('references').doc('${ref.id}').delete(); closeReferenceDetail(); showToast('ì‚­ì œë¨'); renderReferences(); }" class="btn btn-secondary" style="flex: 1; color: var(--danger);">ğŸ—‘ï¸ ì‚­ì œ</button>
          </div>
        </div>
      `;

      document.getElementById('referenceDetailContent').innerHTML = html;
      document.getElementById('referenceDetailModal').classList.add('show');
    }

    function closeReferenceDetail() {
      document.getElementById('referenceDetailModal').classList.remove('show');
    }

    // ========================================
    // ì¹´í…Œê³ ë¦¬ ê´€ë¦¬ ì‹œìŠ¤í…œ
    // ========================================

    function openCategoryModal() {
      renderCategoryList();
      document.getElementById('categoryModal').classList.add('show');
    }

    function closeCategoryModal() {
      document.getElementById('categoryModal').classList.remove('show');
    }

    function renderCategoryList() {
      const list = document.getElementById('categoryList');
      const cats = getCategories();

      list.innerHTML = cats.map((c, i) => `
        <div style="display: flex; align-items: center; gap: 8px; padding: 12px; background: ${c.bg}; border-radius: 8px;">
          <span style="font-size: 20px;">${c.emoji}</span>
          <span style="flex: 1; font-weight: 500; color: ${c.color};">${c.label}</span>
          <button onclick="editCategory('${c.id}')" style="background: white; border: none; padding: 6px 10px; border-radius: 6px; cursor: pointer; font-size: 12px;">ìˆ˜ì •</button>
          <button onclick="deleteCategory('${c.id}')" style="background: #FEE2E2; color: #DC2626; border: none; padding: 6px 10px; border-radius: 6px; cursor: pointer; font-size: 12px;">ì‚­ì œ</button>
        </div>
      `).join('');
    }

    async function addCategory() {
      const emoji = document.getElementById('newCatEmoji').value.trim() || 'ğŸ“';
      const name = document.getElementById('newCatName').value.trim();
      const color = document.getElementById('newCatColor').value;

      if (!name) { showToast('ì¹´í…Œê³ ë¦¬ëª…ì„ ì…ë ¥í•´ì£¼ì„¸ìš”'); return; }

      const id = name.toLowerCase().replace(/\s+/g, '_');
      const bg = color + '20'; // ì—°í•œ ë°°ê²½ìƒ‰

      try {
        await db.collection('refCategories').doc(id).set({
          id, label: name, emoji, color, bg,
          order: state.refCategories.length,
          createdAt: new Date().toISOString()
        });
        showToast('ì¹´í…Œê³ ë¦¬ ì¶”ê°€ë¨');
        document.getElementById('newCatEmoji').value = '';
        document.getElementById('newCatName').value = '';
      } catch (e) {
        showToast('ì¶”ê°€ ì‹¤íŒ¨');
      }
    }

    async function editCategory(catId) {
      const cat = getCategoryById(catId);
      const newEmoji = prompt('ì´ëª¨ì§€:', cat.emoji);
      const newLabel = prompt('ì´ë¦„:', cat.label);
      const newColor = prompt('ìƒ‰ìƒ (hex):', cat.color);

      if (!newLabel) return;

      try {
        await db.collection('refCategories').doc(catId).update({
          emoji: newEmoji || cat.emoji,
          label: newLabel,
          color: newColor || cat.color,
          bg: (newColor || cat.color) + '20'
        });
        showToast('ìˆ˜ì •ë¨');
      } catch (e) {
        showToast('ìˆ˜ì • ì‹¤íŒ¨');
      }
    }

    async function deleteCategory(catId) {
      if (!confirm('ì´ ì¹´í…Œê³ ë¦¬ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;

      try {
        await db.collection('refCategories').doc(catId).delete();
        showToast('ì‚­ì œë¨');
      } catch (e) {
        showToast('ì‚­ì œ ì‹¤íŒ¨');
      }
    }

    // ìˆ«ì í¬ë§·
    function formatNumber(num) {
      if (num === null || num === undefined) return '0';
      return Number(num).toLocaleString('ko-KR');
    }

    // í† ìŠ¤íŠ¸ ë©”ì‹œì§€
    function showToast(msg) {
      const toast = document.getElementById('toast');
      toast.textContent = msg;
      toast.style.display = 'block';
      setTimeout(() => toast.style.display = 'none', 2500);
    }

    // ========================================
    // ì˜ì—…í˜„í™© ì‹œìŠ¤í…œ
    // ========================================
    function getStrategyTarget() {
      const saved = state.strategyData || {};
      return {
        annualRevenue: saved.annualRevenue || 500000000,
        successRate: saved.successRate || 30,
        avgDealRevenue: saved.avgDealRevenue || 4630000,
        targetSuccessDeals: saved.targetSuccessDeals || 108,
        monthlySuccessDeals: saved.monthlySuccessDeals || 9,
        monthlyProfit: saved.monthlyProfit || 4000000,
        annualProfit: saved.annualProfit || 48000000,
        commission30Ratio: saved.commission30Ratio || 70,
        monthlyNewSuppliers: saved.monthlyNewSuppliers || 3,
        monthlyNewSellers: saved.monthlyNewSellers || 15,
        get requiredTotalDeals() { return Math.ceil(this.targetSuccessDeals / (this.successRate / 100)); },
        get monthlyRequiredDeals() { return Math.ceil(this.requiredTotalDeals / 12); },
        get weeklyRequiredDeals() { return Math.ceil(this.requiredTotalDeals / 52); }
      };
    }

    function renderSalesDashboard() {
      const container = document.getElementById('salesDashboardContent');
      if (!container) return;

      container.innerHTML = `
        <div style="text-align: center; padding: 60px;">
          <div class="loading-spinner"></div>
          <p style="color: var(--gray-500); margin-top: 16px;">ì˜ì—…í˜„í™© ë¡œë”©ì¤‘...</p>
        </div>
      `;

      loadSalesDashboardData();
    }

    async function loadSalesDashboardData() {
      try {
        // í•„ìš”í•œ ë°ì´í„° ë¡œë“œ
        if (!state.deals) state.deals = [];
        if (!state.sellerSettlements) state.sellerSettlements = [];
        if (!state.supplierSettlements) state.supplierSettlements = [];
        if (!state.sellers) state.sellers = [];
        if (!state.suppliers) state.suppliers = [];
        if (!state.teamMembers) state.teamMembers = [];

        renderSalesDashboardContent();
      } catch (error) {
        console.error('ì˜ì—…í˜„í™© ë¡œë“œ ì˜¤ë¥˜:', error);
        document.getElementById('salesDashboardContent').innerHTML = '<div style="text-align: center; padding: 60px; color: var(--danger);">ë°ì´í„° ë¡œë“œ ì˜¤ë¥˜</div>';
      }
    }

    function renderSalesDashboardContent() {
      const container = document.getElementById('salesDashboardContent');
      if (!container) return;

      const members = state.teamMembers || [];
      const currentUser = state.currentUser || {};
      const isAdmin = currentUser.role === 'admin';

      const now = new Date();
      const currentYear = now.getFullYear();
      const thisMonth = now.toISOString().slice(0, 7);
      const thisYearStr = String(currentYear);

      const allSettlements = state.sellerSettlements || [];
      const allDeals = state.deals || [];

      const yearDeals = allDeals.filter(d => (d.startDate || d.createdAt || '').startsWith(thisYearStr));
      const yearSettlements = allSettlements.filter(s => (s.settlementDate || s.createdAt || '').startsWith(thisYearStr));
      const monthDeals = allDeals.filter(d => (d.endDate || '').startsWith(thisMonth));
      const monthSettlements = allSettlements.filter(s => (s.settlementDate || s.createdAt || '').startsWith(thisMonth));

      const successfulDeals = yearDeals.filter(d => d.isSuccess === true || d.ë‹¬ì„±ì—¬ë¶€ === 'ì„±ê³µ');
      const monthSuccessfulDeals = monthDeals.filter(d => d.isSuccess === true || d.ë‹¬ì„±ì—¬ë¶€ === 'ì„±ê³µ');

      const deals30Percent = yearDeals.filter(d => Number(d.commissionRate || d.supplierCommission || 0) >= 30);
      const commission30Ratio = yearDeals.length > 0 ? Math.round((deals30Percent.length / yearDeals.length) * 100) : 0;

      const totalSalesAmount = yearSettlements.reduce((sum, s) => sum + (Number(s.salesAmount) || 0), 0);
      const monthSalesAmount = monthSettlements.reduce((sum, s) => sum + (Number(s.salesAmount) || 0), 0);

      // ìˆœìµ ê³„ì‚°
      const yearInhouseSettlements = yearSettlements.filter(s => s.productType !== 'external');
      const inhouseSalesAmt = yearInhouseSettlements.reduce((sum, s) => sum + (Number(s.salesAmount) || 0), 0);
      const inhouseSellerPayout = yearInhouseSettlements.reduce((sum, s) => sum + (Number(s.actualPayment) || 0), 0);
      const inhousePgFeeAmt = Math.round(inhouseSalesAmt * 0.04);
      const inhouseProfitAmt = inhouseSalesAmt - inhouseSellerPayout - inhousePgFeeAmt;

      const yearExternalSettlements = yearSettlements.filter(s => s.productType === 'external');
      const externalSalesAmt = yearExternalSettlements.reduce((sum, s) => sum + (Number(s.salesAmount) || 0), 0);
      const externalSellerPayout = yearExternalSettlements.reduce((sum, s) => sum + (Number(s.actualPayment) || 0), 0);
      const externalPgFeeAmt = Math.round(externalSalesAmt * 0.04);

      const yearSupplierSettlements = (state.supplierSettlements || []).filter(s => (s.settlementDate || s.createdAt || '').startsWith(thisYearStr));
      const supplierPayoutAmt = yearSupplierSettlements.reduce((sum, s) => sum + (Number(s.totalSupplyAmount) || Number(s.supplyAmount) || 0) + (Number(s.totalVatAmount) || Number(s.vatAmount) || 0), 0);
      const externalProfitAmt = externalSalesAmt - externalSellerPayout - supplierPayoutAmt - externalPgFeeAmt;

      const totalProfitAmount = inhouseProfitAmt + externalProfitAmt;

      const completedDeals = yearDeals.filter(d => d.status === 'completed' || d.isSuccess !== undefined || d.ë‹¬ì„±ì—¬ë¶€);
      const currentSuccessRate = completedDeals.length > 0 ? Math.round((successfulDeals.length / completedDeals.length) * 100) : 0;

      const T = getStrategyTarget();
      const revenueProgress = Math.min(100, Math.round((totalSalesAmount / T.annualRevenue) * 100));
      const profitProgress = Math.min(100, Math.round((totalProfitAmount / T.annualProfit) * 100));
      const successDealsProgress = Math.min(100, Math.round((successfulDeals.length / T.targetSuccessDeals) * 100));
      const totalDealsProgress = Math.min(100, Math.round((yearDeals.length / T.requiredTotalDeals) * 100));

      const yearEnd = new Date(currentYear, 11, 31);
      const remainingDays = Math.ceil((yearEnd - now) / (1000 * 60 * 60 * 24));
      const remainingWeeks = Math.ceil(remainingDays / 7);
      const remainingMonths = 12 - now.getMonth();

      const remainingTotalDeals = Math.max(T.requiredTotalDeals - yearDeals.length, 0);
      const weeklyNeededDeals = Math.ceil(remainingTotalDeals / Math.max(remainingWeeks, 1));
      const monthlyNeededDeals = Math.ceil(remainingTotalDeals / Math.max(remainingMonths, 1));

      // ì´ë²ˆ ì£¼ ë°ì´í„°
      const weekStart = new Date(now);
      weekStart.setDate(now.getDate() - now.getDay());
      weekStart.setHours(0, 0, 0, 0);
      const thisWeekDeals = allDeals.filter(d => {
        if (!d.endDate) return false;
        const endDate = new Date(d.endDate);
        return endDate >= weekStart && endDate <= now;
      });

      const weeklyTargetDeals = T.weeklyRequiredDeals;
      const monthlyTargetDeals = T.monthlyRequiredDeals;
      const weeklyProgress = Math.min(100, Math.round((thisWeekDeals.length / weeklyTargetDeals) * 100));
      const monthlyProgress = Math.min(100, Math.round((monthDeals.length / monthlyTargetDeals) * 100));

      // íŒ€ì›ë³„ ì‹¤ì 
      const memberStats = members.filter(m => m.role !== 'ceo').map(member => {
        const mSuppliers = (state.suppliers || []).filter(s => s.registeredBy === member.id);
        const mSellers = (state.sellers || []).filter(s => s.registeredBy === member.id);
        const mDeals = allDeals.filter(d => d.registeredBy === member.id);
        const mYearDeals = mDeals.filter(d => (d.startDate || d.createdAt || '').startsWith(thisYearStr));
        const mMonthDeals = mDeals.filter(d => (d.endDate || '').startsWith(thisMonth));
        const mSuccessDeals = mYearDeals.filter(d => d.isSuccess === true || d.ë‹¬ì„±ì—¬ë¶€ === 'ì„±ê³µ');

        const sellerNames = mSellers.map(s => s.name).filter(Boolean);
        const mSettlements = allSettlements.filter(s => {
          if (s.registeredBy === member.id) return true;
          const sName = s.sellerName || '';
          return sellerNames.some(name => name && (sName.includes(name.split('/')[0]) || sName.includes(name)));
        });

        const mYearSettlements = mSettlements.filter(s => (s.settlementDate || s.createdAt || '').startsWith(thisYearStr));
        const totalSales = mYearSettlements.reduce((sum, s) => sum + (Number(s.salesAmount) || 0), 0);
        const totalProfit = mYearSettlements.reduce((sum, s) => sum + (Number(s.marginAmount) || 0), 0);

        const mCompletedDeals = mYearDeals.filter(d => d.status === 'completed' || d.isSuccess !== undefined || d.ë‹¬ì„±ì—¬ë¶€);
        const mSuccessRate = mCompletedDeals.length > 0 ? Math.round((mSuccessDeals.length / mCompletedDeals.length) * 100) : 0;

        return {
          ...member,
          suppliers: mSuppliers.length,
          sellers: mSellers.length,
          yearDeals: mYearDeals.length,
          monthDeals: mMonthDeals.length,
          successDeals: mSuccessDeals.length,
          successRate: mSuccessRate,
          sales: totalSales,
          profit: totalProfit
        };
      });

      // TOP ë­í‚¹
      const supplierSalesMap = {};
      allSettlements.forEach(s => {
        const brand = s.brandName || s.supplierName || 'ë¯¸ì§€ì •';
        if (!supplierSalesMap[brand]) supplierSalesMap[brand] = { name: brand, sales: 0, count: 0 };
        supplierSalesMap[brand].sales += Number(s.salesAmount) || 0;
        supplierSalesMap[brand].count += 1;
      });
      const topSuppliers = Object.values(supplierSalesMap).filter(s => s.sales > 0).sort((a, b) => b.sales - a.sales).slice(0, 5);

      const sellerSalesMap = {};
      allSettlements.forEach(s => {
        const seller = s.sellerName || 'ë¯¸ì§€ì •';
        if (!sellerSalesMap[seller]) sellerSalesMap[seller] = { name: seller, sales: 0, margin: 0, count: 0 };
        sellerSalesMap[seller].sales += Number(s.salesAmount) || 0;
        sellerSalesMap[seller].margin += Number(s.marginAmount) || 0;
        sellerSalesMap[seller].count += 1;
      });
      const topSellers = Object.values(sellerSalesMap).filter(s => s.sales > 0).sort((a, b) => b.sales - a.sales).slice(0, 5);

      const C = {
        primary: '#3182f6',
        orange: '#fc9600',
        blue: '#0064FF',
        blueLight: '#E8F3FF',
        green: '#00C471',
        greenLight: '#E8F8F0',
        red: '#F04452',
        redLight: '#FEE2E4',
        yellow: '#F59E0B',
        yellowLight: '#FEF3C7',
        black: '#191F28',
        gray900: '#191F28',
        gray700: '#333D4B',
        gray600: '#4E5968',
        gray500: '#6B7684',
        gray400: '#8B95A1',
        gray300: '#B0B8C1',
        gray200: '#D1D6DB',
        gray100: '#E5E8EB',
        gray50: '#F2F4F6',
        white: '#FFFFFF'
      };

      const getProgressColor = (progress) => progress >= 80 ? C.green : progress >= 50 ? C.yellow : C.red;
      const getProgressBg = (progress) => progress >= 80 ? C.greenLight : progress >= 50 ? C.yellowLight : C.redLight;

      container.innerHTML = `
        <div style="max-width: 1400px; margin: 0 auto;">
          <!-- í—¤ë” -->
          <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
            <div>
              <h1 style="font-size: 24px; font-weight: 700; color: ${C.black}; margin: 0;">ì˜ì—…í˜„í™©</h1>
              <p style="color: ${C.gray500}; margin-top: 4px; font-size: 13px;">
                ì—° ${(T.annualRevenue / 100000000)}ì–µ = ê³µêµ¬ ${T.requiredTotalDeals}ê±´ (ì›”${T.monthlyRequiredDeals}/ì£¼${T.weeklyRequiredDeals}) â†’ ì„±ê³µ ${T.targetSuccessDeals}ê±´
              </p>
            </div>
            <div style="display: flex; gap: 8px;">
              ${isAdmin ? `<button onclick="openGoalCalculator()" style="padding: 8px 14px; font-size: 12px; font-weight: 600; background: ${C.white}; color: ${C.primary}; border: 1px solid ${C.gray200}; border-radius: 8px; cursor: pointer;">ğŸ§® ê³„ì‚°ê¸°</button>` : ''}
            </div>
          </div>

          <!-- í•µì‹¬ í˜„í™© ë°°ë„ˆ -->
          <div style="background: linear-gradient(135deg, ${C.primary}, #1b64da); border-radius: 14px; padding: 16px 20px; margin-bottom: 16px; color: white;">
            <div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 12px;">
              <div style="display: flex; gap: 20px; flex-wrap: wrap;">
                <div><div style="font-size: 11px; opacity: 0.85;">ê³µêµ¬</div><div style="font-size: 20px; font-weight: 700;">${yearDeals.length}<span style="font-size: 13px; opacity: 0.8;">/${T.requiredTotalDeals}</span></div></div>
                <div><div style="font-size: 11px; opacity: 0.85;">ì„±ê³µ</div><div style="font-size: 20px; font-weight: 700;">${successfulDeals.length}<span style="font-size: 13px; opacity: 0.8;">/${T.targetSuccessDeals}</span></div></div>
                <div><div style="font-size: 11px; opacity: 0.85;">ë§¤ì¶œ</div><div style="font-size: 20px; font-weight: 700;">${(totalSalesAmount / 100000000).toFixed(1)}<span style="font-size: 13px; opacity: 0.8;">/${(T.annualRevenue / 100000000)}ì–µ</span></div></div>
                <div><div style="font-size: 11px; opacity: 0.85;">ì„±ê³µë¥ </div><div style="font-size: 20px; font-weight: 700;">${currentSuccessRate}%</div></div>
              </div>
              <div style="text-align: right;">
                <div style="font-size: 11px; opacity: 0.8;">ë‚¨ì€ ê¸°ê°„</div>
                <div style="font-size: 18px; font-weight: 700;">${remainingMonths}ê°œì›” ${remainingDays % 30}ì¼</div>
              </div>
            </div>
          </div>

          <!-- KPI ì¹´ë“œ -->
          <div style="display: grid; grid-template-columns: repeat(6, 1fr); gap: 12px; margin-bottom: 16px;">
            <div style="background: ${C.white}; border-radius: 12px; padding: 14px; box-shadow: 0 1px 4px rgba(0,0,0,0.04);">
              <div style="font-size: 11px; color: ${C.gray500}; margin-bottom: 6px;">ì—° ë§¤ì¶œ</div>
              <div style="font-size: 20px; font-weight: 700; color: ${C.black};">${(totalSalesAmount / 100000000).toFixed(2)}ì–µ</div>
              <div style="background: ${C.gray100}; height: 4px; border-radius: 2px; margin-top: 8px;"><div style="background: ${getProgressColor(revenueProgress)}; height: 100%; width: ${revenueProgress}%; border-radius: 2px;"></div></div>
            </div>
            <div style="background: ${C.white}; border-radius: 12px; padding: 14px; box-shadow: 0 1px 4px rgba(0,0,0,0.04);">
              <div style="font-size: 11px; color: ${C.gray500}; margin-bottom: 6px;">ì—° ìˆœìµ</div>
              <div style="font-size: 20px; font-weight: 700; color: ${totalProfitAmount >= 0 ? C.green : C.red};">${formatNumber(totalProfitAmount)}ì›</div>
              <div style="display: flex; justify-content: space-between; font-size: 9px; color: ${C.gray400}; margin-top: 4px;">
                <span>ìì‚¬ ${formatNumber(inhouseProfitAmt)}ì›</span>
                <span>íƒ€ì‚¬ ${formatNumber(externalProfitAmt)}ì›</span>
              </div>
            </div>
            <div style="background: ${weeklyProgress >= 100 ? C.greenLight : C.blueLight}; border-radius: 12px; padding: 14px;">
              <div style="font-size: 11px; color: ${C.gray600}; margin-bottom: 6px;">ğŸ“… ì´ë²ˆ ì£¼</div>
              <div style="font-size: 20px; font-weight: 700; color: ${weeklyProgress >= 100 ? C.green : C.blue};">${thisWeekDeals.length}<span style="font-size: 12px; color: ${C.gray500};">/${weeklyTargetDeals}</span></div>
              <div style="font-size: 10px; color: ${C.gray600}; margin-top: 4px;">${weeklyProgress >= 100 ? 'âœ… ë‹¬ì„±' : `${Math.max(weeklyTargetDeals - thisWeekDeals.length, 0)}ê±´ í•„ìš”`}</div>
            </div>
            <div style="background: ${monthlyProgress >= 100 ? C.greenLight : C.gray50}; border-radius: 12px; padding: 14px;">
              <div style="font-size: 11px; color: ${C.gray600}; margin-bottom: 6px;">ğŸ“† ì´ë²ˆ ë‹¬</div>
              <div style="font-size: 20px; font-weight: 700; color: ${monthlyProgress >= 100 ? C.green : C.black};">${monthDeals.length}<span style="font-size: 12px; color: ${C.gray500};">/${monthlyTargetDeals}</span></div>
              <div style="font-size: 10px; color: ${C.gray600}; margin-top: 4px;">${monthlyProgress >= 100 ? 'âœ… ë‹¬ì„±' : `${Math.max(monthlyTargetDeals - monthDeals.length, 0)}ê±´ í•„ìš”`}</div>
            </div>
            <div style="background: ${C.white}; border-radius: 12px; padding: 14px; box-shadow: 0 1px 4px rgba(0,0,0,0.04);">
              <div style="font-size: 11px; color: ${C.gray500}; margin-bottom: 6px;">ë‚¨ì€ ê³µêµ¬</div>
              <div style="font-size: 20px; font-weight: 700; color: ${C.black};">${remainingTotalDeals}ê±´</div>
              <div style="font-size: 10px; color: ${C.gray500}; margin-top: 4px;">ì£¼ ${weeklyNeededDeals} / ì›” ${monthlyNeededDeals}</div>
            </div>
            <div style="background: ${commission30Ratio >= T.commission30Ratio ? C.greenLight : C.white}; border-radius: 12px; padding: 14px; box-shadow: 0 1px 4px rgba(0,0,0,0.04);">
              <div style="font-size: 11px; color: ${C.gray500}; margin-bottom: 6px;">30% ìˆ˜ìˆ˜ë£Œ</div>
              <div style="font-size: 20px; font-weight: 700; color: ${commission30Ratio >= T.commission30Ratio ? C.green : C.yellow};">${commission30Ratio}%</div>
              <div style="font-size: 10px; color: ${C.gray500}; margin-top: 4px;">ëª©í‘œ ${T.commission30Ratio}%</div>
            </div>
          </div>

          <!-- íŒ€ì›ë³„ ì˜ì—… ì„±ê³¼ -->
          <div style="background: ${C.white}; border-radius: 16px; padding: 24px; box-shadow: 0 2px 8px rgba(0,0,0,0.04); margin-bottom: 20px;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
              <div style="font-size: 16px; font-weight: 700; color: ${C.black};">ğŸ‘¥ íŒ€ì›ë³„ ì˜ì—… ì„±ê³¼ (${currentYear}ë…„)</div>
              <div style="font-size: 12px; color: ${C.gray400};">ì „ì²´ ê³µê¸‰ì‚¬ ${state.suppliers?.length || 0}ê°œ Â· ì…€ëŸ¬ ${state.sellers?.length || 0}ëª…</div>
            </div>

            ${memberStats.length === 0 ? `
              <div style="text-align: center; padding: 40px; color: ${C.gray500};">ë“±ë¡ëœ íŒ€ì›ì´ ì—†ìŠµë‹ˆë‹¤.</div>
            ` : `
              <div style="overflow-x: auto;">
                <table style="width: 100%; border-collapse: collapse; font-size: 13px;">
                  <thead>
                    <tr style="background: ${C.gray50}; border-bottom: 2px solid ${C.gray200};">
                      <th style="padding: 14px 12px; text-align: left; font-weight: 600; color: ${C.gray700};">íŒ€ì›</th>
                      <th style="padding: 14px 12px; text-align: center; font-weight: 600; color: ${C.gray700};">ê³µê¸‰ì‚¬</th>
                      <th style="padding: 14px 12px; text-align: center; font-weight: 600; color: ${C.gray700};">ì…€ëŸ¬</th>
                      <th style="padding: 14px 12px; text-align: center; font-weight: 600; color: ${C.gray700};">ì—° ê³µêµ¬</th>
                      <th style="padding: 14px 12px; text-align: center; font-weight: 600; color: ${C.gray700};">ì´ë²ˆë‹¬</th>
                      <th style="padding: 14px 12px; text-align: center; font-weight: 600; color: ${C.gray700};">ì„±ê³µ</th>
                      <th style="padding: 14px 12px; text-align: center; font-weight: 600; color: ${C.gray700};">ì„±ê³µë¥ </th>
                      <th style="padding: 14px 12px; text-align: right; font-weight: 600; color: ${C.gray700};">ë§¤ì¶œ</th>
                      <th style="padding: 14px 12px; text-align: right; font-weight: 600; color: ${C.gray700};">ìˆœìµ</th>
                    </tr>
                  </thead>
                  <tbody>
                    ${memberStats.map(m => {
                      const rateColor = m.successRate >= 30 ? C.green : m.successRate >= 20 ? C.yellow : C.red;
                      const rateBg = m.successRate >= 30 ? C.greenLight : m.successRate >= 20 ? C.yellowLight : C.redLight;
                      return `
                        <tr style="border-bottom: 1px solid ${C.gray100};">
                          <td style="padding: 14px 12px;">
                            <div style="display: flex; align-items: center; gap: 10px;">
                              <div style="width: 32px; height: 32px; border-radius: 50%; background: linear-gradient(135deg, ${C.primary}, #3B82F6); display: flex; align-items: center; justify-content: center; color: white; font-weight: 600; font-size: 13px;">
                                ${(m.name || m.id || '?').charAt(0)}
                              </div>
                              <div>
                                <div style="font-weight: 600; color: ${C.black};">${m.name || m.id}</div>
                                <div style="font-size: 11px; color: ${C.gray400};">${m.role === 'admin' ? 'ê´€ë¦¬ì' : m.role === 'manager' ? 'ë§¤ë‹ˆì €' : 'íŒ€ì›'}</div>
                              </div>
                            </div>
                          </td>
                          <td style="padding: 14px 12px; text-align: center; font-weight: 500;">${m.suppliers}</td>
                          <td style="padding: 14px 12px; text-align: center; font-weight: 500;">${m.sellers}</td>
                          <td style="padding: 14px 12px; text-align: center; font-weight: 600; color: ${C.black};">${m.yearDeals}</td>
                          <td style="padding: 14px 12px; text-align: center; color: ${C.blue}; font-weight: 600;">${m.monthDeals}</td>
                          <td style="padding: 14px 12px; text-align: center; color: ${C.green}; font-weight: 600;">${m.successDeals}</td>
                          <td style="padding: 14px 12px; text-align: center;">
                            <span style="background: ${rateBg}; color: ${rateColor}; padding: 4px 10px; border-radius: 12px; font-weight: 700; font-size: 12px;">${m.successRate}%</span>
                          </td>
                          <td style="padding: 14px 12px; text-align: right; font-weight: 500; color: ${C.gray700};">${formatNumber(m.sales)}ì›</td>
                          <td style="padding: 14px 12px; text-align: right; font-weight: 600; color: ${C.green};">${formatNumber(m.profit)}ì›</td>
                        </tr>
                      `;
                    }).join('')}
                  </tbody>
                  <tfoot>
                    <tr style="background: ${C.gray50}; border-top: 2px solid ${C.gray200};">
                      <td style="padding: 14px 12px; font-weight: 700; color: ${C.black};">í•©ê³„</td>
                      <td style="padding: 14px 12px; text-align: center; font-weight: 700;">${state.suppliers?.length || 0}</td>
                      <td style="padding: 14px 12px; text-align: center; font-weight: 700;">${state.sellers?.length || 0}</td>
                      <td style="padding: 14px 12px; text-align: center; font-weight: 700;">${yearDeals.length}</td>
                      <td style="padding: 14px 12px; text-align: center; font-weight: 700; color: ${C.blue};">${monthDeals.length}</td>
                      <td style="padding: 14px 12px; text-align: center; font-weight: 700; color: ${C.green};">${successfulDeals.length}</td>
                      <td style="padding: 14px 12px; text-align: center;">
                        <span style="background: ${currentSuccessRate >= 30 ? C.greenLight : currentSuccessRate >= 20 ? C.yellowLight : C.redLight}; color: ${currentSuccessRate >= 30 ? C.green : currentSuccessRate >= 20 ? C.yellow : C.red}; padding: 4px 10px; border-radius: 12px; font-weight: 700; font-size: 12px;">${currentSuccessRate}%</span>
                      </td>
                      <td style="padding: 14px 12px; text-align: right; font-weight: 700; color: ${C.gray900};">${formatNumber(totalSalesAmount)}ì›</td>
                      <td style="padding: 14px 12px; text-align: right; font-weight: 700; color: ${C.green};">${formatNumber(totalProfitAmount)}ì›</td>
                    </tr>
                  </tfoot>
                </table>
              </div>
            `}
          </div>

          <!-- TOP ì„±ê³¼ ë­í‚¹ -->
          <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 16px;">
            <!-- ê³µê¸‰ì‚¬ TOP -->
            <div style="background: ${C.white}; border-radius: 16px; padding: 24px; box-shadow: 0 2px 8px rgba(0,0,0,0.04);">
              <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
                <div style="font-size: 15px; font-weight: 700; color: ${C.black};">ğŸ­ ê³µê¸‰ì‚¬ íŒë§¤ TOP</div>
              </div>
              ${topSuppliers.length === 0 ? `
                <div style="text-align: center; padding: 24px; color: ${C.gray400}; font-size: 13px;">ë°ì´í„° ì—†ìŒ</div>
              ` : topSuppliers.map((s, i) => `
                <div style="display: flex; justify-content: space-between; align-items: center; padding: 10px 0; ${i < topSuppliers.length - 1 ? `border-bottom: 1px solid ${C.gray100};` : ''}">
                  <div style="display: flex; align-items: center; gap: 10px;">
                    <span style="width: 24px; height: 24px; display: flex; align-items: center; justify-content: center; background: ${i < 3 ? C.primary : C.gray200}; color: ${i < 3 ? 'white' : C.gray600}; border-radius: 50%; font-size: 11px; font-weight: 700;">${i + 1}</span>
                    <span style="font-size: 13px; color: ${C.gray700};">${s.name}</span>
                  </div>
                  <span style="font-size: 12px; font-weight: 600; color: ${C.gray600};">${formatNumber(s.sales)}ì›</span>
                </div>
              `).join('')}
            </div>

            <!-- ì…€ëŸ¬ TOP -->
            <div style="background: ${C.white}; border-radius: 16px; padding: 24px; box-shadow: 0 2px 8px rgba(0,0,0,0.04);">
              <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
                <div style="font-size: 15px; font-weight: 700; color: ${C.black};">ğŸ‘¤ ì…€ëŸ¬ íŒë§¤ TOP</div>
              </div>
              ${topSellers.length === 0 ? `
                <div style="text-align: center; padding: 24px; color: ${C.gray400}; font-size: 13px;">ë°ì´í„° ì—†ìŒ</div>
              ` : topSellers.map((s, i) => `
                <div style="display: flex; justify-content: space-between; align-items: center; padding: 10px 0; ${i < topSellers.length - 1 ? `border-bottom: 1px solid ${C.gray100};` : ''}">
                  <div style="display: flex; align-items: center; gap: 10px;">
                    <span style="width: 24px; height: 24px; display: flex; align-items: center; justify-content: center; background: ${i < 3 ? C.green : C.gray200}; color: ${i < 3 ? 'white' : C.gray600}; border-radius: 50%; font-size: 11px; font-weight: 700;">${i + 1}</span>
                    <span style="font-size: 13px; color: ${C.gray700};">${s.name}</span>
                  </div>
                  <span style="font-size: 12px; font-weight: 600; color: ${C.gray600};">${formatNumber(s.sales)}ì›</span>
                </div>
              `).join('')}
            </div>
          </div>
        </div>
      `;
    }

    function openGoalCalculator() {
      const T = getStrategyTarget();
      const m = document.getElementById('modal');
      m.className = 'modal show';
      m.innerHTML = `
        <div class="modal-content" style="max-width: 800px;">
          <div class="modal-header" style="background: linear-gradient(135deg, var(--primary), #1b64da); color: white;">
            <h2 class="modal-title" style="color: white;">ğŸ§® ê³µêµ¬ì„¤ê³„ ê³„ì‚°ê¸°</h2>
            <button class="modal-close" onclick="closeModal()" style="color: white;">Ã—</button>
          </div>
          <div style="padding: 20px;">
            <div style="background: var(--gray-50); border-radius: 12px; padding: 20px; margin-bottom: 20px;">
              <div style="font-weight: 700; color: var(--gray-800); margin-bottom: 16px; font-size: 16px;">ğŸ“ í˜„ì¬ ì „ëµ ëª©í‘œ</div>
              <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 16px;">
                <div style="background: white; border-radius: 10px; padding: 14px; border: 1px solid var(--gray-200);">
                  <div style="font-size: 12px; color: var(--gray-600); margin-bottom: 6px;">ì—°ê°„ ë§¤ì¶œ ëª©í‘œ</div>
                  <div style="font-size: 20px; font-weight: 700; color: var(--primary);">${(T.annualRevenue / 100000000).toFixed(1)}ì–µì›</div>
                </div>
                <div style="background: white; border-radius: 10px; padding: 14px; border: 1px solid var(--gray-200);">
                  <div style="font-size: 12px; color: var(--gray-600); margin-bottom: 6px;">ëª©í‘œ ì„±ê³µë¥ </div>
                  <div style="font-size: 20px; font-weight: 700; color: #F59E0B;">${T.successRate}%</div>
                </div>
                <div style="background: white; border-radius: 10px; padding: 14px; border: 1px solid var(--gray-200);">
                  <div style="font-size: 12px; color: var(--gray-600); margin-bottom: 6px;">ì—°ê°„ ìˆœìµ ëª©í‘œ</div>
                  <div style="font-size: 20px; font-weight: 700; color: #00C471;">${(T.annualProfit / 10000).toFixed(0)}ë§Œì›</div>
                </div>
              </div>
            </div>

            <div style="background: linear-gradient(135deg, var(--primary), #1b64da); border-radius: 16px; padding: 24px; color: white;">
              <div style="font-weight: 700; margin-bottom: 20px; font-size: 16px;">ğŸ“Š ëª©í‘œ ë‹¬ì„± ê°€ì´ë“œ</div>
              <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 12px;">
                <div style="background: rgba(255,255,255,0.15); border-radius: 10px; padding: 14px; text-align: center;">
                  <div style="font-size: 22px; font-weight: 700;">${T.requiredTotalDeals}</div>
                  <div style="font-size: 11px; opacity: 0.8;">ì—° í•„ìš” ê³µêµ¬</div>
                </div>
                <div style="background: rgba(255,255,255,0.15); border-radius: 10px; padding: 14px; text-align: center;">
                  <div style="font-size: 22px; font-weight: 700;">${T.monthlyRequiredDeals}</div>
                  <div style="font-size: 11px; opacity: 0.8;">ì›” í•„ìš” ê³µêµ¬</div>
                </div>
                <div style="background: rgba(255,255,255,0.15); border-radius: 10px; padding: 14px; text-align: center;">
                  <div style="font-size: 22px; font-weight: 700;">${T.weeklyRequiredDeals}</div>
                  <div style="font-size: 11px; opacity: 0.8;">ì£¼ í•„ìš” ê³µêµ¬</div>
                </div>
                <div style="background: rgba(255,255,255,0.2); border-radius: 10px; padding: 14px; text-align: center;">
                  <div style="font-size: 22px; font-weight: 700;">${T.targetSuccessDeals}</div>
                  <div style="font-size: 11px; opacity: 0.8;">ì—° ì„±ê³µ ëª©í‘œ</div>
                </div>
              </div>
            </div>

            <div style="background: #E8F5E9; border: 2px solid #4CAF50; border-radius: 12px; padding: 16px; margin-top: 20px;">
              <div style="font-weight: 700; color: #2E7D32; margin-bottom: 8px;">âœ… ì„±ê³µ ê³µì‹</div>
              <div style="font-size: 13px; color: #388E3C; line-height: 1.6;">
                <strong>ëª©í‘œ:</strong> ì›” ${T.monthlyRequiredDeals}ê±´ ê³µêµ¬ Ã— ì„±ê³µë¥  ${T.successRate}% = ì›” ${T.monthlySuccessDeals}ê±´ ì„±ê³µ<br>
                <strong>í•µì‹¬:</strong> 30% ì´ìƒ ìˆ˜ìˆ˜ë£Œ ê³µêµ¬ ë¹„ì¤‘ ${T.commission30Ratio}% í™•ë³´ë¡œ ë§ˆì§„ ê·¹ëŒ€í™”
              </div>
            </div>
          </div>
          <div class="modal-footer" style="border-top: 1px solid var(--gray-200); padding: 16px 20px;">
            <button class="btn btn-secondary" onclick="closeModal()">ë‹«ê¸°</button>
          </div>
        </div>
      `;
    }

    // ========================================
    // ì—…ë¬´ê°€ì´ë“œ ì‹œìŠ¤í…œ
    // ========================================
    let guideTab = 'essence';

    function renderGuide() {
      const container = document.getElementById('guideContent');
      if (!container) return;

      container.innerHTML = `
        <div style="max-width: 1200px; margin: 0 auto;">
          <!-- í—¤ë” -->
          <div style="background: linear-gradient(135deg, var(--primary), #e08600); color: white; padding: 28px; border-radius: 16px; margin-bottom: 24px; box-shadow: 0 4px 16px rgba(49, 130, 246, 0.2);">
            <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 12px;">
              <div style="font-size: 36px;">ğŸ“š</div>
              <div>
                <div style="font-size: 24px; font-weight: 700;">ëª¨ì—¬ë¼ë”œ ì—…ë¬´ ê°€ì´ë“œ</div>
                <div style="font-size: 14px; opacity: 0.9; margin-top: 4px;">ì‹ ê·œ íŒ€ì›ì„ ìœ„í•œ ìƒì„¸ ê°€ì´ë“œ - ë³¸ì§ˆë¶€í„° ì‹¤ë¬´ê¹Œì§€</div>
              </div>
            </div>
            <div style="background: rgba(255,255,255,0.15); border-radius: 10px; padding: 14px; margin-top: 12px;">
              <div style="font-size: 13px; font-weight: 600; margin-bottom: 6px;">ğŸ’¡ ëª¨ì—¬ë¼ë”œ í•µì‹¬ ì •ì˜</div>
              <div style="font-size: 15px; line-height: 1.6;">"<strong>ì‚¬ëŒì˜ ì‹ ë¢°</strong>ë¥¼ ìœ í†µì˜ ì¤‘ì‹¬ì— ë‘” ë¯¸ë””ì–´ì»¤ë¨¸ìŠ¤ ê¸°ë°˜ ê³µë™êµ¬ë§¤ ì¸í”„ë¼ í”Œë«í¼"</div>
            </div>
          </div>

          <!-- íƒ­ ë©”ë‰´ -->
          <div style="display: flex; gap: 8px; margin-bottom: 20px; border-bottom: 2px solid var(--gray-200); padding-bottom: 8px; flex-wrap: wrap;">
            <button onclick="switchGuideTab('essence')" style="padding: 12px 16px; font-size: 14px; font-weight: 600; border: none; cursor: pointer; border-radius: 8px 8px 0 0; transition: all 0.2s; ${guideTab === 'essence' ? 'background: var(--primary); color: white;' : 'background: var(--gray-100); color: var(--gray-600);'}">
              ğŸ¯ ë³¸ì§ˆ ë©”ì‹œì§€
            </button>
            <button onclick="switchGuideTab('process')" style="padding: 12px 16px; font-size: 14px; font-weight: 600; border: none; cursor: pointer; border-radius: 8px 8px 0 0; transition: all 0.2s; ${guideTab === 'process' ? 'background: var(--primary); color: white;' : 'background: var(--gray-100); color: var(--gray-600);'}">
              ğŸ“‹ ì—…ë¬´ í”„ë¡œì„¸ìŠ¤
            </button>
            <button onclick="switchGuideTab('partner')" style="padding: 12px 16px; font-size: 14px; font-weight: 600; border: none; cursor: pointer; border-radius: 8px 8px 0 0; transition: all 0.2s; ${guideTab === 'partner' ? 'background: var(--primary); color: white;' : 'background: var(--gray-100); color: var(--gray-600);'}">
              ğŸ¤ íŒŒíŠ¸ë„ˆ ì‘ëŒ€
            </button>
          </div>

          <!-- ì»¨í…ì¸  ì˜ì—­ -->
          <div style="background: white; border-radius: 16px; padding: 24px; box-shadow: 0 2px 12px rgba(0,0,0,0.06);">
            ${guideTab === 'essence' ? getGuideEssenceContent() : guideTab === 'process' ? getGuideProcessContent() : getGuidePartnerContent()}
          </div>
        </div>
      `;
    }

    function switchGuideTab(tab) {
      guideTab = tab;
      renderGuide();
    }

    function getGuideEssenceContent() {
      return `
        <!-- í•µì‹¬ ê°€ì¹˜ -->
        <div style="text-align: center; padding: 20px 0 30px;">
          <div style="font-size: 28px; font-weight: 700; color: #191F28; margin-bottom: 12px;">ì™œ ëª¨ì—¬ë¼ë”œì¸ê°€?</div>
          <div style="font-size: 16px; color: #6B7684; max-width: 600px; margin: 0 auto; line-height: 1.6;">
            ê´‘ê³  ì‹ ë¢°ë„ëŠ” í•˜ë½í•˜ê³ , 'ì‚¬ëŒ ì¶”ì²œ'ì˜ ê°€ì¹˜ëŠ” ìƒìŠ¹í•©ë‹ˆë‹¤.<br>
            ëª¨ì—¬ë¼ë”œì€ <strong>"ì‹ ë¢° â†’ êµ¬ë§¤"</strong> êµ¬ì¡°ì— ìµœì í™”ëœ í”Œë«í¼ì…ë‹ˆë‹¤.
          </div>
        </div>

        <!-- 3ëŒ€ ê³ ê° ê°€ì¹˜ ì¹´ë“œ -->
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 20px; margin-bottom: 30px;">
          <!-- ê³µê¸‰ì‚¬ -->
          <div style="background: linear-gradient(135deg, #EEF2FF, #E0E7FF); border-radius: 16px; padding: 24px; border: 1px solid #C7D2FE;">
            <div style="font-size: 32px; margin-bottom: 12px;">ğŸ­</div>
            <div style="font-size: 18px; font-weight: 700; color: #4338CA; margin-bottom: 8px;">ê³µê¸‰ì‚¬</div>
            <div style="font-size: 13px; color: #6366F1; font-weight: 600; margin-bottom: 16px;">"ì¢‹ì€ ì œí’ˆì´ ë” ë¹ ë¥´ê³  íš¨ìœ¨ì ìœ¼ë¡œ íŒ”ë¦¬ëŠ” êµ¬ì¡°"</div>
            <div style="font-size: 13px; color: #4B5563; line-height: 1.8;">
              âœ“ ì´ˆê¸°ë¹„ìš© <strong>0ì›</strong><br>
              âœ“ í”„ë¦¬ë¯¸ì—„ ì— ë²„ì„œë” ë„¤íŠ¸ì›Œí¬ë¡œ <strong>ë¹ ë¥¸ í™•ì‚°</strong><br>
              âœ“ ì´ë²¤íŠ¸ ê¸°íšÂ·ì‚¬ì€í’ˆÂ·íŒ¨í‚¤ì§•Â·ê²°ì œì°½ <strong>ì¼ê´„ ì§€ì›</strong><br>
              âœ“ <strong>3~7ì¼ ë‚´ ë¹ ë¥¸ ì •ì‚°</strong>, ì¶”ê°€ ê´€ë¦¬ë¹„ ì—†ìŒ<br>
              âœ“ ì½˜í…ì¸  <strong>2ì°¨ ë§ˆì¼€íŒ… í™œìš©</strong> ê°€ëŠ¥
            </div>
          </div>

          <!-- ì…€ëŸ¬ -->
          <div style="background: linear-gradient(135deg, #FEF3C7, #FDE68A); border-radius: 16px; padding: 24px; border: 1px solid #FCD34D;">
            <div style="font-size: 32px; margin-bottom: 12px;">ğŸ‘©â€ğŸ’¼</div>
            <div style="font-size: 18px; font-weight: 700; color: #B45309; margin-bottom: 8px;">ì…€ëŸ¬</div>
            <div style="font-size: 13px; color: #D97706; font-weight: 600; margin-bottom: 16px;">"ì½˜í…ì¸ ëŠ” ì…€ëŸ¬ê°€, êµ¬ì¡°ëŠ” ëª¨ì—¬ë¼ë”œì´"</div>
            <div style="font-size: 13px; color: #4B5563; line-height: 1.8;">
              âœ“ ì´ˆê¸°ë¹„ìš© <strong>0ì›</strong><br>
              âœ“ ê¸°íšÂ·ë””ìì¸Â·ê²°ì œÂ·ì •ì‚°ê¹Œì§€ <strong>í’€ì„œí¬íŠ¸</strong><br>
              âœ“ ì „ì† ê³„ì•½ ê¸°ë°˜ <strong>ìˆ˜ìµ ì•ˆì •ì„±</strong> í™•ë³´<br>
              âœ“ ë¸Œëœë“œ ì§ê±°ë˜/ì •ì‚° <strong>ë¦¬ìŠ¤í¬ ì°¨ë‹¨</strong><br>
              âœ“ ì„±ì¥ ì‹œ ìˆ˜ìˆ˜ë£Œ ìƒìŠ¹, <strong>ë¸Œëœë“œí™”ê¹Œì§€ í™•ì¥</strong>
            </div>
          </div>

          <!-- ì†Œë¹„ì -->
          <div style="background: linear-gradient(135deg, #DCFCE7, #BBF7D0); border-radius: 16px; padding: 24px; border: 1px solid #86EFAC;">
            <div style="font-size: 32px; margin-bottom: 12px;">ğŸ›’</div>
            <div style="font-size: 18px; font-weight: 700; color: #166534; margin-bottom: 8px;">ì†Œë¹„ì</div>
            <div style="font-size: 13px; color: #16A34A; font-weight: 600; margin-bottom: 16px;">"ì‹ ë¢°ë¥¼ ì „ì œë¡œ í•œ ê³µë™êµ¬ë§¤ ê²½í—˜"</div>
            <div style="font-size: 13px; color: #4B5563; line-height: 1.8;">
              âœ“ ê´‘ê³ ê°€ ì•„ë‹Œ, <strong>ì‹¤ì œ ì‚¬ìš© ê¸°ë°˜ ì¶”ì²œ</strong><br>
              âœ“ ê³µì‹ ë¸Œëœë“œ ì—°ë™ìœ¼ë¡œ <strong>ê°€ê²©Â·í’ˆì§ˆ ì‹ ë¢°</strong><br>
              âœ“ <strong>ë³µì¡í•œ ê²½ë¡œ ì—†ëŠ”</strong> ê°„í¸ êµ¬ë§¤<br>
              âœ“ ì…€ëŸ¬ê°€ ì§ì ‘ ì¨ë³´ê³  ì¢‹ì•˜ë˜ ì œí’ˆ<br>
              âœ“ <strong>í•©ë¦¬ì ì¸ ê°€ê²©</strong>ì— ë§Œë‚˜ëŠ” í’ˆì§ˆ
            </div>
          </div>
        </div>

        <!-- ë³¸ì§ˆì  ì°¨ë³„ì  -->
        <div style="background: #F9FAFB; border-radius: 12px; padding: 24px; margin-bottom: 20px;">
          <div style="font-size: 16px; font-weight: 700; color: #191F28; margin-bottom: 16px;">ğŸ† ëª¨ì—¬ë¼ë”œì˜ ë³¸ì§ˆì  ì°¨ë³„ì  (MOAT)</div>
          <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 16px;">
            <div style="display: flex; align-items: center; gap: 12px; padding: 14px; background: white; border-radius: 10px;">
              <div style="width: 40px; height: 40px; background: #E8F3FF; border-radius: 10px; display: flex; align-items: center; justify-content: center; font-size: 18px;">ğŸ“Š</div>
              <div>
                <div style="font-size: 14px; font-weight: 600; color: #191F28;">ì…€ëŸ¬ ì— ë²„ì„œë” ë„¤íŠ¸ì›Œí¬ & ë¹…ë°ì´í„°</div>
                <div style="font-size: 12px; color: #6B7684;">ì–´ë–¤ ìƒí’ˆì´ ì˜ íŒ”ë¦¬ëŠ”ì§€ ë°ì´í„° ê¸°ë°˜ ë¶„ì„</div>
              </div>
            </div>
            <div style="display: flex; align-items: center; gap: 12px; padding: 14px; background: white; border-radius: 10px;">
              <div style="width: 40px; height: 40px; background: #FEF3C7; border-radius: 10px; display: flex; align-items: center; justify-content: center; font-size: 18px;">ğŸ“</div>
              <div>
                <div style="font-size: 14px; font-weight: 600; color: #191F28;">ì „ì† ê³„ì•½ ê¸°ë°˜ì˜ ì•ˆì •ì  êµ¬ì¡°</div>
                <div style="font-size: 12px; color: #6B7684;">1ë…„ ì „ì†ê³„ì•½ìœ¼ë¡œ ì§ê±°ë˜ ìœ„í—˜ ì°¨ë‹¨</div>
              </div>
            </div>
            <div style="display: flex; align-items: center; gap: 12px; padding: 14px; background: white; border-radius: 10px;">
              <div style="width: 40px; height: 40px; background: #DCFCE7; border-radius: 10px; display: flex; align-items: center; justify-content: center; font-size: 18px;">âš¡</div>
              <div>
                <div style="font-size: 14px; font-weight: 600; color: #191F28;">í’€ìŠ¤íƒ ìœ í†µ ìš´ì˜</div>
                <div style="font-size: 12px; color: #6B7684;">ì´ë²¤íŠ¸Â·ì •ì‚°Â·ê²°ì œê¹Œì§€ ì›ìŠ¤í†± ì§€ì›</div>
              </div>
            </div>
            <div style="display: flex; align-items: center; gap: 12px; padding: 14px; background: white; border-radius: 10px;">
              <div style="width: 40px; height: 40px; background: #FCE7F3; border-radius: 10px; display: flex; align-items: center; justify-content: center; font-size: 18px;">ğŸ’</div>
              <div>
                <div style="font-size: 14px; font-weight: 600; color: #191F28;">"ì‹ ë¢° â†’ êµ¬ë§¤" êµ¬ì¡°</div>
                <div style="font-size: 12px; color: #6B7684;">ê´‘ê³ â†’ì „í™˜ì´ ì•„ë‹Œ, ì‹ ë¢° ê¸°ë°˜ í”Œë«í¼</div>
              </div>
            </div>
          </div>
        </div>

        <!-- ë¹„ì „ -->
        <div style="background: linear-gradient(135deg, var(--primary), #e08600); border-radius: 12px; padding: 24px; color: white; text-align: center;">
          <div style="font-size: 15px; font-weight: 600; margin-bottom: 12px;">ğŸš€ ëª¨ì—¬ë¼ë”œì´ ë§Œë“œëŠ” ë¯¸ë˜</div>
          <div style="display: flex; justify-content: center; gap: 40px; flex-wrap: wrap;">
            <div>
              <div style="font-size: 24px; margin-bottom: 4px;">ğŸ­</div>
              <div style="font-size: 13px; opacity: 0.9;">ë¸Œëœë“œì—ê²ŒëŠ”</div>
              <div style="font-size: 14px; font-weight: 600;">ê°€ì¥ íš¨ìœ¨ì ì¸ ìœ í†µ ì±„ë„</div>
            </div>
            <div>
              <div style="font-size: 24px; margin-bottom: 4px;">ğŸ‘©â€ğŸ’¼</div>
              <div style="font-size: 13px; opacity: 0.9;">ì…€ëŸ¬ì—ê²ŒëŠ”</div>
              <div style="font-size: 14px; font-weight: 600;">ì§€ì† ê°€ëŠ¥í•œ ìˆ˜ìµ ì¸í”„ë¼</div>
            </div>
            <div>
              <div style="font-size: 24px; margin-bottom: 4px;">ğŸ›’</div>
              <div style="font-size: 13px; opacity: 0.9;">ì†Œë¹„ìì—ê²ŒëŠ”</div>
              <div style="font-size: 14px; font-weight: 600;">ê°€ì¥ ë¯¿ì„ ìˆ˜ ìˆëŠ” ì¶”ì²œ ê³µê°„</div>
            </div>
          </div>
        </div>
      `;
    }

    function getGuideProcessContent() {
      return `
        <!-- ì „ì²´ íë¦„ -->
        <div style="background: var(--gray-50); border-radius: 12px; padding: 16px; margin-bottom: 20px; border: 1px solid var(--gray-200);">
          <div style="font-size: 14px; font-weight: 700; color: var(--gray-800); margin-bottom: 12px;">ì „ì²´ íë¦„</div>
          <div style="display: flex; align-items: center; justify-content: center; gap: 8px; flex-wrap: wrap; font-size: 12px; font-weight: 600;">
            <span style="background: var(--primary); color: white; padding: 6px 12px; border-radius: 6px;">ìƒí’ˆ ì¤€ë¹„</span>
            <span style="color: var(--gray-400);">â†’</span>
            <span style="background: var(--primary); color: white; padding: 6px 12px; border-radius: 6px;">ì…€ëŸ¬ ì¤€ë¹„</span>
            <span style="color: var(--gray-400);">â†’</span>
            <span style="background: var(--primary); color: white; padding: 6px 12px; border-radius: 6px;">ê³µêµ¬ ë“±ë¡</span>
            <span style="color: var(--gray-400);">â†’</span>
            <span style="background: var(--primary); color: white; padding: 6px 12px; border-radius: 6px;">íŒë§¤</span>
            <span style="color: var(--gray-400);">â†’</span>
            <span style="background: var(--primary); color: white; padding: 6px 12px; border-radius: 6px;">ì •ì‚°</span>
          </div>
        </div>

        <!-- ë‹¨ê³„ë³„ ì„¤ëª… -->
        <div style="display: grid; gap: 12px;">
          <div style="background: white; border: 1px solid var(--gray-200); border-radius: 10px; padding: 16px;">
            <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 12px;">
              <div style="width: 28px; height: 28px; background: var(--primary); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-size: 13px; font-weight: 700;">1</div>
              <div style="font-size: 14px; font-weight: 700; color: var(--gray-800);">ìƒí’ˆ ì¤€ë¹„</div>
              <span style="font-size: 11px; color: var(--gray-500); background: var(--gray-100); padding: 2px 8px; border-radius: 4px;">êµ¬ë§¤íŒ€</span>
            </div>
            <div style="display: flex; gap: 20px; font-size: 12px; color: var(--gray-600); padding-left: 38px; flex-wrap: wrap;">
              <div>â‘  ìƒí’ˆ ë¦¬ìŠ¤íŠ¸ì—ì„œ ê³µê¸‰ì‚¬ ì°¾ê¸°</div>
              <div>â‘¡ ë§ˆì§„ê³„ì‚°ê¸°ë¡œ ê³µê¸‰ë‹¨ê°€ í˜‘ìƒ</div>
              <div>â‘¢ ìƒí’ˆ DBì— ë“±ë¡</div>
            </div>
          </div>

          <div style="background: white; border: 1px solid var(--gray-200); border-radius: 10px; padding: 16px;">
            <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 12px;">
              <div style="width: 28px; height: 28px; background: var(--primary); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-size: 13px; font-weight: 700;">2</div>
              <div style="font-size: 14px; font-weight: 700; color: var(--gray-800);">ì…€ëŸ¬ ì¤€ë¹„</div>
              <span style="font-size: 11px; color: var(--gray-500); background: var(--gray-100); padding: 2px 8px; border-radius: 4px;">ë§ˆì¼€íŒ…íŒ€</span>
            </div>
            <div style="padding-left: 38px;">
              <div style="display: flex; gap: 8px; margin-bottom: 8px;">
                <span style="font-size: 11px; background: #dbeafe; color: #1e40af; padding: 2px 8px; border-radius: 4px; font-weight: 600;">A. ì‹ ê·œ ì…€ëŸ¬ ë°œêµ´</span>
              </div>
              <div style="display: flex; gap: 20px; font-size: 12px; color: var(--gray-600); margin-bottom: 12px; flex-wrap: wrap;">
                <div>â‘  ì…€ëŸ¬ ë¦¬ìŠ¤íŠ¸ì—ì„œ ì¸í”Œë£¨ì–¸ì„œ ì°¾ê¸°</div>
                <div>â‘¡ ì»¨íƒ â†’ ì œì•ˆ â†’ ê³„ì•½</div>
                <div>â‘¢ ì…€ëŸ¬ DBì— ë“±ë¡</div>
              </div>
              <div style="display: flex; gap: 8px; margin-bottom: 8px;">
                <span style="font-size: 11px; background: #fef3c7; color: #92400e; padding: 2px 8px; border-radius: 4px; font-weight: 600;">B. ê¸°ì¡´ ì…€ëŸ¬ì—ê²Œ ì œì•ˆ</span>
              </div>
              <div style="display: flex; gap: 20px; font-size: 12px; color: var(--gray-600); flex-wrap: wrap;">
                <div>â‘  ì…€ëŸ¬ DBì—ì„œ ì í•©í•œ ì…€ëŸ¬ ì„ íƒ</div>
                <div>â‘¡ ë§ˆì§„ê³„ì‚°ê¸°ë¡œ ì…€ëŸ¬ ë§ˆì§„ í˜‘ìƒ</div>
                <div>â‘¢ ì…€ëŸ¬ ì œì•ˆì„œ ì „ë‹¬</div>
              </div>
            </div>
          </div>

          <div style="background: white; border: 1px solid var(--gray-200); border-radius: 10px; padding: 16px;">
            <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 12px;">
              <div style="width: 28px; height: 28px; background: var(--primary); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-size: 13px; font-weight: 700;">3</div>
              <div style="font-size: 14px; font-weight: 700; color: var(--gray-800);">ê³µêµ¬ ë“±ë¡</div>
            </div>
            <div style="display: flex; gap: 20px; font-size: 12px; color: var(--gray-600); padding-left: 38px; flex-wrap: wrap;">
              <div>â‘  ê³µêµ¬ ìº˜ë¦°ë”ì—ì„œ ê³µêµ¬ ë“±ë¡</div>
              <div>â‘¡ ì…€ëŸ¬ì—ê²Œ ê³µêµ¬ ê°€ì´ë“œ ì „ë‹¬</div>
              <div>â‘¢ ì…€ëŸ¬ê°€ SNSì— í™ë³´</div>
            </div>
          </div>

          <div style="background: white; border: 1px solid var(--gray-200); border-radius: 10px; padding: 16px;">
            <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 12px;">
              <div style="width: 28px; height: 28px; background: var(--primary); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-size: 13px; font-weight: 700;">4</div>
              <div style="font-size: 14px; font-weight: 700; color: var(--gray-800);">íŒë§¤ & ì •ì‚°</div>
            </div>
            <div style="display: flex; gap: 16px; font-size: 12px; color: var(--gray-600); padding-left: 38px; flex-wrap: wrap;">
              <div>â‘  ì†Œë¹„ìê°€ ëª¨ì—¬ë¼ë”œì—ì„œ ê²°ì œ</div>
              <div>â‘¡ ê³µê¸‰ì‚¬ì—ê²Œ ë°œì£¼ì„œ ì „ë‹¬</div>
              <div>â‘¢ ê³µê¸‰ì‚¬ê°€ ìƒí’ˆ ë°°ì†¡</div>
              <div>â‘£ ê³µê¸‰ì‚¬ê°€ ì†¡ì¥ ëª¨ì—¬ë¼ë”œì—ê²Œ ì „ë‹¬</div>
              <div>â‘¤ ê³µêµ¬ ì¢…ë£Œ í›„ ì…€ëŸ¬, ê³µê¸‰ì‚¬ì—ê²Œ 3~7ì¼ ë‚´ ì •ì‚°</div>
            </div>
          </div>
        </div>

        <!-- ìˆ˜ìµ êµ¬ì¡° -->
        <div style="background: var(--gray-50); border-radius: 10px; padding: 16px; margin-top: 16px; border: 1px solid var(--gray-200);">
          <div style="font-size: 13px; font-weight: 700; color: var(--gray-800); margin-bottom: 10px;">ìˆ˜ìµ êµ¬ì¡°</div>
          <div style="display: flex; align-items: center; justify-content: center; gap: 12px; font-size: 11px; flex-wrap: wrap;">
            <div style="text-align: center; padding: 8px 12px; background: white; border-radius: 6px;">
              <div style="font-weight: 600; color: var(--gray-700);">ê³µê¸‰ì‚¬</div>
              <div style="color: var(--gray-500);">ê³µê¸‰ê°€</div>
            </div>
            <span style="color: var(--gray-400);">+</span>
            <div style="text-align: center; padding: 8px 12px; background: white; border-radius: 6px;">
              <div style="font-weight: 600; color: var(--gray-700);">ì…€ëŸ¬</div>
              <div style="color: var(--gray-500);">ë§ˆì§„(-3.3%)</div>
            </div>
            <span style="color: var(--gray-400);">+</span>
            <div style="text-align: center; padding: 8px 12px; background: white; border-radius: 6px;">
              <div style="font-weight: 600; color: var(--gray-700);">PGì‚¬</div>
              <div style="color: var(--gray-500);">4%</div>
            </div>
            <span style="color: var(--gray-400);">+</span>
            <div style="text-align: center; padding: 8px 12px; background: var(--primary); border-radius: 6px; color: white;">
              <div style="font-weight: 600;">ëª¨ì—¬ë¼ë”œ</div>
              <div style="opacity: 0.9;">ë‚˜ë¨¸ì§€ ì „ë¶€</div>
            </div>
            <span style="color: var(--gray-400);">=</span>
            <div style="text-align: center; padding: 8px 12px; background: var(--gray-900); border-radius: 6px; color: white;">
              <div style="font-weight: 600;">íŒë§¤ê°€</div>
            </div>
          </div>
        </div>
      `;
    }

    function getGuidePartnerContent() {
      return `
        <div style="font-size: 18px; font-weight: 700; color: #191F28; margin-bottom: 20px;">ğŸ¤ íŒŒíŠ¸ë„ˆ ì‘ëŒ€ ê°€ì´ë“œ</div>

        <!-- ê³µê¸‰ì‚¬ ì‘ëŒ€ -->
        <div style="background: #EEF2FF; border-radius: 12px; padding: 20px; margin-bottom: 20px; border: 1px solid #C7D2FE;">
          <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 16px;">
            <span style="font-size: 24px;">ğŸ­</span>
            <span style="font-size: 16px; font-weight: 700; color: #4338CA;">ê³µê¸‰ì‚¬ ì‘ëŒ€ ì‹œ í•µì‹¬ í¬ì¸íŠ¸</span>
          </div>

          <div style="background: white; border-radius: 10px; padding: 16px; margin-bottom: 12px;">
            <div style="font-size: 14px; font-weight: 600; color: #191F28; margin-bottom: 8px;">ğŸ“Œ ì²« ì»¨íƒ ì‹œ ì „ë‹¬í•  ë©”ì‹œì§€</div>
            <div style="font-size: 13px; color: #4B5563; line-height: 1.8; padding: 12px; background: #F9FAFB; border-radius: 8px; border-left: 3px solid #4338CA;">
              "ëª¨ì—¬ë¼ë”œì€ ë‹¨ìˆœ ë²¤ë”ì‚¬ê°€ ì•„ë‹ˆë¼,<br>
              <strong>ì œí’ˆì´ ì‹œì¥ì— ë¹ ë¥´ê²Œ ë…¸ì¶œë˜ê³  ì‹¤êµ¬ë§¤ë¡œ ì´ì–´ì§€ëŠ” êµ¬ì¡°</strong>ë¥¼ ë§Œë“œëŠ” ê³³ì…ë‹ˆë‹¤."
            </div>
          </div>

          <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 12px;">
            <div style="background: white; border-radius: 8px; padding: 14px;">
              <div style="font-size: 13px; font-weight: 600; color: #4338CA; margin-bottom: 8px;">âœ… ê°•ì¡°í•´ì•¼ í•  ê²ƒ</div>
              <div style="font-size: 12px; color: #4B5563; line-height: 1.7;">
                â€¢ ì´ˆê¸°ë¹„ìš© 0ì›<br>
                â€¢ í”„ë¦¬ë¯¸ì—„ ì— ë²„ì„œë” ë„¤íŠ¸ì›Œí¬<br>
                â€¢ ì´ë²¤íŠ¸ ê¸°íšÂ·ì‚¬ì€í’ˆÂ·ê²°ì œì°½ ì§€ì›<br>
                â€¢ 3~7ì¼ ë‚´ ë¹ ë¥¸ ì •ì‚°<br>
                â€¢ ì½˜í…ì¸  2ì°¨ ë§ˆì¼€íŒ… í™œìš© ê°€ëŠ¥
              </div>
            </div>
            <div style="background: white; border-radius: 8px; padding: 14px;">
              <div style="font-size: 13px; font-weight: 600; color: #DC2626; margin-bottom: 8px;">âŒ í”¼í•´ì•¼ í•  ê²ƒ</div>
              <div style="font-size: 12px; color: #4B5563; line-height: 1.7;">
                â€¢ ë‹¨ìˆœ "ê³µë™êµ¬ë§¤ ì§„í–‰í•´ìš”" ì‹ ì ‘ê·¼<br>
                â€¢ ìˆ˜ìˆ˜ë£Œë§Œ ê°•ì¡°í•˜ëŠ” ì„¤ëª…<br>
                â€¢ íŒë§¤ ë³´ì¥ ì•½ì†<br>
                â€¢ ê²½ìŸì‚¬ ë¹„ë°©
              </div>
            </div>
          </div>
        </div>

        <!-- ì…€ëŸ¬ ì‘ëŒ€ -->
        <div style="background: #FEF3C7; border-radius: 12px; padding: 20px; margin-bottom: 20px; border: 1px solid #FCD34D;">
          <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 16px;">
            <span style="font-size: 24px;">ğŸ‘©â€ğŸ’¼</span>
            <span style="font-size: 16px; font-weight: 700; color: #B45309;">ì…€ëŸ¬ ì‘ëŒ€ ì‹œ í•µì‹¬ í¬ì¸íŠ¸</span>
          </div>

          <div style="background: white; border-radius: 10px; padding: 16px; margin-bottom: 12px;">
            <div style="font-size: 14px; font-weight: 600; color: #191F28; margin-bottom: 8px;">ğŸ“Œ ì²« ì»¨íƒ ì‹œ ì „ë‹¬í•  ë©”ì‹œì§€</div>
            <div style="font-size: 13px; color: #4B5563; line-height: 1.8; padding: 12px; background: #F9FAFB; border-radius: 8px; border-left: 3px solid #B45309;">
              "ëª¨ì—¬ë¼ë”œì€ ì…€ëŸ¬ê°€ <strong>'ì§€ì†ì ìœ¼ë¡œ ì˜ íŒ” ìˆ˜ ìˆëŠ” êµ¬ì¡°'</strong>ë¥¼ ë§Œë“¤ì–´ì£¼ëŠ” ì„±ì¥ í”Œë«í¼ì…ë‹ˆë‹¤.<br>
              ì½˜í…ì¸ ëŠ” ì…€ëŸ¬ê°€, êµ¬ì¡°ëŠ” ëª¨ì—¬ë¼ë”œì´ ì±…ì„ì§‘ë‹ˆë‹¤."
            </div>
          </div>

          <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 12px;">
            <div style="background: white; border-radius: 8px; padding: 14px;">
              <div style="font-size: 13px; font-weight: 600; color: #B45309; margin-bottom: 8px;">âœ… ê°•ì¡°í•´ì•¼ í•  ê²ƒ</div>
              <div style="font-size: 12px; color: #4B5563; line-height: 1.7;">
                â€¢ ì´ˆê¸°ë¹„ìš© 0ì›, í’€ì„œí¬íŠ¸<br>
                â€¢ ì „ì†ê³„ì•½ìœ¼ë¡œ ìˆ˜ìµ ì•ˆì •ì„±<br>
                â€¢ ë¸Œëœë“œ í˜‘ìƒ/ì •ì‚° ìœ„í—˜ ì°¨ë‹¨<br>
                â€¢ ì„±ì¥ ì‹œ ìˆ˜ìˆ˜ë£Œ ìë™ ìƒìŠ¹<br>
                â€¢ ODM/OEM ë¸Œëœë“œí™” ì§€ì›
              </div>
            </div>
            <div style="background: white; border-radius: 8px; padding: 14px;">
              <div style="font-size: 13px; font-weight: 600; color: #DC2626; margin-bottom: 8px;">âŒ í”¼í•´ì•¼ í•  ê²ƒ</div>
              <div style="font-size: 12px; color: #4B5563; line-height: 1.7;">
                â€¢ "ë§ì´ íŒ”ë©´ ëˆ ë©ë‹ˆë‹¤" ì‹ ì ‘ê·¼<br>
                â€¢ ìˆ˜ìµë§Œ ê°•ì¡°í•˜ëŠ” ì„¤ëª…<br>
                â€¢ ì „ì†ê³„ì•½ ë¶€ë‹´ê° ì£¼ê¸°<br>
                â€¢ ì„±ê¸‰í•œ ê³„ì•½ ìš”êµ¬
              </div>
            </div>
          </div>

          <div style="background: white; border-radius: 8px; padding: 14px; margin-top: 12px;">
            <div style="font-size: 13px; font-weight: 600; color: #B45309; margin-bottom: 8px;">ğŸ’° ì…€ëŸ¬ ìˆ˜ìˆ˜ë£Œ êµ¬ì¡° ì„¤ëª…</div>
            <div style="font-size: 12px; color: #4B5563; line-height: 1.7;">
              â€¢ ê¸°ë³¸ ìˆ˜ìˆ˜ë£Œ: í˜‘ì˜ (ìƒí’ˆ/ì…€ëŸ¬ë³„ ìƒì´)<br>
              â€¢ 500ê°œ ì´ìƒ íŒë§¤ ì‹œ: ë³´ë„ˆìŠ¤ ë§ˆì§„ +1%ì”© (ëª¨ì—¬ë¼ë”œ ë¶€ë‹´)<br>
              â€¢ ì •ì‚°: ê³µêµ¬ ì¢…ë£Œ í›„ 3~7ì¼ ë‚´ ë¹ ë¥¸ ì…ê¸ˆ
            </div>
          </div>
        </div>

        <!-- FAQ -->
        <div style="background: #F2F4F6; border-radius: 12px; padding: 20px;">
          <div style="font-size: 16px; font-weight: 700; color: #191F28; margin-bottom: 16px;">â“ ìì£¼ ë°›ëŠ” ì§ˆë¬¸ & ë‹µë³€</div>

          <div style="display: grid; gap: 12px;">
            <div style="background: white; border-radius: 10px; padding: 16px;">
              <div style="font-size: 13px; font-weight: 600; color: #0064FF; margin-bottom: 6px;">Q. ì™œ ì´ˆê¸°ë¹„ìš©ì´ 0ì›ì¸ê°€ìš”?</div>
              <div style="font-size: 13px; color: #4B5563;">A. ëª¨ì—¬ë¼ë”œì€ íŒë§¤ ìˆ˜ìˆ˜ë£Œ ê¸°ë°˜ ìˆ˜ìµ êµ¬ì¡°ì…ë‹ˆë‹¤. íŒŒíŠ¸ë„ˆì˜ ì„±ê³µì´ ê³§ ìš°ë¦¬ì˜ ì„±ê³µì´ê¸° ë•Œë¬¸ì—, ì§„ì… ì¥ë²½ì„ ë‚®ì¶”ê³  í•¨ê»˜ ì„±ì¥í•˜ëŠ” êµ¬ì¡°ë¥¼ ë§Œë“¤ì—ˆìŠµë‹ˆë‹¤.</div>
            </div>
            <div style="background: white; border-radius: 10px; padding: 16px;">
              <div style="font-size: 13px; font-weight: 600; color: #0064FF; margin-bottom: 6px;">Q. ë‹¤ë¥¸ ê³µë™êµ¬ë§¤ í”Œë«í¼ê³¼ ë­ê°€ ë‹¤ë¥¸ê°€ìš”?</div>
              <div style="font-size: 13px; color: #4B5563;">A. ëª¨ì—¬ë¼ë”œì€ 'ì‹ ë¢° â†’ êµ¬ë§¤' êµ¬ì¡°ì— ìµœì í™”ë˜ì–´ ìˆìŠµë‹ˆë‹¤. ë‹¨ìˆœ ì¤‘ê°œê°€ ì•„ë‹ˆë¼, ì´ë²¤íŠ¸ ê¸°íšë¶€í„° ì •ì‚°ê¹Œì§€ í’€ìŠ¤íƒ ìœ í†µ ìš´ì˜ì„ ì œê³µí•©ë‹ˆë‹¤.</div>
            </div>
            <div style="background: white; border-radius: 10px; padding: 16px;">
              <div style="font-size: 13px; font-weight: 600; color: #0064FF; margin-bottom: 6px;">Q. ì „ì†ê³„ì•½ì´ë©´ ë‹¤ë¥¸ ê³³ì—ì„œ ëª» íŒŒë‚˜ìš”?</div>
              <div style="font-size: 13px; color: #4B5563;">A. ì „ì†ê³„ì•½ì€ 'ëª¨ì—¬ë¼ë”œ ì±„ë„ ë‚´'ì—ì„œì˜ ë…ì ì„ ì˜ë¯¸í•©ë‹ˆë‹¤. ì…€ëŸ¬ë‹˜ì˜ ë‹¤ë¥¸ ì±„ë„ í™œë™ì—ëŠ” ì œí•œì´ ì—†ìœ¼ë©°, ì˜¤íˆë ¤ ì•ˆì •ì ì¸ ìˆ˜ìµ ë³´í˜¸ë¥¼ ìœ„í•œ ì¥ì¹˜ì…ë‹ˆë‹¤.</div>
            </div>
          </div>
        </div>
      `;
    }

    // ì´ˆê¸°í™”
    document.addEventListener('DOMContentLoaded', () => {
      loadAdminPassword();
      checkLoginStatus();
    });
  </script>
</body>
</html>
