# 레퍼럴 캐시백 시스템 로드맵

## 📋 프로젝트 개요
- **목표**: 소비자가 공구를 친구에게 공유하고, 구매 시 양측 캐시백 제공
- **판매 채널**: 카페24 쇼핑몰
- **예상 기간**: 5-7일 (Phase 1~3)
- **고도화 계획**: 추후 실시간 Webhook, Firebase Dynamic Links 적용

---

## 🎯 구현 단계

### Phase 1: 기본 레퍼럴 시스템 (1-2일) ⏳
**목표**: 레퍼럴 링크 생성 및 추적

- [x] 설계 문서 작성 (`REFERRAL_CASHBACK_DESIGN.md`)
- [ ] Firestore 컬렉션 생성
  - `referrals`: 레퍼럴 코드 및 추적 데이터
  - `cashbacks`: 캐시백 적립 내역
  - `user_mappings`: 카페24 회원 ID ↔ Firebase UID 매핑
- [ ] 레퍼럴 코드 생성 함수 (`generateReferralCode()`)
- [ ] 공유 UI 컴포넌트 추가 (공구 페이지)
  - 레퍼럴 링크 생성 버튼
  - 카카오톡/문자 공유 버튼
  - 링크 복사 기능
- [ ] 레퍼럴 클릭 추적 (쿠키 저장)

**완료 기준**: 사용자가 레퍼럴 링크를 생성하고 공유할 수 있음

---

### Phase 2: 카페24 주문 연동 (2-3일) 🔄
**목표**: 주문 동기화 시 레퍼럴 코드 인식 및 캐시백 적립

**구현 방식 (1차)**: 주문 메모 방식
- [ ] `syncCafe24Orders()` 함수 수정
  - 주문 메모에서 레퍼럴 코드 추출 (`extractReferralCodeFromMemo()`)
  - `cafe24_orders` 컬렉션에 `referralCode` 필드 추가
- [ ] 캐시백 자동 적립 로직 (`processReferralCashback()`)
  - 추천인 캐시백: 5,000원
  - 피추천인 캐시백: 3,000원
- [ ] 보안 검증
  - 자기 자신 구매 방지
  - 중복 구매 방지 (1인 1회)
  - 레퍼럴 코드 만료 처리 (30일)
- [ ] 레퍼럴 통계 업데이트
  - 클릭 수, 전환 수, 총 캐시백 금액

**완료 기준**: 레퍼럴 링크로 구매 시 자동으로 캐시백 적립됨

---

### Phase 3: 캐시백 조회 및 사용 (1-2일) 💰
**목표**: 사용자가 캐시백을 확인하고 사용할 수 있음

- [ ] 캐시백 대시보드 UI (`/my-cashback.html`)
  - 총 캐시백 금액 표시
  - 사용 가능 / 사용 완료 금액
  - 초대 현황 (클릭 수, 전환율)
  - 캐시백 내역 테이블
- [ ] 캐시백 사용 로직 (`applyCashback()`)
  - 주문 시 캐시백 차감 (FIFO)
  - 잔여 금액 업데이트
- [ ] Admin 페이지에 레퍼럴 통계 추가
  - 전체 레퍼럴 현황
  - 전환율 분석
  - 총 지급 캐시백

**완료 기준**: 사용자가 캐시백 잔액을 확인하고 다음 구매에 사용 가능

---

## 🚀 고도화 계획 (추후)

### Phase 4: 카페24 사용자 정의 필드 (3-5일)
**목표**: 완전 자동 추적, 사용자 액션 불필요

- [ ] 카페24 관리자 설정
  - 주문서 사용자 정의 필드 추가 (`referral_code`)
  - API embed 파라미터에 `additional_information` 추가
- [ ] JavaScript 쿠키 → 카페24 필드 자동 입력
- [ ] 주문 동기화 로직 변경
  - 사용자 정의 필드에서 레퍼럴 코드 읽기
  - 메모 방식 대신 필드 우선 사용

**효과**: 전환율 15~25% 증가 예상

---

### Phase 5: 실시간 Webhook (5-7일)
**목표**: 주문 생성 즉시 캐시백 적립

- [ ] Cloud Function으로 Webhook 엔드포인트 생성
- [ ] 카페24 개발자센터 앱 등록
- [ ] Webhook URL 등록 (`order.created` 이벤트)
- [ ] 실시간 알림 (FCM Push)
- [ ] 대시보드 실시간 업데이트

**효과**: 사용자 경험 향상, 관리 편의성 증대

---

### Phase 6: Firebase Dynamic Links (선택)
**목표**: 앱/웹 통합, 딥링크 지원

- [ ] Firebase Dynamic Links 설정
- [ ] 앱 설치 유도 로직
- [ ] 앱 내 레퍼럴 페이지 연동
- [ ] 바이럴 계수(K-factor) 측정

**효과**: 앱 설치 증가, 바이럴 확산

---

## 📊 예상 성과

### 비즈니스 지표
- **바이럴 계수 (K-factor)**: 0.3 ~ 0.5
- **전환율 증가**: 15~25%
- **고객 획득 비용 (CAC) 절감**: 30~40%

### 운영 비용
- **개발 비용**: 5-7일 (Phase 1~3)
- **Firebase 비용**: 무료 할당량 내 (예상)
- **캐시백 지급**: 주문당 평균 8,000원
  - 추천인: 5,000원
  - 피추천인: 3,000원

---

## 📝 다음 작업
1. ✅ 설계 문서 작성 완료
2. ✅ 로드맵 작성 완료
3. 🔄 **Phase 1 시작**: Firestore 컬렉션 생성
4. 🔄 레퍼럴 링크 생성 로직 구현
5. 🔄 공유 UI 컴포넌트 추가

---

## 📌 참고 문서
- [상세 설계서](./REFERRAL_CASHBACK_DESIGN.md) - 전체 시스템 아키텍처
- [카페24 API 문서](https://developers.cafe24.com/) - OAuth 및 주문 API
- [Firebase 문서](https://firebase.google.com/docs) - Firestore, Cloud Functions

---

**최종 업데이트**: 2026-01-12
**담당자**: Claude AI
**상태**: 🟡 진행 중 (Phase 1)
