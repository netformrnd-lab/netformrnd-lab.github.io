<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ìƒí’ˆ ìƒì„¸ - ëª¨ì—¬ë¼ë”œ</title>
    <meta name="description" content="ëª¨ì—¬ë¼ë”œ ê³µêµ¬ ìƒí’ˆ ìƒì„¸ í˜ì´ì§€">
    <link rel="icon" href="/favicon.ico">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;600;700;800&display=swap" rel="stylesheet">

    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-storage-compat.js"></script>

    <!-- Kakao SDK -->
    <script src="https://t1.kakaocdn.net/kakao_js_sdk/2.5.0/kakao.min.js"></script>

    <!-- Swiper -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css">
    <script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>

    <style>
        :root {
            --color-primary: #fc9600;
            --color-primary-dark: #e88a00;
            --color-primary-light: rgba(252, 150, 0, 0.1);
            --color-text: #222;
            --color-text-sub: #666;
            --color-text-light: #999;
            --color-border: #e5e5e5;
            --color-bg: #fff;
            --color-bg-gray: #f8f8f8;
            --color-bg-dark: #191b30;
            --color-accent: #ffd700;
            --color-success: #00c853;
            --color-error: #ff5252;
            --color-kakao: #fee500;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Noto Sans KR', -apple-system, BlinkMacSystemFont, 'Malgun Gothic', sans-serif;
            font-size: 14px;
            color: var(--color-text);
            background: var(--color-bg);
            line-height: 1.6;
            -webkit-font-smoothing: antialiased;
        }

        a {
            color: inherit;
            text-decoration: none;
        }

        img {
            max-width: 100%;
            vertical-align: top;
        }

        button {
            font-family: inherit;
            cursor: pointer;
        }

        /* í—¤ë” */
        .header {
            position: sticky;
            top: 0;
            z-index: 100;
            background: var(--color-bg);
            border-bottom: 1px solid var(--color-border);
        }

        .header-inner {
            max-width: 1200px;
            margin: 0 auto;
            padding: 12px 20px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .logo img {
            height: 32px;
        }

        .header-nav {
            display: flex;
            gap: 8px;
        }

        .header-nav a {
            padding: 8px 14px;
            font-size: 13px;
            font-weight: 500;
            color: var(--color-text-sub);
            border: 1px solid var(--color-border);
            border-radius: 6px;
            transition: all 0.2s;
        }

        .header-nav a:hover {
            border-color: var(--color-primary);
            color: var(--color-primary);
        }

        /* ë ˆí¼ëŸ´ ë°°ë„ˆ */
        .referral-banner {
            background: linear-gradient(135deg, var(--color-primary) 0%, var(--color-primary-dark) 100%);
            color: #fff;
            padding: 14px 20px;
            display: none;
        }

        .referral-banner.active {
            display: block;
        }

        .referral-banner-inner {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .referral-banner-icon {
            font-size: 24px;
        }

        .referral-banner-text strong {
            font-weight: 700;
        }

        /* ë¡œë”© */
        .loading-wrap {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 100px 20px;
        }

        .loading-spinner {
            width: 40px;
            height: 40px;
            border: 3px solid var(--color-border);
            border-top-color: var(--color-primary);
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
        }

        .loading-text {
            margin-top: 16px;
            color: var(--color-text-sub);
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* ë©”ì¸ ì»¨í…Œì´ë„ˆ */
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }

        /* ìƒí’ˆ ìƒì„¸ ì˜ì—­ */
        .detail-area {
            display: flex;
            gap: 40px;
            padding: 30px 0;
        }

        @media (max-width: 768px) {
            .detail-area {
                flex-direction: column;
                gap: 0;
                padding: 0;
            }
        }

        /* ì´ë¯¸ì§€ ì˜ì—­ */
        .img-area {
            flex: 0 0 500px;
            max-width: 500px;
        }

        @media (max-width: 768px) {
            .img-area {
                flex: none;
                max-width: 100%;
            }
        }

        .prd-img-main {
            position: relative;
            background: var(--color-bg-gray);
            border-radius: 8px;
            overflow: hidden;
        }

        .prd-img-main .swiper-slide img {
            width: 100%;
            aspect-ratio: 1/1;
            object-fit: cover;
        }

        .prd-img-main .swiper-pagination-bullet {
            background: var(--color-text);
            opacity: 0.3;
        }

        .prd-img-main .swiper-pagination-bullet-active {
            background: var(--color-primary);
            opacity: 1;
        }

        .prd-img-thumbs {
            margin-top: 12px;
        }

        .prd-img-thumbs .swiper-slide {
            width: 70px;
            height: 70px;
            border-radius: 6px;
            overflow: hidden;
            border: 2px solid transparent;
            cursor: pointer;
            opacity: 0.6;
            transition: all 0.2s;
        }

        .prd-img-thumbs .swiper-slide-thumb-active {
            border-color: var(--color-primary);
            opacity: 1;
        }

        .prd-img-thumbs .swiper-slide img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        /* ì •ë³´ ì˜ì—­ */
        .info-area {
            flex: 1;
            min-width: 0;
        }

        @media (max-width: 768px) {
            .info-area {
                padding: 20px;
            }
        }

        /* ìƒí’ˆ í—¤ë”© */
        .prd-heading {
            padding-bottom: 20px;
            border-bottom: 1px solid var(--color-border);
        }

        .prd-badges {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
            margin-bottom: 12px;
        }

        .badge {
            display: inline-block;
            padding: 4px 10px;
            font-size: 12px;
            font-weight: 600;
            border-radius: 4px;
        }

        .badge-ongoing {
            background: var(--color-primary-light);
            color: var(--color-primary);
        }

        .badge-upcoming {
            background: rgba(0, 122, 255, 0.1);
            color: #007aff;
        }

        .badge-ended {
            background: #eee;
            color: #999;
        }

        .badge-limited {
            background: var(--color-accent);
            color: #333;
        }

        .badge-hot {
            background: var(--color-error);
            color: #fff;
        }

        .prd-name {
            font-size: 24px;
            font-weight: 700;
            color: var(--color-text);
            line-height: 1.4;
            margin-bottom: 8px;
        }

        @media (max-width: 768px) {
            .prd-name {
                font-size: 20px;
            }
        }

        .prd-subtitle {
            font-size: 14px;
            color: var(--color-text-sub);
        }

        /* ê°€ê²© í…Œì´ë¸” */
        .prd-price-table {
            margin-top: 20px;
        }

        .prd-price-table table {
            width: 100%;
            border-collapse: collapse;
        }

        .prd-price-table th,
        .prd-price-table td {
            padding: 12px 0;
            text-align: left;
            vertical-align: top;
            border-bottom: 1px solid var(--color-border);
        }

        .prd-price-table th {
            width: 100px;
            font-weight: 500;
            color: var(--color-text-sub);
        }

        .original-price {
            color: var(--color-text-light);
            text-decoration: line-through;
            font-size: 14px;
        }

        .sale-price {
            display: flex;
            align-items: baseline;
            gap: 8px;
        }

        .discount-rate {
            font-size: 24px;
            font-weight: 800;
            color: var(--color-primary);
        }

        .current-price {
            font-size: 28px;
            font-weight: 800;
            color: var(--color-text);
        }

        .current-price .won {
            font-size: 18px;
            font-weight: 600;
        }

        /* ì„ ì°©ìˆœ ì´ë²¤íŠ¸ ì„¹ì…˜ */
        .flash-sale-section {
            margin-top: 20px;
            background: var(--color-bg-dark);
            border-radius: 12px;
            padding: 20px;
            color: #fff;
            display: none;
        }

        .flash-sale-section.active {
            display: block;
        }

        .flash-sale-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }

        .flash-sale-title {
            font-size: 16px;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .flash-sale-title::before {
            content: '';
            display: inline-block;
            width: 6px;
            height: 6px;
            background: var(--color-accent);
            border-radius: 50%;
            animation: blink 1s ease-in-out infinite;
        }

        @keyframes blink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.3; }
        }

        .flash-countdown {
            font-size: 18px;
            font-weight: 700;
            font-variant-numeric: tabular-nums;
            background: rgba(255,255,255,0.15);
            padding: 6px 12px;
            border-radius: 6px;
        }

        .flash-progress {
            margin-bottom: 12px;
        }

        .progress-bar {
            height: 8px;
            background: rgba(255,255,255,0.2);
            border-radius: 4px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--color-accent), #ffeb3b);
            border-radius: 4px;
            transition: width 0.5s ease;
        }

        .flash-stats {
            display: flex;
            justify-content: space-between;
            font-size: 13px;
            opacity: 0.8;
            margin-bottom: 16px;
        }

        .flash-sale-btn {
            width: 100%;
            padding: 14px;
            background: #fff;
            color: var(--color-bg-dark);
            border: none;
            border-radius: 8px;
            font-size: 15px;
            font-weight: 700;
            transition: all 0.2s;
        }

        .flash-sale-btn:hover {
            background: var(--color-accent);
        }

        .flash-sale-btn:disabled {
            background: rgba(255,255,255,0.3);
            color: rgba(255,255,255,0.5);
            cursor: not-allowed;
        }

        /* ì•Œë¦¼ ì‹ ì²­ ì„¹ì…˜ */
        .notification-section {
            margin-top: 20px;
            background: var(--color-bg-gray);
            border-radius: 12px;
            padding: 20px;
            display: none;
        }

        .notification-section.active {
            display: block;
        }

        .section-title {
            font-size: 16px;
            font-weight: 700;
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .notification-desc {
            font-size: 14px;
            color: var(--color-text-sub);
            margin-bottom: 16px;
            text-align: center;
        }

        .notification-types {
            display: flex;
            gap: 8px;
            margin-bottom: 12px;
        }

        .notification-type-btn {
            flex: 1;
            padding: 12px;
            border: 2px solid var(--color-border);
            border-radius: 8px;
            background: #fff;
            font-size: 14px;
            font-weight: 600;
            color: var(--color-text-sub);
            transition: all 0.2s;
        }

        .notification-type-btn.active {
            border-color: var(--color-primary);
            background: var(--color-primary-light);
            color: var(--color-primary);
        }

        .form-input {
            width: 100%;
            padding: 14px 16px;
            border: 1px solid var(--color-border);
            border-radius: 8px;
            font-size: 15px;
            margin-bottom: 12px;
            outline: none;
            transition: border-color 0.2s;
        }

        .form-input:focus {
            border-color: var(--color-primary);
        }

        .btn-notification {
            width: 100%;
            padding: 14px;
            background: var(--color-primary);
            color: #fff;
            border: none;
            border-radius: 8px;
            font-size: 15px;
            font-weight: 700;
            transition: background 0.2s;
        }

        .btn-notification:hover {
            background: var(--color-primary-dark);
        }

        .notification-success {
            text-align: center;
            padding: 20px;
            display: none;
        }

        .notification-success.active {
            display: block;
        }

        .notification-success-icon {
            font-size: 48px;
            margin-bottom: 12px;
        }

        .notification-success-text {
            font-size: 16px;
            font-weight: 600;
            color: var(--color-success);
        }

        /* ì¹œêµ¬ ê³µìœ  ì„¹ì…˜ */
        .share-section {
            margin-top: 20px;
            background: linear-gradient(135deg, #fff9e6 0%, #fff5d6 100%);
            border: 1px solid #ffe4a0;
            border-radius: 12px;
            padding: 20px;
        }

        .share-reward-cards {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            margin-bottom: 16px;
        }

        .share-reward-card {
            background: #fff;
            border-radius: 10px;
            padding: 16px;
            text-align: center;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }

        .share-reward-icon {
            font-size: 28px;
            margin-bottom: 8px;
        }

        .share-reward-label {
            font-size: 12px;
            color: var(--color-text-sub);
            margin-bottom: 4px;
        }

        .share-reward-amount {
            font-size: 20px;
            font-weight: 800;
            color: var(--color-primary);
        }

        .share-buttons {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .share-btn-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
        }

        .share-btn {
            padding: 12px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
            transition: all 0.2s;
        }

        .share-btn:active {
            transform: scale(0.98);
        }

        .share-btn-kakao {
            background: var(--color-kakao);
            color: #3c1e1e;
        }

        .share-btn-sms {
            background: var(--color-success);
            color: #fff;
        }

        .share-btn-link {
            background: #fff;
            border: 1px solid var(--color-border);
            color: var(--color-text);
        }

        /* êµ¬ë§¤ ë²„íŠ¼ ì˜ì—­ */
        .action-area {
            margin-top: 24px;
            display: flex;
            gap: 10px;
        }

        .btn-action {
            flex: 1;
            padding: 16px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 700;
            transition: all 0.2s;
        }

        .btn-action:active {
            transform: scale(0.98);
        }

        .btn-buy {
            background: var(--color-primary);
            color: #fff;
        }

        .btn-buy:hover {
            background: var(--color-primary-dark);
        }

        .btn-buy:disabled {
            background: #ccc;
            cursor: not-allowed;
        }

        .btn-share {
            flex: 0 0 auto;
            width: 56px;
            background: var(--color-bg-gray);
            color: var(--color-text);
            font-size: 20px;
        }

        /* êµ¬ë¶„ì„  */
        .section-divider {
            height: 10px;
            background: var(--color-bg-gray);
            margin: 0 -20px;
        }

        @media (min-width: 769px) {
            .section-divider {
                display: none;
            }
        }

        /* ìƒí’ˆ ìƒì„¸ ì •ë³´ */
        .prd-detail-section {
            padding: 30px 0;
        }

        @media (max-width: 768px) {
            .prd-detail-section {
                padding: 20px;
            }
        }

        .prd-detail-content {
            font-size: 15px;
            line-height: 1.8;
            color: var(--color-text);
            white-space: pre-wrap;
        }

        .prd-detail-content img {
            max-width: 100%;
            height: auto;
            margin: 16px 0;
        }

        /* ì ‘ì´ì‹ ì •ë³´ ì„¹ì…˜ */
        .info-fold {
            border-top: 1px solid var(--color-border);
        }

        .info-fold:last-child {
            border-bottom: 1px solid var(--color-border);
        }

        .info-fold-title {
            padding: 16px 20px;
            font-size: 15px;
            font-weight: 600;
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
            transition: background 0.2s;
        }

        .info-fold-title:hover {
            background: var(--color-bg-gray);
        }

        .info-fold-title .icon {
            font-size: 20px;
            color: var(--color-text-sub);
            transition: transform 0.3s;
        }

        .info-fold.open .info-fold-title .icon {
            transform: rotate(45deg);
        }

        .info-fold-content {
            padding: 0 20px 20px;
            display: none;
            font-size: 14px;
            color: var(--color-text-sub);
            line-height: 1.8;
        }

        .info-fold.open .info-fold-content {
            display: block;
        }

        /* í•˜ë‹¨ ê³ ì • ë²„íŠ¼ (ëª¨ë°”ì¼) */
        .bottom-bar {
            display: none;
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: #fff;
            padding: 12px 20px;
            padding-bottom: calc(12px + env(safe-area-inset-bottom));
            box-shadow: 0 -2px 10px rgba(0,0,0,0.1);
            z-index: 100;
        }

        @media (max-width: 768px) {
            .bottom-bar {
                display: block;
            }

            .action-area {
                display: none;
            }
        }

        .bottom-bar-inner {
            display: flex;
            gap: 10px;
        }

        .bottom-bar .btn-buy {
            flex: 1;
        }

        .bottom-bar .btn-share {
            width: 56px;
        }

        /* ëª¨ë‹¬ */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal.active {
            display: flex;
        }

        @media (max-width: 768px) {
            .modal {
                align-items: flex-end;
            }
        }

        .modal-content {
            background: #fff;
            border-radius: 16px;
            padding: 32px 24px;
            max-width: 400px;
            width: 90%;
            animation: modalSlideUp 0.3s ease;
        }

        @media (max-width: 768px) {
            .modal-content {
                max-width: 100%;
                width: 100%;
                border-radius: 20px 20px 0 0;
                padding-bottom: calc(32px + env(safe-area-inset-bottom));
            }
        }

        @keyframes modalSlideUp {
            from {
                transform: translateY(20px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .modal-header {
            text-align: center;
            margin-bottom: 24px;
        }

        .modal-icon {
            font-size: 48px;
            margin-bottom: 12px;
        }

        .modal-title {
            font-size: 20px;
            font-weight: 700;
        }

        .modal-desc {
            font-size: 14px;
            color: var(--color-text-sub);
            margin-top: 8px;
        }

        .referral-link-box {
            background: var(--color-bg-gray);
            border-radius: 10px;
            padding: 14px;
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 20px;
        }

        .referral-link-text {
            flex: 1;
            font-size: 12px;
            color: var(--color-text);
            word-break: break-all;
            font-family: monospace;
        }

        .btn-copy {
            padding: 10px 16px;
            background: var(--color-primary);
            color: #fff;
            border: none;
            border-radius: 6px;
            font-size: 13px;
            font-weight: 600;
            white-space: nowrap;
        }

        .modal-share-buttons {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-bottom: 16px;
        }

        .btn-close-modal {
            width: 100%;
            padding: 14px;
            background: var(--color-bg-gray);
            border: none;
            border-radius: 10px;
            font-size: 15px;
            font-weight: 600;
            color: var(--color-text);
        }

        /* í† ìŠ¤íŠ¸ */
        .toast {
            position: fixed;
            bottom: 100px;
            left: 50%;
            transform: translateX(-50%) translateY(20px);
            background: var(--color-bg-dark);
            color: #fff;
            padding: 14px 24px;
            border-radius: 10px;
            font-size: 14px;
            font-weight: 500;
            z-index: 2000;
            opacity: 0;
            transition: all 0.3s;
            pointer-events: none;
        }

        .toast.active {
            opacity: 1;
            transform: translateX(-50%) translateY(0);
        }

        /* ì—ëŸ¬ í˜ì´ì§€ */
        .error-page {
            display: none;
            text-align: center;
            padding: 100px 20px;
        }

        .error-page.active {
            display: block;
        }

        .error-icon {
            font-size: 64px;
            margin-bottom: 20px;
        }

        .error-title {
            font-size: 20px;
            font-weight: 700;
            margin-bottom: 8px;
        }

        .error-desc {
            color: var(--color-text-sub);
            margin-bottom: 24px;
        }

        .btn-home {
            display: inline-block;
            padding: 12px 24px;
            background: var(--color-primary);
            color: #fff;
            border-radius: 8px;
            font-weight: 600;
        }
    </style>
</head>
<body>
    <!-- í—¤ë” -->
    <header class="header">
        <div class="header-inner">
            <a href="/" class="logo">
                <img src="https://ecimg.cafe24img.com/pg2246b37345376080/moyeora02/web/upload/category/logo/v2_3e5d4a35e206728244d55fa274692f87_zmFfee1NZx_top.jpg" alt="ëª¨ì—¬ë¼ë”œ">
            </a>
            <nav class="header-nav">
                <a href="/consumer/events/">ì´ë²¤íŠ¸</a>
                <a href="/consumer/my-cashback/">ë‚´ ìºì‹œë°±</a>
            </nav>
        </div>
    </header>

    <!-- ë ˆí¼ëŸ´ ë°°ë„ˆ -->
    <div class="referral-banner" id="referralBanner">
        <div class="referral-banner-inner">
            <span class="referral-banner-icon">ğŸ</span>
            <div class="referral-banner-text">
                ì¹œêµ¬ ì´ˆëŒ€ í˜œíƒì´ ì ìš©ë˜ì—ˆìŠµë‹ˆë‹¤! êµ¬ë§¤ ì‹œ <strong id="bannerCashback">3,000</strong>ì› ìºì‹œë°±
            </div>
        </div>
    </div>

    <!-- ë¡œë”© -->
    <div class="loading-wrap" id="loadingWrap">
        <div class="loading-spinner"></div>
        <p class="loading-text">ìƒí’ˆ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>
    </div>

    <!-- ì—ëŸ¬ í˜ì´ì§€ -->
    <div class="error-page" id="errorPage">
        <div class="error-icon">ğŸ˜¢</div>
        <h2 class="error-title">ìƒí’ˆì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤</h2>
        <p class="error-desc">ìš”ì²­í•˜ì‹  ìƒí’ˆì´ ì¡´ì¬í•˜ì§€ ì•Šê±°ë‚˜ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.</p>
        <a href="/" class="btn-home">í™ˆìœ¼ë¡œ ê°€ê¸°</a>
    </div>

    <!-- ë©”ì¸ ì½˜í…ì¸  -->
    <main class="main-content" id="mainContent" style="display: none;">
        <div class="container">
            <div class="detail-area">
                <!-- ì´ë¯¸ì§€ ì˜ì—­ -->
                <div class="img-area">
                    <div class="prd-img-main">
                        <div class="swiper" id="mainSwiper">
                            <div class="swiper-wrapper" id="mainImages"></div>
                            <div class="swiper-pagination"></div>
                        </div>
                    </div>
                    <div class="prd-img-thumbs" id="thumbsWrap" style="display: none;">
                        <div class="swiper" id="thumbsSwiper">
                            <div class="swiper-wrapper" id="thumbImages"></div>
                        </div>
                    </div>
                </div>

                <!-- ì •ë³´ ì˜ì—­ -->
                <div class="info-area">
                    <!-- ìƒí’ˆ í—¤ë”© -->
                    <div class="prd-heading">
                        <div class="prd-badges" id="prdBadges">
                            <span class="badge badge-ongoing" id="statusBadge">ì§„í–‰ì¤‘</span>
                        </div>
                        <h1 class="prd-name" id="prdName">ìƒí’ˆëª…</h1>
                        <p class="prd-subtitle" id="prdSubtitle"></p>
                    </div>

                    <!-- ê°€ê²© í…Œì´ë¸” -->
                    <div class="prd-price-table">
                        <table>
                            <tbody>
                                <tr id="originalPriceRow" style="display: none;">
                                    <th>ì •ê°€</th>
                                    <td><span class="original-price" id="originalPrice">0ì›</span></td>
                                </tr>
                                <tr>
                                    <th>íŒë§¤ê°€</th>
                                    <td>
                                        <div class="sale-price">
                                            <span class="discount-rate" id="discountRate"></span>
                                            <span class="current-price"><span id="currentPrice">0</span><span class="won">ì›</span></span>
                                        </div>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>

                    <!-- ì„ ì°©ìˆœ ì´ë²¤íŠ¸ -->
                    <div class="flash-sale-section" id="flashSaleSection">
                        <div class="flash-sale-header">
                            <span class="flash-sale-title">ì„ ì°©ìˆœ ì´ë²¤íŠ¸</span>
                            <span class="flash-countdown" id="flashCountdown">00:00:00</span>
                        </div>
                        <div class="flash-progress">
                            <div class="progress-bar">
                                <div class="progress-fill" id="flashProgress" style="width: 0%"></div>
                            </div>
                        </div>
                        <div class="flash-stats">
                            <span><strong id="flashCurrent">0</strong>ëª… ì°¸ì—¬</span>
                            <span>ì„ ì°©ìˆœ <strong id="flashTotal">100</strong>ëª…</span>
                        </div>
                        <button class="flash-sale-btn" id="flashSaleBtn" onclick="joinFlashSale()">
                            ì„ ì°©ìˆœ ì´ë²¤íŠ¸ ì°¸ì—¬í•˜ê¸°
                        </button>
                    </div>

                    <!-- ì•Œë¦¼ ì‹ ì²­ (ì˜¤í”ˆ ì˜ˆì •) -->
                    <div class="notification-section" id="notificationSection">
                        <div class="section-title">ğŸ”” ì˜¤í”ˆ ì•Œë¦¼ ì‹ ì²­</div>
                        <div id="notificationForm">
                            <p class="notification-desc">ìƒí’ˆ íŒë§¤ ì˜¤í”ˆ ì‹œ ì•Œë¦¼ì„ ë°›ìœ¼ì„¸ìš”!</p>
                            <div class="notification-types">
                                <button class="notification-type-btn active" data-type="kakao" onclick="selectNotificationType('kakao')">
                                    ğŸ’¬ ì¹´ì¹´ì˜¤í†¡
                                </button>
                                <button class="notification-type-btn" data-type="sms" onclick="selectNotificationType('sms')">
                                    ğŸ“± ë¬¸ì
                                </button>
                            </div>
                            <input type="tel" class="form-input" id="phoneInput" placeholder="ì—°ë½ì²˜ (010-0000-0000)">
                            <button class="btn-notification" onclick="submitNotification()">
                                ì•Œë¦¼ ì‹ ì²­í•˜ê¸°
                            </button>
                        </div>
                        <div class="notification-success" id="notificationSuccess">
                            <div class="notification-success-icon">âœ…</div>
                            <div class="notification-success-text">ì•Œë¦¼ ì‹ ì²­ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!</div>
                        </div>
                    </div>

                    <!-- ì¹œêµ¬ ê³µìœ  -->
                    <div class="share-section">
                        <div class="section-title">ğŸ ì¹œêµ¬ ì´ˆëŒ€í•˜ê³  í•¨ê»˜ í˜œíƒ ë°›ê¸°</div>
                        <div class="share-reward-cards">
                            <div class="share-reward-card">
                                <div class="share-reward-icon">ğŸ˜Š</div>
                                <div class="share-reward-label">ë‚´ê°€ ë°›ëŠ” í˜œíƒ</div>
                                <div class="share-reward-amount" id="referrerReward">5,000ì›</div>
                            </div>
                            <div class="share-reward-card">
                                <div class="share-reward-icon">ğŸ‰</div>
                                <div class="share-reward-label">ì¹œêµ¬ê°€ ë°›ëŠ” í˜œíƒ</div>
                                <div class="share-reward-amount" id="refereeReward">3,000ì›</div>
                            </div>
                        </div>
                        <div class="share-buttons">
                            <div class="share-btn-row">
                                <button class="share-btn share-btn-kakao" onclick="shareKakao()">ğŸ’¬ ì¹´ì¹´ì˜¤í†¡</button>
                                <button class="share-btn share-btn-sms" onclick="shareSMS()">ğŸ“± ë¬¸ì</button>
                            </div>
                            <button class="share-btn share-btn-link" onclick="openShareModal()">ğŸ”— ê³µìœ  ë§í¬ ë³µì‚¬</button>
                        </div>
                    </div>

                    <!-- êµ¬ë§¤ ë²„íŠ¼ (ë°ìŠ¤í¬í†±) -->
                    <div class="action-area">
                        <button class="btn-action btn-share" onclick="openShareModal()">ğŸ”—</button>
                        <button class="btn-action btn-buy" id="btnBuy" onclick="goToCafe24()">êµ¬ë§¤í•˜ê¸°</button>
                    </div>
                </div>
            </div>
        </div>

        <div class="section-divider"></div>

        <!-- ìƒí’ˆ ìƒì„¸ ì •ë³´ -->
        <section class="prd-detail-section">
            <div class="container">
                <div class="section-title">ìƒí’ˆ ì„¤ëª…</div>
                <div class="prd-detail-content" id="prdDescription">
                    ìƒí’ˆ ì„¤ëª…ì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤.
                </div>
            </div>
        </section>

        <!-- ì ‘ì´ì‹ ì •ë³´ ì„¹ì…˜ -->
        <div class="info-folds">
            <div class="info-fold" id="deliveryInfo">
                <div class="info-fold-title" onclick="toggleInfoFold('deliveryInfo')">
                    ë°°ì†¡ ì •ë³´
                    <span class="icon">+</span>
                </div>
                <div class="info-fold-content">
                    <p>â€¢ ë°°ì†¡ ë°©ë²• : íƒë°°</p>
                    <p>â€¢ ë°°ì†¡ ì§€ì—­ : ì „êµ­</p>
                    <p>â€¢ ë°°ì†¡ ë¹„ìš© : ë¬´ë£Œë°°ì†¡ (ì¡°ê±´ë¶€ ë¬´ë£Œë°°ì†¡ ì‹œ 3,000ì›)</p>
                    <p>â€¢ ë°°ì†¡ ê¸°ê°„ : ê²°ì œ ì™„ë£Œ í›„ 2~5ì¼ ì´ë‚´ ë°°ì†¡</p>
                    <p>â€¢ ì œì£¼/ë„ì„œì‚°ê°„ ì§€ì—­ì€ ì¶”ê°€ ë°°ì†¡ë¹„ê°€ ë°œìƒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
                </div>
            </div>
            <div class="info-fold" id="exchangeInfo">
                <div class="info-fold-title" onclick="toggleInfoFold('exchangeInfo')">
                    êµí™˜ ë° ë°˜í’ˆ ì•ˆë‚´
                    <span class="icon">+</span>
                </div>
                <div class="info-fold-content">
                    <p>â€¢ êµí™˜/ë°˜í’ˆ ê¸°ê°„: ìƒí’ˆ ìˆ˜ë ¹ í›„ 7ì¼ ì´ë‚´</p>
                    <p>â€¢ êµí™˜/ë°˜í’ˆ ë¹„ìš©: ë‹¨ìˆœ ë³€ì‹¬ì˜ ê²½ìš° ì™•ë³µ ë°°ì†¡ë¹„ ê³ ê° ë¶€ë‹´</p>
                    <p>â€¢ ìƒí’ˆ ë¶ˆëŸ‰ ë° ì˜¤ë°°ì†¡ì˜ ê²½ìš° ë¬´ë£Œ êµí™˜/ë°˜í’ˆ ê°€ëŠ¥</p>
                    <p>â€¢ ì‚¬ìš© í”ì ì´ ìˆëŠ” ê²½ìš° êµí™˜/ë°˜í’ˆ ë¶ˆê°€</p>
                    <p>â€¢ êµí™˜/ë°˜í’ˆ ì‹ ì²­ì€ ì¹´ì¹´ì˜¤í†¡ ì±„ë„ ë˜ëŠ” ê³ ê°ì„¼í„°ë¡œ ë¬¸ì˜í•´ì£¼ì„¸ìš”.</p>
                </div>
            </div>
            <div class="info-fold" id="serviceInfo">
                <div class="info-fold-title" onclick="toggleInfoFold('serviceInfo')">
                    ì„œë¹„ìŠ¤ ë¬¸ì˜
                    <span class="icon">+</span>
                </div>
                <div class="info-fold-content">
                    <p>â€¢ ì¹´ì¹´ì˜¤í†¡ ì±„ë„: @ëª¨ì—¬ë¼ë”œ</p>
                    <p>â€¢ ë¬¸ì˜ ê°€ëŠ¥ ì‹œê°„: í‰ì¼ 10:00 ~ 18:00 (ì ì‹¬ì‹œê°„ 12:00 ~ 13:00)</p>
                    <p>â€¢ ì£¼ë§ ë° ê³µíœ´ì¼ì€ íœ´ë¬´ì…ë‹ˆë‹¤.</p>
                </div>
            </div>
        </div>
    </main>

    <!-- í•˜ë‹¨ ê³ ì • ë²„íŠ¼ (ëª¨ë°”ì¼) -->
    <div class="bottom-bar" id="bottomBar">
        <div class="bottom-bar-inner">
            <button class="btn-action btn-share" onclick="openShareModal()">ğŸ”—</button>
            <button class="btn-action btn-buy" id="btnBuyMobile" onclick="goToCafe24()">êµ¬ë§¤í•˜ê¸°</button>
        </div>
    </div>

    <!-- ê³µìœ  ëª¨ë‹¬ -->
    <div class="modal" id="shareModal" onclick="closeShareModal(event)">
        <div class="modal-content" onclick="event.stopPropagation()">
            <div class="modal-header">
                <div class="modal-icon">ğŸ</div>
                <h3 class="modal-title">ì¹œêµ¬ ì´ˆëŒ€ ë§í¬</h3>
                <p class="modal-desc">ì´ ë§í¬ë¥¼ ì¹œêµ¬ì—ê²Œ ê³µìœ í•˜ì„¸ìš”!</p>
            </div>
            <div class="referral-link-box">
                <div class="referral-link-text" id="referralLinkText">ìƒì„± ì¤‘...</div>
                <button class="btn-copy" onclick="copyReferralLink()">ë³µì‚¬</button>
            </div>
            <div class="modal-share-buttons">
                <button class="share-btn share-btn-kakao" onclick="shareKakao()">ğŸ’¬ ì¹´ì¹´ì˜¤í†¡</button>
                <button class="share-btn share-btn-sms" onclick="shareSMS()">ğŸ“± ë¬¸ì</button>
            </div>
            <button class="btn-close-modal" onclick="closeShareModal()">ë‹«ê¸°</button>
        </div>
    </div>

    <!-- ì„ ì°©ìˆœ ê²°ê³¼ ëª¨ë‹¬ -->
    <div class="modal" id="flashResultModal" onclick="closeFlashResultModal(event)">
        <div class="modal-content" onclick="event.stopPropagation()">
            <div class="modal-header">
                <div class="modal-icon" id="flashResultIcon">ğŸ‰</div>
                <h3 class="modal-title" id="flashResultTitle">ì¶•í•˜í•©ë‹ˆë‹¤!</h3>
                <p class="modal-desc" id="flashResultDesc">ì„ ì°©ìˆœ ì´ë²¤íŠ¸ì— ë‹¹ì²¨ë˜ì—ˆìŠµë‹ˆë‹¤!</p>
            </div>
            <button class="btn-close-modal" onclick="closeFlashResultModal()">í™•ì¸</button>
        </div>
    </div>

    <!-- í† ìŠ¤íŠ¸ -->
    <div class="toast" id="toast"></div>

    <script>
        // Firebase ì„¤ì •
        const firebaseConfig = {
            apiKey: "AIzaSyAQf_Cu9wMji5QsMBQns5eg6nOD_vmrZMs",
            authDomain: "moyeora-deal-manager.firebaseapp.com",
            projectId: "moyeora-deal-manager",
            storageBucket: "moyeora-deal-manager.firebasestorage.app",
            messagingSenderId: "878495183009",
            appId: "1:878495183009:web:7c7f5f3b6c3d5f5f5f5f5f"
        };

        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        // ì „ì—­ ë³€ìˆ˜
        let currentDeal = null;
        let currentReferralCode = null;
        let cafe24ProductUrl = null;
        let notificationType = 'kakao';
        let flashSaleInterval = null;
        let mainSwiper = null;
        let thumbsSwiper = null;

        // URL íŒŒë¼ë¯¸í„°
        function getUrlParam(param) {
            const urlParams = new URLSearchParams(window.location.search);
            return urlParams.get(param);
        }

        // ì¿ í‚¤ í•¨ìˆ˜
        function setCookie(name, value, days) {
            const d = new Date();
            d.setTime(d.getTime() + (days * 24 * 60 * 60 * 1000));
            document.cookie = name + "=" + value + ";expires=" + d.toUTCString() + ";path=/";
        }

        function getCookie(name) {
            const nameEQ = name + "=";
            const ca = document.cookie.split(';');
            for (let i = 0; i < ca.length; i++) {
                let c = ca[i].trim();
                if (c.indexOf(nameEQ) === 0) return c.substring(nameEQ.length);
            }
            return null;
        }

        // í† ìŠ¤íŠ¸
        function showToast(message) {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.classList.add('active');
            setTimeout(() => toast.classList.remove('active'), 3000);
        }

        // ì ‘ì´ì‹ ì„¹ì…˜ í† ê¸€
        function toggleInfoFold(id) {
            const element = document.getElementById(id);
            element.classList.toggle('open');
        }

        // í˜ì´ì§€ ë¡œë“œ
        window.addEventListener('DOMContentLoaded', async () => {
            const dealId = getUrlParam('id');
            const referralCode = getUrlParam('ref');

            if (!dealId) {
                document.getElementById('loadingWrap').style.display = 'none';
                document.getElementById('errorPage').classList.add('active');
                return;
            }

            // ë ˆí¼ëŸ´ ì½”ë“œ ì²˜ë¦¬
            if (referralCode) {
                setCookie('moyeora_ref', referralCode, 7);
                document.getElementById('referralBanner').classList.add('active');

                try {
                    await db.collection('referrals').doc(referralCode).update({
                        clicks: firebase.firestore.FieldValue.increment(1),
                        lastClickAt: new Date()
                    });
                } catch (e) {
                    console.log('ë ˆí¼ëŸ´ ì¶”ì :', e.message);
                }
            } else {
                const existingRef = getCookie('moyeora_ref');
                if (existingRef) {
                    document.getElementById('referralBanner').classList.add('active');
                }
            }

            await loadDealInfo(dealId);
        });

        // ê³µêµ¬ ì •ë³´ ë¡œë“œ
        async function loadDealInfo(dealId) {
            try {
                const dealDoc = await db.collection('deals').doc(dealId).get();

                if (!dealDoc.exists) {
                    document.getElementById('loadingWrap').style.display = 'none';
                    document.getElementById('errorPage').classList.add('active');
                    return;
                }

                currentDeal = { id: dealDoc.id, ...dealDoc.data() };

                // ì œëª©
                document.getElementById('prdName').textContent = currentDeal.title || 'ê³µêµ¬ ìƒí’ˆ';
                document.getElementById('prdSubtitle').textContent = currentDeal.subtitle || '';
                document.title = `${currentDeal.title || 'ìƒí’ˆ ìƒì„¸'} - ëª¨ì—¬ë¼ë”œ`;

                // ìƒíƒœ ë°°ì§€
                const statusBadge = document.getElementById('statusBadge');
                const status = currentDeal.status || 'ongoing';
                const badgesContainer = document.getElementById('prdBadges');

                if (status === 'ongoing' || status === 'active') {
                    statusBadge.textContent = 'ì§„í–‰ì¤‘';
                    statusBadge.className = 'badge badge-ongoing';
                } else if (status === 'confirmed' || status === 'upcoming') {
                    statusBadge.textContent = 'ì˜¤í”ˆ ì˜ˆì •';
                    statusBadge.className = 'badge badge-upcoming';
                    document.getElementById('notificationSection').classList.add('active');
                } else if (status === 'completed' || status === 'ended') {
                    statusBadge.textContent = 'íŒë§¤ ì¢…ë£Œ';
                    statusBadge.className = 'badge badge-ended';
                    document.getElementById('btnBuy').disabled = true;
                    document.getElementById('btnBuy').textContent = 'íŒë§¤ ì¢…ë£Œ';
                    document.getElementById('btnBuyMobile').disabled = true;
                    document.getElementById('btnBuyMobile').textContent = 'íŒë§¤ ì¢…ë£Œ';
                }

                // ì¶”ê°€ ë±ƒì§€
                if (currentDeal.isLimited) {
                    const limitBadge = document.createElement('span');
                    limitBadge.className = 'badge badge-limited';
                    limitBadge.textContent = 'í•œì •ìˆ˜ëŸ‰';
                    badgesContainer.appendChild(limitBadge);
                }
                if (currentDeal.isHot) {
                    const hotBadge = document.createElement('span');
                    hotBadge.className = 'badge badge-hot';
                    hotBadge.textContent = 'HOT';
                    badgesContainer.appendChild(hotBadge);
                }

                // ê°€ê²©
                if (currentDeal.selectedProducts && currentDeal.selectedProducts.length > 0) {
                    const product = currentDeal.selectedProducts[0];
                    const salePrice = product.supplyPrice || 0;
                    const originalPrice = product.originalPrice || product.retailPrice || salePrice;

                    if (originalPrice > salePrice) {
                        document.getElementById('originalPriceRow').style.display = '';
                        document.getElementById('originalPrice').textContent = originalPrice.toLocaleString() + 'ì›';
                        const discountRate = Math.round((1 - salePrice / originalPrice) * 100);
                        document.getElementById('discountRate').textContent = discountRate + '%';
                    }
                    document.getElementById('currentPrice').textContent = salePrice.toLocaleString();
                }

                // ìºì‹œë°± ê¸ˆì•¡
                const referrerCashback = currentDeal.referrerCashback || 5000;
                const refereeCashback = currentDeal.refereeCashback || 3000;
                document.getElementById('referrerReward').textContent = referrerCashback.toLocaleString() + 'ì›';
                document.getElementById('refereeReward').textContent = refereeCashback.toLocaleString() + 'ì›';
                document.getElementById('bannerCashback').textContent = refereeCashback.toLocaleString();

                // ìƒí’ˆ ì„¤ëª…
                document.getElementById('prdDescription').textContent =
                    currentDeal.description || currentDeal.notes || 'ìƒí’ˆ ì„¤ëª…ì´ ì—†ìŠµë‹ˆë‹¤.';

                // ì´ë¯¸ì§€
                let images = currentDeal.images || [];

                if (images.length === 0 && currentDeal.cafe24ProductNo) {
                    const cafe24BigImg = `https://moyeora02.cafe24.com/web/product/big/${currentDeal.cafe24ProductNo}.jpg`;
                    images = [cafe24BigImg];
                }

                if (images.length === 0 && currentDeal.selectedProducts && currentDeal.selectedProducts.length > 0) {
                    images = currentDeal.selectedProducts
                        .map(p => p.imageUrl || p.image || p.thumbnailUrl || p.thumbnail)
                        .filter(img => img);
                }

                if (images.length === 0) {
                    images = ['https://via.placeholder.com/500x500?text=ìƒí’ˆ+ì´ë¯¸ì§€'];
                }

                // ë©”ì¸ ì´ë¯¸ì§€
                const mainImagesContainer = document.getElementById('mainImages');
                mainImagesContainer.innerHTML = images.map(img =>
                    `<div class="swiper-slide"><img src="${img}" alt="ìƒí’ˆ ì´ë¯¸ì§€" onerror="this.onerror=null; this.src='https://via.placeholder.com/500x500?text=ì´ë¯¸ì§€+ë¡œë“œ+ì‹¤íŒ¨'"></div>`
                ).join('');

                // ì¸ë„¤ì¼ ì´ë¯¸ì§€ (2ê°œ ì´ìƒì¼ ë•Œë§Œ)
                if (images.length > 1) {
                    document.getElementById('thumbsWrap').style.display = 'block';
                    const thumbImagesContainer = document.getElementById('thumbImages');
                    thumbImagesContainer.innerHTML = images.map(img =>
                        `<div class="swiper-slide"><img src="${img}" alt="ì¸ë„¤ì¼"></div>`
                    ).join('');

                    // ì¸ë„¤ì¼ Swiper ë¨¼ì € ì´ˆê¸°í™”
                    thumbsSwiper = new Swiper('#thumbsSwiper', {
                        spaceBetween: 10,
                        slidesPerView: 'auto',
                        freeMode: true,
                        watchSlidesProgress: true,
                    });

                    // ë©”ì¸ Swiper ì´ˆê¸°í™” (ì¸ë„¤ì¼ ì—°ë™)
                    mainSwiper = new Swiper('#mainSwiper', {
                        spaceBetween: 10,
                        pagination: {
                            el: '.swiper-pagination',
                            clickable: true
                        },
                        thumbs: {
                            swiper: thumbsSwiper
                        }
                    });
                } else {
                    // ì´ë¯¸ì§€ 1ê°œì¼ ë•Œ
                    mainSwiper = new Swiper('#mainSwiper', {
                        pagination: {
                            el: '.swiper-pagination',
                            clickable: true
                        }
                    });
                }

                // ì„ ì°©ìˆœ ì´ë²¤íŠ¸
                if (currentDeal.flashSale && currentDeal.flashSale.enabled) {
                    initFlashSale(currentDeal.flashSale);
                }

                // ì¹´í˜24 URL
                if (currentDeal.cafe24ProductUrl) {
                    cafe24ProductUrl = currentDeal.cafe24ProductUrl;
                } else if (currentDeal.cafe24ProductNo) {
                    cafe24ProductUrl = `https://moyeora02.cafe24.com/product/detail.html?product_no=${currentDeal.cafe24ProductNo}`;
                }

                // UI í‘œì‹œ
                document.getElementById('loadingWrap').style.display = 'none';
                document.getElementById('mainContent').style.display = 'block';

            } catch (error) {
                console.error('ìƒí’ˆ ì •ë³´ ë¡œë“œ ì˜¤ë¥˜:', error);
                document.getElementById('loadingWrap').style.display = 'none';
                document.getElementById('errorPage').classList.add('active');
            }
        }

        // ì„ ì°©ìˆœ ì´ë²¤íŠ¸ ì´ˆê¸°í™”
        function initFlashSale(flashSale) {
            const section = document.getElementById('flashSaleSection');
            section.classList.add('active');

            const total = flashSale.totalSlots || 100;
            const current = flashSale.currentCount || 0;
            const endTime = flashSale.endTime?.toDate ? flashSale.endTime.toDate() : new Date(flashSale.endTime);

            document.getElementById('flashTotal').textContent = total;
            document.getElementById('flashCurrent').textContent = current;
            document.getElementById('flashProgress').style.width = (current / total * 100) + '%';

            if (current >= total) {
                document.getElementById('flashSaleBtn').disabled = true;
                document.getElementById('flashSaleBtn').textContent = 'ë§ˆê°ë˜ì—ˆìŠµë‹ˆë‹¤';
                return;
            }

            // ì¹´ìš´íŠ¸ë‹¤ìš´
            flashSaleInterval = setInterval(() => {
                const now = new Date();
                const diff = endTime - now;

                if (diff <= 0) {
                    clearInterval(flashSaleInterval);
                    document.getElementById('flashCountdown').textContent = 'ì¢…ë£Œ';
                    document.getElementById('flashSaleBtn').disabled = true;
                    document.getElementById('flashSaleBtn').textContent = 'ì´ë²¤íŠ¸ ì¢…ë£Œ';
                    return;
                }

                const hours = Math.floor(diff / 3600000);
                const mins = Math.floor((diff % 3600000) / 60000);
                const secs = Math.floor((diff % 60000) / 1000);
                document.getElementById('flashCountdown').textContent =
                    `${String(hours).padStart(2, '0')}:${String(mins).padStart(2, '0')}:${String(secs).padStart(2, '0')}`;
            }, 1000);
        }

        // ì„ ì°©ìˆœ ì´ë²¤íŠ¸ ì°¸ì—¬
        async function joinFlashSale() {
            if (!currentDeal || !currentDeal.flashSale) return;

            const btn = document.getElementById('flashSaleBtn');
            btn.disabled = true;
            btn.textContent = 'ì°¸ì—¬ ì¤‘...';

            try {
                const phoneInput = document.getElementById('phoneInput');
                let phone = phoneInput?.value?.trim() || getCookie('moyeora_phone') || '';

                if (!phone) {
                    phone = prompt('ì„ ì°©ìˆœ ì´ë²¤íŠ¸ ì°¸ì—¬ë¥¼ ìœ„í•´ ì—°ë½ì²˜ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.\n(ì˜ˆ: 010-1234-5678)');
                    if (!phone) {
                        btn.disabled = false;
                        btn.textContent = 'ì„ ì°©ìˆœ ì´ë²¤íŠ¸ ì°¸ì—¬í•˜ê¸°';
                        return;
                    }
                    setCookie('moyeora_phone', phone, 30);
                }

                const dealRef = db.collection('deals').doc(currentDeal.id);
                const result = await db.runTransaction(async (transaction) => {
                    const dealDoc = await transaction.get(dealRef);
                    const flashSale = dealDoc.data().flashSale;

                    const current = flashSale.currentCount || 0;
                    const total = flashSale.totalSlots || 100;

                    if (current >= total) {
                        throw new Error('ë§ˆê°ë˜ì—ˆìŠµë‹ˆë‹¤');
                    }

                    const participantRef = db.collection('flashSaleParticipants').doc();
                    transaction.set(participantRef, {
                        dealId: currentDeal.id,
                        phone: phone,
                        participatedAt: new Date(),
                        position: current + 1
                    });

                    transaction.update(dealRef, {
                        'flashSale.currentCount': current + 1
                    });

                    return { position: current + 1, total };
                });

                document.getElementById('flashResultIcon').textContent = 'ğŸ‰';
                document.getElementById('flashResultTitle').textContent = 'ì¶•í•˜í•©ë‹ˆë‹¤!';
                document.getElementById('flashResultDesc').textContent =
                    `${result.position}/${result.total}ë²ˆì§¸ë¡œ ì°¸ì—¬í•˜ì…¨ìŠµë‹ˆë‹¤!`;
                document.getElementById('flashResultModal').classList.add('active');

                document.getElementById('flashCurrent').textContent = result.position;
                document.getElementById('flashProgress').style.width = (result.position / result.total * 100) + '%';
                btn.textContent = 'ì°¸ì—¬ ì™„ë£Œ!';

            } catch (error) {
                console.error('ì„ ì°©ìˆœ ì°¸ì—¬ ì˜¤ë¥˜:', error);

                if (error.message === 'ë§ˆê°ë˜ì—ˆìŠµë‹ˆë‹¤') {
                    document.getElementById('flashResultIcon').textContent = 'ğŸ˜¢';
                    document.getElementById('flashResultTitle').textContent = 'ì•„ì‰½ê²Œë„...';
                    document.getElementById('flashResultDesc').textContent = 'ì„ ì°©ìˆœì´ ë§ˆê°ë˜ì—ˆìŠµë‹ˆë‹¤.';
                } else {
                    document.getElementById('flashResultIcon').textContent = 'âš ï¸';
                    document.getElementById('flashResultTitle').textContent = 'ì˜¤ë¥˜ ë°œìƒ';
                    document.getElementById('flashResultDesc').textContent = 'ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.';
                    btn.disabled = false;
                    btn.textContent = 'ì„ ì°©ìˆœ ì´ë²¤íŠ¸ ì°¸ì—¬í•˜ê¸°';
                }
                document.getElementById('flashResultModal').classList.add('active');
            }
        }

        function closeFlashResultModal(event) {
            if (event && event.target !== event.currentTarget) return;
            document.getElementById('flashResultModal').classList.remove('active');
        }

        // ì•Œë¦¼ ì‹ ì²­
        function selectNotificationType(type) {
            notificationType = type;
            document.querySelectorAll('.notification-type-btn').forEach(btn => {
                btn.classList.toggle('active', btn.dataset.type === type);
            });
        }

        async function submitNotification() {
            const phone = document.getElementById('phoneInput').value.trim();

            if (!phone) {
                showToast('ì—°ë½ì²˜ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }

            const phoneRegex = /^01[0-9]-?[0-9]{3,4}-?[0-9]{4}$/;
            if (!phoneRegex.test(phone.replace(/-/g, ''))) {
                showToast('ì˜¬ë°”ë¥¸ ì „í™”ë²ˆí˜¸ í˜•ì‹ì´ ì•„ë‹™ë‹ˆë‹¤.');
                return;
            }

            try {
                await db.collection('notifications').add({
                    dealId: currentDeal.id,
                    dealTitle: currentDeal.title,
                    phone: phone,
                    type: notificationType,
                    createdAt: new Date(),
                    status: 'pending'
                });

                setCookie('moyeora_phone', phone, 30);

                document.getElementById('notificationForm').style.display = 'none';
                document.getElementById('notificationSuccess').classList.add('active');
                showToast('ì•Œë¦¼ ì‹ ì²­ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!');

            } catch (error) {
                console.error('ì•Œë¦¼ ì‹ ì²­ ì˜¤ë¥˜:', error);
                showToast('ì•Œë¦¼ ì‹ ì²­ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');
            }
        }

        // ì¹´í˜24ë¡œ ì´ë™
        function goToCafe24() {
            if (!cafe24ProductUrl) {
                showToast('êµ¬ë§¤ í˜ì´ì§€ ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }

            const referralCode = getCookie('moyeora_ref');
            let url = cafe24ProductUrl;

            if (referralCode) {
                const separator = url.includes('?') ? '&' : '?';
                url = `${url}${separator}ref=${referralCode}`;
            }

            window.location.href = url;
        }

        // ê³µìœ  ê¸°ëŠ¥
        async function generateReferralCode() {
            if (currentReferralCode) return currentReferralCode;

            const userId = 'user_' + Date.now() + '_' + Math.random().toString(36).substring(2, 6);

            let code;
            let attempts = 0;
            while (attempts < 5) {
                code = Math.random().toString(36).substring(2, 10).toUpperCase();
                const existing = await db.collection('referrals').doc(code).get();
                if (!existing.exists) break;
                attempts++;
            }

            const referralData = {
                referralCode: code,
                referrerId: userId,
                dealId: currentDeal.id,
                dealTitle: currentDeal.title || '',
                createdAt: new Date(),
                expiresAt: new Date(Date.now() + 30 * 24 * 60 * 60 * 1000),
                clicks: 0,
                conversions: 0,
                totalSales: 0,
                referrerCashback: 0,
                refereeCashback: 0,
                status: 'active',
                purchases: []
            };

            await db.collection('referrals').doc(code).set(referralData);
            currentReferralCode = code;
            return code;
        }

        function getReferralLink() {
            return `${window.location.origin}/consumer/product/?id=${currentDeal.id}&ref=${currentReferralCode}`;
        }

        async function openShareModal() {
            if (!currentDeal) {
                showToast('ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');
                return;
            }

            try {
                await generateReferralCode();
                document.getElementById('referralLinkText').textContent = getReferralLink();
                document.getElementById('shareModal').classList.add('active');
            } catch (error) {
                console.error('ê³µìœ  ë§í¬ ìƒì„± ì˜¤ë¥˜:', error);
                showToast('ê³µìœ  ë§í¬ ìƒì„±ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
            }
        }

        function closeShareModal(event) {
            if (event && event.target !== event.currentTarget) return;
            document.getElementById('shareModal').classList.remove('active');
        }

        async function copyReferralLink() {
            if (!currentReferralCode) await generateReferralCode();

            try {
                await navigator.clipboard.writeText(getReferralLink());
                showToast('ë§í¬ê°€ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!');
            } catch (error) {
                // Fallback for older browsers
                const textArea = document.createElement('textarea');
                textArea.value = getReferralLink();
                document.body.appendChild(textArea);
                textArea.select();
                document.execCommand('copy');
                document.body.removeChild(textArea);
                showToast('ë§í¬ê°€ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!');
            }
        }

        async function shareKakao() {
            if (!currentReferralCode) await generateReferralCode();

            if (typeof Kakao === 'undefined' || !Kakao.isInitialized()) {
                try {
                    Kakao.init('2e874ef8e5b6a792564592d49632a83e');
                } catch (e) {
                    showToast('ì¹´ì¹´ì˜¤í†¡ ê³µìœ ë¥¼ ì‚¬ìš©í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                    return;
                }
            }

            const referralLink = getReferralLink();
            const refereeCashback = currentDeal.refereeCashback || 3000;

            Kakao.Share.sendDefault({
                objectType: 'feed',
                content: {
                    title: `ğŸ ${currentDeal.title}`,
                    description: `ì¹œêµ¬ ì´ˆëŒ€ í˜œíƒ! ì§€ê¸ˆ êµ¬ë§¤í•˜ë©´ ${refereeCashback.toLocaleString()}ì› ìºì‹œë°±`,
                    imageUrl: currentDeal.images?.[0] || 'https://moyeoradeal.shop/images/share-thumbnail.jpg',
                    link: {
                        mobileWebUrl: referralLink,
                        webUrl: referralLink
                    }
                },
                buttons: [{
                    title: 'ìƒí’ˆ ë³´ê¸°',
                    link: {
                        mobileWebUrl: referralLink,
                        webUrl: referralLink
                    }
                }]
            });
        }

        async function shareSMS() {
            if (!currentReferralCode) await generateReferralCode();

            const referralLink = getReferralLink();
            const refereeCashback = currentDeal.refereeCashback || 3000;
            const message = `ğŸ ${currentDeal.title}\n\nì¹œêµ¬ ì´ˆëŒ€ í˜œíƒìœ¼ë¡œ ${refereeCashback.toLocaleString()}ì› ìºì‹œë°± ë°›ìœ¼ì„¸ìš”!\n\n${referralLink}`;

            window.location.href = `sms:?body=${encodeURIComponent(message)}`;
        }
    </script>
</body>
</html>
