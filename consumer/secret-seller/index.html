<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì‹œí¬ë¦¿ ì…€ëŸ¬ ì „ìš© - ëª¨ì—¬ë¼ë”œ</title>
    <meta name="description" content="ì…€ëŸ¬ ì „ìš© íŠ¹ë³„ ìƒí’ˆ í˜ì´ì§€">
    <link rel="icon" href="/favicon.ico">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;600;700;800&display=swap" rel="stylesheet">

    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>

    <!-- Kakao SDK -->
    <script src="https://t1.kakaocdn.net/kakao_js_sdk/2.5.0/kakao.min.js"></script>

    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Noto Sans KR', -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            color: #fff;
            line-height: 1.6;
            min-height: 100vh;
        }

        /* í—¤ë” */
        .header {
            background: rgba(0,0,0,0.3);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid rgba(255,255,255,0.1);
            padding: 16px 20px;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header-content {
            max-width: 480px;
            margin: 0 auto;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .logo {
            font-size: 22px;
            font-weight: 800;
            background: linear-gradient(135deg, #ffd700, #ff6b6b);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-decoration: none;
        }

        .secret-badge {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 6px 12px;
            background: linear-gradient(135deg, #ffd700, #ff6b6b);
            border-radius: 20px;
            font-size: 12px;
            font-weight: 700;
            color: #1a1a2e;
        }

        /* ì»¨í…Œì´ë„ˆ */
        .container {
            max-width: 480px;
            margin: 0 auto;
            padding: 20px;
            padding-bottom: 120px;
        }

        /* ì¸ì¦ í•„ìš” ì„¹ì…˜ */
        .auth-section {
            background: rgba(255,255,255,0.05);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 20px;
            padding: 40px 20px;
            text-align: center;
            margin-top: 60px;
        }

        .auth-icon {
            font-size: 64px;
            margin-bottom: 20px;
        }

        .auth-title {
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 12px;
        }

        .auth-desc {
            font-size: 14px;
            color: rgba(255,255,255,0.7);
            margin-bottom: 24px;
        }

        .auth-form {
            max-width: 300px;
            margin: 0 auto;
        }

        .auth-input {
            width: 100%;
            padding: 16px;
            background: rgba(255,255,255,0.1);
            border: 1px solid rgba(255,255,255,0.2);
            border-radius: 12px;
            font-size: 16px;
            color: white;
            text-align: center;
            letter-spacing: 4px;
            margin-bottom: 16px;
        }

        .auth-input::placeholder {
            color: rgba(255,255,255,0.4);
            letter-spacing: normal;
        }

        .auth-input:focus {
            outline: none;
            border-color: #ffd700;
        }

        .btn-auth {
            width: 100%;
            padding: 16px;
            background: linear-gradient(135deg, #ffd700, #ff6b6b);
            color: #1a1a2e;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 700;
            cursor: pointer;
        }

        /* ì…€ëŸ¬ ì›°ì»´ */
        .welcome-section {
            text-align: center;
            margin-bottom: 30px;
            padding-top: 20px;
        }

        .welcome-emoji {
            font-size: 48px;
            margin-bottom: 12px;
        }

        .welcome-title {
            font-size: 24px;
            font-weight: 800;
            margin-bottom: 8px;
            background: linear-gradient(135deg, #ffd700, #ff6b6b);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .welcome-subtitle {
            font-size: 14px;
            color: rgba(255,255,255,0.7);
        }

        /* íŠ¹ë³„ í˜œíƒ ë°°ë„ˆ */
        .benefit-banner {
            background: linear-gradient(135deg, rgba(255,215,0,0.2), rgba(255,107,107,0.2));
            border: 1px solid rgba(255,215,0,0.3);
            border-radius: 16px;
            padding: 20px;
            margin-bottom: 24px;
        }

        .benefit-title {
            font-size: 16px;
            font-weight: 700;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .benefit-list {
            list-style: none;
        }

        .benefit-list li {
            font-size: 14px;
            color: rgba(255,255,255,0.9);
            padding: 8px 0;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .benefit-list li:last-child {
            border-bottom: none;
        }

        /* ìƒí’ˆ ê·¸ë¦¬ë“œ */
        .products-section {
            margin-bottom: 24px;
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }

        .section-title {
            font-size: 18px;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .product-count {
            font-size: 13px;
            color: rgba(255,255,255,0.6);
        }

        .products-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
        }

        .product-card {
            background: rgba(255,255,255,0.08);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 16px;
            overflow: hidden;
            cursor: pointer;
            transition: all 0.3s;
        }

        .product-card:hover {
            transform: translateY(-4px);
            border-color: rgba(255,215,0,0.5);
        }

        .product-image {
            width: 100%;
            aspect-ratio: 1;
            object-fit: cover;
        }

        .product-content {
            padding: 12px;
        }

        .product-seller-badge {
            display: inline-block;
            padding: 3px 8px;
            background: linear-gradient(135deg, #ffd700, #ff6b6b);
            border-radius: 4px;
            font-size: 10px;
            font-weight: 700;
            color: #1a1a2e;
            margin-bottom: 8px;
        }

        .product-title {
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 8px;
            line-height: 1.4;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .product-price-section {
            display: flex;
            align-items: baseline;
            gap: 6px;
        }

        .product-discount {
            font-size: 14px;
            font-weight: 700;
            color: #ff6b6b;
        }

        .product-price {
            font-size: 16px;
            font-weight: 700;
        }

        .product-original-price {
            font-size: 12px;
            color: rgba(255,255,255,0.4);
            text-decoration: line-through;
        }

        /* ì¶”ê°€ í˜œíƒ ì„¹ì…˜ */
        .extra-benefits {
            background: rgba(255,255,255,0.05);
            border-radius: 16px;
            padding: 20px;
            margin-bottom: 24px;
        }

        .extra-title {
            font-size: 16px;
            font-weight: 700;
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .benefit-cards {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
        }

        .benefit-card {
            background: rgba(255,255,255,0.08);
            border-radius: 12px;
            padding: 16px;
            text-align: center;
        }

        .benefit-card-icon {
            font-size: 32px;
            margin-bottom: 8px;
        }

        .benefit-card-title {
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 4px;
        }

        .benefit-card-value {
            font-size: 18px;
            font-weight: 800;
            background: linear-gradient(135deg, #ffd700, #ff6b6b);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        /* ê³µìœ  ì„¹ì…˜ */
        .share-section {
            background: rgba(255,255,255,0.05);
            border-radius: 16px;
            padding: 20px;
        }

        .share-title {
            font-size: 16px;
            font-weight: 700;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .share-desc {
            font-size: 14px;
            color: rgba(255,255,255,0.7);
            margin-bottom: 16px;
        }

        .share-buttons {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
        }

        .share-btn {
            padding: 14px;
            border: none;
            border-radius: 10px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
        }

        .share-btn-kakao {
            background: #fee500;
            color: #3c1e1e;
        }

        .share-btn-link {
            background: rgba(255,255,255,0.1);
            color: white;
            border: 1px solid rgba(255,255,255,0.2);
        }

        /* í•˜ë‹¨ ê³ ì • */
        .bottom-bar {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(26,26,46,0.95);
            backdrop-filter: blur(10px);
            border-top: 1px solid rgba(255,255,255,0.1);
            padding: 12px 20px;
            z-index: 100;
        }

        .bottom-bar-content {
            max-width: 480px;
            margin: 0 auto;
            display: flex;
            gap: 10px;
        }

        .btn-primary {
            flex: 1;
            padding: 16px;
            background: linear-gradient(135deg, #ffd700, #ff6b6b);
            color: #1a1a2e;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 700;
            cursor: pointer;
        }

        .btn-secondary {
            padding: 16px 20px;
            background: rgba(255,255,255,0.1);
            color: white;
            border: 1px solid rgba(255,255,255,0.2);
            border-radius: 12px;
            font-size: 16px;
            cursor: pointer;
        }

        /* ëª¨ë‹¬ */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(4px);
            z-index: 9999;
            align-items: center;
            justify-content: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: #1a1a2e;
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 20px;
            padding: 30px;
            max-width: 400px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-header {
            text-align: center;
            margin-bottom: 20px;
        }

        .modal-icon {
            font-size: 48px;
            margin-bottom: 12px;
        }

        .modal-title {
            font-size: 20px;
            font-weight: 700;
        }

        .modal-desc {
            font-size: 14px;
            color: rgba(255,255,255,0.7);
            margin-top: 8px;
        }

        .modal-product-info {
            background: rgba(255,255,255,0.05);
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 20px;
        }

        .modal-product-title {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 8px;
        }

        .modal-product-price {
            font-size: 20px;
            font-weight: 800;
            background: linear-gradient(135deg, #ffd700, #ff6b6b);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .btn-modal-primary {
            width: 100%;
            padding: 16px;
            background: linear-gradient(135deg, #ffd700, #ff6b6b);
            color: #1a1a2e;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 700;
            cursor: pointer;
            margin-bottom: 10px;
        }

        .btn-modal-secondary {
            width: 100%;
            padding: 14px;
            background: transparent;
            color: rgba(255,255,255,0.7);
            border: 1px solid rgba(255,255,255,0.2);
            border-radius: 12px;
            font-size: 15px;
            cursor: pointer;
        }

        /* í† ìŠ¤íŠ¸ */
        .toast {
            position: fixed;
            bottom: 100px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(255,255,255,0.95);
            color: #1a1a2e;
            padding: 14px 24px;
            border-radius: 10px;
            font-size: 14px;
            font-weight: 500;
            z-index: 10000;
            opacity: 0;
            transition: opacity 0.3s;
        }

        .toast.active {
            opacity: 1;
        }

        /* ë¡œë”© */
        .loading {
            text-align: center;
            padding: 60px 20px;
        }

        .loading-spinner {
            width: 40px;
            height: 40px;
            border: 3px solid rgba(255,255,255,0.1);
            border-top: 3px solid #ffd700;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 16px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* ìˆ¨ê¹€ í´ë˜ìŠ¤ */
        .hidden {
            display: none !important;
        }
    </style>
</head>
<body>
    <!-- í—¤ë” -->
    <div class="header">
        <div class="header-content">
            <a href="/" class="logo">ëª¨ì—¬ë¼ë”œ</a>
            <div class="secret-badge" id="secretBadge" style="display: none;">
                <span>VIP</span> SECRET SELLER
            </div>
        </div>
    </div>

    <div class="container">
        <!-- ì¸ì¦ ì„¹ì…˜ -->
        <div class="auth-section" id="authSection">
            <div class="auth-icon">ğŸ”</div>
            <h1 class="auth-title">ì‹œí¬ë¦¿ ì…€ëŸ¬ ì „ìš©</h1>
            <p class="auth-desc">
                ì´ í˜ì´ì§€ëŠ” ì´ˆëŒ€ë°›ì€ ì…€ëŸ¬ë§Œ ì ‘ê·¼í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.<br>
                ì „ë‹¬ë°›ì€ ì‹œí¬ë¦¿ ì½”ë“œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.
            </p>
            <div class="auth-form">
                <input type="text" class="auth-input" id="secretCodeInput"
                    placeholder="ì‹œí¬ë¦¿ ì½”ë“œ ì…ë ¥" maxlength="8"
                    oninput="this.value = this.value.toUpperCase()">
                <button class="btn-auth" onclick="verifySecretCode()">ì ‘ì†í•˜ê¸°</button>
            </div>
        </div>

        <!-- ë©”ì¸ ì½˜í…ì¸  (ì¸ì¦ í›„ í‘œì‹œ) -->
        <div id="mainContent" class="hidden">
            <!-- ì›°ì»´ ë©”ì‹œì§€ -->
            <div class="welcome-section">
                <div class="welcome-emoji">ğŸŒŸ</div>
                <h1 class="welcome-title" id="sellerWelcome">VIP ì…€ëŸ¬ë‹˜, í™˜ì˜í•©ë‹ˆë‹¤!</h1>
                <p class="welcome-subtitle">íŠ¹ë³„íˆ ì¤€ë¹„ëœ ìƒí’ˆì„ ë§Œë‚˜ë³´ì„¸ìš”</p>
            </div>

            <!-- íŠ¹ë³„ í˜œíƒ ë°°ë„ˆ -->
            <div class="benefit-banner">
                <div class="benefit-title">
                    <span>ğŸ‘‘</span> ì‹œí¬ë¦¿ ì…€ëŸ¬ ì „ìš© í˜œíƒ
                </div>
                <ul class="benefit-list">
                    <li><span>âœ¨</span> ì¼ë°˜ ê°€ê²© ëŒ€ë¹„ ìµœëŒ€ 30% ì¶”ê°€ í• ì¸</li>
                    <li><span>ğŸ</span> êµ¬ë§¤ ì‹œ ì¶”ê°€ ìºì‹œë°± +5,000ì›</li>
                    <li><span>ğŸš€</span> ë¬´ë£Œ ë°°ì†¡ + ìµì¼ ì¶œê³ </li>
                    <li><span>ğŸ’</span> ì‹œí¬ë¦¿ ì „ìš© í•œì • ìƒí’ˆ</li>
                </ul>
            </div>

            <!-- ì‹œí¬ë¦¿ ìƒí’ˆ -->
            <div class="products-section">
                <div class="section-header">
                    <div class="section-title">
                        <span>ğŸ”¥</span> ì‹œí¬ë¦¿ ìƒí’ˆ
                    </div>
                    <span class="product-count" id="productCount">0ê°œ ìƒí’ˆ</span>
                </div>
                <div class="products-grid" id="productsGrid">
                    <div class="loading">
                        <div class="loading-spinner"></div>
                    </div>
                </div>
            </div>

            <!-- ì¶”ê°€ í˜œíƒ -->
            <div class="extra-benefits">
                <div class="extra-title">
                    <span>ğŸ’°</span> ì´ë²ˆ ë‹¬ í˜œíƒ í˜„í™©
                </div>
                <div class="benefit-cards">
                    <div class="benefit-card">
                        <div class="benefit-card-icon">ğŸ›’</div>
                        <div class="benefit-card-title">ëˆ„ì  êµ¬ë§¤</div>
                        <div class="benefit-card-value" id="totalPurchases">0íšŒ</div>
                    </div>
                    <div class="benefit-card">
                        <div class="benefit-card-icon">ğŸ’</div>
                        <div class="benefit-card-title">ëˆ„ì  ìºì‹œë°±</div>
                        <div class="benefit-card-value" id="totalCashback">0ì›</div>
                    </div>
                    <div class="benefit-card">
                        <div class="benefit-card-icon">ğŸ‘¥</div>
                        <div class="benefit-card-title">ì´ˆëŒ€í•œ ì¹œêµ¬</div>
                        <div class="benefit-card-value" id="invitedFriends">0ëª…</div>
                    </div>
                    <div class="benefit-card">
                        <div class="benefit-card-icon">ğŸ†</div>
                        <div class="benefit-card-title">VIP ë“±ê¸‰</div>
                        <div class="benefit-card-value" id="vipLevel">GOLD</div>
                    </div>
                </div>
            </div>

            <!-- ì¹œêµ¬ ì´ˆëŒ€ -->
            <div class="share-section">
                <div class="share-title">
                    <span>ğŸ</span> ì¹œêµ¬ ì´ˆëŒ€í•˜ê¸°
                </div>
                <p class="share-desc">
                    ì¹œêµ¬ë¥¼ ì´ˆëŒ€í•˜ë©´ ë‘˜ ë‹¤ ì¶”ê°€ ìºì‹œë°±!<br>
                    ë‚˜: 10,000ì› / ì¹œêµ¬: 5,000ì›
                </p>
                <div class="share-buttons">
                    <button class="share-btn share-btn-kakao" onclick="shareKakao()">
                        ğŸ’¬ ì¹´ì¹´ì˜¤í†¡
                    </button>
                    <button class="share-btn share-btn-link" onclick="copyShareLink()">
                        ğŸ”— ë§í¬ ë³µì‚¬
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- í•˜ë‹¨ ë°” (ì¸ì¦ í›„ í‘œì‹œ) -->
    <div class="bottom-bar hidden" id="bottomBar">
        <div class="bottom-bar-content">
            <button class="btn-secondary" onclick="location.href='/consumer/my-cashback/'">
                ë‚´ ìºì‹œë°±
            </button>
            <button class="btn-primary" id="btnBuySelected" onclick="buySelectedProduct()">
                ì„ íƒ ìƒí’ˆ êµ¬ë§¤
            </button>
        </div>
    </div>

    <!-- ìƒí’ˆ ìƒì„¸ ëª¨ë‹¬ -->
    <div class="modal" id="productModal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-icon">ğŸ›ï¸</div>
                <h3 class="modal-title">ì‹œí¬ë¦¿ ìƒí’ˆ</h3>
                <p class="modal-desc">ì…€ëŸ¬ ì „ìš© íŠ¹ë³„ê°€ë¡œ ë§Œë‚˜ë³´ì„¸ìš”</p>
            </div>

            <div class="modal-product-info">
                <div class="modal-product-title" id="modalProductTitle">ìƒí’ˆëª…</div>
                <div class="modal-product-price" id="modalProductPrice">0ì›</div>
            </div>

            <button class="btn-modal-primary" onclick="goToCafe24FromModal()">
                êµ¬ë§¤í•˜ëŸ¬ ê°€ê¸°
            </button>
            <button class="btn-modal-secondary" onclick="closeProductModal()">
                ë‹«ê¸°
            </button>
        </div>
    </div>

    <!-- í† ìŠ¤íŠ¸ -->
    <div class="toast" id="toast"></div>

    <script>
        // Firebase ì„¤ì •
        const firebaseConfig = {
            apiKey: "AIzaSyAQf_Cu9wMji5QsMBQns5eg6nOD_vmrZMs",
            authDomain: "moyeora-deal-manager.firebaseapp.com",
            projectId: "moyeora-deal-manager",
            storageBucket: "moyeora-deal-manager.firebasestorage.app",
            messagingSenderId: "878495183009",
            appId: "1:878495183009:web:7c7f5f3b6c3d5f5f5f5f5f"
        };

        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        // ì „ì—­ ë³€ìˆ˜
        let currentSeller = null;
        let secretProducts = [];
        let selectedProduct = null;

        // í† ìŠ¤íŠ¸
        function showToast(message) {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.classList.add('active');
            setTimeout(() => toast.classList.remove('active'), 3000);
        }

        // URL íŒŒë¼ë¯¸í„°
        function getUrlParam(param) {
            return new URLSearchParams(window.location.search).get(param);
        }

        // í˜ì´ì§€ ë¡œë“œ
        window.addEventListener('DOMContentLoaded', () => {
            const code = getUrlParam('code');
            if (code) {
                document.getElementById('secretCodeInput').value = code.toUpperCase();
                verifySecretCode();
            }
        });

        // ì‹œí¬ë¦¿ ì½”ë“œ ê²€ì¦
        async function verifySecretCode() {
            const code = document.getElementById('secretCodeInput').value.trim().toUpperCase();

            if (!code || code.length < 4) {
                showToast('ì‹œí¬ë¦¿ ì½”ë“œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }

            try {
                // Firestoreì—ì„œ ì‹œí¬ë¦¿ ì½”ë“œ í™•ì¸
                const sellerSnapshot = await db.collection('sellers')
                    .where('secretCode', '==', code)
                    .limit(1)
                    .get();

                if (sellerSnapshot.empty) {
                    // secretSellerCodes ì»¬ë ‰ì…˜ë„ í™•ì¸
                    const codeSnapshot = await db.collection('secretSellerCodes').doc(code).get();

                    if (!codeSnapshot.exists) {
                        showToast('ìœ íš¨í•˜ì§€ ì•Šì€ ì‹œí¬ë¦¿ ì½”ë“œì…ë‹ˆë‹¤.');
                        return;
                    }

                    currentSeller = {
                        id: code,
                        ...codeSnapshot.data()
                    };
                } else {
                    currentSeller = {
                        id: sellerSnapshot.docs[0].id,
                        ...sellerSnapshot.docs[0].data()
                    };
                }

                // ë¡œê·¸ì¸ ì„±ê³µ - ì¿ í‚¤ì— ì €ì¥
                document.cookie = `moyeora_secret=${code}; max-age=${7 * 24 * 60 * 60}; path=/`;

                // UI ì „í™˜
                document.getElementById('authSection').classList.add('hidden');
                document.getElementById('mainContent').classList.remove('hidden');
                document.getElementById('bottomBar').classList.remove('hidden');
                document.getElementById('secretBadge').style.display = 'flex';

                // ì›°ì»´ ë©”ì‹œì§€
                const sellerName = currentSeller.name || currentSeller.companyName || 'VIP ì…€ëŸ¬';
                document.getElementById('sellerWelcome').textContent = `${sellerName}ë‹˜, í™˜ì˜í•©ë‹ˆë‹¤!`;

                // ìƒí’ˆ ë° í†µê³„ ë¡œë“œ
                await Promise.all([
                    loadSecretProducts(),
                    loadSellerStats()
                ]);

            } catch (error) {
                console.error('ì¸ì¦ ì˜¤ë¥˜:', error);
                showToast('ì¸ì¦ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
            }
        }

        // ì‹œí¬ë¦¿ ìƒí’ˆ ë¡œë“œ
        async function loadSecretProducts() {
            try {
                // ì‹œí¬ë¦¿ ì…€ëŸ¬ìš© ìƒí’ˆ ì¡°íšŒ
                const snapshot = await db.collection('deals')
                    .where('isSecretSeller', '==', true)
                    .where('status', 'in', ['ongoing', 'active'])
                    .orderBy('createdAt', 'desc')
                    .limit(20)
                    .get();

                secretProducts = snapshot.docs.map(doc => ({
                    id: doc.id,
                    ...doc.data()
                }));

                renderProducts();

            } catch (error) {
                console.error('ìƒí’ˆ ë¡œë“œ ì˜¤ë¥˜:', error);
                // ì¸ë±ìŠ¤ ì—†ì„ ìˆ˜ ìˆìœ¼ë¯€ë¡œ í´ë°±
                try {
                    const fallbackSnapshot = await db.collection('deals')
                        .where('status', 'in', ['ongoing', 'active'])
                        .limit(10)
                        .get();

                    secretProducts = fallbackSnapshot.docs
                        .map(doc => ({ id: doc.id, ...doc.data() }))
                        .filter(d => d.isSecretSeller || d.secretSellerDiscount);

                    renderProducts();
                } catch (e) {
                    document.getElementById('productsGrid').innerHTML = '<div class="loading">ìƒí’ˆì„ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</div>';
                }
            }
        }

        // ìƒí’ˆ ë Œë”ë§
        function renderProducts() {
            const grid = document.getElementById('productsGrid');

            if (secretProducts.length === 0) {
                grid.innerHTML = `
                    <div style="grid-column: 1/-1; text-align: center; padding: 40px; color: rgba(255,255,255,0.5);">
                        í˜„ì¬ ì¤€ë¹„ëœ ì‹œí¬ë¦¿ ìƒí’ˆì´ ì—†ìŠµë‹ˆë‹¤.
                    </div>
                `;
                return;
            }

            document.getElementById('productCount').textContent = `${secretProducts.length}ê°œ ìƒí’ˆ`;

            grid.innerHTML = secretProducts.map(product => {
                const price = product.selectedProducts?.[0]?.supplyPrice || 0;
                const originalPrice = product.selectedProducts?.[0]?.originalPrice || price;
                const secretDiscount = product.secretSellerDiscount || 10;
                const secretPrice = Math.round(price * (1 - secretDiscount / 100));
                const totalDiscount = originalPrice > 0 ? Math.round((1 - secretPrice / originalPrice) * 100) : secretDiscount;

                return `
                    <div class="product-card" onclick="openProductModal('${product.id}')">
                        <img class="product-image" src="${product.images?.[0] || 'https://via.placeholder.com/200x200?text=ìƒí’ˆ'}" alt="${product.title}">
                        <div class="product-content">
                            <div class="product-seller-badge">SECRET -${secretDiscount}%</div>
                            <div class="product-title">${product.title}</div>
                            <div class="product-price-section">
                                <span class="product-discount">${totalDiscount}%</span>
                                <span class="product-price">${secretPrice.toLocaleString()}ì›</span>
                            </div>
                            ${originalPrice > secretPrice ? `<div class="product-original-price">${originalPrice.toLocaleString()}ì›</div>` : ''}
                        </div>
                    </div>
                `;
            }).join('');
        }

        // ì…€ëŸ¬ í†µê³„ ë¡œë“œ
        async function loadSellerStats() {
            try {
                // ì‹¤ì œ êµ¬í˜„ ì‹œ ì…€ëŸ¬ë³„ í†µê³„ ì¡°íšŒ
                // ì—¬ê¸°ì„œëŠ” ì„ì‹œ ë°ì´í„° í‘œì‹œ
                document.getElementById('totalPurchases').textContent = '3íšŒ';
                document.getElementById('totalCashback').textContent = '25,000ì›';
                document.getElementById('invitedFriends').textContent = '2ëª…';
                document.getElementById('vipLevel').textContent = 'GOLD';
            } catch (error) {
                console.error('í†µê³„ ë¡œë“œ ì˜¤ë¥˜:', error);
            }
        }

        // ìƒí’ˆ ëª¨ë‹¬ ì—´ê¸°
        function openProductModal(productId) {
            selectedProduct = secretProducts.find(p => p.id === productId);

            if (!selectedProduct) return;

            const price = selectedProduct.selectedProducts?.[0]?.supplyPrice || 0;
            const secretDiscount = selectedProduct.secretSellerDiscount || 10;
            const secretPrice = Math.round(price * (1 - secretDiscount / 100));

            document.getElementById('modalProductTitle').textContent = selectedProduct.title;
            document.getElementById('modalProductPrice').textContent = secretPrice.toLocaleString() + 'ì›';
            document.getElementById('productModal').classList.add('active');
        }

        function closeProductModal() {
            document.getElementById('productModal').classList.remove('active');
            selectedProduct = null;
        }

        // ì¹´í˜24ë¡œ ì´ë™
        function goToCafe24FromModal() {
            if (!selectedProduct) return;

            let url = selectedProduct.cafe24ProductUrl;

            if (!url && selectedProduct.cafe24ProductNo) {
                url = `https://moyeora02.cafe24.com/product/detail.html?product_no=${selectedProduct.cafe24ProductNo}`;
            }

            if (!url) {
                showToast('êµ¬ë§¤ ë§í¬ê°€ ì¤€ë¹„ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.');
                return;
            }

            // ì‹œí¬ë¦¿ ì½”ë“œ íŒŒë¼ë¯¸í„° ì¶”ê°€
            const code = document.getElementById('secretCodeInput').value || getCookie('moyeora_secret');
            if (code) {
                const separator = url.includes('?') ? '&' : '?';
                url = `${url}${separator}secret=${code}`;
            }

            window.location.href = url;
        }

        function buySelectedProduct() {
            if (selectedProduct) {
                goToCafe24FromModal();
            } else {
                showToast('ìƒí’ˆì„ ì„ íƒí•´ì£¼ì„¸ìš”.');
            }
        }

        // ê³µìœ  ê¸°ëŠ¥
        async function shareKakao() {
            const code = document.getElementById('secretCodeInput').value || getCookie('moyeora_secret');
            const shareUrl = `${window.location.origin}/consumer/secret-seller/?code=${code}`;

            if (typeof Kakao !== 'undefined') {
                try {
                    if (!Kakao.isInitialized()) {
                        Kakao.init('2e874ef8e5b6a792564592d49632a83e');
                    }

                    Kakao.Share.sendDefault({
                        objectType: 'feed',
                        content: {
                            title: 'ğŸŒŸ ì‹œí¬ë¦¿ ì…€ëŸ¬ ì „ìš© í˜œíƒ',
                            description: 'íŠ¹ë³„ í• ì¸ + ì¶”ê°€ ìºì‹œë°±! VIP í˜œíƒì„ ë°›ì•„ë³´ì„¸ìš”',
                            imageUrl: 'https://moyeoradeal.shop/images/secret-seller.jpg',
                            link: {
                                mobileWebUrl: shareUrl,
                                webUrl: shareUrl
                            }
                        },
                        buttons: [{
                            title: 'í˜œíƒ ë°›ìœ¼ëŸ¬ ê°€ê¸°',
                            link: {
                                mobileWebUrl: shareUrl,
                                webUrl: shareUrl
                            }
                        }]
                    });
                } catch (e) {
                    copyShareLink();
                }
            } else {
                copyShareLink();
            }
        }

        async function copyShareLink() {
            const code = document.getElementById('secretCodeInput').value || getCookie('moyeora_secret');
            const shareUrl = `${window.location.origin}/consumer/secret-seller/?code=${code}`;

            try {
                await navigator.clipboard.writeText(shareUrl);
                showToast('ë§í¬ê°€ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!');
            } catch (error) {
                showToast('ë§í¬ ë³µì‚¬ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
            }
        }

        // ì¿ í‚¤ ì½ê¸°
        function getCookie(name) {
            const value = `; ${document.cookie}`;
            const parts = value.split(`; ${name}=`);
            if (parts.length === 2) return parts.pop().split(';').shift();
            return null;
        }
    </script>
</body>
</html>
