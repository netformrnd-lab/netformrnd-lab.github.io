<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì…€ëŸ¬ ì „ìš© ìƒí’ˆ - ëª¨ì—¬ë¼ë”œ</title>
    <meta name="description" content="ì…€ëŸ¬ ì „ìš© ê³µë™êµ¬ë§¤ ìƒí’ˆ í˜ì´ì§€">
    <meta name="robots" content="noindex, nofollow">
    <link rel="icon" href="/favicon.ico">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;600;700;800&display=swap" rel="stylesheet">

    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-storage-compat.js"></script>

    <!-- Kakao SDK -->
    <script src="https://t1.kakaocdn.net/kakao_js_sdk/2.5.0/kakao.min.js"></script>

    <!-- Swiper -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css">
    <script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>

    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Noto Sans KR', -apple-system, BlinkMacSystemFont, sans-serif;
            background: #f8f9fa;
            color: #212529;
            line-height: 1.6;
        }

        /* í—¤ë” */
        .header {
            background: white;
            border-bottom: 1px solid #e9ecef;
            padding: 16px 20px;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header-content {
            max-width: 480px;
            margin: 0 auto;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .logo {
            font-size: 22px;
            font-weight: 800;
            color: #fc9600;
            text-decoration: none;
        }

        .seller-badge {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 6px 12px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            color: white;
        }

        /* ì»¨í…Œì´ë„ˆ */
        .container {
            max-width: 480px;
            margin: 0 auto;
            padding-bottom: 120px;
        }

        /* ì…€ëŸ¬ ì •ë³´ ë°°ë„ˆ */
        .seller-banner {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            text-align: center;
        }

        .seller-profile {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            margin-bottom: 8px;
        }

        .seller-avatar {
            width: 48px;
            height: 48px;
            border-radius: 50%;
            background: rgba(255,255,255,0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
        }

        .seller-name {
            font-size: 18px;
            font-weight: 700;
        }

        .seller-desc {
            font-size: 13px;
            opacity: 0.9;
        }

        /* ìƒí’ˆ ì´ë¯¸ì§€ ê°¤ëŸ¬ë¦¬ */
        .product-gallery {
            background: white;
        }

        .product-gallery .swiper-slide img {
            width: 100%;
            aspect-ratio: 1/1;
            object-fit: cover;
        }

        .product-gallery .swiper-pagination-bullet-active {
            background: #667eea;
        }

        /* ê³µë™êµ¬ë§¤ ì¼ì • */
        .schedule-section {
            background: white;
            padding: 20px;
            border-bottom: 1px solid #e9ecef;
        }

        .schedule-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }

        .schedule-title {
            font-size: 16px;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .schedule-status {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
        }

        .schedule-status.upcoming {
            background: #e3f2fd;
            color: #1976d2;
        }

        .schedule-status.ongoing {
            background: #e8f5e9;
            color: #388e3c;
        }

        .schedule-status.ended {
            background: #f5f5f5;
            color: #757575;
        }

        .schedule-dates {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
        }

        .schedule-date-box {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 14px;
            text-align: center;
        }

        .schedule-date-label {
            font-size: 12px;
            color: #6c757d;
            margin-bottom: 4px;
        }

        .schedule-date-value {
            font-size: 15px;
            font-weight: 600;
            color: #212529;
        }

        /* D-day ì¹´ìš´íŠ¸ë‹¤ìš´ */
        .countdown-section {
            background: linear-gradient(135deg, #ff6b6b 0%, #ee5a24 100%);
            color: white;
            padding: 20px;
            text-align: center;
            display: none;
        }

        .countdown-section.active {
            display: block;
        }

        .countdown-label {
            font-size: 14px;
            margin-bottom: 8px;
            opacity: 0.9;
        }

        .countdown-timer {
            display: flex;
            justify-content: center;
            gap: 16px;
        }

        .countdown-item {
            text-align: center;
        }

        .countdown-value {
            font-size: 32px;
            font-weight: 800;
            line-height: 1;
        }

        .countdown-unit {
            font-size: 12px;
            opacity: 0.8;
            margin-top: 4px;
        }

        /* ìƒí’ˆ ì •ë³´ */
        .product-info {
            background: white;
            padding: 20px;
            border-bottom: 8px solid #f1f3f5;
        }

        .product-badges {
            display: flex;
            gap: 8px;
            margin-bottom: 12px;
            flex-wrap: wrap;
        }

        .badge {
            padding: 4px 10px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 600;
        }

        .badge-exclusive {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
        }

        .badge-limited {
            background: #ef4444;
            color: white;
        }

        .product-title {
            font-size: 20px;
            font-weight: 700;
            color: #212529;
            margin-bottom: 8px;
            line-height: 1.4;
        }

        .product-subtitle {
            font-size: 14px;
            color: #6c757d;
            margin-bottom: 16px;
        }

        .price-section {
            margin-bottom: 16px;
        }

        .original-price {
            font-size: 14px;
            color: #adb5bd;
            text-decoration: line-through;
        }

        .sale-price {
            display: flex;
            align-items: baseline;
            gap: 8px;
        }

        .discount-rate {
            font-size: 22px;
            font-weight: 800;
            color: #ef4444;
        }

        .current-price {
            font-size: 26px;
            font-weight: 800;
            color: #212529;
        }

        .current-price span {
            font-size: 16px;
        }

        /* ì•Œë¦¼ ì‹ ì²­ ì„¹ì…˜ */
        .notification-section {
            background: white;
            padding: 20px;
            border-bottom: 8px solid #f1f3f5;
        }

        .section-title {
            font-size: 16px;
            font-weight: 700;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .notification-box {
            background: linear-gradient(135deg, #f0f4ff 0%, #fef3f0 100%);
            border-radius: 12px;
            padding: 20px;
        }

        .notification-desc {
            font-size: 14px;
            color: #495057;
            margin-bottom: 16px;
            text-align: center;
        }

        .notification-form {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .notification-types {
            display: flex;
            gap: 8px;
        }

        .notification-type-btn {
            flex: 1;
            padding: 12px;
            border: 2px solid #dee2e6;
            border-radius: 10px;
            background: white;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
            transition: all 0.2s;
        }

        .notification-type-btn.active {
            border-color: #667eea;
            background: #f0f4ff;
            color: #667eea;
        }

        .form-input {
            padding: 14px 16px;
            border: 1px solid #dee2e6;
            border-radius: 10px;
            font-size: 15px;
            outline: none;
        }

        .form-input:focus {
            border-color: #667eea;
        }

        .btn-submit-notification {
            width: 100%;
            padding: 16px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 700;
            cursor: pointer;
        }

        .btn-submit-notification:disabled {
            background: #adb5bd;
            cursor: not-allowed;
        }

        .notification-success {
            text-align: center;
            padding: 20px;
            display: none;
        }

        .notification-success.active {
            display: block;
        }

        .notification-success-icon {
            font-size: 48px;
            margin-bottom: 12px;
        }

        .notification-success-text {
            font-size: 16px;
            font-weight: 600;
            color: #10b981;
        }

        /* ì¹œêµ¬ ê³µìœ  ì„¹ì…˜ */
        .share-section {
            background: white;
            padding: 20px;
            border-bottom: 8px solid #f1f3f5;
        }

        .share-reward-cards {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            margin-bottom: 16px;
        }

        .share-reward-card {
            background: linear-gradient(135deg, #f8f9ff 0%, #fff5f0 100%);
            border-radius: 12px;
            padding: 16px;
            text-align: center;
            border: 1px solid #e9ecef;
        }

        .share-reward-icon {
            font-size: 28px;
            margin-bottom: 4px;
        }

        .share-reward-label {
            font-size: 12px;
            color: #6c757d;
            margin-bottom: 4px;
        }

        .share-reward-amount {
            font-size: 20px;
            font-weight: 800;
            color: #667eea;
        }

        .share-buttons {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }

        .share-btn {
            padding: 14px;
            border: none;
            border-radius: 10px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
        }

        .share-btn-kakao {
            background: #fee500;
            color: #3c1e1e;
        }

        .share-btn-sms {
            background: #10b981;
            color: white;
        }

        .share-btn-link {
            background: #495057;
            color: white;
            grid-column: 1 / -1;
        }

        /* ìƒí’ˆ ì„¤ëª… */
        .description-section {
            background: white;
            padding: 20px;
        }

        .description-content {
            font-size: 14px;
            color: #495057;
            line-height: 1.8;
            white-space: pre-wrap;
        }

        /* í•˜ë‹¨ ê³ ì • ë²„íŠ¼ */
        .bottom-bar {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: white;
            padding: 12px 20px;
            box-shadow: 0 -4px 12px rgba(0,0,0,0.1);
            z-index: 100;
        }

        .bottom-bar-content {
            max-width: 480px;
            margin: 0 auto;
            display: flex;
            gap: 10px;
        }

        .btn-buy {
            flex: 1;
            padding: 16px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 17px;
            font-weight: 700;
            cursor: pointer;
        }

        .btn-buy:disabled {
            background: #adb5bd;
            cursor: not-allowed;
        }

        .btn-buy.upcoming {
            background: linear-gradient(135deg, #ff6b6b 0%, #ee5a24 100%);
        }

        .btn-share-bottom {
            padding: 16px 20px;
            background: #f8f9fa;
            border: 2px solid #e9ecef;
            border-radius: 12px;
            font-size: 20px;
            cursor: pointer;
        }

        /* ì ‘ê·¼ ë¶ˆê°€ */
        .access-denied {
            text-align: center;
            padding: 100px 20px;
        }

        .access-denied-icon {
            font-size: 64px;
            margin-bottom: 20px;
        }

        .access-denied-title {
            font-size: 20px;
            font-weight: 700;
            margin-bottom: 12px;
            color: #212529;
        }

        .access-denied-desc {
            font-size: 14px;
            color: #6c757d;
        }

        /* ë¡œë”© */
        .loading {
            text-align: center;
            padding: 100px 20px;
        }

        .loading-spinner {
            width: 40px;
            height: 40px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 16px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* í† ìŠ¤íŠ¸ */
        .toast {
            position: fixed;
            bottom: 100px;
            left: 50%;
            transform: translateX(-50%);
            background: #212529;
            color: white;
            padding: 14px 24px;
            border-radius: 10px;
            font-size: 14px;
            font-weight: 500;
            z-index: 10000;
            opacity: 0;
            transition: opacity 0.3s;
        }

        .toast.active {
            opacity: 1;
        }

        /* ëª¨ë‹¬ */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(4px);
            z-index: 9999;
            align-items: center;
            justify-content: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: white;
            border-radius: 20px;
            padding: 30px;
            max-width: 400px;
            width: 90%;
        }

        .modal-header {
            text-align: center;
            margin-bottom: 20px;
        }

        .modal-icon {
            font-size: 48px;
            margin-bottom: 12px;
        }

        .modal-title {
            font-size: 20px;
            font-weight: 700;
        }

        .modal-desc {
            font-size: 14px;
            color: #6c757d;
            margin-top: 8px;
        }

        .referral-link-box {
            background: #f8f9fa;
            border: 2px dashed #dee2e6;
            border-radius: 10px;
            padding: 14px;
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .referral-link-text {
            flex: 1;
            font-size: 11px;
            color: #495057;
            word-break: break-all;
            font-family: monospace;
        }

        .btn-copy {
            padding: 10px 16px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 13px;
            font-weight: 600;
            cursor: pointer;
            white-space: nowrap;
        }

        .btn-close-modal {
            width: 100%;
            padding: 14px;
            background: #e9ecef;
            border: none;
            border-radius: 10px;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            color: #495057;
            margin-top: 10px;
        }
    </style>
</head>
<body>
    <!-- í—¤ë” -->
    <div class="header">
        <div class="header-content">
            <a href="/" class="logo">ëª¨ì—¬ë¼ë”œ</a>
            <div class="seller-badge" id="sellerBadge" style="display: none;">
                <span>EXCLUSIVE</span>
            </div>
        </div>
    </div>

    <!-- ë¡œë”© -->
    <div class="loading" id="loading">
        <div class="loading-spinner"></div>
        <p>ìƒí’ˆ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>
    </div>

    <!-- ì ‘ê·¼ ë¶ˆê°€ -->
    <div class="access-denied" id="accessDenied" style="display: none;">
        <div class="access-denied-icon">ğŸ”’</div>
        <h1 class="access-denied-title">ì ‘ê·¼í•  ìˆ˜ ì—†ëŠ” í˜ì´ì§€ì…ë‹ˆë‹¤</h1>
        <p class="access-denied-desc">
            ì´ í˜ì´ì§€ëŠ” ì…€ëŸ¬ ì „ìš© ë§í¬ë¥¼ í†µí•´ì„œë§Œ<br>ì ‘ê·¼í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
        </p>
    </div>

    <!-- ë©”ì¸ ì½˜í…ì¸  -->
    <div class="container" id="mainContent" style="display: none;">
        <!-- ì…€ëŸ¬ ì •ë³´ ë°°ë„ˆ -->
        <div class="seller-banner">
            <div class="seller-profile">
                <div class="seller-avatar" id="sellerAvatar">ğŸª</div>
                <div>
                    <div class="seller-name" id="sellerName">ì…€ëŸ¬ëª…</div>
                    <div class="seller-desc">ì „ìš© ê³µë™êµ¬ë§¤</div>
                </div>
            </div>
        </div>

        <!-- ìƒí’ˆ ì´ë¯¸ì§€ ê°¤ëŸ¬ë¦¬ -->
        <div class="product-gallery">
            <div class="swiper" id="productSwiper">
                <div class="swiper-wrapper" id="productImages">
                </div>
                <div class="swiper-pagination"></div>
            </div>
        </div>

        <!-- D-day ì¹´ìš´íŠ¸ë‹¤ìš´ (ì˜¤í”ˆ ì „) -->
        <div class="countdown-section" id="countdownSection">
            <div class="countdown-label" id="countdownLabel">ê³µë™êµ¬ë§¤ ì˜¤í”ˆê¹Œì§€</div>
            <div class="countdown-timer">
                <div class="countdown-item">
                    <div class="countdown-value" id="countdownDays">00</div>
                    <div class="countdown-unit">ì¼</div>
                </div>
                <div class="countdown-item">
                    <div class="countdown-value" id="countdownHours">00</div>
                    <div class="countdown-unit">ì‹œê°„</div>
                </div>
                <div class="countdown-item">
                    <div class="countdown-value" id="countdownMinutes">00</div>
                    <div class="countdown-unit">ë¶„</div>
                </div>
                <div class="countdown-item">
                    <div class="countdown-value" id="countdownSeconds">00</div>
                    <div class="countdown-unit">ì´ˆ</div>
                </div>
            </div>
        </div>

        <!-- ê³µë™êµ¬ë§¤ ì¼ì • -->
        <div class="schedule-section">
            <div class="schedule-header">
                <div class="schedule-title">
                    <span>ğŸ“…</span> ê³µë™êµ¬ë§¤ ì¼ì •
                </div>
                <span class="schedule-status upcoming" id="scheduleStatus">ì˜¤í”ˆ ì˜ˆì •</span>
            </div>
            <div class="schedule-dates">
                <div class="schedule-date-box">
                    <div class="schedule-date-label">ì‹œì‘ì¼</div>
                    <div class="schedule-date-value" id="startDate">-</div>
                </div>
                <div class="schedule-date-box">
                    <div class="schedule-date-label">ì¢…ë£Œì¼</div>
                    <div class="schedule-date-value" id="endDate">-</div>
                </div>
            </div>
        </div>

        <!-- ìƒí’ˆ ì •ë³´ -->
        <div class="product-info">
            <div class="product-badges" id="productBadges">
                <span class="badge badge-exclusive">ì…€ëŸ¬ ì „ìš©</span>
            </div>
            <h1 class="product-title" id="productTitle">ìƒí’ˆëª…</h1>
            <p class="product-subtitle" id="productSubtitle"></p>

            <div class="price-section">
                <div class="original-price" id="originalPrice"></div>
                <div class="sale-price">
                    <span class="discount-rate" id="discountRate"></span>
                    <span class="current-price" id="currentPrice">0<span>ì›</span></span>
                </div>
            </div>
        </div>

        <!-- ì•Œë¦¼ ì‹ ì²­ (ì˜¤í”ˆ ì˜ˆì •ì¼ ë•Œ) -->
        <div class="notification-section" id="notificationSection">
            <div class="section-title">
                <span>ğŸ””</span> ì˜¤í”ˆ ì•Œë¦¼ ë°›ê¸°
            </div>
            <div class="notification-box">
                <div class="notification-form" id="notificationForm">
                    <p class="notification-desc">ê³µë™êµ¬ë§¤ ì˜¤í”ˆ ì‹œ ì•Œë¦¼ì„ ë°›ìœ¼ì„¸ìš”!</p>
                    <div class="notification-types">
                        <button class="notification-type-btn active" data-type="kakao" onclick="selectNotificationType('kakao')">
                            ğŸ’¬ ì¹´ì¹´ì˜¤í†¡
                        </button>
                        <button class="notification-type-btn" data-type="sms" onclick="selectNotificationType('sms')">
                            ğŸ“± ë¬¸ì
                        </button>
                    </div>
                    <input type="tel" class="form-input" id="phoneInput" placeholder="ì—°ë½ì²˜ (010-0000-0000)">
                    <button class="btn-submit-notification" onclick="submitNotification()">
                        ì•Œë¦¼ ì‹ ì²­í•˜ê¸°
                    </button>
                </div>
                <div class="notification-success" id="notificationSuccess">
                    <div class="notification-success-icon">âœ…</div>
                    <div class="notification-success-text">ì•Œë¦¼ ì‹ ì²­ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!</div>
                </div>
            </div>
        </div>

        <!-- ì¹œêµ¬ ê³µìœ  -->
        <div class="share-section">
            <div class="section-title">
                <span>ğŸ</span> ì¹œêµ¬ì—ê²Œ ê³µìœ í•˜ê¸°
            </div>
            <div class="share-reward-cards">
                <div class="share-reward-card">
                    <div class="share-reward-icon">ğŸ˜Š</div>
                    <div class="share-reward-label">ë‚´ê°€ ë°›ëŠ” í˜œíƒ</div>
                    <div class="share-reward-amount" id="referrerReward">5,000ì›</div>
                </div>
                <div class="share-reward-card">
                    <div class="share-reward-icon">ğŸ‰</div>
                    <div class="share-reward-label">ì¹œêµ¬ê°€ ë°›ëŠ” í˜œíƒ</div>
                    <div class="share-reward-amount" id="refereeReward">3,000ì›</div>
                </div>
            </div>
            <div class="share-buttons">
                <button class="share-btn share-btn-kakao" onclick="shareKakao()">ğŸ’¬ ì¹´ì¹´ì˜¤í†¡</button>
                <button class="share-btn share-btn-sms" onclick="shareSMS()">ğŸ“± ë¬¸ì</button>
                <button class="share-btn share-btn-link" onclick="openShareModal()">ğŸ”— ê³µìœ  ë§í¬ ë³µì‚¬</button>
            </div>
        </div>

        <!-- ìƒí’ˆ ì„¤ëª… -->
        <div class="description-section">
            <div class="section-title">ìƒí’ˆ ì„¤ëª…</div>
            <div class="description-content" id="productDescription">
                ìƒí’ˆ ì„¤ëª…ì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤.
            </div>
        </div>
    </div>

    <!-- í•˜ë‹¨ ê³ ì • ë²„íŠ¼ -->
    <div class="bottom-bar" id="bottomBar" style="display: none;">
        <div class="bottom-bar-content">
            <button class="btn-share-bottom" onclick="openShareModal()">ğŸ”—</button>
            <button class="btn-buy" id="btnBuy" onclick="goToCafe24()">êµ¬ë§¤í•˜ê¸°</button>
        </div>
    </div>

    <!-- ê³µìœ  ëª¨ë‹¬ -->
    <div class="modal" id="shareModal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-icon">ğŸ</div>
                <h3 class="modal-title">ì¹œêµ¬ ì´ˆëŒ€ ë§í¬</h3>
                <p class="modal-desc">ì´ ë§í¬ë¥¼ ì¹œêµ¬ì—ê²Œ ê³µìœ í•˜ì„¸ìš”!</p>
            </div>

            <div class="referral-link-box">
                <div class="referral-link-text" id="referralLinkText">ìƒì„± ì¤‘...</div>
                <button class="btn-copy" onclick="copyReferralLink()">ë³µì‚¬</button>
            </div>

            <div class="share-buttons">
                <button class="share-btn share-btn-kakao" onclick="shareKakao()">ğŸ’¬ ì¹´ì¹´ì˜¤í†¡</button>
                <button class="share-btn share-btn-sms" onclick="shareSMS()">ğŸ“± ë¬¸ì</button>
            </div>

            <button class="btn-close-modal" onclick="closeShareModal()">ë‹«ê¸°</button>
        </div>
    </div>

    <!-- í† ìŠ¤íŠ¸ -->
    <div class="toast" id="toast"></div>

    <script>
        // Firebase ì„¤ì •
        const firebaseConfig = {
            apiKey: "AIzaSyAQf_Cu9wMji5QsMBQns5eg6nOD_vmrZMs",
            authDomain: "moyeora-deal-manager.firebaseapp.com",
            projectId: "moyeora-deal-manager",
            storageBucket: "moyeora-deal-manager.firebasestorage.app",
            messagingSenderId: "878495183009",
            appId: "1:878495183009:web:7c7f5f3b6c3d5f5f5f5f5f"
        };

        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        // ì „ì—­ ë³€ìˆ˜
        let currentDeal = null;
        let currentSeller = null;
        let currentReferralCode = null;
        let cafe24ProductUrl = null;
        let notificationType = 'kakao';
        let countdownInterval = null;

        // URL íŒŒë¼ë¯¸í„°
        function getUrlParam(param) {
            return new URLSearchParams(window.location.search).get(param);
        }

        // ì¿ í‚¤ í•¨ìˆ˜
        function setCookie(name, value, days) {
            const d = new Date();
            d.setTime(d.getTime() + (days * 24 * 60 * 60 * 1000));
            document.cookie = name + "=" + value + ";expires=" + d.toUTCString() + ";path=/";
        }

        function getCookie(name) {
            const nameEQ = name + "=";
            const ca = document.cookie.split(';');
            for(let i = 0; i < ca.length; i++) {
                let c = ca[i].trim();
                if (c.indexOf(nameEQ) === 0) return c.substring(nameEQ.length);
            }
            return null;
        }

        // í† ìŠ¤íŠ¸
        function showToast(message) {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.classList.add('active');
            setTimeout(() => toast.classList.remove('active'), 3000);
        }

        // í˜ì´ì§€ ë¡œë“œ
        window.addEventListener('DOMContentLoaded', async () => {
            const sellerId = getUrlParam('seller');
            const dealId = getUrlParam('deal');
            const referralCode = getUrlParam('ref');

            // í•„ìˆ˜ íŒŒë¼ë¯¸í„° ì²´í¬
            if (!sellerId || !dealId) {
                document.getElementById('loading').style.display = 'none';
                document.getElementById('accessDenied').style.display = 'block';
                return;
            }

            // ë ˆí¼ëŸ´ ì½”ë“œ ì €ì¥
            if (referralCode) {
                setCookie('moyeora_ref', referralCode, 7);
                try {
                    await db.collection('referrals').doc(referralCode).update({
                        clicks: firebase.firestore.FieldValue.increment(1),
                        lastClickAt: new Date()
                    });
                } catch (e) {
                    console.log('ë ˆí¼ëŸ´ ì¶”ì :', e.message);
                }
            }

            await loadSellerAndDeal(sellerId, dealId);
        });

        // ì…€ëŸ¬ ë° ìƒí’ˆ ì •ë³´ ë¡œë“œ
        async function loadSellerAndDeal(sellerId, dealId) {
            try {
                // ì…€ëŸ¬ ì •ë³´ ì¡°íšŒ
                const sellerDoc = await db.collection('sellers').doc(sellerId).get();
                if (sellerDoc.exists) {
                    currentSeller = { id: sellerDoc.id, ...sellerDoc.data() };
                } else {
                    // ì…€ëŸ¬ ì •ë³´ ì—†ì–´ë„ ì§„í–‰ (dealIdë¡œë§Œ ì²˜ë¦¬)
                    currentSeller = { id: sellerId, name: 'ì…€ëŸ¬' };
                }

                // ê³µë™êµ¬ë§¤ ìƒí’ˆ ì •ë³´ ì¡°íšŒ
                const dealDoc = await db.collection('deals').doc(dealId).get();
                if (!dealDoc.exists) {
                    document.getElementById('loading').style.display = 'none';
                    document.getElementById('accessDenied').style.display = 'block';
                    return;
                }

                currentDeal = { id: dealDoc.id, ...dealDoc.data() };

                // ì…€ëŸ¬ ì „ìš© ìƒí’ˆì¸ì§€ í™•ì¸ (ì˜µì…˜)
                // if (currentDeal.sellerId && currentDeal.sellerId !== sellerId) {
                //     document.getElementById('loading').style.display = 'none';
                //     document.getElementById('accessDenied').style.display = 'block';
                //     return;
                // }

                // UI ë Œë”ë§
                renderPage();

            } catch (error) {
                console.error('ë°ì´í„° ë¡œë“œ ì˜¤ë¥˜:', error);
                showToast('ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
            }
        }

        // í˜ì´ì§€ ë Œë”ë§
        function renderPage() {
            // ì…€ëŸ¬ ì •ë³´
            document.getElementById('sellerName').textContent = currentSeller.name || currentSeller.companyName || 'ì…€ëŸ¬';
            document.getElementById('sellerBadge').style.display = 'flex';

            // ìƒí’ˆ ì œëª©
            document.getElementById('productTitle').textContent = currentDeal.title || 'ê³µêµ¬ ìƒí’ˆ';
            document.getElementById('productSubtitle').textContent = currentDeal.subtitle || '';

            // ì¼ì • ì •ë³´
            const startDate = currentDeal.startDate?.toDate ? currentDeal.startDate.toDate() : new Date(currentDeal.startDate);
            const endDate = currentDeal.endDate?.toDate ? currentDeal.endDate.toDate() : new Date(currentDeal.endDate);
            const now = new Date();

            document.getElementById('startDate').textContent = formatDate(startDate);
            document.getElementById('endDate').textContent = formatDate(endDate);

            // ìƒíƒœ ê²°ì •
            const statusEl = document.getElementById('scheduleStatus');
            const btnBuy = document.getElementById('btnBuy');

            if (now < startDate) {
                // ì˜¤í”ˆ ì˜ˆì •
                statusEl.textContent = 'ì˜¤í”ˆ ì˜ˆì •';
                statusEl.className = 'schedule-status upcoming';
                btnBuy.textContent = 'ì˜¤í”ˆ ì•Œë¦¼ ë°›ê¸°';
                btnBuy.classList.add('upcoming');
                btnBuy.onclick = () => document.getElementById('phoneInput').focus();

                // ì¹´ìš´íŠ¸ë‹¤ìš´ ì‹œì‘
                startCountdown(startDate, 'ê³µë™êµ¬ë§¤ ì˜¤í”ˆê¹Œì§€');
                document.getElementById('notificationSection').style.display = 'block';
            } else if (now >= startDate && now <= endDate) {
                // ì§„í–‰ì¤‘
                statusEl.textContent = 'ì§„í–‰ì¤‘';
                statusEl.className = 'schedule-status ongoing';
                btnBuy.textContent = 'êµ¬ë§¤í•˜ê¸°';
                btnBuy.classList.remove('upcoming');
                document.getElementById('notificationSection').style.display = 'none';

                // ì¢…ë£Œ ì¹´ìš´íŠ¸ë‹¤ìš´
                startCountdown(endDate, 'ê³µë™êµ¬ë§¤ ì¢…ë£Œê¹Œì§€');
            } else {
                // ì¢…ë£Œ
                statusEl.textContent = 'ì¢…ë£Œ';
                statusEl.className = 'schedule-status ended';
                btnBuy.textContent = 'íŒë§¤ ì¢…ë£Œ';
                btnBuy.disabled = true;
                document.getElementById('notificationSection').style.display = 'none';
            }

            // ê°€ê²© ì •ë³´
            if (currentDeal.selectedProducts && currentDeal.selectedProducts.length > 0) {
                const product = currentDeal.selectedProducts[0];
                const salePrice = product.supplyPrice || 0;
                const originalPrice = product.originalPrice || product.retailPrice || salePrice;

                if (originalPrice > salePrice) {
                    document.getElementById('originalPrice').textContent = originalPrice.toLocaleString() + 'ì›';
                    const discountRate = Math.round((1 - salePrice / originalPrice) * 100);
                    document.getElementById('discountRate').textContent = discountRate + '%';
                }
                document.getElementById('currentPrice').innerHTML = salePrice.toLocaleString() + '<span>ì›</span>';
            }

            // ìºì‹œë°± ì •ë³´
            const referrerCashback = currentDeal.referrerCashback || 5000;
            const refereeCashback = currentDeal.refereeCashback || 3000;
            document.getElementById('referrerReward').textContent = referrerCashback.toLocaleString() + 'ì›';
            document.getElementById('refereeReward').textContent = refereeCashback.toLocaleString() + 'ì›';

            // ìƒí’ˆ ì„¤ëª…
            document.getElementById('productDescription').textContent =
                currentDeal.description || currentDeal.notes || 'ìƒí’ˆ ì„¤ëª…ì´ ì—†ìŠµë‹ˆë‹¤.';

            // ì´ë¯¸ì§€
            const imagesContainer = document.getElementById('productImages');
            const images = currentDeal.images || [];
            if (images.length > 0) {
                imagesContainer.innerHTML = images.map(img =>
                    `<div class="swiper-slide"><img src="${img}" alt="ìƒí’ˆ ì´ë¯¸ì§€"></div>`
                ).join('');
            } else {
                imagesContainer.innerHTML = `<div class="swiper-slide"><img src="https://via.placeholder.com/480x480?text=ìƒí’ˆ+ì´ë¯¸ì§€" alt="ìƒí’ˆ ì´ë¯¸ì§€"></div>`;
            }

            // ì¹´í˜24 URL
            if (currentDeal.cafe24ProductUrl) {
                cafe24ProductUrl = currentDeal.cafe24ProductUrl;
            } else if (currentDeal.cafe24ProductNo) {
                cafe24ProductUrl = `https://moyeora02.cafe24.com/product/detail.html?product_no=${currentDeal.cafe24ProductNo}`;
            }

            // Swiper ì´ˆê¸°í™”
            new Swiper('#productSwiper', {
                pagination: {
                    el: '.swiper-pagination',
                    clickable: true
                }
            });

            // UI í‘œì‹œ
            document.getElementById('loading').style.display = 'none';
            document.getElementById('mainContent').style.display = 'block';
            document.getElementById('bottomBar').style.display = 'block';
        }

        // ë‚ ì§œ í¬ë§·
        function formatDate(date) {
            if (!date || isNaN(date.getTime())) return '-';
            const month = date.getMonth() + 1;
            const day = date.getDate();
            const hours = date.getHours();
            const minutes = String(date.getMinutes()).padStart(2, '0');
            return `${month}/${day} ${hours}:${minutes}`;
        }

        // ì¹´ìš´íŠ¸ë‹¤ìš´
        function startCountdown(targetDate, label) {
            const section = document.getElementById('countdownSection');
            document.getElementById('countdownLabel').textContent = label;
            section.classList.add('active');

            function updateCountdown() {
                const now = new Date();
                const diff = targetDate - now;

                if (diff <= 0) {
                    clearInterval(countdownInterval);
                    section.classList.remove('active');
                    // í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨í•˜ì—¬ ìƒíƒœ ì—…ë°ì´íŠ¸
                    location.reload();
                    return;
                }

                const days = Math.floor(diff / (1000 * 60 * 60 * 24));
                const hours = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
                const seconds = Math.floor((diff % (1000 * 60)) / 1000);

                document.getElementById('countdownDays').textContent = String(days).padStart(2, '0');
                document.getElementById('countdownHours').textContent = String(hours).padStart(2, '0');
                document.getElementById('countdownMinutes').textContent = String(minutes).padStart(2, '0');
                document.getElementById('countdownSeconds').textContent = String(seconds).padStart(2, '0');
            }

            updateCountdown();
            countdownInterval = setInterval(updateCountdown, 1000);
        }

        // ì•Œë¦¼ ì‹ ì²­
        function selectNotificationType(type) {
            notificationType = type;
            document.querySelectorAll('.notification-type-btn').forEach(btn => {
                btn.classList.toggle('active', btn.dataset.type === type);
            });
        }

        async function submitNotification() {
            const phone = document.getElementById('phoneInput').value.trim();

            if (!phone) {
                showToast('ì—°ë½ì²˜ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }

            const phoneRegex = /^01[0-9]-?[0-9]{3,4}-?[0-9]{4}$/;
            if (!phoneRegex.test(phone.replace(/-/g, ''))) {
                showToast('ì˜¬ë°”ë¥¸ ì „í™”ë²ˆí˜¸ í˜•ì‹ì´ ì•„ë‹™ë‹ˆë‹¤.');
                return;
            }

            try {
                await db.collection('notifications').add({
                    dealId: currentDeal.id,
                    dealTitle: currentDeal.title,
                    sellerId: currentSeller.id,
                    sellerName: currentSeller.name || currentSeller.companyName,
                    phone: phone,
                    type: notificationType,
                    createdAt: new Date(),
                    status: 'pending'
                });

                setCookie('moyeora_phone', phone, 30);

                document.getElementById('notificationForm').style.display = 'none';
                document.getElementById('notificationSuccess').classList.add('active');
                showToast('ì•Œë¦¼ ì‹ ì²­ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!');

            } catch (error) {
                console.error('ì•Œë¦¼ ì‹ ì²­ ì˜¤ë¥˜:', error);
                showToast('ì•Œë¦¼ ì‹ ì²­ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
            }
        }

        // ì¹´í˜24ë¡œ ì´ë™
        function goToCafe24() {
            const btnBuy = document.getElementById('btnBuy');

            // ì˜¤í”ˆ ì „ì´ë©´ ì•Œë¦¼ ì‹ ì²­ìœ¼ë¡œ ìŠ¤í¬ë¡¤
            if (btnBuy.classList.contains('upcoming')) {
                document.getElementById('phoneInput').scrollIntoView({ behavior: 'smooth' });
                document.getElementById('phoneInput').focus();
                return;
            }

            if (!cafe24ProductUrl) {
                showToast('êµ¬ë§¤ í˜ì´ì§€ ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }

            const referralCode = getCookie('moyeora_ref');
            let url = cafe24ProductUrl;

            // ì…€ëŸ¬ IDì™€ ë ˆí¼ëŸ´ ì½”ë“œ ì¶”ê°€
            const params = new URLSearchParams();
            params.append('seller', currentSeller.id);
            if (referralCode) params.append('ref', referralCode);

            const separator = url.includes('?') ? '&' : '?';
            url = `${url}${separator}${params.toString()}`;

            window.location.href = url;
        }

        // ê³µìœ  ê¸°ëŠ¥
        async function generateReferralCode() {
            if (currentReferralCode) return currentReferralCode;

            const visitorId = 'visitor_' + Date.now() + '_' + Math.random().toString(36).substring(2, 6);

            let code;
            let attempts = 0;
            while (attempts < 5) {
                code = Math.random().toString(36).substring(2, 10).toUpperCase();
                const existing = await db.collection('referrals').doc(code).get();
                if (!existing.exists) break;
                attempts++;
            }

            const referralData = {
                referralCode: code,
                referrerId: visitorId,
                dealId: currentDeal.id,
                dealTitle: currentDeal.title || '',
                sellerId: currentSeller.id,
                sellerName: currentSeller.name || '',
                createdAt: new Date(),
                expiresAt: new Date(Date.now() + 30 * 24 * 60 * 60 * 1000),
                clicks: 0,
                conversions: 0,
                status: 'active'
            };

            await db.collection('referrals').doc(code).set(referralData);
            currentReferralCode = code;
            return code;
        }

        function getReferralLink() {
            return `${window.location.origin}/consumer/secret-seller/?seller=${currentSeller.id}&deal=${currentDeal.id}&ref=${currentReferralCode}`;
        }

        async function openShareModal() {
            if (!currentDeal) {
                showToast('ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');
                return;
            }

            try {
                await generateReferralCode();
                document.getElementById('referralLinkText').textContent = getReferralLink();
                document.getElementById('shareModal').classList.add('active');
            } catch (error) {
                console.error('ê³µìœ  ë§í¬ ìƒì„± ì˜¤ë¥˜:', error);
                showToast('ê³µìœ  ë§í¬ ìƒì„±ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
            }
        }

        function closeShareModal() {
            document.getElementById('shareModal').classList.remove('active');
        }

        async function copyReferralLink() {
            if (!currentReferralCode) await generateReferralCode();

            try {
                await navigator.clipboard.writeText(getReferralLink());
                showToast('ë§í¬ê°€ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!');
            } catch (error) {
                showToast('ë§í¬ ë³µì‚¬ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
            }
        }

        async function shareKakao() {
            if (!currentReferralCode) await generateReferralCode();

            if (typeof Kakao === 'undefined' || !Kakao.isInitialized()) {
                try {
                    Kakao.init('2e874ef8e5b6a792564592d49632a83e');
                } catch (e) {
                    showToast('ì¹´ì¹´ì˜¤í†¡ ê³µìœ ë¥¼ ì‚¬ìš©í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                    return;
                }
            }

            const referralLink = getReferralLink();
            const refereeCashback = currentDeal.refereeCashback || 3000;
            const sellerName = currentSeller.name || currentSeller.companyName || 'ì…€ëŸ¬';

            Kakao.Share.sendDefault({
                objectType: 'feed',
                content: {
                    title: `ğŸ›’ ${currentDeal.title}`,
                    description: `${sellerName} ì „ìš© ê³µêµ¬! ì§€ê¸ˆ êµ¬ë§¤í•˜ë©´ ${refereeCashback.toLocaleString()}ì› ìºì‹œë°±`,
                    imageUrl: currentDeal.images?.[0] || 'https://moyeoradeal.shop/images/share-thumbnail.jpg',
                    link: {
                        mobileWebUrl: referralLink,
                        webUrl: referralLink
                    }
                },
                buttons: [{
                    title: 'ìƒí’ˆ ë³´ê¸°',
                    link: {
                        mobileWebUrl: referralLink,
                        webUrl: referralLink
                    }
                }]
            });
        }

        async function shareSMS() {
            if (!currentReferralCode) await generateReferralCode();

            const referralLink = getReferralLink();
            const refereeCashback = currentDeal.refereeCashback || 3000;
            const sellerName = currentSeller.name || currentSeller.companyName || 'ì…€ëŸ¬';

            const message = `ğŸ›’ ${sellerName} ì „ìš© ê³µêµ¬!\n\n${currentDeal.title}\n\nì§€ê¸ˆ êµ¬ë§¤í•˜ë©´ ${refereeCashback.toLocaleString()}ì› ìºì‹œë°±!\n\n${referralLink}`;

            window.location.href = `sms:?body=${encodeURIComponent(message)}`;
        }
    </script>
</body>
</html>
