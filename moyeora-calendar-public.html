<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ëª¨ì—¬ë¼ë”œ - ê³µêµ¬ ì¼ì •í‘œ</title>
  <link href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/static/pretendard.css" rel="stylesheet">
  <style>
    :root {
      --primary: #fc9600;
      --primary-light: #fff8f0;
      --primary-dark: #e08600;
      --white: #ffffff;
      --gray-900: #191f28;
      --gray-700: #4e5968;
      --gray-600: #6b7684;
      --gray-500: #8b95a1;
      --gray-400: #b0b8c1;
      --gray-300: #d1d6db;
      --gray-200: #e5e8eb;
      --gray-100: #f2f4f6;
      --gray-50: #f9fafb;
      --success: #00c073;
      --success-light: #e8f7f0;
      --danger: #f04452;
      --info: #3182f6;
      --info-light: #eef4ff;
    }
    
    * { margin: 0; padding: 0; box-sizing: border-box; }
    
    body { 
      min-height: 100vh; 
      background: var(--gray-100);
      font-family: 'Pretendard', -apple-system, BlinkMacSystemFont, system-ui, sans-serif;
      color: var(--gray-900);
      line-height: 1.5;
      -webkit-font-smoothing: antialiased;
    }
    
    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 24px;
    }
    
    /* í—¤ë” */
    .header {
      background: var(--white);
      border-bottom: 1px solid var(--gray-200);
      padding: 20px 0;
      margin-bottom: 24px;
    }
    
    .header-inner {
      max-width: 1200px;
      margin: 0 auto;
      padding: 0 24px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .logo {
      display: flex;
      align-items: center;
      gap: 12px;
    }
    
    .logo-icon {
      width: 40px;
      height: 40px;
      background: var(--primary);
      border-radius: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 20px;
    }
    
    .logo-text {
      font-size: 20px;
      font-weight: 700;
      color: var(--gray-900);
    }
    
    .view-mode-badge {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 8px 14px;
      background: var(--primary-light);
      border: 1px solid var(--primary);
      border-radius: 8px;
      font-size: 13px;
      font-weight: 600;
      color: var(--primary-dark);
    }
    
    /* í•„í„° íƒ­ */
    .filter-tabs {
      display: flex;
      gap: 8px;
      margin-bottom: 24px;
      flex-wrap: wrap;
    }
    
    .filter-tab {
      padding: 10px 18px;
      border-radius: 20px;
      border: 1px solid var(--gray-200);
      background: var(--white);
      font-size: 14px;
      font-weight: 500;
      color: var(--gray-600);
      cursor: pointer;
      transition: all 0.15s ease;
    }
    
    .filter-tab:hover {
      border-color: var(--primary);
      color: var(--primary);
    }
    
    .filter-tab.active {
      background: var(--primary);
      border-color: var(--primary);
      color: var(--white);
    }
    
    /* ìº˜ë¦°ë” ë„¤ë¹„ê²Œì´ì…˜ */
    .calendar-nav {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
    }
    
    .calendar-title {
      font-size: 24px;
      font-weight: 700;
    }
    
    .nav-buttons {
      display: flex;
      gap: 8px;
    }
    
    .btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
      padding: 10px 16px;
      border-radius: 8px;
      font-size: 14px;
      font-weight: 600;
      border: none;
      cursor: pointer;
      transition: all 0.15s ease;
      font-family: inherit;
    }
    
    .btn-secondary {
      background: var(--white);
      color: var(--gray-700);
      border: 1px solid var(--gray-200);
    }
    
    .btn-secondary:hover {
      background: var(--gray-50);
      border-color: var(--gray-300);
    }
    
    .btn-primary {
      background: var(--primary);
      color: var(--white);
    }
    
    .btn-primary:hover {
      background: var(--primary-dark);
    }
    
    /* ìº˜ë¦°ë” */
    .calendar-card {
      background: var(--white);
      border-radius: 16px;
      padding: 24px;
    }
    
    .calendar-header {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      margin-bottom: 8px;
    }
    
    .calendar-header-day {
      text-align: center;
      padding: 12px;
      font-size: 13px;
      font-weight: 600;
      color: var(--gray-500);
    }
    
    .calendar-header-day.sunday { color: var(--danger); }
    .calendar-header-day.saturday { color: var(--info); }
    
    .calendar-grid {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      gap: 4px;
    }
    
    .calendar-day {
      min-height: 100px;
      padding: 8px;
      background: var(--gray-50);
      border-radius: 12px;
      transition: all 0.15s ease;
    }
    
    .calendar-day:hover {
      background: var(--gray-100);
    }
    
    .calendar-day.other-month {
      background: transparent;
      opacity: 0.4;
    }
    
    .calendar-day.today {
      background: var(--primary-light);
      border: 2px solid var(--primary);
    }
    
    .calendar-day.sunday .day-number { color: var(--danger); }
    .calendar-day.saturday .day-number { color: var(--info); }
    
    .day-number {
      font-size: 14px;
      font-weight: 600;
      margin-bottom: 6px;
    }
    
    .deal-badge {
      padding: 4px 8px;
      border-radius: 6px;
      font-size: 11px;
      font-weight: 500;
      margin-bottom: 4px;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      cursor: pointer;
    }
    
    .deal-badge.supplier {
      background: var(--info-light);
      color: var(--info);
    }
    
    .deal-badge.seller {
      background: var(--primary-light);
      color: var(--primary-dark);
    }
    
    .deal-badge.both {
      background: var(--success-light);
      color: var(--success);
    }
    
    /* ìƒíƒœ ë°°ì§€ */
    .status-badge {
      display: inline-block;
      padding: 4px 10px;
      border-radius: 12px;
      font-size: 12px;
      font-weight: 600;
    }
    
    .status-negotiating {
      background: var(--gray-100);
      color: var(--gray-700);
    }
    
    .status-confirmed {
      background: var(--success-light);
      color: var(--success);
    }
    
    .status-ongoing {
      background: var(--primary-light);
      color: var(--primary-dark);
    }
    
    .status-completed {
      background: var(--info-light);
      color: var(--info);
    }
    
    /* í†µê³„ ì¹´ë“œ */
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 16px;
      margin-bottom: 24px;
    }
    
    .stat-card {
      background: var(--white);
      border-radius: 16px;
      padding: 20px;
      text-align: center;
      box-shadow: 0 2px 8px rgba(0,0,0,0.04);
    }
    
    .stat-card.active {
      background: var(--primary);
      color: var(--white);
    }
    
    .stat-number {
      font-size: 32px;
      font-weight: 700;
      margin-bottom: 4px;
    }
    
    .stat-label {
      font-size: 14px;
      opacity: 0.8;
    }
    
    /* ê³µêµ¬ ëª©ë¡ */
    .deal-list {
      margin-top: 24px;
    }
    
    .deal-list-title {
      font-size: 18px;
      font-weight: 700;
      margin-bottom: 16px;
    }
    
    .deal-item {
      background: var(--white);
      border-radius: 16px;
      padding: 20px;
      margin-bottom: 12px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.04);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .deal-info {
      flex: 1;
    }
    
    .deal-title {
      font-size: 16px;
      font-weight: 700;
      margin-bottom: 4px;
    }
    
    .deal-meta {
      font-size: 13px;
      color: var(--gray-500);
      display: flex;
      gap: 16px;
    }
    
    /* ëª¨ë‹¬ */
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0,0,0,0.5);
      z-index: 1000;
      align-items: center;
      justify-content: center;
      padding: 20px;
    }
    
    .modal.show {
      display: flex;
    }
    
    .modal-content {
      background: var(--white);
      border-radius: 20px;
      width: 100%;
      max-width: 500px;
      max-height: 80vh;
      overflow-y: auto;
    }
    
    .modal-header {
      padding: 20px 24px;
      border-bottom: 1px solid var(--gray-100);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .modal-title {
      font-size: 18px;
      font-weight: 700;
    }
    
    .modal-close {
      width: 32px;
      height: 32px;
      border-radius: 8px;
      border: none;
      background: var(--gray-100);
      cursor: pointer;
      font-size: 18px;
    }
    
    .modal-body {
      padding: 24px;
    }
    
    .info-row {
      display: flex;
      justify-content: space-between;
      padding: 12px 0;
      border-bottom: 1px solid var(--gray-100);
    }
    
    .info-row:last-child {
      border-bottom: none;
    }
    
    .info-label {
      color: var(--gray-500);
      font-size: 14px;
    }
    
    .info-value {
      font-weight: 600;
      font-size: 14px;
    }
    
    /* ë¡œë”© */
    .loading {
      display: flex;
      justify-content: center;
      align-items: center;
      height: 400px;
    }
    
    .loading-spinner {
      width: 40px;
      height: 40px;
      border: 3px solid var(--gray-200);
      border-top-color: var(--primary);
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }
    
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
    
    /* ë°˜ì‘í˜• */
    @media (max-width: 768px) {
      .container {
        padding: 16px;
      }
      
      .header-inner {
        flex-direction: column;
        gap: 16px;
        text-align: center;
      }
      
      .stats-grid {
        grid-template-columns: repeat(2, 1fr);
      }
      
      .calendar-day {
        min-height: 70px;
        padding: 4px;
      }
      
      .day-number {
        font-size: 12px;
      }
      
      .deal-badge {
        font-size: 10px;
        padding: 2px 4px;
      }
      
      .deal-item {
        flex-direction: column;
        align-items: flex-start;
        gap: 12px;
      }
      
      .filter-tabs {
        justify-content: center;
      }
    }
    
    /* í‘¸í„° */
    .footer {
      text-align: center;
      padding: 40px 20px;
      color: var(--gray-500);
      font-size: 13px;
    }
  </style>
</head>
<body>
  <header class="header">
    <div class="header-inner">
      <div class="logo">
        <img src="logo-horizontal.png" alt="ëª¨ì—¬ë¼ë”œ" style="height: 32px;">
      </div>
      <div id="view-mode-badge" class="view-mode-badge">
        ğŸ“… ê³µêµ¬ ì¼ì •í‘œ
      </div>
    </div>
  </header>
  
  <div class="container">
    <div id="app">
      <div class="loading">
        <div class="loading-spinner"></div>
      </div>
    </div>
  </div>
  
  <footer class="footer">
    <p>Â© 2025 ëª¨ì—¬ë¼ë”œ. ë³¸ ì¼ì •í‘œëŠ” ì½ê¸° ì „ìš©ì…ë‹ˆë‹¤.</p>
  </footer>
  
  <div class="modal" id="modal"></div>

  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>

<script>
// Firebase ì„¤ì •
const firebaseConfig = {
  apiKey: "AIzaSyAQf_Cu9wMji5QsMBQns5eg6nOD_vmrZMs",
  authDomain: "moyeora-deal-manager.firebaseapp.com",
  projectId: "moyeora-deal-manager",
  storageBucket: "moyeora-deal-manager.firebasestorage.app",
  messagingSenderId: "527148187832",
  appId: "1:527148187832:web:dc35b0413a7157db34744d",
  measurementId: "G-XEGLCEG93R"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

// URL íŒŒë¼ë¯¸í„° íŒŒì‹±
const urlParams = new URLSearchParams(window.location.search);
const viewMode = urlParams.get('mode') || 'all'; // 'supplier', 'seller', 'all'
const filterId = urlParams.get('id') || ''; // íŠ¹ì • ê³µê¸‰ì‚¬/ì…€ëŸ¬ ID
const filterName = urlParams.get('name') || ''; // ê³µê¸‰ì‚¬/ì…€ëŸ¬ ì´ë¦„ (í‘œì‹œìš©)

// ìƒíƒœ ê´€ë¦¬
let state = {
  currentDate: new Date(),
  deals: [],
  suppliers: [],
  sellers: [],
  supplierProducts: [],
  loading: true,
  statusFilter: 'all' // 'all', 'negotiating', 'confirmed', 'ongoing', 'completed'
};

// ìƒìˆ˜
const STATUS = {
  negotiating: { label: 'í˜‘ì˜ì¤‘', class: 'status-negotiating' },
  confirmed: { label: 'í™•ì •', class: 'status-confirmed' },
  ongoing: { label: 'ì§„í–‰ì¤‘', class: 'status-ongoing' },
  completed: { label: 'ì™„ë£Œ', class: 'status-completed' }
};

const WEEKDAYS = ['ì¼', 'ì›”', 'í™”', 'ìˆ˜', 'ëª©', 'ê¸ˆ', 'í† '];

// ìœ í‹¸ë¦¬í‹°
const formatDate = (date) => {
  if (!date) return '';
  const d = date instanceof Date ? date : new Date(date);
  return `${d.getFullYear()}-${String(d.getMonth()+1).padStart(2,'0')}-${String(d.getDate()).padStart(2,'0')}`;
};

const getDaysInMonth = (year, month) => new Date(year, month + 1, 0).getDate();
const getFirstDayOfMonth = (year, month) => new Date(year, month, 1).getDay();

// Firebase ë¦¬ìŠ¤ë„ˆ
function setupListeners() {
  db.collection('deals').orderBy('startDate', 'desc').onSnapshot(snapshot => {
    state.deals = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
    render();
  });
  
  db.collection('suppliers').orderBy('name').onSnapshot(snapshot => {
    state.suppliers = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
    render();
  });
  
  db.collection('sellers').orderBy('name').onSnapshot(snapshot => {
    state.sellers = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
    state.loading = false;
    render();
  });
  
  db.collection('supplierProducts').orderBy('brandName').onSnapshot(snapshot => {
    state.supplierProducts = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
    render();
  });
}

// í•„í„°ë§ëœ ê³µêµ¬ ê°€ì ¸ì˜¤ê¸°
function getFilteredDeals() {
  let deals = state.deals;
  
  // ëª¨ë“œë³„ í•„í„°ë§
  if (viewMode === 'supplier' && filterId) {
    // supplierIdë¡œ ë§¤ì¹­í•˜ê±°ë‚˜, ê³µê¸‰ì‚¬ëª…(filterName)ìœ¼ë¡œ ë§¤ì¹­
    const supplierName = decodeURIComponent(filterName);
    deals = deals.filter(d => {
      if (d.supplierId === filterId) return true;
      // supplierIdë¡œ ê³µê¸‰ì‚¬ ì°¾ì•„ì„œ ì´ë¦„ ë¹„êµ
      const supplier = state.suppliers.find(s => s.id === d.supplierId);
      return supplier?.name === supplierName;
    });
  } else if (viewMode === 'seller' && filterId) {
    const sellerName = decodeURIComponent(filterName);
    deals = deals.filter(d => {
      if (d.sellerId === filterId) return true;
      const seller = state.sellers.find(s => s.id === d.sellerId);
      return seller?.name === sellerName;
    });
  }
  
  // ìƒíƒœë³„ í•„í„°ë§
  if (state.statusFilter !== 'all') {
    deals = deals.filter(d => d.status === state.statusFilter);
  }
  
  return deals;
}

// ë„¤ë¹„ê²Œì´ì…˜
function prevMonth() {
  state.currentDate = new Date(state.currentDate.getFullYear(), state.currentDate.getMonth() - 1, 1);
  render();
}

function nextMonth() {
  state.currentDate = new Date(state.currentDate.getFullYear(), state.currentDate.getMonth() + 1, 1);
  render();
}

function goToday() {
  state.currentDate = new Date();
  render();
}

function setStatusFilter(status) {
  state.statusFilter = status;
  render();
}

// ëª¨ë‹¬
function closeModal() {
  document.getElementById('modal').className = 'modal';
}

function openDealDetail(dealId) {
  const deal = state.deals.find(d => d.id === dealId);
  if (!deal) return;
  
  const supplier = state.suppliers.find(s => s.id === deal.supplierId);
  const seller = state.sellers.find(s => s.id === deal.sellerId);
  const statusInfo = STATUS[deal.status] || { label: deal.status, class: '' };
  
  // ê³µêµ¬ ê¸°ê°„ ê³„ì‚°
  const startDate = new Date(deal.startDate);
  const endDate = new Date(deal.endDate);
  const dealDays = Math.ceil((endDate - startDate) / (1000 * 60 * 60 * 24)) + 1;
  
  // ì„ íƒëœ ìƒí’ˆ ëª©ë¡
  const products = (deal.selectedProducts || [])
    .map(pid => state.supplierProducts.find(p => p.id === pid))
    .filter(Boolean);
  
  // ì…€ëŸ¬ëª…ì—ì„œ ì´ë¦„ë§Œ ì¶”ì¶œ (ì˜ˆ: "ì•ˆì¬ê²½/ì§„í•˜ë§˜(0.8ë§Œ)" -> "ì§„í•˜ë§˜(0.8ë§Œ)")
  const getSellerDisplayName = (name) => {
    if (!name) return '-';
    const parts = name.split('/');
    return parts.length > 1 ? parts[1] : name;
  };
  
  const m = document.getElementById('modal');
  m.className = 'modal show';
  
  // ê³µê¸‰ì‚¬ìš© í˜ì´ì§€: ì…€ëŸ¬ ìƒì„¸ ì •ë³´ í‘œì‹œ
  if (viewMode === 'supplier') {
    m.innerHTML = `
      <div class="modal-content">
        <div class="modal-header">
          <h2 class="modal-title">ğŸ“… ê³µêµ¬ ìƒì„¸</h2>
          <button class="modal-close" onclick="closeModal()">Ã—</button>
        </div>
        <div class="modal-body">
          <div style="text-align: center; margin-bottom: 20px;">
            <div style="font-size: 22px; font-weight: 700; margin-bottom: 8px;">${deal.title}</div>
            <span class="status-badge ${statusInfo.class}">${statusInfo.label}</span>
          </div>
          
          <div class="info-row">
            <span class="info-label">ğŸ“… ê³µêµ¬ ê¸°ê°„</span>
            <span class="info-value">${deal.startDate} ~ ${deal.endDate} (${dealDays}ì¼)</span>
          </div>
          
          <!-- ì…€ëŸ¬ ì •ë³´ (ê³µê¸‰ì‚¬ìš©) -->
          <div style="margin-top: 20px; padding: 16px; background: var(--primary-light); border-radius: 12px;">
            <div style="font-weight: 700; margin-bottom: 12px; color: var(--primary-dark);">ğŸ‘¤ ì…€ëŸ¬ ì •ë³´</div>
            
            <div class="info-row" style="border-color: rgba(252,150,0,0.2);">
              <span class="info-label">ì…€ëŸ¬ëª…</span>
              <span class="info-value">${getSellerDisplayName(seller?.name)}</span>
            </div>
            
            ${seller?.accountLink ? `
              <div class="info-row" style="border-color: rgba(252,150,0,0.2);">
                <span class="info-label">ê³„ì • ë§í¬</span>
                <span class="info-value">
                  <a href="${seller.accountLink.startsWith('http') ? seller.accountLink : 'https://' + seller.accountLink}" target="_blank" style="color: var(--info); text-decoration: none;">${seller.accountLink}</a>
                </span>
              </div>
            ` : ''}
            
            ${seller?.address ? `
              <div class="info-row" style="border-color: rgba(252,150,0,0.2);">
                <span class="info-label">ë°°ì†¡ ì£¼ì†Œ</span>
                <span class="info-value" style="font-size: 13px;">${seller.address}</span>
              </div>
            ` : ''}
            
            ${seller?.phone ? `
              <div class="info-row" style="border-color: rgba(252,150,0,0.2);">
                <span class="info-label">ì—°ë½ì²˜</span>
                <span class="info-value">${seller.phone}</span>
              </div>
            ` : ''}
          </div>
          
          ${products.length > 0 ? `
            <div style="margin-top: 20px;">
              <div style="font-weight: 600; margin-bottom: 12px;">ğŸ“¦ ê³µêµ¬ ì§„í–‰ ìƒí’ˆ</div>
              ${products.map(p => `
                <div style="padding: 12px; background: var(--gray-50); border-radius: 8px; margin-bottom: 8px;">
                  <div style="font-weight: 500;">${p.productName}</div>
                </div>
              `).join('')}
            </div>
          ` : ''}
          
          ${deal.notes ? `
            <div style="margin-top: 20px; padding: 16px; background: var(--info-light); border-radius: 12px;">
              <div style="font-weight: 600; margin-bottom: 8px; color: var(--info);">ğŸ“ ë©”ëª¨</div>
              <div style="font-size: 14px; color: var(--gray-700);">${deal.notes}</div>
            </div>
          ` : ''}
        </div>
      </div>
    `;
  } 
  // ì…€ëŸ¬ìš© í˜ì´ì§€: ê°„ë‹¨í•œ ì •ë³´ë§Œ
  else if (viewMode === 'seller') {
    m.innerHTML = `
      <div class="modal-content">
        <div class="modal-header">
          <h2 class="modal-title">ğŸ“… ë‚´ ê³µêµ¬ ìƒì„¸</h2>
          <button class="modal-close" onclick="closeModal()">Ã—</button>
        </div>
        <div class="modal-body">
          <div style="text-align: center; margin-bottom: 20px;">
            <div style="font-size: 22px; font-weight: 700; margin-bottom: 8px;">${deal.title}</div>
            <span class="status-badge ${statusInfo.class}">${statusInfo.label}</span>
          </div>
          
          <div class="info-row">
            <span class="info-label">ğŸ“… ê³µêµ¬ ê¸°ê°„</span>
            <span class="info-value">${deal.startDate} ~ ${deal.endDate} (${dealDays}ì¼)</span>
          </div>
          
          <div class="info-row">
            <span class="info-label">ğŸ­ ê³µê¸‰ì‚¬</span>
            <span class="info-value">${supplier?.name || '-'}</span>
          </div>
          
          ${products.length > 0 ? `
            <div style="margin-top: 20px;">
              <div style="font-weight: 600; margin-bottom: 12px;">ğŸ“¦ ê³µêµ¬ ìƒí’ˆ</div>
              ${products.map(p => `
                <div style="padding: 12px; background: var(--gray-50); border-radius: 8px; margin-bottom: 8px;">
                  <div style="font-weight: 500;">${p.productName}</div>
                </div>
              `).join('')}
            </div>
          ` : ''}
          
          ${deal.notes ? `
            <div style="margin-top: 20px; padding: 16px; background: var(--info-light); border-radius: 12px;">
              <div style="font-weight: 600; margin-bottom: 8px; color: var(--info);">ğŸ“ ë©”ëª¨</div>
              <div style="font-size: 14px; color: var(--gray-700);">${deal.notes}</div>
            </div>
          ` : ''}
        </div>
      </div>
    `;
  }
  // ì „ì²´ ë³´ê¸°
  else {
    m.innerHTML = `
      <div class="modal-content">
        <div class="modal-header">
          <h2 class="modal-title">ğŸ“… ê³µêµ¬ ìƒì„¸</h2>
          <button class="modal-close" onclick="closeModal()">Ã—</button>
        </div>
        <div class="modal-body">
          <div style="text-align: center; margin-bottom: 20px;">
            <div style="font-size: 22px; font-weight: 700; margin-bottom: 8px;">${deal.title}</div>
            <span class="status-badge ${statusInfo.class}">${statusInfo.label}</span>
          </div>
          
          <div class="info-row">
            <span class="info-label">ğŸ“… ê³µêµ¬ ê¸°ê°„</span>
            <span class="info-value">${deal.startDate} ~ ${deal.endDate} (${dealDays}ì¼)</span>
          </div>
          
          <div class="info-row">
            <span class="info-label">ğŸ­ ê³µê¸‰ì‚¬</span>
            <span class="info-value">${supplier?.name || '-'}</span>
          </div>
          
          <div class="info-row">
            <span class="info-label">ğŸ‘¤ ì…€ëŸ¬</span>
            <span class="info-value">${seller?.name || '-'}</span>
          </div>
          
          ${deal.notes ? `
            <div style="margin-top: 20px; padding: 16px; background: var(--info-light); border-radius: 12px;">
              <div style="font-weight: 600; margin-bottom: 8px; color: var(--info);">ğŸ“ ë©”ëª¨</div>
              <div style="font-size: 14px; color: var(--gray-700);">${deal.notes}</div>
            </div>
          ` : ''}
        </div>
      </div>
    `;
  }
}

// ë Œë”ë§
function render() {
  const app = document.getElementById('app');
  
  if (state.loading) {
    app.innerHTML = '<div class="loading"><div class="loading-spinner"></div></div>';
    return;
  }
  
  // ë·° ëª¨ë“œ ë°°ì§€ ì—…ë°ì´íŠ¸
  const badge = document.getElementById('view-mode-badge');
  if (viewMode === 'supplier' && filterName) {
    badge.innerHTML = `ğŸ­ ${decodeURIComponent(filterName)} ê³µê¸‰ì‚¬ ì¼ì •`;
    badge.style.background = 'var(--info-light)';
    badge.style.borderColor = 'var(--info)';
    badge.style.color = 'var(--info)';
  } else if (viewMode === 'seller' && filterName) {
    badge.innerHTML = `ğŸ‘¤ ${decodeURIComponent(filterName)} ì…€ëŸ¬ ì¼ì •`;
    badge.style.background = 'var(--primary-light)';
    badge.style.borderColor = 'var(--primary)';
    badge.style.color = 'var(--primary-dark)';
  } else {
    badge.innerHTML = 'ğŸ“… ì „ì²´ ê³µêµ¬ ì¼ì •í‘œ';
  }
  
  const year = state.currentDate.getFullYear();
  const month = state.currentDate.getMonth();
  const today = formatDate(new Date());
  
  const daysInMonth = getDaysInMonth(year, month);
  const firstDay = getFirstDayOfMonth(year, month);
  const prevMonthDays = getDaysInMonth(year, month - 1);
  
  const filteredDeals = getFilteredDeals();
  
  // í†µê³„
  const stats = {
    negotiating: filteredDeals.filter(d => d.status === 'negotiating').length,
    confirmed: filteredDeals.filter(d => d.status === 'confirmed').length,
    ongoing: filteredDeals.filter(d => d.status === 'ongoing').length,
    completed: filteredDeals.filter(d => d.status === 'completed').length
  };
  
  // ì´ë²ˆ ë‹¬ ê³µêµ¬ ëª©ë¡
  const monthDeals = filteredDeals.filter(d => {
    const start = new Date(d.startDate);
    const end = new Date(d.endDate);
    const monthStart = new Date(year, month, 1);
    const monthEnd = new Date(year, month + 1, 0);
    return start <= monthEnd && end >= monthStart;
  });
  
  // ìº˜ë¦°ë” ìƒì„±
  let calendarDays = '';
  
  // ì´ì „ ë‹¬
  for (let i = firstDay - 1; i >= 0; i--) {
    const day = prevMonthDays - i;
    calendarDays += `<div class="calendar-day other-month"><div class="day-number">${day}</div></div>`;
  }
  
  // ì´ë²ˆ ë‹¬
  for (let day = 1; day <= daysInMonth; day++) {
    const dateStr = formatDate(new Date(year, month, day));
    const dayOfWeek = new Date(year, month, day).getDay();
    const isToday = dateStr === today;
    const isSunday = dayOfWeek === 0;
    const isSaturday = dayOfWeek === 6;
    
    const dayDeals = filteredDeals.filter(d => dateStr >= d.startDate && dateStr <= d.endDate);
    
    let dealBadges = '';
    dayDeals.slice(0, 3).forEach(deal => {
      const isStart = dateStr === deal.startDate;
      const isSingle = deal.startDate === deal.endDate;
      
      // ê³µêµ¬ ê¸°ê°„ ê³„ì‚°
      const startDate = new Date(deal.startDate);
      const endDate = new Date(deal.endDate);
      const dealDays = Math.ceil((endDate - startDate) / (1000 * 60 * 60 * 24)) + 1;
      const daysText = dealDays > 1 ? `(${dealDays}ì¼)` : '';
      
      let badgeClass = 'deal-badge';
      if (viewMode === 'supplier') badgeClass += ' supplier';
      else if (viewMode === 'seller') badgeClass += ' seller';
      else badgeClass += ' both';
      
      const displayText = isStart || isSingle ? `${deal.title}${daysText}` : 'Â·';
      dealBadges += `<div class="${badgeClass}" onclick="openDealDetail('${deal.id}')" title="${deal.title} ${daysText}">${displayText}</div>`;
    });
    
    if (dayDeals.length > 3) {
      dealBadges += `<div style="font-size:11px;color:var(--gray-500);text-align:center">+${dayDeals.length - 3}</div>`;
    }
    
    calendarDays += `
      <div class="calendar-day ${isToday ? 'today' : ''} ${isSunday ? 'sunday' : ''} ${isSaturday ? 'saturday' : ''}">
        <div class="day-number">${day}</div>
        ${dealBadges}
      </div>
    `;
  }
  
  // ë‹¤ìŒ ë‹¬
  const totalCells = firstDay + daysInMonth;
  const remainingCells = 7 - (totalCells % 7);
  if (remainingCells < 7) {
    for (let i = 1; i <= remainingCells; i++) {
      calendarDays += `<div class="calendar-day other-month"><div class="day-number">${i}</div></div>`;
    }
  }
  
  app.innerHTML = `
    <!-- í†µê³„ -->
    <div class="stats-grid">
      <div class="stat-card ${state.statusFilter === 'negotiating' ? 'active' : ''}" onclick="setStatusFilter('negotiating')" style="cursor:pointer;">
        <div class="stat-number">${stats.negotiating}</div>
        <div class="stat-label">í˜‘ì˜ì¤‘</div>
      </div>
      <div class="stat-card ${state.statusFilter === 'confirmed' ? 'active' : ''}" onclick="setStatusFilter('confirmed')" style="cursor:pointer;">
        <div class="stat-number">${stats.confirmed}</div>
        <div class="stat-label">í™•ì •</div>
      </div>
      <div class="stat-card ${state.statusFilter === 'ongoing' ? 'active' : ''}" onclick="setStatusFilter('ongoing')" style="cursor:pointer;">
        <div class="stat-number">${stats.ongoing}</div>
        <div class="stat-label">ì§„í–‰ì¤‘</div>
      </div>
      <div class="stat-card ${state.statusFilter === 'completed' ? 'active' : ''}" onclick="setStatusFilter('completed')" style="cursor:pointer;">
        <div class="stat-number">${stats.completed}</div>
        <div class="stat-label">ì™„ë£Œ</div>
      </div>
    </div>
    
    <!-- í•„í„° íƒ­ -->
    <div class="filter-tabs">
      <div class="filter-tab ${state.statusFilter === 'all' ? 'active' : ''}" onclick="setStatusFilter('all')">ì „ì²´</div>
      <div class="filter-tab ${state.statusFilter === 'negotiating' ? 'active' : ''}" onclick="setStatusFilter('negotiating')">í˜‘ì˜ì¤‘</div>
      <div class="filter-tab ${state.statusFilter === 'confirmed' ? 'active' : ''}" onclick="setStatusFilter('confirmed')">í™•ì •</div>
      <div class="filter-tab ${state.statusFilter === 'ongoing' ? 'active' : ''}" onclick="setStatusFilter('ongoing')">ì§„í–‰ì¤‘</div>
      <div class="filter-tab ${state.statusFilter === 'completed' ? 'active' : ''}" onclick="setStatusFilter('completed')">ì™„ë£Œ</div>
    </div>
    
    <!-- ìº˜ë¦°ë” -->
    <div class="calendar-card">
      <div class="calendar-nav">
        <div class="nav-buttons">
          <button class="btn btn-secondary" onclick="prevMonth()">â—€</button>
          <button class="btn btn-secondary" onclick="goToday()">ì˜¤ëŠ˜</button>
          <button class="btn btn-secondary" onclick="nextMonth()">â–¶</button>
        </div>
        <h2 class="calendar-title">${year}ë…„ ${month + 1}ì›”</h2>
        <div style="width: 140px;"></div>
      </div>
      
      <div class="calendar-header">
        ${WEEKDAYS.map((w, i) => `<div class="calendar-header-day ${i === 0 ? 'sunday' : ''} ${i === 6 ? 'saturday' : ''}">${w}</div>`).join('')}
      </div>
      
      <div class="calendar-grid">
        ${calendarDays}
      </div>
    </div>
    
    <!-- ì´ë²ˆ ë‹¬ ê³µêµ¬ ëª©ë¡ -->
    ${monthDeals.length > 0 ? `
      <div class="deal-list">
        <h3 class="deal-list-title">ğŸ“‹ ${month + 1}ì›” ê³µêµ¬ ëª©ë¡ (${monthDeals.length}ê±´)</h3>
        ${monthDeals.map(deal => {
          const supplier = state.suppliers.find(s => s.id === deal.supplierId);
          const seller = state.sellers.find(s => s.id === deal.sellerId);
          const statusInfo = STATUS[deal.status] || { label: deal.status, class: '' };
          
          // ê¸°ê°„ ê³„ì‚°
          const startDate = new Date(deal.startDate);
          const endDate = new Date(deal.endDate);
          const dealDays = Math.ceil((endDate - startDate) / (1000 * 60 * 60 * 24)) + 1;
          
          // ì…€ëŸ¬ëª…ì—ì„œ ë‹‰ë„¤ì„ë§Œ ì¶”ì¶œ
          const getSellerDisplayName = (name) => {
            if (!name) return '-';
            const parts = name.split('/');
            return parts.length > 1 ? parts[1] : name;
          };
          
          return `
            <div class="deal-item" onclick="openDealDetail('${deal.id}')" style="cursor: pointer;">
              <div class="deal-info">
                <div class="deal-title">${deal.title} (${dealDays}ì¼)</div>
                <div class="deal-meta">
                  <span>ğŸ“… ${deal.startDate} ~ ${deal.endDate}</span>
                  ${viewMode === 'supplier' ? `<span>ğŸ‘¤ ${getSellerDisplayName(seller?.name)}</span>` : ''}
                  ${viewMode === 'seller' ? `<span>ğŸ­ ${supplier?.name || '-'}</span>` : ''}
                  ${viewMode === 'all' ? `<span>ğŸ­ ${supplier?.name || '-'}</span><span>ğŸ‘¤ ${seller?.name || '-'}</span>` : ''}
                </div>
              </div>
              <span class="status-badge ${statusInfo.class}">${statusInfo.label}</span>
            </div>
          `;
        }).join('')}
      </div>
    ` : ''}
  `;
}

// ì´ˆê¸°í™”
setupListeners();
</script>
</body>
</html>
